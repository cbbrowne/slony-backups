From anooj.n at directi.com  Tue Jan  4 00:31:38 2011
From: anooj.n at directi.com (Anooj Narvekar)
Date: Tue, 04 Jan 2011 14:01:38 +0530
Subject: [Slony1-general] Dropping table without going through Slony script
Message-ID: <4D22DAEA.2070903@directi.com>

Hey,

Recently, unknowingly, we dropped a table on the master db which was a 
part of Slony replication without it going through the Slony script. 
This table is however present on the mirror/replicated db. I read 
somewhere, and want to confirm if the following hack will work.

Dropped table name : foo
tab_id in sl_table : 20

* Create a new table named "foo" with the same schema as the original 
dropped table
* Add trigger on the master table with name "_mirror_logtrigger_20"(as 
created on other replicated tables)
* Update sl_table with the new oid.
* All done, now drop the table via the slop drop script?

Thanks for help in advance


--
Anooj Narvekar


From devrim at gunduz.org  Tue Jan  4 06:15:03 2011
From: devrim at gunduz.org (Devrim =?ISO-8859-1?Q?G=DCND=DCZ?=)
Date: Tue, 04 Jan 2011 16:15:03 +0200
Subject: [Slony1-general] How do we change IP of origin?
Message-ID: <1294150503.2981.44.camel@lenovo01-laptop03.gunduz.org>


We changed network topology in one of our clusters, and I need to renew
IP addresses in both origin and master.

How can I do that without restarting replication from scratch? In this
case, the data is small, and I can restart replication -- but still I
wonder whether there is a better way to do that or not.

Regards,

-- 
Devrim G?ND?Z
PostgreSQL Dan??man?/Consultant, Red Hat Certified Engineer
PostgreSQL RPM Repository: http://yum.pgrpms.org
Community: devrim~PostgreSQL.org, devrim.gunduz~linux.org.tr
http://www.gunduz.org  Twitter: http://twitter.com/devrimgunduz
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 198 bytes
Desc: This is a digitally signed message part
Url : http://lists.slony.info/pipermail/slony1-general/attachments/20110104/406ace09/attachment.pgp 

From ssinger at ca.afilias.info  Tue Jan  4 06:39:56 2011
From: ssinger at ca.afilias.info (Steve Singer)
Date: Tue, 04 Jan 2011 09:39:56 -0500
Subject: [Slony1-general] How do we change IP of origin?
In-Reply-To: <1294150503.2981.44.camel@lenovo01-laptop03.gunduz.org>
References: <1294150503.2981.44.camel@lenovo01-laptop03.gunduz.org>
Message-ID: <4D23313C.5000002@ca.afilias.info>

On 11-01-04 09:15 AM, Devrim G?ND?Z wrote:
>
> We changed network topology in one of our clusters, and I need to renew
> IP addresses in both origin and master.
>
> How can I do that without restarting replication from scratch? In this
> case, the data is small, and I can restart replication -- but still I
> wonder whether there is a better way to do that or not.
>

I think you can do this by

1) Issuing a series of STORE PATH commands to update all of your 
conninfo tables to have the new IP

2) Restart the slon daemons to have the new IP in the conninfo for the 
local node (update the command line or slon.conf to have the new I.P)

3) Update any admin conninfo lines in any slonik scripts/preambles you 
have lying around

Slony doesn't store the nodes IP as part of sl_node.


> Regards,
>
>
>
>
> _______________________________________________
> Slony1-general mailing list
> Slony1-general at lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general


From stephane.schildknecht at postgresql.fr  Tue Jan  4 06:46:01 2011
From: stephane.schildknecht at postgresql.fr (=?ISO-8859-15?Q?=22St=E9phane_A=2E_Schildknecht=22?=)
Date: Tue, 04 Jan 2011 15:46:01 +0100
Subject: [Slony1-general] How do we change IP of origin?
In-Reply-To: <4D23313C.5000002@ca.afilias.info>
References: <1294150503.2981.44.camel@lenovo01-laptop03.gunduz.org>
	<4D23313C.5000002@ca.afilias.info>
Message-ID: <4D2332A9.4090209@postgresql.fr>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Le 04/01/2011 15:39, Steve Singer a ?crit :
> On 11-01-04 09:15 AM, Devrim G?ND?Z wrote:
>>
>> We changed network topology in one of our clusters, and I need to renew
>> IP addresses in both origin and master.
>>
>> How can I do that without restarting replication from scratch? In this
>> case, the data is small, and I can restart replication -- but still I
>> wonder whether there is a better way to do that or not.
>>
> 
> I think you can do this by
> 
> 1) Issuing a series of STORE PATH commands to update all of your 
> conninfo tables to have the new IP
> 
> 2) Restart the slon daemons to have the new IP in the conninfo for the 
> local node (update the command line or slon.conf to have the new I.P)
> 
> 3) Update any admin conninfo lines in any slonik scripts/preambles you 
> have lying around
> 
> Slony doesn't store the nodes IP as part of sl_node.
> 
> 

Hi,

Having done such things recently, I can warn you to wait long enough to be sure
the event of modifying the path is correctly propagated.
It's not really long, though, but don't issue the store path and the restart in
the same breath.

Best regards,
- -- 
St?phane Schildknecht
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.10 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/

iEYEARECAAYFAk0jMqkACgkQA+REPKWGI0GC6ACgtn2nkzOPw75cAguY+rt/ICQ4
ZxUAoLBWoTYQuGSzsaymaTQW04xDZl5+
=oHeN
-----END PGP SIGNATURE-----

From sreddy at spark.net  Tue Jan  4 09:23:39 2011
From: sreddy at spark.net (sharadov)
Date: Tue, 4 Jan 2011 09:23:39 -0800 (PST)
Subject: [Slony1-general]  How do I go about restarting slony?
Message-ID: <30588795.post@talk.nabble.com>




One of the slaves is running behind on replication. It is recommended that
you restart slony when this happens. What are the steps one should take to
go about restarting it?

Thanks, Sharad

-- 
View this message in context: http://old.nabble.com/How-do-I-go-about-restarting-slony--tp30588795p30588795.html
Sent from the Slony-I -- General mailing list archive at Nabble.com.


From scott.marlowe at gmail.com  Tue Jan  4 10:28:14 2011
From: scott.marlowe at gmail.com (Scott Marlowe)
Date: Tue, 4 Jan 2011 11:28:14 -0700
Subject: [Slony1-general] How do I go about restarting slony?
In-Reply-To: <30588795.post@talk.nabble.com>
References: <30588795.post@talk.nabble.com>
Message-ID: <AANLkTina6a-YdStG+GZ5uY3+VC+5g9sdGzJfO56FhgMh@mail.gmail.com>

On Tue, Jan 4, 2011 at 10:23 AM, sharadov <sreddy at spark.net> wrote:
>
>
>
> One of the slaves is running behind on replication. It is recommended that
> you restart slony when this happens. What are the steps one should take to
> go about restarting it?

There's restarting the slon daemons, there's dropping a node and
recreating it, and there's dropping all replication and starting over.
 In that order.  How to stop and start slon daemons depends on how you
installed the slon daemons.  We used the slony tools to do it.  The
init script basically kill -9s all of the slon daemons to stop it, and
starts each with a script to start them.

After that, if the node can't catch up you may need to drop and
recreate the node.  Pretty simple really, read the reference docs on
drop node command to get started.

Then, there's tearing down all replication on all machines in the
cluster and starting over.  That's probably more involved than you
want or need really.

From sreddy at spark.net  Tue Jan  4 10:37:40 2011
From: sreddy at spark.net (sharadov)
Date: Tue, 4 Jan 2011 10:37:40 -0800 (PST)
Subject: [Slony1-general] How do I go about restarting slony?
In-Reply-To: <AANLkTina6a-YdStG+GZ5uY3+VC+5g9sdGzJfO56FhgMh@mail.gmail.com>
References: <30588795.post@talk.nabble.com>
	<AANLkTina6a-YdStG+GZ5uY3+VC+5g9sdGzJfO56FhgMh@mail.gmail.com>
Message-ID: <30589470.post@talk.nabble.com>



Thanks Scott.
What is the command to stop/start slony?
And commands to drop a node and recreate it.



Scott Marlowe-2 wrote:
> 
> On Tue, Jan 4, 2011 at 10:23 AM, sharadov <sreddy at spark.net> wrote:
>>
>>
>>
>> One of the slaves is running behind on replication. It is recommended
>> that
>> you restart slony when this happens. What are the steps one should take
>> to
>> go about restarting it?
> 
> There's restarting the slon daemons, there's dropping a node and
> recreating it, and there's dropping all replication and starting over.
>  In that order.  How to stop and start slon daemons depends on how you
> installed the slon daemons.  We used the slony tools to do it.  The
> init script basically kill -9s all of the slon daemons to stop it, and
> starts each with a script to start them.
> 
> After that, if the node can't catch up you may need to drop and
> recreate the node.  Pretty simple really, read the reference docs on
> drop node command to get started.
> 
> Then, there's tearing down all replication on all machines in the
> cluster and starting over.  That's probably more involved than you
> want or need really.
> _______________________________________________
> Slony1-general mailing list
> Slony1-general at lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
> 
> 

-- 
View this message in context: http://old.nabble.com/How-do-I-go-about-restarting-slony--tp30588795p30589470.html
Sent from the Slony-I -- General mailing list archive at Nabble.com.


From scott.marlowe at gmail.com  Tue Jan  4 10:48:18 2011
From: scott.marlowe at gmail.com (Scott Marlowe)
Date: Tue, 4 Jan 2011 11:48:18 -0700
Subject: [Slony1-general] How do I go about restarting slony?
In-Reply-To: <30589470.post@talk.nabble.com>
References: <30588795.post@talk.nabble.com>
	<AANLkTina6a-YdStG+GZ5uY3+VC+5g9sdGzJfO56FhgMh@mail.gmail.com>
	<30589470.post@talk.nabble.com>
Message-ID: <AANLkTinJXHUfAinDz6gHmF5pMMPv+ABa9qd5S9CuSy7G@mail.gmail.com>

On Tue, Jan 4, 2011 at 11:37 AM, sharadov <sreddy at spark.net> wrote:
>
>
> Thanks Scott.
> What is the command to stop/start slony?

Depends on your platform and how you installed it.  For my Ubuntu and
Centos boxen it's:

sudo /etc/init.d/slony stop
sudo /etc/init.d/slony start

> And commands to drop a node and recreate it.

You'll need to write some simple slonik scripts.  The one we use is
something like this:

------------------------------------------ drop_node2.slnk
---------------------------------

cluster name = slony_www;
 node 1 admin conninfo='host=db1 dbname=www user=slony port=5432';
 node 2 admin conninfo='host=db2 dbname=www user=slony port=5432';

try {
	drop node( id=2, event node=1);
  } on error {
        exit 1;
  }
  echo 'Dropped node 2';

-------------------------------------------------------------------------------------------------

And you'd run it like:

slonik < drop_node2.slnk

You really need to familiarize yourself with slony administration.  Look here:

http://www.slony.info/adminguide/slony1-1.2.22/doc/adminguide/index.html

Sadly, there aren't a lot of shortcuts for understanding how slony works.

From sreddy at spark.net  Tue Jan  4 10:54:32 2011
From: sreddy at spark.net (sharadov)
Date: Tue, 4 Jan 2011 10:54:32 -0800 (PST)
Subject: [Slony1-general] How do I go about restarting slony?
In-Reply-To: <AANLkTinJXHUfAinDz6gHmF5pMMPv+ABa9qd5S9CuSy7G@mail.gmail.com>
References: <30588795.post@talk.nabble.com>
	<AANLkTina6a-YdStG+GZ5uY3+VC+5g9sdGzJfO56FhgMh@mail.gmail.com>
	<30589470.post@talk.nabble.com>
	<AANLkTinJXHUfAinDz6gHmF5pMMPv+ABa9qd5S9CuSy7G@mail.gmail.com>
Message-ID: <30589596.post@talk.nabble.com>


Thanks for the help Scott.
This should get me started.



Scott Marlowe-2 wrote:
> 
> On Tue, Jan 4, 2011 at 11:37 AM, sharadov <sreddy at spark.net> wrote:
>>
>>
>> Thanks Scott.
>> What is the command to stop/start slony?
> 
> Depends on your platform and how you installed it.  For my Ubuntu and
> Centos boxen it's:
> 
> sudo /etc/init.d/slony stop
> sudo /etc/init.d/slony start
> 
>> And commands to drop a node and recreate it.
> 
> You'll need to write some simple slonik scripts.  The one we use is
> something like this:
> 
> ------------------------------------------ drop_node2.slnk
> ---------------------------------
> 
> cluster name = slony_www;
>  node 1 admin conninfo='host=db1 dbname=www user=slony port=5432';
>  node 2 admin conninfo='host=db2 dbname=www user=slony port=5432';
> 
> try {
> 	drop node( id=2, event node=1);
>   } on error {
>         exit 1;
>   }
>   echo 'Dropped node 2';
> 
> -------------------------------------------------------------------------------------------------
> 
> And you'd run it like:
> 
> slonik < drop_node2.slnk
> 
> You really need to familiarize yourself with slony administration.  Look
> here:
> 
> http://www.slony.info/adminguide/slony1-1.2.22/doc/adminguide/index.html
> 
> Sadly, there aren't a lot of shortcuts for understanding how slony works.
> _______________________________________________
> Slony1-general mailing list
> Slony1-general at lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
> 
> 

-- 
View this message in context: http://old.nabble.com/How-do-I-go-about-restarting-slony--tp30588795p30589596.html
Sent from the Slony-I -- General mailing list archive at Nabble.com.


From ssinger at ca.afilias.info  Tue Jan  4 13:43:58 2011
From: ssinger at ca.afilias.info (Steve Singer)
Date: Tue, 04 Jan 2011 16:43:58 -0500
Subject: [Slony1-general] ERROR: duplicate key value violates
 unique	constraint "sl_nodelock-pkey" error - bugzilla # 132
In-Reply-To: <20101229210353.1D460290D29@main.slony.info>
References: <20101229210353.1D460290D29@main.slony.info>
Message-ID: <4D23949E.6050205@ca.afilias.info>

On 10-12-29 04:03 PM, Mark Steben wrote:
> Hi ? I?ve been running slony 2.0.4 in test for a few weeks now.
>
> Just last week we physically moved the machine that houses the master db
>
> To a server block that the slave also resides on. We changed the i/p and
> also
>
> Began running with pgpool (port 9999) as the administrator.
>
> It was then that we began throwing the above error. No matter how many times
>
> I?ve cleared out sl_nodelock and restarted slon I still get the same
> error on
>
> The master postgres log. Reading through the slony docs and entering
> bugzilla
>
> For the first time, I come to realize this is a bug that has been fixed.
>
> I?m not a systems administrator so, while I do database upgrades, I?m
> not as familiar
>
> With applying patches on existing software and I?m totally new to
> bugzilla. Need some
>
> Guidance. Do I:
>
> 1. Upgrade to 2.0.5?
>
> 2. apply a patch? If so where do I find it?
>

If bug 132 is your issue (bug 132 seems to refer to issues with slon 
choking on it's own nodelock while restarting itself, and I don't see 
enough in your problem description to say for sure if this your problem) 
then your best upgrading to 2.0.5 or 2.0.6

The final fix for 132 was committed in a few different commits so there 
isn't a single patch + it is better to be running an official release vs 
a patched version.



> Thanks for your time,
>
> Mark Steben| Database Administrator
> @utoRevenue_? <http://www.autorevenue.com> /- "Keeping Customers Close"/
> 95D Ashley Ave, West Springfield, MA 01089
> 413.243.4800 x1512 (Phone) |413.732-1824 (Fax)
> @utoRevenue is a registered trademark and a division of Dominion
> Enterprises <http://www.dominionenterprises.com>
> ****
>
>
>
> _______________________________________________
> Slony1-general mailing list
> Slony1-general at lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general


From rod at iol.ie  Wed Jan  5 10:04:24 2011
From: rod at iol.ie (Raymond O'Donnell)
Date: Wed, 05 Jan 2011 18:04:24 +0000
Subject: [Slony1-general] 2.0.6 -> 2.0.4?
Message-ID: <4D24B2A8.8030101@iol.ie>

Hi all, a quick question - can Slony-1 2.0.6 on Linux replicate to 2.0.4 
on Windows?

Thanks,

Ray.


-- 
Raymond O'Donnell :: Galway :: Ireland
rod at iol.ie

From scott.marlowe at gmail.com  Wed Jan  5 10:20:16 2011
From: scott.marlowe at gmail.com (Scott Marlowe)
Date: Wed, 5 Jan 2011 11:20:16 -0700
Subject: [Slony1-general] 2.0.6 -> 2.0.4?
In-Reply-To: <4D24B2A8.8030101@iol.ie>
References: <4D24B2A8.8030101@iol.ie>
Message-ID: <AANLkTimGzb=6i=FrgDv9z6LZUGiGGpQNfw6ZPqkxhnpV@mail.gmail.com>

No, all the slony versions need to match.

On Wed, Jan 5, 2011 at 11:04 AM, Raymond O'Donnell <rod at iol.ie> wrote:
> Hi all, a quick question - can Slony-1 2.0.6 on Linux replicate to 2.0.4
> on Windows?
>
> Thanks,
>
> Ray.
>
>
> --
> Raymond O'Donnell :: Galway :: Ireland
> rod at iol.ie
> _______________________________________________
> Slony1-general mailing list
> Slony1-general at lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
>



-- 
To understand recursion, one must first understand recursion.

From peter.geoghegan86 at gmail.com  Wed Jan  5 10:20:39 2011
From: peter.geoghegan86 at gmail.com (Peter Geoghegan)
Date: Wed, 5 Jan 2011 18:20:39 +0000
Subject: [Slony1-general] 2.0.6 -> 2.0.4?
In-Reply-To: <4D24B2A8.8030101@iol.ie>
References: <4D24B2A8.8030101@iol.ie>
Message-ID: <AANLkTikh_49f78hu88wKDhj_9qcfwM6fR+s8D0jM=3m3@mail.gmail.com>

Hi Ray,

On 5 January 2011 18:04, Raymond O'Donnell <rod at iol.ie> wrote:
> Hi all, a quick question - can Slony-1 2.0.6 on Linux replicate to 2.0.4
> on Windows?

No, it cannot. Slony versions must always be identical. There's
probably no good reason to not use 2.0.4 everywhere to save yourself
the trouble that comes with building Slony on windows (you need to use
mingw). The bugs fixed in 2.0.5 and 2.0.6 are pretty unlikely to
affect you.

-- 
Regards,
Peter Geoghegan

From rod at iol.ie  Wed Jan  5 10:25:56 2011
From: rod at iol.ie (Raymond O'Donnell)
Date: Wed, 05 Jan 2011 18:25:56 +0000
Subject: [Slony1-general] 2.0.6 -> 2.0.4?
In-Reply-To: <AANLkTikh_49f78hu88wKDhj_9qcfwM6fR+s8D0jM=3m3@mail.gmail.com>
References: <4D24B2A8.8030101@iol.ie>
	<AANLkTikh_49f78hu88wKDhj_9qcfwM6fR+s8D0jM=3m3@mail.gmail.com>
Message-ID: <4D24B7B4.2080601@iol.ie>

On 05/01/2011 18:20, Peter Geoghegan wrote:
> Hi Ray,
>
> On 5 January 2011 18:04, Raymond O'Donnell<rod at iol.ie>  wrote:
>> Hi all, a quick question - can Slony-1 2.0.6 on Linux replicate to 2.0.4
>> on Windows?
>
> No, it cannot. Slony versions must always be identical. There's
> probably no good reason to not use 2.0.4 everywhere to save yourself
> the trouble that comes with building Slony on windows (you need to use
> mingw). The bugs fixed in 2.0.5 and 2.0.6 are pretty unlikely to
> affect you.

OK, fair enough - thanks Peter & Scott. I have 2.0.4 via Stackbuilder on 
Windows, and I compiled 2.0.6 on Linux. I'll go back and grab 2.0.4 on 
Linux and compile that instead.

Ray.

-- 
Raymond O'Donnell :: Galway :: Ireland
rod at iol.ie

From cbbrowne at ca.afilias.info  Wed Jan  5 10:29:42 2011
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Wed, 05 Jan 2011 13:29:42 -0500
Subject: [Slony1-general] 2.0.6 -> 2.0.4?
In-Reply-To: <4D24B2A8.8030101@iol.ie> (Raymond O'Donnell's message of "Wed,
	05 Jan 2011 18:04:24 +0000")
References: <4D24B2A8.8030101@iol.ie>
Message-ID: <87pqsbcig9.fsf@cbbrowne.afilias-int.info>

Raymond O'Donnell <rod at iol.ie> writes:
> Hi all, a quick question - can Slony-1 2.0.6 on Linux replicate to 2.0.4 
> on Windows?

No.  All nodes in a cluster must either be running 2.0.4 or 2.0.6 - you
can't mix versions.

Slon processes check that they are connecting to the identical version
of Slony on each node, and will indicate a fatal error if there is a
mismatch.
-- 
(reverse (concatenate 'string "ofni.sailifa" "@" "enworbbc"))
Christopher Browne
"Bother,"  said Pooh,  "Eeyore, ready  two photon  torpedoes  and lock
phasers on the Heffalump, Piglet, meet me in transporter room three"

From cbbrowne at ca.afilias.info  Wed Jan  5 10:39:09 2011
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Wed, 05 Jan 2011 13:39:09 -0500
Subject: [Slony1-general] 2.0.6 -> 2.0.4?
In-Reply-To: <4D24B7B4.2080601@iol.ie> (Raymond O'Donnell's message of "Wed,
	05 Jan 2011 18:25:56 +0000")
References: <4D24B2A8.8030101@iol.ie>
	<AANLkTikh_49f78hu88wKDhj_9qcfwM6fR+s8D0jM=3m3@mail.gmail.com>
	<4D24B7B4.2080601@iol.ie>
Message-ID: <87lj2zci0i.fsf@cbbrowne.afilias-int.info>

Raymond O'Donnell <rod at iol.ie> writes:
> On 05/01/2011 18:20, Peter Geoghegan wrote:
>> Hi Ray,
>>
>> On 5 January 2011 18:04, Raymond O'Donnell<rod at iol.ie>  wrote:
>>> Hi all, a quick question - can Slony-1 2.0.6 on Linux replicate to 2.0.4
>>> on Windows?
>>
>> No, it cannot. Slony versions must always be identical. There's
>> probably no good reason to not use 2.0.4 everywhere to save yourself
>> the trouble that comes with building Slony on windows (you need to use
>> mingw). The bugs fixed in 2.0.5 and 2.0.6 are pretty unlikely to
>> affect you.
>
> OK, fair enough - thanks Peter & Scott. I have 2.0.4 via Stackbuilder on 
> Windows, and I compiled 2.0.6 on Linux. I'll go back and grab 2.0.4 on 
> Linux and compile that instead.

I wouldn't think that a terribly wise wise.

Version 2.0.5 fixed a LARGE number of problems from earlier versions,
and you would lose them all by falling back to 2.0.4.

I suggest you review the release notes:
  <http://git.postgresql.org/gitweb?p=slony1-engine.git;a=blob;f=RELEASE;h=edd1bc425167ecfb51c8fbbe0fe24e6127fe27b4;hb=refs/heads/REL_2_0_STABLE>
-- 
select 'cbbrowne' || '@' || 'afilias.info';
Christopher Browne
"Bother,"  said Pooh,  "Eeyore, ready  two photon  torpedoes  and lock
phasers on the Heffalump, Piglet, meet me in transporter room three"

From rod at iol.ie  Wed Jan  5 10:48:42 2011
From: rod at iol.ie (Raymond O'Donnell)
Date: Wed, 05 Jan 2011 18:48:42 +0000
Subject: [Slony1-general] 2.0.6 -> 2.0.4?
In-Reply-To: <87lj2zci0i.fsf@cbbrowne.afilias-int.info>
References: <4D24B2A8.8030101@iol.ie>	<AANLkTikh_49f78hu88wKDhj_9qcfwM6fR+s8D0jM=3m3@mail.gmail.com>	<4D24B7B4.2080601@iol.ie>
	<87lj2zci0i.fsf@cbbrowne.afilias-int.info>
Message-ID: <4D24BD0A.5010900@iol.ie>

On 05/01/2011 18:39, Christopher Browne wrote:

> I wouldn't think that a terribly wise wise.
>
> Version 2.0.5 fixed a LARGE number of problems from earlier versions,
> and you would lose them all by falling back to 2.0.4.

I'd prefer to run 2.0.6 in any case, but 2.0.4 is what's available via 
StackBuilder on Windows.... unless there are Windows binaries available 
elsewhere?

Ray.

-- 
Raymond O'Donnell :: Galway :: Ireland
rod at iol.ie

From peter.geoghegan86 at gmail.com  Wed Jan  5 10:53:54 2011
From: peter.geoghegan86 at gmail.com (Peter Geoghegan)
Date: Wed, 5 Jan 2011 18:53:54 +0000
Subject: [Slony1-general] 2.0.6 -> 2.0.4?
In-Reply-To: <4D24BD0A.5010900@iol.ie>
References: <4D24B2A8.8030101@iol.ie>
	<AANLkTikh_49f78hu88wKDhj_9qcfwM6fR+s8D0jM=3m3@mail.gmail.com>
	<4D24B7B4.2080601@iol.ie>
	<87lj2zci0i.fsf@cbbrowne.afilias-int.info>
	<4D24BD0A.5010900@iol.ie>
Message-ID: <AANLkTiniBADEMjvn4TqjUf_94wYkNYa_6c554Wmbgg1u@mail.gmail.com>

On 5 January 2011 18:48, Raymond O'Donnell <rod at iol.ie> wrote:
> I'd prefer to run 2.0.6 in any case, but 2.0.4 is what's available via
> StackBuilder on Windows.... unless there are Windows binaries available
> elsewhere?

No. Hiroshi Saito used to distribute his own binaries that were
available a little bit before EDB's, but he doesn't anymore. EDB QA
their Slony binaries, so I suppose Hiroshi concluded that it was a
redundant effort.

-- 
Regards,
Peter Geoghegan

From rod at iol.ie  Wed Jan  5 11:59:41 2011
From: rod at iol.ie (Raymond O'Donnell)
Date: Wed, 05 Jan 2011 19:59:41 +0000
Subject: [Slony1-general] 2.0.6 -> 2.0.4?
In-Reply-To: <AANLkTiniBADEMjvn4TqjUf_94wYkNYa_6c554Wmbgg1u@mail.gmail.com>
References: <4D24B2A8.8030101@iol.ie>	<AANLkTikh_49f78hu88wKDhj_9qcfwM6fR+s8D0jM=3m3@mail.gmail.com>	<4D24B7B4.2080601@iol.ie>	<87lj2zci0i.fsf@cbbrowne.afilias-int.info>	<4D24BD0A.5010900@iol.ie>
	<AANLkTiniBADEMjvn4TqjUf_94wYkNYa_6c554Wmbgg1u@mail.gmail.com>
Message-ID: <4D24CDAD.8020406@iol.ie>

On 05/01/2011 18:53, Peter Geoghegan wrote:
> On 5 January 2011 18:48, Raymond O'Donnell<rod at iol.ie>  wrote:
>> I'd prefer to run 2.0.6 in any case, but 2.0.4 is what's available via
>> StackBuilder on Windows.... unless there are Windows binaries available
>> elsewhere?
>
> No. Hiroshi Saito used to distribute his own binaries that were
> available a little bit before EDB's, but he doesn't anymore. EDB QA
> their Slony binaries, so I suppose Hiroshi concluded that it was a
> redundant effort.

Ok. Looks like I'm stuck with 2.0.4 for the moment so.

Thanks for the help!

Ray.

-- 
Raymond O'Donnell :: Galway :: Ireland
rod at iol.ie

From rod at iol.ie  Wed Jan  5 14:07:55 2011
From: rod at iol.ie (Raymond O'Donnell)
Date: Wed, 05 Jan 2011 22:07:55 +0000
Subject: [Slony1-general] Error?
Message-ID: <4D24EBBB.6030208@iol.ie>

Hi all,

I'm playing with Slony 2.0.4 on my Windows 7 laptop, trying to replicate 
a toy database. I've been using the Slonik scripts in the docs as a 
model. When I execute the script to start replication (see below), I get 
the following message:

c:\test-slony>slonik start.slonik
start.slonik:27: NOTICE:  subscribe set: omit_copy=f
start.slonik:27: NOTICE:  subscribe set: omit_copy=f
CONTEXT:  SQL statement "SELECT  "_test_cluster".subscribeSet_int( $1 , 
$2 ,  $3 ,  $4 ,  $5 )"
PL/pgSQL function "subscribeset" line 68 at PERFORM


I don't know if this is an error or not, but data seems to be getting 
replicated from the master to the slave database. Here's the script - 
line 27 is the "subscribe set" command:


#----------------------------

include <incl.slonik>;


# Define which namespace the replication system uses.
cluster name = @cluster;


# Tell slonik how to reach the databases.
node @master_node admin conninfo = @master_conninfo;
node @slave_node  admin conninfo = @slave_conninfo;


# Node 2 (slave) subscribes to set 1
subscribe set (id = 1, provider = @master_node, receiver = @slave_node, 
forward = no);

#----------------------------

I can post the include file and the configuration script also if necessary.

Thanks in advance,

Ray.


-- 
Raymond O'Donnell :: Galway :: Ireland
rod at iol.ie

From ssinger at ca.afilias.info  Wed Jan  5 14:13:15 2011
From: ssinger at ca.afilias.info (Steve Singer)
Date: Wed, 05 Jan 2011 17:13:15 -0500
Subject: [Slony1-general] Error?
In-Reply-To: <4D24EBBB.6030208@iol.ie>
References: <4D24EBBB.6030208@iol.ie>
Message-ID: <4D24ECFB.6030608@ca.afilias.info>

On 11-01-05 05:07 PM, Raymond O'Donnell wrote:
> Hi all,
>
> I'm playing with Slony 2.0.4 on my Windows 7 laptop, trying to replicate
> a toy database. I've been using the Slonik scripts in the docs as a
> model. When I execute the script to start replication (see below), I get
> the following message:
>
> c:\test-slony>slonik start.slonik
> start.slonik:27: NOTICE:  subscribe set: omit_copy=f
> start.slonik:27: NOTICE:  subscribe set: omit_copy=f
> CONTEXT:  SQL statement "SELECT  "_test_cluster".subscribeSet_int( $1 ,
> $2 ,  $3 ,  $4 ,  $5 )"
> PL/pgSQL function "subscribeset" line 68 at PERFORM
>
>
> I don't know if this is an error or not, but data seems to be getting
> replicated from the master to the slave database. Here's the script -
> line 27 is the "subscribe set" command:
>

That is not an error.
It is normal output for slony


>
> #----------------------------
>
> include<incl.slonik>;
>
>
> # Define which namespace the replication system uses.
> cluster name = @cluster;
>
>
> # Tell slonik how to reach the databases.
> node @master_node admin conninfo = @master_conninfo;
> node @slave_node  admin conninfo = @slave_conninfo;
>
>
> # Node 2 (slave) subscribes to set 1
> subscribe set (id = 1, provider = @master_node, receiver = @slave_node,
> forward = no);
>
> #----------------------------
>
> I can post the include file and the configuration script also if necessary.
>
> Thanks in advance,
>
> Ray.
>
>


From rod at iol.ie  Wed Jan  5 14:25:47 2011
From: rod at iol.ie (Raymond O'Donnell)
Date: Wed, 05 Jan 2011 22:25:47 +0000
Subject: [Slony1-general] Error?
In-Reply-To: <4D24ECFB.6030608@ca.afilias.info>
References: <4D24EBBB.6030208@iol.ie> <4D24ECFB.6030608@ca.afilias.info>
Message-ID: <4D24EFEB.705@iol.ie>

On 05/01/2011 22:13, Steve Singer wrote:
> On 11-01-05 05:07 PM, Raymond O'Donnell wrote:
>> Hi all,
>>
>> I'm playing with Slony 2.0.4 on my Windows 7 laptop, trying to replicate
>> a toy database. I've been using the Slonik scripts in the docs as a
>> model. When I execute the script to start replication (see below), I get
>> the following message:
>>
>> c:\test-slony>slonik start.slonik
>> start.slonik:27: NOTICE: subscribe set: omit_copy=f
>> start.slonik:27: NOTICE: subscribe set: omit_copy=f
>> CONTEXT: SQL statement "SELECT "_test_cluster".subscribeSet_int( $1 ,
>> $2 , $3 , $4 , $5 )"
>> PL/pgSQL function "subscribeset" line 68 at PERFORM
>>
>>
>> I don't know if this is an error or not, but data seems to be getting
>> replicated from the master to the slave database. Here's the script -
>> line 27 is the "subscribe set" command:
>>
>
> That is not an error.
> It is normal output for slony

Ok, grand - thanks for confirming.

Ray.


-- 
Raymond O'Donnell :: Galway :: Ireland
rod at iol.ie

From cbbrowne at ca.afilias.info  Wed Jan  5 14:36:41 2011
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Wed, 05 Jan 2011 17:36:41 -0500
Subject: [Slony1-general] Error?
In-Reply-To: <4D24EBBB.6030208@iol.ie> (Raymond O'Donnell's message of "Wed,
	05 Jan 2011 22:07:55 +0000")
References: <4D24EBBB.6030208@iol.ie>
Message-ID: <87d3obc70m.fsf@cbbrowne.afilias-int.info>

Raymond O'Donnell <rod at iol.ie> writes:
> Hi all,
>
> I'm playing with Slony 2.0.4 on my Windows 7 laptop, trying to replicate 
> a toy database. I've been using the Slonik scripts in the docs as a 
> model. When I execute the script to start replication (see below), I get 
> the following message:
>
> c:\test-slony>slonik start.slonik
> start.slonik:27: NOTICE:  subscribe set: omit_copy=f
> start.slonik:27: NOTICE:  subscribe set: omit_copy=f
> CONTEXT:  SQL statement "SELECT  "_test_cluster".subscribeSet_int( $1 , 
> $2 ,  $3 ,  $4 ,  $5 )"
> PL/pgSQL function "subscribeset" line 68 at PERFORM
>
>
> I don't know if this is an error or not, but data seems to be getting 
> replicated from the master to the slave database. Here's the script - 
> line 27 is the "subscribe set" command:

It's not an error; it's debugging output that I had in the code when
working on the "OMIT COPY" feature.

Because people have gotten confused about this, I removed it from the
2.0 branch:
   http://git.postgresql.org/gitweb?p=slony1-engine.git;a=commit;h=f6deeb815d2739100bebd6a709b79b641a481387

You may safely ignore these NOTICE statements.  Once version 2.0.7 is
released, these debugging statements will not get generated anymore.
-- 
(format nil "~S@~S" "cbbrowne" "ca.afilias.info")
Christopher Browne
"Bother,"  said Pooh,  "Eeyore, ready  two photon  torpedoes  and lock
phasers on the Heffalump, Piglet, meet me in transporter room three"

From cbbrowne at ca.afilias.info  Thu Jan 13 13:13:21 2011
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Thu, 13 Jan 2011 16:13:21 -0500
Subject: [Slony1-general] Suggestions for enhancement 173 - SLONY ABORT
Message-ID: <87sjwweccu.fsf@cbbrowne.afilias-int.info>

Bug #173 is about the notion of extending Slonik to allow one to
ask a Slonik script to error out upon running into particular
conditions.

These "ABORT" statements could be used to guard a script; if it runs
into unacceptable pre-conditions, it may terminate before it does any
damage to the cluster.

I suggest the following, as starting points:

- Behind by...
   - >= 5 events
   - >= 30 seconds

  ABORT IF BEHIND ( PROVIDER = 1, RECEIVER = 3, SECONDS = 30, comment = 'Behind by 30 seconds', return=1);
  ABORT IF BEHIND ( PROVIDER = 1, RECEIVER = 3, EVENT = 5, comment= 'Behind by 5 events', return=2);

Other Health Criteria
- Is node there?
- Is replication set there?
- Is subscription active?
- Run SQL, fail if ERROR

  ABORT IF NODE ABSENT ( EVENT NODE = 1, ID = 3, comment = 'Node 3 missing according to node 1',return=3);
  ABORT IF SET ABSENT ( EVENT NODE = 1, ID = 3, comment = 'Set 3 missing according to node 1',return=4);
  ABORT IF SET NOT SUBSCRIBED ( EVENT NODE = 1, ID = 3, comment = 'Set 3 not subscribed by node 1', return=5 );
  ABORT IF SCRIPT ERROR ( EVENT NODE = 1, script = '/tmp/myscript.sql',return=6 );

-- 
http://linuxfinances.info/info/slony.html
"If you want to travel around the world and be invited to speak at a
lot of different places, just write a Unix operating system."
-- Linus Torvalds

From vivek at khera.org  Fri Jan 14 08:41:33 2011
From: vivek at khera.org (Vick Khera)
Date: Fri, 14 Jan 2011 11:41:33 -0500
Subject: [Slony1-general] Suggestions for enhancement 173 - SLONY ABORT
In-Reply-To: <87sjwweccu.fsf@cbbrowne.afilias-int.info>
References: <87sjwweccu.fsf@cbbrowne.afilias-int.info>
Message-ID: <AANLkTinraoyt49OKCQK-V7PGyFvNFo5nw2YNv=Jo1x1y@mail.gmail.com>

On Thu, Jan 13, 2011 at 4:13 PM, Christopher Browne
<cbbrowne at ca.afilias.info> wrote:
> Behind by...
> ? - >= 5 events
> ? - >= 30 seconds
>

I like these two.


> Other Health Criteria
> - Is node there?
> - Is replication set there?
> - Is subscription active?
> - Run SQL, fail if ERROR

Doesn't "missing node" or "missing set" generally cause total abort
already?  Hmm. I guess it could be later in the script after stuff is
already done.

I worry aboutt "run SQL".  there would probably need to be some
foot-gun avoidance instructions of stuff not to do.  Perhaps it can
only be a SELECT (and your fault if you call a function with side
effects).

From cbbrowne at ca.afilias.info  Fri Jan 14 08:57:00 2011
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Fri, 14 Jan 2011 11:57:00 -0500
Subject: [Slony1-general] Suggestions for enhancement 173 - SLONY ABORT
In-Reply-To: <AANLkTinraoyt49OKCQK-V7PGyFvNFo5nw2YNv=Jo1x1y@mail.gmail.com>
	(Vick Khera's message of "Fri, 14 Jan 2011 11:41:33 -0500")
References: <87sjwweccu.fsf@cbbrowne.afilias-int.info>
	<AANLkTinraoyt49OKCQK-V7PGyFvNFo5nw2YNv=Jo1x1y@mail.gmail.com>
Message-ID: <87fwsve84j.fsf@cbbrowne.afilias-int.info>

Vick Khera <vivek at khera.org> writes:
> On Thu, Jan 13, 2011 at 4:13 PM, Christopher Browne
> <cbbrowne at ca.afilias.info> wrote:
>> Behind by...
>> ? - >= 5 events
>> ? - >= 30 seconds
>>
>
> I like these two.
>
>
>> Other Health Criteria
>> - Is node there?
>> - Is replication set there?
>> - Is subscription active?
>> - Run SQL, fail if ERROR
>
> Doesn't "missing node" or "missing set" generally cause total abort
> already?  Hmm. I guess it could be later in the script after stuff is
> already done.

Well, this feature is rather like a C assert() statement.  I'd think a
good way to use this is to have a script start by declaring what it
needs as cluster configuration; if any of those conditions fail to be
true, it fails without attempting to do any work.

> I worry aboutt "run SQL".  there would probably need to be some
> foot-gun avoidance instructions of stuff not to do.  Perhaps it can
> only be a SELECT (and your fault if you call a function with side
> effects).

I'd be inclined to run the SQL within a read-only transaction, which
would prevent any such shenanigans.
-- 
(reverse (concatenate 'string "ofni.sailifa" "@" "enworbbc"))
Christopher Browne
"Bother,"  said Pooh,  "Eeyore, ready  two photon  torpedoes  and lock
phasers on the Heffalump, Piglet, meet me in transporter room three"

From blittlejohn at posportal.com  Fri Jan 14 11:08:17 2011
From: blittlejohn at posportal.com (Brad Littlejohn)
Date: Fri, 14 Jan 2011 11:08:17 -0800
Subject: [Slony1-general] Changing IP address of Slave database
Message-ID: <FC2125863502344C9B615565CF826F7C0121911AE2@posexch1.posportal.com>


            Hi all.

            After doing a bit of googling on changing the IP address of the master and slave database servers being replicated by Slony, I'm still a bit confused on how to change the address. To give some background, I have 2 servers running PostgreSQL 8.4, and replication works fine between the database on each server. These are currently connected via crossover cable, just for the initial seed of the database (it's roughly 300GB in size).

            The slave database is going to be moved to a DR location, and kept up to date real time with Slony; however, the IP address of the master and slave servers are going to change. I currently have the following set up to set up to do the initial seed:


CLUSTER=my_cluster
DB1=trans
DB2=trans
H1=10.0.1.1
H2=10.0.1.2
U=postgres

slonik << _EOF_

cluster name = $CLUSTER;

node 1 admin conninfo = 'dbname=$DB1 host=$H1 user=$U';
node 2 admin conninfo = 'dbname=$DB2 host=$H2 user=$U';

init cluster (id = 1, comment = 'TRANS database on 10.0.1.1');

create set (id = 1, origin = 1,
       comment = 'TRANS database');

set add table...
...
...
...

store node (id = 2, comment = 'TRANS database on 10.0.1.2', event node = 1);
store path (server = 1, client = 2,
      conninfo = 'dbname=$DB1 host=$H1 user=$U');

store path (server = 2, client = 1,
           conninfo = 'dbname=$DB2 host=$H2 user=$U');

store listen (origin = 1, provider = 1, receiver = 2);
store listen (origin = 2, provider = 2, receiver = 1);

_EOF_

            Would I just need to change the IP addresses in the variables above? If so, would the "create set" and "set add table" calls still need to be in there? If those calls do need to be there, wouldn't they error because they already exist for the cluster? When I try to change the IP addresses in the variables above and comment out the create set and set add table calls, I get:

<stdin>:22: Error: namespace "_my_cluster" already exists in database of node 2

            If I drop the cluster there, the seed would have to be redone. So is there anything else I'm missing here?

            Brad



* This e-mail and any files transmitted with it may contain confidential and/or privileged information and intended solely for the use of the individual or entity to whom they are addressed. If you are not the addressee or authorized to receive this for the addressee, you must not use, copy, disclose, or take any action based on this message or any information herein. If you have received this message in error, please advise the sender immediately by reply e-mail and delete this message.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20110114/3449f897/attachment.htm 

From cbbrowne at ca.afilias.info  Fri Jan 14 11:50:11 2011
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Fri, 14 Jan 2011 14:50:11 -0500
Subject: [Slony1-general] Changing IP address of Slave database
In-Reply-To: <FC2125863502344C9B615565CF826F7C0121911AE2@posexch1.posportal.com>
	(Brad Littlejohn's message of "Fri, 14 Jan 2011 11:08:17 -0800")
References: <FC2125863502344C9B615565CF826F7C0121911AE2@posexch1.posportal.com>
Message-ID: <87bp3je03w.fsf@cbbrowne.afilias-int.info>

Brad Littlejohn <blittlejohn at posportal.com> writes:
> ??????????? After doing a bit of googling on changing the IP address
> of the master and slave database servers being replicated by Slony,
> I?m still a bit confused on how to change the address. To give some
> background, I have 2 servers running PostgreSQL 8.4, and replication
> works fine between the database on each server. These are currently
> connected via crossover cable, just for the initial seed of the
> database (it?s roughly 300GB in size).
>
> ?
>
> ??????????? The slave database is going to be moved to a DR location,
> and kept up to date real time with Slony; however, the IP address of
> the master and slave servers are going to change. I currently have the
> following set up to set up to do the initial seed:

My first question is why you're using IP addresses, when it's commonly
easier to indirect this via using hostnames.

For instance, if you had, in your DNS configuration, a set of CNAME
values, you could change that, and redirect the traffic without any need
to touch Slony configuration altogether.  Similarly, having A or AAAA
records for your favorite host names would allow using host names rather
than IP addresses.

That being said, it can be meaningful to need to switch configuration
around.

If you change the addresses of servers, you'll need to modify
configuration that Slony uses in three notable places:

 a) Whatever script you use to invoke slon processes need to be changed
    to point to the new addresses.

 b) Any slonik scripts that you use will need to have the "admin
    conninfo" changed to indicate the new addresses.

 c) You will need to run a slonik script (that takes b) into
    consideration!) which runs STORE PATH commands to indicate the new
    addresses.

    That slonik script does not need to take any action other than
    running STORE PATH commands; it should not run:
     - init cluster, because the cluster is already initialized
     - store node, because additional nodes are already present
     - create set, because sets are already initialized

    The shell script you tried to run tried to perform all sorts of
    extra actions in addition to running STORE PATH, and those other
    actions failed.
-- 
let name="cbbrowne" and tld="afilias.info" in name ^ "@" ^ tld;;
Christopher Browne
"Bother,"  said Pooh,  "Eeyore, ready  two photon  torpedoes  and lock
phasers on the Heffalump, Piglet, meet me in transporter room three"

From ssinger at ca.afilias.info  Fri Jan 14 12:09:21 2011
From: ssinger at ca.afilias.info (Steve Singer)
Date: Fri, 14 Jan 2011 15:09:21 -0500
Subject: [Slony1-general] Suggestions for enhancement 173 - SLONY ABORT
In-Reply-To: <87sjwweccu.fsf@cbbrowne.afilias-int.info>
References: <87sjwweccu.fsf@cbbrowne.afilias-int.info>
Message-ID: <4D30AD71.7070408@ca.afilias.info>

On 11-01-13 04:13 PM, Christopher Browne wrote:
> Bug #173 is about the notion of extending Slonik to allow one to
> ask a Slonik script to error out upon running into particular
> conditions.
>
> These "ABORT" statements could be used to guard a script; if it runs
> into unacceptable pre-conditions, it may terminate before it does any
> damage to the cluster.
>
> I suggest the following, as starting points:
>
> - Behind by...
>     ->= 5 events
>     ->= 30 seconds
>
>    ABORT IF BEHIND ( PROVIDER = 1, RECEIVER = 3, SECONDS = 30, comment = 'Behind by 30 seconds', return=1);
>    ABORT IF BEHIND ( PROVIDER = 1, RECEIVER = 3, EVENT = 5, comment= 'Behind by 5 events', return=2);
>

I like this idea in principal:
-Do you mean provider or do you really mean origin?
-I think EVENT should be 'EVENT COUNT' or something to indicate that we 
are checking the number of events it is behind, versus ('has the 
receiver received event number 5')
.


> Other Health Criteria
> - Is node there?

This is worthwhile. Slonik already has a function that basically does 
this. (I see this as a connectivity test not an existance test where you 
obviously can't connect to something that doesn't exist).

> - Is replication set there?
> - Is subscription active?
> - Run SQL, fail if ERROR
>
>    ABORT IF NODE ABSENT ( EVENT NODE = 1, ID = 3, comment = 'Node 3 missing according to node 1',return=3);
>    ABORT IF SET ABSENT ( EVENT NODE = 1, ID = 3, comment = 'Set 3 missing according to node 1',return=4);
>    ABORT IF SET NOT SUBSCRIBED ( EVENT NODE = 1, ID = 3, comment = 'Set 3 not subscribed by node 1', return=5 );
>    ABORT IF SCRIPT ERROR ( EVENT NODE = 1, script = '/tmp/myscript.sql',return=6 );

These lead me to want things like:  "Is the replication set there? If 
not don't abort run these slonik commands to create it'.  All of these 
are also questions about the configuration of the cluster I wonder if 
script writers wouldn't be better off querying the sl_* tables directly 
to answer this from a 'real' scripting language (shell,perl, etc...)

Back when we were discussing ideas for 2.1 I had discussed an idea where 
we replace slonik with stored functions that can connect to remote nodes 
via libpq.   You could then write your slonik scripts in your favorite 
pl for conditionals and loops.   Though this is a huge change and not in 
scope for 2.1







From blittlejohn at posportal.com  Fri Jan 14 12:24:27 2011
From: blittlejohn at posportal.com (Brad Littlejohn)
Date: Fri, 14 Jan 2011 12:24:27 -0800
Subject: [Slony1-general] Changing IP address of Slave database
In-Reply-To: <87bp3je03w.fsf@cbbrowne.afilias-int.info>
References: <FC2125863502344C9B615565CF826F7C0121911AE2@posexch1.posportal.com>
	<87bp3je03w.fsf@cbbrowne.afilias-int.info>
Message-ID: <FC2125863502344C9B615565CF826F7C0121911AE4@posexch1.posportal.com>



> -----Original Message-----
> From: Christopher Browne [mailto:cbbrowne at ca.afilias.info]
> Sent: Friday, January 14, 2011 11:50 AM
> To: Brad Littlejohn
> Cc: 'slony1-general at lists.slony.info'
> Subject: Re: [Slony1-general] Changing IP address of Slave database
> 
> Brad Littlejohn <blittlejohn at posportal.com> writes:
> > ??????????? After doing a bit of googling on changing the IP address
> > of the master and slave database servers being replicated by Slony,
> > I?m still a bit confused on how to change the address. To give some
> > background, I have 2 servers running PostgreSQL 8.4, and replication
> > works fine between the database on each server. These are currently
> > connected via crossover cable, just for the initial seed of the
> > database (it?s roughly 300GB in size).
> >
> >
> >
> > ??????????? The slave database is going to be moved to a DR location,
> > and kept up to date real time with Slony; however, the IP address of
> > the master and slave servers are going to change. I currently have
> the
> > following set up to set up to do the initial seed:
> 
> My first question is why you're using IP addresses, when it's commonly
> easier to indirect this via using hostnames.

	First, thanks for the response. I appreciate it!

	That was going to be my next step after getting this working. I was using IP addresses in this instance so I could initially seed the slave database out of bounds of the main network these are on. Seeing a near 300GB database would have impacted other users of our network here, plus would limit me to the speed of the switch of that particular network. This way, my bandwidth was limited only to the NICs in the servers.

	Additionally, I'm also doing a smaller test of this in a VM sandbox, so I don't do it on live data. CYA.

> 
> If you change the addresses of servers, you'll need to modify
> configuration that Slony uses in three notable places:
> 
>  a) Whatever script you use to invoke slon processes need to be changed
>     to point to the new addresses.
> 
>  b) Any slonik scripts that you use will need to have the "admin
>     conninfo" changed to indicate the new addresses.
> 
>  c) You will need to run a slonik script (that takes b) into
>     consideration!) which runs STORE PATH commands to indicate the new
>     addresses.
> 
>     That slonik script does not need to take any action other than
>     running STORE PATH commands; it should not run:
>      - init cluster, because the cluster is already initialized
>      - store node, because additional nodes are already present
>      - create set, because sets are already initialized
> 
>     The shell script you tried to run tried to perform all sorts of
>     extra actions in addition to running STORE PATH, and those other
>     actions failed.

	Perfect! This just ran great in my testbed! What I needed was:

	1. the IP addresses/hostnames (obviously),
	2. cluster name/admin conninfo (Preamble),
	3. STORE PATH command, and
	4. STORE LISTEN command.

	I'm not sure if #4 is required, but it is working for me. Now I'm ready to move over to trying this on my production servers when the slave server gets installed in our DR facility. And I'll definitely take your advice with using hostnames in production, now that the seed is done. Thanks once again!

	Brad


* This e-mail and any files transmitted with it may contain confidential and/or privileged information and intended solely for the use of the individual or entity to whom they are addressed. If you are not the addressee or authorized to receive this for the addressee, you must not use, copy, disclose, or take any action based on this message or any information herein. If you have received this message in error, please advise the sender immediately by reply e-mail and delete this message.

From cbbrowne at ca.afilias.info  Fri Jan 14 13:05:22 2011
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Fri, 14 Jan 2011 16:05:22 -0500
Subject: [Slony1-general] Changing IP address of Slave database
In-Reply-To: <FC2125863502344C9B615565CF826F7C0121911AE4@posexch1.posportal.com>
	(Brad Littlejohn's message of "Fri, 14 Jan 2011 12:24:27 -0800")
References: <FC2125863502344C9B615565CF826F7C0121911AE2@posexch1.posportal.com>
	<87bp3je03w.fsf@cbbrowne.afilias-int.info>
	<FC2125863502344C9B615565CF826F7C0121911AE4@posexch1.posportal.com>
Message-ID: <877he7dwml.fsf@cbbrowne.afilias-int.info>

Brad Littlejohn <blittlejohn at posportal.com> writes:
>> -----Original Message-----
>> From: Christopher Browne [mailto:cbbrowne at ca.afilias.info]
>> Sent: Friday, January 14, 2011 11:50 AM
>> To: Brad Littlejohn
>> Cc: 'slony1-general at lists.slony.info'
>> Subject: Re: [Slony1-general] Changing IP address of Slave database
>> 
>> Brad Littlejohn <blittlejohn at posportal.com> writes:
>> > ??????????? After doing a bit of googling on changing the IP address
>> > of the master and slave database servers being replicated by Slony,
>> > I?m still a bit confused on how to change the address. To give some
>> > background, I have 2 servers running PostgreSQL 8.4, and replication
>> > works fine between the database on each server. These are currently
>> > connected via crossover cable, just for the initial seed of the
>> > database (it?s roughly 300GB in size).
>> >
>> >
>> >
>> > ??????????? The slave database is going to be moved to a DR location,
>> > and kept up to date real time with Slony; however, the IP address of
>> > the master and slave servers are going to change. I currently have
>> the
>> > following set up to set up to do the initial seed:
>> 
>> My first question is why you're using IP addresses, when it's commonly
>> easier to indirect this via using hostnames.
>
> 	First, thanks for the response. I appreciate it!
>
> 	That was going to be my next step after getting this working. I
> was using IP addresses in this instance so I could initially seed the
> slave database out of bounds of the main network these are on. Seeing
> a near 300GB database would have impacted other users of our network
> here, plus would limit me to the speed of the switch of that
> particular network. This way, my bandwidth was limited only to the
> NICs in the servers.
>
> 	Additionally, I'm also doing a smaller test of this in a VM
> 	sandbox, so I don't do it on live data. CYA.

All sounds pretty apropos.

I'd be more a fan of having the sandbox be pretty similar, network-wise,
to the real environment.  That way the things you learn about how to
properly configure the network for the sandbox are also pretty good
lessons for production.

>> If you change the addresses of servers, you'll need to modify
>> configuration that Slony uses in three notable places:
>> 
>>  a) Whatever script you use to invoke slon processes need to be changed
>>     to point to the new addresses.
>> 
>>  b) Any slonik scripts that you use will need to have the "admin
>>     conninfo" changed to indicate the new addresses.
>> 
>>  c) You will need to run a slonik script (that takes b) into
>>     consideration!) which runs STORE PATH commands to indicate the new
>>     addresses.
>> 
>>     That slonik script does not need to take any action other than
>>     running STORE PATH commands; it should not run:
>>      - init cluster, because the cluster is already initialized
>>      - store node, because additional nodes are already present
>>      - create set, because sets are already initialized
>> 
>>     The shell script you tried to run tried to perform all sorts of
>>     extra actions in addition to running STORE PATH, and those other
>>     actions failed.
>
> 	Perfect! This just ran great in my testbed! What I needed was:
>
> 	1. the IP addresses/hostnames (obviously),
> 	2. cluster name/admin conninfo (Preamble),
> 	3. STORE PATH command, and
> 	4. STORE LISTEN command.
>
> 	I'm not sure if #4 is required, but it is working for me. Now
> I'm ready to move over to trying this on my production servers when
> the slave server gets installed in our DR facility. And I'll
> definitely take your advice with using hostnames in production, now
> that the seed is done. Thanks once again!

The STORE LISTEN part shouldn't be necessary on recent-ish versions of
Slony.  That configuration used to need to get computed by hand, back in
version 1.0, but it's automatically computed on the more recent
versions, certainly for 1.2.x and 2.0.x.

I didn't see what version you were on; I presume 2.0.x?
-- 
(reverse (concatenate 'string "ofni.sailifa" "@" "enworbbc"))
Christopher Browne
"Bother,"  said Pooh,  "Eeyore, ready  two photon  torpedoes  and lock
phasers on the Heffalump, Piglet, meet me in transporter room three"

From blittlejohn at posportal.com  Fri Jan 14 13:15:38 2011
From: blittlejohn at posportal.com (Brad Littlejohn)
Date: Fri, 14 Jan 2011 13:15:38 -0800
Subject: [Slony1-general] Changing IP address of Slave database
In-Reply-To: <877he7dwml.fsf@cbbrowne.afilias-int.info>
References: <FC2125863502344C9B615565CF826F7C0121911AE2@posexch1.posportal.com>
	<87bp3je03w.fsf@cbbrowne.afilias-int.info>
	<FC2125863502344C9B615565CF826F7C0121911AE4@posexch1.posportal.com>
	<877he7dwml.fsf@cbbrowne.afilias-int.info>
Message-ID: <FC2125863502344C9B615565CF826F7C0121911AE6@posexch1.posportal.com>



> -----Original Message-----
> From: Christopher Browne [mailto:cbbrowne at ca.afilias.info]
> Sent: Friday, January 14, 2011 1:05 PM
> To: Brad Littlejohn
> Cc: 'slony1-general at lists.slony.info'
> Subject: Re: [Slony1-general] Changing IP address of Slave database
> 
> Brad Littlejohn <blittlejohn at posportal.com> writes:
> >
> > 	Perfect! This just ran great in my testbed! What I needed was:
> >
> > 	1. the IP addresses/hostnames (obviously),
> > 	2. cluster name/admin conninfo (Preamble),
> > 	3. STORE PATH command, and
> > 	4. STORE LISTEN command.
> >
> > 	I'm not sure if #4 is required, but it is working for me. Now
> > I'm ready to move over to trying this on my production servers when
> > the slave server gets installed in our DR facility. And I'll
> > definitely take your advice with using hostnames in production, now
> > that the seed is done. Thanks once again!
> 
> The STORE LISTEN part shouldn't be necessary on recent-ish versions of
> Slony.  That configuration used to need to get computed by hand, back
> in
> version 1.0, but it's automatically computed on the more recent
> versions, certainly for 1.2.x and 2.0.x.
> 
> I didn't see what version you were on; I presume 2.0.x?

	Yes. I'm using Slony 2.0.6.

	Brad

* This e-mail and any files transmitted with it may contain confidential and/or privileged information and intended solely for the use of the individual or entity to whom they are addressed. If you are not the addressee or authorized to receive this for the addressee, you must not use, copy, disclose, or take any action based on this message or any information herein. If you have received this message in error, please advise the sender immediately by reply e-mail and delete this message.

From guillaume at lelarge.info  Tue Jan 18 02:08:37 2011
From: guillaume at lelarge.info (Guillaume Lelarge)
Date: Tue, 18 Jan 2011 11:08:37 +0100
Subject: [Slony1-general] =?utf-8?q?sl=5Fstatus_not_updated=2C_despite_rep?=
 =?utf-8?q?lication_working_=28slony_2=2E0=2E6=29?=
Message-ID: <756fa4f452776a9d53697790ab5fe269@localhost>

Hi,

I have an issue on Slony 2.0.6 and PostgreSQL 9.0.2. After stopping a
slave, waiting for a few minutes, and then starting the slave again, the
sl_status view shows a lag that keeps going up. And even if the lag keeps
going up, replication is working on all slaves. The only way to fix this is
to restart the slon daemons.

Is this behaviour expected? AFAICT, it isn't. At least, it doesn't seem so
to Peter Geoghegan that asked many times about this issue (see "sl_status
incorrectly reports long event lag", "Error - table id 1 has already been
assigned", "Problem with Slony-I 2.0.2, sl_status persists", "Why does
sl_status event lag grow, even though events *are* replicated?", "slony I
2.0.3" threads). The usual answer was to stick with the 1.2 branch, but it
seemed to me that 2.0.6 got rid of many bugs.

So, is it a bug of the 2.0 branch? or is it an expected behaviour? Any
tips would be great.

Thanks.

Regards.


-- 
Guillaume
 http://www.postgresql.fr
 http://dalibo.com

From ssinger at ca.afilias.info  Tue Jan 18 05:04:18 2011
From: ssinger at ca.afilias.info (Steve Singer)
Date: Tue, 18 Jan 2011 08:04:18 -0500
Subject: [Slony1-general] sl_status not updated,
 despite replication working (slony 2.0.6)
In-Reply-To: <756fa4f452776a9d53697790ab5fe269@localhost>
References: <756fa4f452776a9d53697790ab5fe269@localhost>
Message-ID: <4D358FD2.3000208@ca.afilias.info>

On 11-01-18 05:08 AM, Guillaume Lelarge wrote:
> Hi,
>
> I have an issue on Slony 2.0.6 and PostgreSQL 9.0.2. After stopping a
> slave, waiting for a few minutes, and then starting the slave again, the
> sl_status view shows a lag that keeps going up. And even if the lag keeps
> going up, replication is working on all slaves. The only way to fix this is
> to restart the slon daemons.
>
> Is this behaviour expected? AFAICT, it isn't. At least, it doesn't seem so
> to Peter Geoghegan that asked many times about this issue (see "sl_status
> incorrectly reports long event lag", "Error - table id 1 has already been
> assigned", "Problem with Slony-I 2.0.2, sl_status persists", "Why does
> sl_status event lag grow, even though events *are* replicated?", "slony I
> 2.0.3" threads). The usual answer was to stick with the 1.2 branch, but it
> seemed to me that 2.0.6 got rid of many bugs.
>
> So, is it a bug of the 2.0 branch? or is it an expected behaviour? Any
> tips would be great.


Are SYNC events being generated on that slave? (examin sl_event on the 
slave with ev_origin=$slave_id)

Are the confirms for those events confirming they have been processed by 
the master making it back to the slave (look at sl_confirm on the slave)


>
> Thanks.
>
> Regards.
>
>


From guillaume at lelarge.info  Tue Jan 18 05:22:31 2011
From: guillaume at lelarge.info (Guillaume Lelarge)
Date: Tue, 18 Jan 2011 14:22:31 +0100
Subject: [Slony1-general]
 =?utf-8?q?sl=5Fstatus_not_updated=2C_despite_rep?=
 =?utf-8?q?lication_working_=28slony_2=2E0=2E6=29?=
In-Reply-To: <4D358FD2.3000208@ca.afilias.info>
References: <756fa4f452776a9d53697790ab5fe269@localhost>
	<4D358FD2.3000208@ca.afilias.info>
Message-ID: <e42f9715e752e7c423f2fdd663eb4831@localhost>

On Tue, 18 Jan 2011 08:04:18 -0500, Steve Singer <ssinger at ca.afilias.info>
wrote:
> On 11-01-18 05:08 AM, Guillaume Lelarge wrote:
>> Hi,
>>
>> I have an issue on Slony 2.0.6 and PostgreSQL 9.0.2. After stopping a
>> slave, waiting for a few minutes, and then starting the slave again,
the
>> sl_status view shows a lag that keeps going up. And even if the lag
keeps
>> going up, replication is working on all slaves. The only way to fix
this
>> is
>> to restart the slon daemons.
>>
>> Is this behaviour expected? AFAICT, it isn't. At least, it doesn't seem
>> so
>> to Peter Geoghegan that asked many times about this issue (see
"sl_status
>> incorrectly reports long event lag", "Error - table id 1 has already
been
>> assigned", "Problem with Slony-I 2.0.2, sl_status persists", "Why does
>> sl_status event lag grow, even though events *are* replicated?", "slony
I
>> 2.0.3" threads). The usual answer was to stick with the 1.2 branch, but
>> it
>> seemed to me that 2.0.6 got rid of many bugs.
>>
>> So, is it a bug of the 2.0 branch? or is it an expected behaviour? Any
>> tips would be great.
> 
> 
> Are SYNC events being generated on that slave? (examin sl_event on the 
> slave with ev_origin=$slave_id)
> 

Yes, every 10 seconds.

> Are the confirms for those events confirming they have been processed by

> the master making it back to the slave (look at sl_confirm on the slave)
> 

No, the oldest one is around the same time when I stopped the slave.

FYI, I tried 2.1dev, which, to my happy surprise, use the application_name
variable. I have the same behaviour but I noticed that one connection is
not renewed when the slave is up again. It is "slon.node_2_listen" (node 2
is my slave).


-- 
Guillaume
 http://www.postgresql.fr
 http://dalibo.com

From ssinger at ca.afilias.info  Tue Jan 18 06:20:38 2011
From: ssinger at ca.afilias.info (Steve Singer)
Date: Tue, 18 Jan 2011 09:20:38 -0500
Subject: [Slony1-general] sl_status not updated,
 despite replication working (slony 2.0.6)
In-Reply-To: <e42f9715e752e7c423f2fdd663eb4831@localhost>
References: <756fa4f452776a9d53697790ab5fe269@localhost>
	<4D358FD2.3000208@ca.afilias.info>
	<e42f9715e752e7c423f2fdd663eb4831@localhost>
Message-ID: <4D35A1B6.7070602@ca.afilias.info>

On 11-01-18 08:22 AM, Guillaume Lelarge wrote:
> On Tue, 18 Jan 2011 08:04:18 -0500, Steve Singer<ssinger at ca.afilias.info>
> wrote:
>> On 11-01-18 05:08 AM, Guillaume Lelarge wrote:
>>> Hi,
>>>
>>> I have an issue on Slony 2.0.6 and PostgreSQL 9.0.2. After stopping a
>>> slave, waiting for a few minutes, and then starting the slave again,
> the
>>> sl_status view shows a lag that keeps going up. And even if the lag
> keeps
>>> going up, replication is working on all slaves. The only way to fix
> this
>>> is
>>> to restart the slon daemons.
>>>
>>> Is this behaviour expected? AFAICT, it isn't. At least, it doesn't seem
>>> so
>>> to Peter Geoghegan that asked many times about this issue (see
> "sl_status
>>> incorrectly reports long event lag", "Error - table id 1 has already
> been
>>> assigned", "Problem with Slony-I 2.0.2, sl_status persists", "Why does
>>> sl_status event lag grow, even though events *are* replicated?", "slony
> I
>>> 2.0.3" threads). The usual answer was to stick with the 1.2 branch, but
>>> it
>>> seemed to me that 2.0.6 got rid of many bugs.
>>>
>>> So, is it a bug of the 2.0 branch? or is it an expected behaviour? Any
>>> tips would be great.
>>
>>
>> Are SYNC events being generated on that slave? (examin sl_event on the
>> slave with ev_origin=$slave_id)
>>
>
> Yes, every 10 seconds.
>
>> Are the confirms for those events confirming they have been processed by
>
>> the master making it back to the slave (look at sl_confirm on the slave)
>>
>
> No, the oldest one is around the same time when I stopped the slave.
>

Are the SYNC's from node to making it to your origin?  (do they show up 
in sl_event on the origin).  If yes, do the confirms for those events 
show up in sl_confirm on the origin.  Or in other words are the sync's 
from node 2 making it to the origin?



> FYI, I tried 2.1dev, which, to my happy surprise, use the application_name
> variable. I have the same behaviour but I noticed that one connection is
> not renewed when the slave is up again. It is "slon.node_2_listen" (node 2
> is my slave).
>
>


From guillaume at lelarge.info  Tue Jan 18 06:38:29 2011
From: guillaume at lelarge.info (Guillaume Lelarge)
Date: Tue, 18 Jan 2011 15:38:29 +0100
Subject: [Slony1-general]
 =?utf-8?q?sl=5Fstatus_not_updated=2C_despite_rep?=
 =?utf-8?q?lication_working_=28slony_2=2E0=2E6=29?=
In-Reply-To: <4D35A1B6.7070602@ca.afilias.info>
References: <756fa4f452776a9d53697790ab5fe269@localhost>
	<4D358FD2.3000208@ca.afilias.info>
	<e42f9715e752e7c423f2fdd663eb4831@localhost>
	<4D35A1B6.7070602@ca.afilias.info>
Message-ID: <8fe1f2fd306cdea25697e948d003dd3e@localhost>

On Tue, 18 Jan 2011 09:20:38 -0500, Steve Singer <ssinger at ca.afilias.info>
wrote:
> On 11-01-18 08:22 AM, Guillaume Lelarge wrote:
>> On Tue, 18 Jan 2011 08:04:18 -0500, Steve
Singer<ssinger at ca.afilias.info>
>> wrote:
>>> On 11-01-18 05:08 AM, Guillaume Lelarge wrote:
>>[...]
>>> Are the confirms for those events confirming they have been processed
by
>>
>>> the master making it back to the slave (look at sl_confirm on the
slave)
>>>
>>
>> No, the oldest one is around the same time when I stopped the slave.
>>
> 
> Are the SYNC's from node to making it to your origin?  (do they show up 
> in sl_event on the origin).  If yes, do the confirms for those events 
> show up in sl_confirm on the origin.  Or in other words are the sync's 
> from node 2 making it to the origin?
> 

No, they don't make it to the origin.


-- 
Guillaume
 http://www.postgresql.fr
 http://dalibo.com

From zhidong.she at gmail.com  Tue Jan 18 19:23:36 2011
From: zhidong.she at gmail.com (Zhidong She)
Date: Wed, 19 Jan 2011 11:23:36 +0800
Subject: [Slony1-general] Can we run many slony instances simultaneously in
	one host?
Message-ID: <AANLkTi=YAiFx0oqhcH5aajHKLpVt3i6THsfr+3uiG2BF@mail.gmail.com>

Hi guys,

If in one postgres server, I have many databases and I want all the
databases to be synchronized by slony, how can I deploy the slony?
For each database, run a slony process? Can we run many slony
instances simultaneously in one host?

Thanks,
Br,
Zhidong

From stephane.schildknecht at postgresql.fr  Wed Jan 19 00:33:23 2011
From: stephane.schildknecht at postgresql.fr (=?ISO-8859-15?Q?=22St=E9phane_A=2E_Schildknecht=22?=)
Date: Wed, 19 Jan 2011 09:33:23 +0100
Subject: [Slony1-general] Can we run many slony instances simultaneously
 in	one host?
In-Reply-To: <AANLkTi=YAiFx0oqhcH5aajHKLpVt3i6THsfr+3uiG2BF@mail.gmail.com>
References: <AANLkTi=YAiFx0oqhcH5aajHKLpVt3i6THsfr+3uiG2BF@mail.gmail.com>
Message-ID: <4D36A1D3.1050003@postgresql.fr>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Le 19/01/2011 04:23, Zhidong She a ?crit :
> Hi guys,
> 
> If in one postgres server, I have many databases and I want all the
> databases to be synchronized by slony, how can I deploy the slony?
> For each database, run a slony process? Can we run many slony
> instances simultaneously in one host?

You can have as many replication instances as you need on a single PostgreSQL
server, one by database.

You have to start one daemon by participating node (one database on one server).

Regards,
- -- 
St?phane Schildknecht
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.10 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/

iEYEARECAAYFAk02odMACgkQA+REPKWGI0EYkgCePEu9Usmw/u0Kj2VlFlcrRGIV
QQsAn3xSRlzwI3kQDx4x51XWX+TfwAU7
=xwzU
-----END PGP SIGNATURE-----

From guillaume at lelarge.info  Wed Jan 19 01:58:41 2011
From: guillaume at lelarge.info (Guillaume Lelarge)
Date: Wed, 19 Jan 2011 10:58:41 +0100
Subject: [Slony1-general]
 =?utf-8?q?sl=5Fstatus_not_updated=2C_despite_rep?=
 =?utf-8?q?lication_working_=28slony_2=2E0=2E6=29?=
In-Reply-To: <8fe1f2fd306cdea25697e948d003dd3e@localhost>
References: <756fa4f452776a9d53697790ab5fe269@localhost>
	<4D358FD2.3000208@ca.afilias.info>
	<e42f9715e752e7c423f2fdd663eb4831@localhost>
	<4D35A1B6.7070602@ca.afilias.info>
	<8fe1f2fd306cdea25697e948d003dd3e@localhost>
Message-ID: <567b84d7418c270f2e368b6325638010@localhost>

On Tue, 18 Jan 2011 15:38:29 +0100, Guillaume Lelarge
<guillaume at lelarge.info> wrote:
> On Tue, 18 Jan 2011 09:20:38 -0500, Steve Singer
<ssinger at ca.afilias.info>
> wrote:
>> On 11-01-18 08:22 AM, Guillaume Lelarge wrote:
>>> On Tue, 18 Jan 2011 08:04:18 -0500, Steve
> Singer<ssinger at ca.afilias.info>
>>> wrote:
>>>> On 11-01-18 05:08 AM, Guillaume Lelarge wrote:
>>>[...]
>>>> Are the confirms for those events confirming they have been processed
> by
>>>
>>>> the master making it back to the slave (look at sl_confirm on the
> slave)
>>>>
>>>
>>> No, the oldest one is around the same time when I stopped the slave.
>>>
>> 
>> Are the SYNC's from node to making it to your origin?  (do they show up

>> in sl_event on the origin).  If yes, do the confirms for those events 
>> show up in sl_confirm on the origin.  Or in other words are the sync's 
>> from node 2 making it to the origin?
>> 
> 
> No, they don't make it to the origin.

I've done more tests on this issue. It appears than I didn't have the last
source of 2.1. I couldn't get it from my customer's office (git pull didn't
work, they have really hard firewall rules).

Now that I have it, after some checks, 2.1 is not affected by my issue.
a6893dbbaa782d7ca4b22ff1cee2b7953a29e89c
(http://git.postgresql.org/gitweb?p=slony1-engine.git;a=commitdiff;h=a6893dbbaa782d7ca4b22ff1cee2b7953a29e89c)
seeming related to my issue, I tried it on 2.0.6 and, tadam, now it works.

I think this bug fix should be applied on REL_2_0_STABLE, so that it
doesn't bite any more 2.0 users.

Thanks.

Regards.


-- 
Guillaume
 http://www.postgresql.fr
 http://dalibo.com

From ssinger at ca.afilias.info  Thu Jan 20 06:26:32 2011
From: ssinger at ca.afilias.info (Steve Singer)
Date: Thu, 20 Jan 2011 09:26:32 -0500
Subject: [Slony1-general] sl_status not updated,
 despite replication working (slony 2.0.6)
In-Reply-To: <567b84d7418c270f2e368b6325638010@localhost>
References: <756fa4f452776a9d53697790ab5fe269@localhost>
	<4D358FD2.3000208@ca.afilias.info>
	<e42f9715e752e7c423f2fdd663eb4831@localhost>
	<4D35A1B6.7070602@ca.afilias.info>
	<8fe1f2fd306cdea25697e948d003dd3e@localhost>
	<567b84d7418c270f2e368b6325638010@localhost>
Message-ID: <4D384618.9020900@ca.afilias.info>

On 11-01-19 04:58 AM, Guillaume Lelarge wrote:

>
> I've done more tests on this issue. It appears than I didn't have the last
> source of 2.1. I couldn't get it from my customer's office (git pull didn't
> work, they have really hard firewall rules).
>
> Now that I have it, after some checks, 2.1 is not affected by my issue.
> a6893dbbaa782d7ca4b22ff1cee2b7953a29e89c
> (http://git.postgresql.org/gitweb?p=slony1-engine.git;a=commitdiff;h=a6893dbbaa782d7ca4b22ff1cee2b7953a29e89c)
> seeming related to my issue, I tried it on 2.0.6 and, tadam, now it works.
>
> I think this bug fix should be applied on REL_2_0_STABLE, so that it
> doesn't bite any more 2.0 users.
>

This patch has been merged into REL_2_0_STABLE


> Thanks.
>
> Regards.
>
>


From guillaume at lelarge.info  Thu Jan 20 07:02:43 2011
From: guillaume at lelarge.info (Guillaume Lelarge)
Date: Thu, 20 Jan 2011 16:02:43 +0100
Subject: [Slony1-general] sl_status not updated,
 despite replication working (slony 2.0.6)
In-Reply-To: <4D384618.9020900@ca.afilias.info>
References: <756fa4f452776a9d53697790ab5fe269@localhost>
	<4D358FD2.3000208@ca.afilias.info>
	<e42f9715e752e7c423f2fdd663eb4831@localhost>
	<4D35A1B6.7070602@ca.afilias.info>
	<8fe1f2fd306cdea25697e948d003dd3e@localhost>
	<567b84d7418c270f2e368b6325638010@localhost>
	<4D384618.9020900@ca.afilias.info>
Message-ID: <4D384E93.7060102@lelarge.info>

Le 20/01/2011 15:26, Steve Singer a ?crit :
> On 11-01-19 04:58 AM, Guillaume Lelarge wrote:
> 
>>
>> I've done more tests on this issue. It appears than I didn't have the
>> last
>> source of 2.1. I couldn't get it from my customer's office (git pull
>> didn't
>> work, they have really hard firewall rules).
>>
>> Now that I have it, after some checks, 2.1 is not affected by my issue.
>> a6893dbbaa782d7ca4b22ff1cee2b7953a29e89c
>> (http://git.postgresql.org/gitweb?p=slony1-engine.git;a=commitdiff;h=a6893dbbaa782d7ca4b22ff1cee2b7953a29e89c)
>>
>> seeming related to my issue, I tried it on 2.0.6 and, tadam, now it
>> works.
>>
>> I think this bug fix should be applied on REL_2_0_STABLE, so that it
>> doesn't bite any more 2.0 users.
>>
> 
> This patch has been merged into REL_2_0_STABLE
> 

Thanks a lot.


-- 
Guillaume
 http://www.postgresql.fr
 http://dalibo.com

From peter.geoghegan86 at gmail.com  Thu Jan 20 18:19:54 2011
From: peter.geoghegan86 at gmail.com (Peter Geoghegan)
Date: Fri, 21 Jan 2011 02:19:54 +0000
Subject: [Slony1-general] sl_status not updated,
 despite replication working (slony 2.0.6)
In-Reply-To: <4D384E93.7060102@lelarge.info>
References: <756fa4f452776a9d53697790ab5fe269@localhost>
	<4D358FD2.3000208@ca.afilias.info>
	<e42f9715e752e7c423f2fdd663eb4831@localhost>
	<4D35A1B6.7070602@ca.afilias.info>
	<8fe1f2fd306cdea25697e948d003dd3e@localhost>
	<567b84d7418c270f2e368b6325638010@localhost>
	<4D384618.9020900@ca.afilias.info> <4D384E93.7060102@lelarge.info>
Message-ID: <AANLkTi=0ESWjpvfLKE-_oOuYL=07c9nPg_GVLgNfFywm@mail.gmail.com>

I'm really glad that this bug has finally been fixed!

-- 
Regards,
Peter Geoghegan

From ozkan at polestarglobal.com  Mon Jan 24 07:20:20 2011
From: ozkan at polestarglobal.com (Ejber Ozkan)
Date: Mon, 24 Jan 2011 09:20:20 -0600
Subject: [Slony1-general] /usr/bin/ld: skipping incompatible
 /usr/pgsql-9.0/lib//libpgport.a when searching for -lpgport
Message-ID: <AB4F91433E82F043B53AF2DA8812C47017B0D18111@34093-MBX-C17.mex07a.mlsrvr.com>

I wish to test migrate from 8.1.15 to 9.0 of postgresql (yes very old!).

slony1-1.2.22 compiled ok on 8.1 (FC10)
but on CentOS 5.5 with Postgresql90 installed ( I only have to x64 installed of 9.0 from the pgrpms).
I get a compile error:

gcc -g -O2 -Wall -Wmissing-prototypes -Wmissing-declarations -I../.. -DPGSHARE="\"/usr/pgsql-9.0/bin//../share/\"" -DPG_VERSION_MAJOR=9 slonik.o dbutil.o parser.o  ../parsestatements/scanner.o -L/usr/pgsql-9.0/lib/ -L/usr/pgsql-9.0/lib/ -lpq  -Wl,-rpath,/usr/pgsql-9.0/lib/ -lpgport  -o slonik
/usr/bin/ld: skipping incompatible /usr/pgsql-9.0/lib//libpgport.a when searching for -lpgport
/usr/bin/ld: skipping incompatible /usr/pgsql-9.0/lib//libpgport.a when searching for -lpgport
/usr/bin/ld: cannot find -lpgport
collect2: ld returned 1 exit status
make[2]: *** [slonik] Error 1

I have seen a mention in thread http://lists.slony.info/pipermail/slony1-general/2010-November/thread.html#11280
But not directly resolved.
Anyone come across this and able to fix this without source recompile of Postgres?
On a related note can I run slony 2.0 on PG 9.0 and replicate from 8.1 with slony 1.2 ?, I couldn't find an answer in the documentation about replication from different slony codebases.
Thanks.

Ejber Ozkan

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20110124/94b9de8e/attachment.htm 

From mark at mark.mielke.cc  Mon Jan 24 09:38:35 2011
From: mark at mark.mielke.cc (Mark Mielke)
Date: Mon, 24 Jan 2011 12:38:35 -0500
Subject: [Slony1-general] Does Slony support replicating from one schema to
 another schema (different database, different schema name)?
Message-ID: <4D3DB91B.4010906@mark.mielke.cc>

Hi all:

I am trying to use Slony for the first time - sorry if this is a newbie 
question...

I am trying to replicating two of our JIRA databases into a data 
warehouse using Slony. Each instance has it's own "jira" database, and 
stores all tables and sequences in the "public" schema.

In the data warehouse, I would like to replicate each instance to a 
schema in the same database.

So something like:

     jira_host1:"jira":"public" -> dw_host1:"dw":"jira1"
     jira_host2:"jira":"public" -> dw_host2:"dw":"jira2"

Can Slony do this and I am missing it in the documentation? Or is Slony 
not really designed to do this?

If not designed to do this - does anybody have any suggestions on how to 
accomplish the above?

Thanks for the help, all!

-- 
Mark Mielke<mark at mielke.cc>


From cbbrowne at ca.afilias.info  Mon Jan 24 09:56:49 2011
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Mon, 24 Jan 2011 12:56:49 -0500
Subject: [Slony1-general] Does Slony support replicating from one schema
	to another schema (different database, different schema name)?
In-Reply-To: <4D3DB91B.4010906@mark.mielke.cc> (Mark Mielke's message of "Mon, 
	24 Jan 2011 12:38:35 -0500")
References: <4D3DB91B.4010906@mark.mielke.cc>
Message-ID: <87aaiq89su.fsf@cbbrowne.afilias-int.info>

Mark Mielke <mark at mark.mielke.cc> writes:
> Hi all:
>
> I am trying to use Slony for the first time - sorry if this is a newbie 
> question...
>
> I am trying to replicating two of our JIRA databases into a data 
> warehouse using Slony. Each instance has it's own "jira" database, and 
> stores all tables and sequences in the "public" schema.
>
> In the data warehouse, I would like to replicate each instance to a 
> schema in the same database.
>
> So something like:
>
>      jira_host1:"jira":"public" -> dw_host1:"dw":"jira1"
>      jira_host2:"jira":"public" -> dw_host2:"dw":"jira2"
>
> Can Slony do this and I am missing it in the documentation? Or is Slony 
> not really designed to do this?
>
> If not designed to do this - does anybody have any suggestions on how to 
> accomplish the above?
>
> Thanks for the help, all!

Sadly, no, this isn't something that Slony can do today.

There has occasionally been talk about this sort of feature; the
challenge comes fundamentally in how to manage the configuration.  That
is, how do you control the names of table and schema?  How should Slony
capture that configuration, and maintain it?  And what is supposed to
happen if you reconfigure the cluster via MOVE SET or FAILOVER?

There's a chance that it has a destabilizing effect (e.g. - if you do
MOVE SET/FAILOVER, that might break the cluster), and if that be the
case, it's a dangerous thing to do.  I don't know that this is the case;
the analysis hasn't been done to determine such.

The current model of sl_table and sl_log_[12] are somewhat unamenable to
this in that the shape of configuration tends to be drawn from the
provider node; there's not a particularly easy place to go to redirect
the names.  

One of the particularly interesting ideas for the future is the change
to use "copy protocol", where we'd use COPY where today the slon
generates INSERT/UPDATE/DELETE statements.  Replicated data would get
transferred via COPY into the sl_log tables on the subscriber, and a
trigger on sl_log_[12] would expand it into I/U/D within the subscriber
database.  'Twould be nifty from performance standpoint, as:
  - It eliminates a bunch of parsing
  - It eliminates some present slon memory bloat issues because COPY is
    a streaming protocol
  - COPYing data into sl_log_* is *way* faster than INSERTing the same,
tho I digress there.

This protocol *IS* relevant in that having the expansion take place on
the subscriber lends itself to doing further transformations (e.g. -
such as changing table/schema name) as a part of that expansion.

In any case, the most troublesome part is thinking about how to
configure this, and managing that configuration.  
-- 
output = ("cbbrowne" "@" "afilias.info")
Christopher Browne
"Bother,"  said Pooh,  "Eeyore, ready  two photon  torpedoes  and lock
phasers on the Heffalump, Piglet, meet me in transporter room three"

From ssinger at ca.afilias.info  Mon Jan 24 12:19:06 2011
From: ssinger at ca.afilias.info (Steve Singer)
Date: Mon, 24 Jan 2011 15:19:06 -0500
Subject: [Slony1-general] /usr/bin/ld: skipping incompatible
 /usr/pgsql-9.0/lib//libpgport.a when searching for -lpgport
In-Reply-To: <AB4F91433E82F043B53AF2DA8812C47017B0D18111@34093-MBX-C17.mex07a.mlsrvr.com>
References: <AB4F91433E82F043B53AF2DA8812C47017B0D18111@34093-MBX-C17.mex07a.mlsrvr.com>
Message-ID: <4D3DDEBA.9090009@ca.afilias.info>

On 11-01-24 10:20 AM, Ejber Ozkan wrote:
> I wish to test migrate from 8.1.15 to 9.0 of postgresql (yes very old!).
>
> slony1-1.2.22 compiled ok on 8.1 (FC10)
>
> but on CentOS 5.5 with Postgresql90 installed ( I only have to x64
> installed of 9.0 from the pgrpms).
>
> I get a compile error:
>
> gcc -g -O2 -Wall -Wmissing-prototypes -Wmissing-declarations -I../..
> -DPGSHARE="\"/usr/pgsql-9.0/bin//../share/\"" -DPG_VERSION_MAJOR=9
> slonik.o dbutil.o parser.o ../parsestatements/scanner.o
> -L/usr/pgsql-9.0/lib/ -L/usr/pgsql-9.0/lib/ -lpq
> -Wl,-rpath,/usr/pgsql-9.0/lib/ -lpgport -o slonik
>
> /usr/bin/ld: skipping incompatible /usr/pgsql-9.0/lib//libpgport.a when
> searching for -lpgport
>
> /usr/bin/ld: skipping incompatible /usr/pgsql-9.0/lib//libpgport.a when
> searching for -lpgport
>
> /usr/bin/ld: cannot find -lpgport
>
> collect2: ld returned 1 exit status
>

I've usually seen that style of error with a conflict between 64 vs 32 
bit libraries.  You might want to double check that you have all the 64 
bit RPM's installed (I'm assuming you want to build 64 bit).

Also make sure you have the postgresql90-devel package installed.




> make[2]: *** [slonik] Error 1
>

> On a related note can I run slony 2.0 on PG 9.0 and replicate from 8.1
> with slony 1.2 ?, I couldn?t find an answer in the documentation about
> replication from different slony codebases.
>

No you must be running the same version of slony on all nodes in your 
cluster.

> Thanks.
>
> *Ejber Ozkan***
>
>
>
> _______________________________________________
> Slony1-general mailing list
> Slony1-general at lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general


From devrim at gunduz.org  Mon Jan 24 12:26:42 2011
From: devrim at gunduz.org (Devrim =?ISO-8859-1?Q?G=DCND=DCZ?=)
Date: Mon, 24 Jan 2011 22:26:42 +0200
Subject: [Slony1-general] /usr/bin/ld: skipping incompatible
 /usr/pgsql-9.0/lib//libpgport.a when searching for -lpgport
In-Reply-To: <AB4F91433E82F043B53AF2DA8812C47017B0D18111@34093-MBX-C17.mex07a.mlsrvr.com>
References: <AB4F91433E82F043B53AF2DA8812C47017B0D18111@34093-MBX-C17.mex07a.mlsrvr.com>
Message-ID: <1295900802.2477.6.camel@lenovo01-laptop03.gunduz.org>

On Mon, 2011-01-24 at 09:20 -0600, Ejber Ozkan wrote:
> 
> slony1-1.2.22 compiled ok on 8.1 (FC10)
> but on CentOS 5.5 with Postgresql90 installed ( I only have to x64
> installed of 9.0 from the pgrpms).
> I get a compile error:
> 
> gcc -g -O2 -Wall -Wmissing-prototypes -Wmissing-declarations -I../..
> -DPGSHARE="\"/usr/pgsql-9.0/bin//../share/\"" -DPG_VERSION_MAJOR=9
> slonik.o dbutil.o parser.o  ../parsestatements/scanner.o
> -L/usr/pgsql-9.0/lib/ -L/usr/pgsql-9.0/lib/ -lpq
> -Wl,-rpath,/usr/pgsql-9.0/lib/ -lpgport  -o slonik
> /usr/bin/ld: skipping incompatible /usr/pgsql-9.0/lib//libpgport.a
> when searching for -lpgport
> /usr/bin/ld: skipping incompatible /usr/pgsql-9.0/lib//libpgport.a
> when searching for -lpgport
> /usr/bin/ld: cannot find -lpgport
> collect2: ld returned 1 exit status
> make[2]: *** [slonik] Error 1 

http://blog.2ndquadrant.com/en/2011/01/how-not-to-build-postgresql-90.html

Could this be the issue?
-- 
Devrim G?ND?Z
PostgreSQL Dan??man?/Consultant, Red Hat Certified Engineer
PostgreSQL RPM Repository: http://yum.pgrpms.org
Community: devrim~PostgreSQL.org, devrim.gunduz~linux.org.tr
http://www.gunduz.org  Twitter: http://twitter.com/devrimgunduz
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 198 bytes
Desc: This is a digitally signed message part
Url : http://lists.slony.info/pipermail/slony1-general/attachments/20110124/ed1a95c9/attachment.pgp 

From stephane.schildknecht at postgresql.fr  Tue Jan 25 05:42:03 2011
From: stephane.schildknecht at postgresql.fr (=?ISO-8859-15?Q?=22St=E9phane_A=2E_Schildknecht=22?=)
Date: Tue, 25 Jan 2011 14:42:03 +0100
Subject: [Slony1-general] Ubuntu packages (backport) ?
Message-ID: <4D3ED32B.5040404@postgresql.fr>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Hi,

I'm Looking for Slony (1.2 or 2.0) to replicate between PG 8.4 on Ubuntu 8.04
and PG 9.0 on Ubuntu 10.04.

Having a look at packages.ubuntu.com, I could see slony versions are tight to
Ubuntu versions, and don't follow further patches.

The only Ubuntu version with last version of Slony seems to be natty. But, I
won't use natty in a production environment, yet.

I know I could compile slony, but there are cases where packages are more
convenient.

Are there backports of Slony latest versions backports for hardy and lucid ?

Thanks in advance.

BTW, is there a new version of Slony scheduled (whith patch for sl_status
problem) ?

Regards,
- -- 
St?phane Schildknecht
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.10 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/

iEYEARECAAYFAk0+0ysACgkQA+REPKWGI0ElxACfZv6bRW6Uu7op8AaAX9DWZtSy
iAUAoNK9VD98YJFQMtrV4cnvvt0Aa9I9
=Aoul
-----END PGP SIGNATURE-----

From ozkan at polestarglobal.com  Tue Jan 25 06:57:43 2011
From: ozkan at polestarglobal.com (Ejber Ozkan)
Date: Tue, 25 Jan 2011 08:57:43 -0600
Subject: [Slony1-general] /usr/bin/ld: skipping incompatible
 /usr/pgsql-9.0/lib//libpgport.a when searching for -lpgport
In-Reply-To: <1295900802.2477.6.camel@lenovo01-laptop03.gunduz.org>
References: <AB4F91433E82F043B53AF2DA8812C47017B0D18111@34093-MBX-C17.mex07a.mlsrvr.com>
	<1295900802.2477.6.camel@lenovo01-laptop03.gunduz.org>
Message-ID: <AB4F91433E82F043B53AF2DA8812C47017B0D18521@34093-MBX-C17.mex07a.mlsrvr.com>

I may have installed the devel 32 bit , but I DID uninstall it, and only had x64. Strange.
I uninstalled all the rpms again (rpm -e postgresql90-devel --allmatches) and re-yummed and now slony compiled successfully.
Incidentally I tried removing the -lgport and recompiling and that worked too (After commenting out a few lines) , but I thought that would not be safe.
I am now testing slony with 8.1 to 9.0 and it appears to be going smoothly so far.
Sahol dostum!

Kind Regards
--
Ejber Ozkan

-----Original Message-----
From: Devrim G?ND?Z [mailto:devrim at gunduz.org] 
Sent: 24 January 2011 20:27
To: Ejber Ozkan
Cc: slony1-general at lists.slony.info
Subject: Re: [Slony1-general] /usr/bin/ld: skipping incompatible /usr/pgsql-9.0/lib//libpgport.a when searching for -lpgport

On Mon, 2011-01-24 at 09:20 -0600, Ejber Ozkan wrote:
> 
> slony1-1.2.22 compiled ok on 8.1 (FC10) but on CentOS 5.5 with 
> Postgresql90 installed ( I only have to x64 installed of 9.0 from the 
> pgrpms).
> I get a compile error:
> 
> gcc -g -O2 -Wall -Wmissing-prototypes -Wmissing-declarations -I../..
> -DPGSHARE="\"/usr/pgsql-9.0/bin//../share/\"" -DPG_VERSION_MAJOR=9 
> slonik.o dbutil.o parser.o  ../parsestatements/scanner.o 
> -L/usr/pgsql-9.0/lib/ -L/usr/pgsql-9.0/lib/ -lpq 
> -Wl,-rpath,/usr/pgsql-9.0/lib/ -lpgport  -o slonik
> /usr/bin/ld: skipping incompatible /usr/pgsql-9.0/lib//libpgport.a 
> when searching for -lpgport
> /usr/bin/ld: skipping incompatible /usr/pgsql-9.0/lib//libpgport.a 
> when searching for -lpgport
> /usr/bin/ld: cannot find -lpgport
> collect2: ld returned 1 exit status
> make[2]: *** [slonik] Error 1

http://blog.2ndquadrant.com/en/2011/01/how-not-to-build-postgresql-90.html

Could this be the issue?
--
Devrim G?ND?Z
PostgreSQL Dan??man?/Consultant, Red Hat Certified Engineer PostgreSQL RPM Repository: http://yum.pgrpms.org
Community: devrim~PostgreSQL.org, devrim.gunduz~linux.org.tr http://www.gunduz.org  Twitter: http://twitter.com/devrimgunduz

From ssinger at ca.afilias.info  Tue Jan 25 07:22:08 2011
From: ssinger at ca.afilias.info (Steve Singer)
Date: Tue, 25 Jan 2011 10:22:08 -0500
Subject: [Slony1-general] Ubuntu packages (backport) ?
In-Reply-To: <4D3ED32B.5040404@postgresql.fr>
References: <4D3ED32B.5040404@postgresql.fr>
Message-ID: <4D3EEAA0.9050900@ca.afilias.info>

On 11-01-25 08:42 AM, "St?phane A. Schildknecht" wrote:
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>


> Hi,
>
>
> BTW, is there a new version of Slony scheduled (whith patch for sl_status
> problem) ?
>

I'm a bit confused about this sl_status issue. I think you are referring 
to http://lists.slony.info/pipermail/slony1-general/2011-January/011477.html

but I still don't have a good grasp on the behavior being observed.  The 
patch merged in from 2.1 dealt with cases where the remoteListener 
losses it's connection with a remote postgres and isn't able to properly 
recover from it.  Restarting slon would fix the issue.

If this happens you would see lag in sl_status but only until you 
restart the slon and it connects to the database.




> Regards,
> - --
> St?phane Schildknecht
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v1.4.10 (GNU/Linux)
> Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/
>
> iEYEARECAAYFAk0+0ysACgkQA+REPKWGI0ElxACfZv6bRW6Uu7op8AaAX9DWZtSy
> iAUAoNK9VD98YJFQMtrV4cnvvt0Aa9I9
> =Aoul
> -----END PGP SIGNATURE-----
> _______________________________________________
> Slony1-general mailing list
> Slony1-general at lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general


From JanWieck at Yahoo.com  Thu Jan 27 07:30:46 2011
From: JanWieck at Yahoo.com (Jan Wieck)
Date: Thu, 27 Jan 2011 10:30:46 -0500
Subject: [Slony1-general] Suggestions for enhancement 173 - SLONY ABORT
In-Reply-To: <4D30AD71.7070408@ca.afilias.info>
References: <87sjwweccu.fsf@cbbrowne.afilias-int.info>
	<4D30AD71.7070408@ca.afilias.info>
Message-ID: <4D418FA6.7010309@Yahoo.com>

On 1/14/2011 3:09 PM, Steve Singer wrote:
> On 11-01-13 04:13 PM, Christopher Browne wrote:
>>  Bug #173 is about the notion of extending Slonik to allow one to
>>  ask a Slonik script to error out upon running into particular
>>  conditions.
>>
>>  These "ABORT" statements could be used to guard a script; if it runs
>>  into unacceptable pre-conditions, it may terminate before it does any
>>  damage to the cluster.
>>
>>  I suggest the following, as starting points:
>>
>>  - Behind by...
>>      ->= 5 events
>>      ->= 30 seconds
>>
>>     ABORT IF BEHIND ( PROVIDER = 1, RECEIVER = 3, SECONDS = 30, comment = 'Behind by 30 seconds', return=1);
>>     ABORT IF BEHIND ( PROVIDER = 1, RECEIVER = 3, EVENT = 5, comment= 'Behind by 5 events', return=2);
>>
>
> I like this idea in principal:
> -Do you mean provider or do you really mean origin?
> -I think EVENT should be 'EVENT COUNT' or something to indicate that we
> are checking the number of events it is behind, versus ('has the
> receiver received event number 5')

Another important detail would be to ask

     "Are there any non-SYNC events outstanding?"

Scripts that modify the cluster configuration may not care about how far 
a node is behind in data, but definitely need to assume that the current 
configuration is stable and not altered underneath by older events, that 
haven't propagated through the cluster.


Jan

-- 
Anyone who trades liberty for security deserves neither
liberty nor security. -- Benjamin Franklin

From rod at iol.ie  Thu Jan 27 11:50:48 2011
From: rod at iol.ie (Raymond O'Donnell)
Date: Thu, 27 Jan 2011 19:50:48 +0000
Subject: [Slony1-general] Slon daemon
Message-ID: <4D41CC98.1030802@iol.ie>

Hi all,

Apologies for the entry-level question.... I'm getting to grips with 
Slony on Linux for the first time (have been running it on Windows for a 
while).

The slon program is described in the docs as a daemon.... so does that 
mean that when run it's supposed to detach from the terminal and run 
independently, continuing to run when I log out?

If not, what do people usually do?

Many thanks,

Ray.


-- 
Raymond O'Donnell :: Galway :: Ireland
rod at iol.ie

From cbbrowne at ca.afilias.info  Thu Jan 27 12:35:53 2011
From: cbbrowne at ca.afilias.info (Christopher Browne)
Date: Thu, 27 Jan 2011 15:35:53 -0500
Subject: [Slony1-general] Slon daemon
In-Reply-To: <4D41CC98.1030802@iol.ie> (Raymond O'Donnell's message of "Thu,
	27 Jan 2011 19:50:48 +0000")
References: <4D41CC98.1030802@iol.ie>
Message-ID: <87wrlqm6dy.fsf@cbbrowne.afilias-int.info>

Raymond O'Donnell <rod at iol.ie> writes:
> Hi all,
>
> Apologies for the entry-level question.... I'm getting to grips with 
> Slony on Linux for the first time (have been running it on Windows for a 
> while).
>
> The slon program is described in the docs as a daemon.... so does that 
> mean that when run it's supposed to detach from the terminal and run 
> independently, continuing to run when I log out?
>
> If not, what do people usually do?

Erm, slon is logically a daemon, so it's *like* those programs that
detach themselves.  And yes, it's supposed to run independently, because
it's not much good if it stops replicating when you log out :-).

It's not *formally* implemented as a daemon, though - we didn't go the
whole 9 yards to make it detach itself that way.

You are free to wrap it in something that leaves the result silent
(e.g. - like a shell script).

On Windows, I believe it gets invoked as a Service, so the slon
processes are children of the server process.

On Linux, there are several ways to have a "service" wrapped around it:

1.  You could run on command line, so your shell is the service, and it
emits messages to stdout, which might emit to your terminal session.
Pretty useful for debugging; it's kind of inconvenient when a daemon
is unable to make itself heard at the terminal.

2.  There are built-in scripts that represent 'service wrappers.'

See tools/slon_start.sh, tools/launch_clusters.sh, which are scripts
that I wrote for this purpose.  One does one slon; the other launches a
whole set of them.

3.  People commonly build scripts in the style of SysV Init that are
pretty analogous to those in #2.

See /etc/init.d on your favorite system for samples of such scripts for
other services.  They'll generally be pretty similar to the scripts in
#2.

The thing that's special/different about Slony is that it launches a
slon for every replica, whereas it's typical for /etc/init.d scripts to
be starting only a single instance of a service to run on that host.
-- 
let name="cbbrowne" and tld="ca.afilias.info" in name ^ "@" ^ tld;;
Christopher Browne
"Bother,"  said Pooh,  "Eeyore, ready  two photon  torpedoes  and lock
phasers on the Heffalump, Piglet, meet me in transporter room three"

From rod at iol.ie  Thu Jan 27 13:06:22 2011
From: rod at iol.ie (Raymond O'Donnell)
Date: Thu, 27 Jan 2011 21:06:22 +0000
Subject: [Slony1-general] Slon daemon
In-Reply-To: <87wrlqm6dy.fsf@cbbrowne.afilias-int.info>
References: <4D41CC98.1030802@iol.ie>
	<87wrlqm6dy.fsf@cbbrowne.afilias-int.info>
Message-ID: <4D41DE4E.1020600@iol.ie>

On 27/01/2011 20:35, Christopher Browne wrote:
> Raymond O'Donnell<rod at iol.ie>  writes:
>> Hi all,
>>
>> Apologies for the entry-level question.... I'm getting to grips with
>> Slony on Linux for the first time (have been running it on Windows for a
>> while).
>>
>> The slon program is described in the docs as a daemon.... so does that
>> mean that when run it's supposed to detach from the terminal and run
>> independently, continuing to run when I log out?
>>
>> If not, what do people usually do?
>
> Erm, slon is logically a daemon, so it's *like* those programs that
> detach themselves.  And yes, it's supposed to run independently, because
> it's not much good if it stops replicating when you log out :-).
>
> It's not *formally* implemented as a daemon, though - we didn't go the
> whole 9 yards to make it detach itself that way.

Hi Christopher, thanks for the reply. That's what I was wondering about 
- experimentation showed that the slon process did indeed disappear when 
I logged out. :-)

Just curious - why did you go this route with the implementation?

> See tools/slon_start.sh, tools/launch_clusters.sh, which are scripts
> that I wrote for this purpose.  One does one slon; the other launches a
> whole set of them.

I was looking at slon_start.sh, and as far as I can make out (I'm no 
expert in shell scripting) slon just gets pushed into the background; 
won't it then vanish once I log out? - or have I misunderstood the script?

Thanks for the help.

Ray.

-- 
Raymond O'Donnell :: Galway :: Ireland
rod at iol.ie

From scott.marlowe at gmail.com  Thu Jan 27 13:15:13 2011
From: scott.marlowe at gmail.com (Scott Marlowe)
Date: Thu, 27 Jan 2011 14:15:13 -0700
Subject: [Slony1-general] Slon daemon
In-Reply-To: <4D41DE4E.1020600@iol.ie>
References: <4D41CC98.1030802@iol.ie>
	<87wrlqm6dy.fsf@cbbrowne.afilias-int.info>
	<4D41DE4E.1020600@iol.ie>
Message-ID: <AANLkTik-+Z6ernbsHuxpJkXx32mabUmhS_=n68Qi9nKy@mail.gmail.com>

On Thu, Jan 27, 2011 at 2:06 PM, Raymond O'Donnell <rod at iol.ie> wrote:
> On 27/01/2011 20:35, Christopher Browne wrote:
>> Raymond O'Donnell<rod at iol.ie> ?writes:
>>> Hi all,
>>>
>>> Apologies for the entry-level question.... I'm getting to grips with
>>> Slony on Linux for the first time (have been running it on Windows for a
>>> while).
>>>
>>> The slon program is described in the docs as a daemon.... so does that
>>> mean that when run it's supposed to detach from the terminal and run
>>> independently, continuing to run when I log out?
>>>
>>> If not, what do people usually do?
>>
>> Erm, slon is logically a daemon, so it's *like* those programs that
>> detach themselves. ?And yes, it's supposed to run independently, because
>> it's not much good if it stops replicating when you log out :-).
>>
>> It's not *formally* implemented as a daemon, though - we didn't go the
>> whole 9 yards to make it detach itself that way.
>
> Hi Christopher, thanks for the reply. That's what I was wondering about
> - experimentation showed that the slon process did indeed disappear when
> I logged out. :-)
>
> Just curious - why did you go this route with the implementation.

Actually it's VERY common to implement unix daemons this way, for the
reason mentioned in Christopher's reply, that it makes troubleshooting
easier.  For instance Postgres uses either the pg_ctl wrapper or an
/etc/init.d/postgresql wrapper to daemonize it, but is easily started
in single user mode for troubleshooting.

In fact, according to grep, sort, uniq, and wc, 83 of the 88 daemons
in my /etc/init.d directory have && in them somewhere which is usually
used to detach a process from a terminal in this way.

> I was looking at slon_start.sh, and as far as I can make out (I'm no
> expert in shell scripting) slon just gets pushed into the background;
> won't it then vanish once I log out? - or have I misunderstood the script?

No, it gets pushed into the background and detached as well.

From ian.lea at gmail.com  Thu Jan 27 12:14:55 2011
From: ian.lea at gmail.com (Ian Lea)
Date: Thu, 27 Jan 2011 20:14:55 +0000
Subject: [Slony1-general] Slon daemon
In-Reply-To: <4D41CC98.1030802@iol.ie>
References: <4D41CC98.1030802@iol.ie>
Message-ID: <AANLkTimB829ZLBLOacbCxv_oYRKO8Q1P2avrL6XuST2d@mail.gmail.com>

> ...
> The slon program is described in the docs as a daemon.... so does that
> mean that when run it's supposed to detach from the terminal and run
> independently, continuing to run when I log out?

Yes.  http://en.wikipedia.org/wiki/Daemon_(computer_software)

--
Ian.

From kleptog at gmail.com  Thu Jan 27 13:45:29 2011
From: kleptog at gmail.com (Martijn van Oosterhout)
Date: Thu, 27 Jan 2011 22:45:29 +0100
Subject: [Slony1-general] Slon daemon
In-Reply-To: <87wrlqm6dy.fsf@cbbrowne.afilias-int.info>
References: <4D41CC98.1030802@iol.ie>
	<87wrlqm6dy.fsf@cbbrowne.afilias-int.info>
Message-ID: <AANLkTi=bGb8Wbo+csLFYWkBqSAi_SFSEHPs-zQG=Bb0y@mail.gmail.com>

On 27 January 2011 21:35, Christopher Browne <cbbrowne at ca.afilias.info> wrote:
> Erm, slon is logically a daemon, so it's *like* those programs that
> detach themselves. ?And yes, it's supposed to run independently, because
> it's not much good if it stops replicating when you log out :-).

<snip>

> On Linux, there are several ways to have a "service" wrapped around it:

I find daemontools works well.

http://cr.yp.to/daemontools.html

Don't mind the author. It's packaged for several distributions and
provides a nice way to manage daemons in general but slon in
particular is well suited.

Have a nice day,
-- 
Martijn van Oosterhout <kleptog at gmail.com> http://svana.org/kleptog/

From rod at iol.ie  Thu Jan 27 14:05:26 2011
From: rod at iol.ie (Raymond O'Donnell)
Date: Thu, 27 Jan 2011 22:05:26 +0000
Subject: [Slony1-general] Slon daemon
In-Reply-To: <AANLkTi=bGb8Wbo+csLFYWkBqSAi_SFSEHPs-zQG=Bb0y@mail.gmail.com>
References: <4D41CC98.1030802@iol.ie>	<87wrlqm6dy.fsf@cbbrowne.afilias-int.info>
	<AANLkTi=bGb8Wbo+csLFYWkBqSAi_SFSEHPs-zQG=Bb0y@mail.gmail.com>
Message-ID: <4D41EC26.6030402@iol.ie>

On 27/01/2011 21:45, Martijn van Oosterhout wrote:
> On 27 January 2011 21:35, Christopher Browne<cbbrowne at ca.afilias.info>  wrote:
>> Erm, slon is logically a daemon, so it's *like* those programs that
>> detach themselves.  And yes, it's supposed to run independently, because
>> it's not much good if it stops replicating when you log out :-).
>
> <snip>
>
>> On Linux, there are several ways to have a "service" wrapped around it:
>
> I find daemontools works well.
>
> http://cr.yp.to/daemontools.html
>
> Don't mind the author. It's packaged for several distributions and
> provides a nice way to manage daemons in general but slon in
> particular is well suited.

Thanks everyone for your replies... I'm not a Linux expert, so am 
getting my head around how things work.

A bit more Googling led me to /etc/init.d/skeleton (I'm on Debian), 
which I'll have a go at adapting. I'll have a look at daemontools also, 
as Martijn has suggested.

Ray.

-- 
Raymond O'Donnell :: Galway :: Ireland
rod at iol.ie

From scott.marlowe at gmail.com  Thu Jan 27 14:08:14 2011
From: scott.marlowe at gmail.com (Scott Marlowe)
Date: Thu, 27 Jan 2011 15:08:14 -0700
Subject: [Slony1-general] Slon daemon
In-Reply-To: <4D41EC26.6030402@iol.ie>
References: <4D41CC98.1030802@iol.ie>
	<87wrlqm6dy.fsf@cbbrowne.afilias-int.info>
	<AANLkTi=bGb8Wbo+csLFYWkBqSAi_SFSEHPs-zQG=Bb0y@mail.gmail.com>
	<4D41EC26.6030402@iol.ie>
Message-ID: <AANLkTi=QMuy755sZAn_t5rqaYfL5Z42SOcJWj-jSO8op@mail.gmail.com>

On Thu, Jan 27, 2011 at 3:05 PM, Raymond O'Donnell <rod at iol.ie> wrote:
> which I'll have a go at adapting. I'll have a look at daemontools also,
> as Martijn has suggested.

I vote for daemontools too, we use them in production and it greatly
simplifies some stuff.  We don't define our dataset in it, just our
servers, but if you've got 5 or 6 slon machines up and running, it
makes the /etc/init.d/slony stuff much easier.

From rod at iol.ie  Thu Jan 27 14:55:37 2011
From: rod at iol.ie (Raymond O'Donnell)
Date: Thu, 27 Jan 2011 22:55:37 +0000
Subject: [Slony1-general] Slon daemon
In-Reply-To: <AANLkTi=QMuy755sZAn_t5rqaYfL5Z42SOcJWj-jSO8op@mail.gmail.com>
References: <4D41CC98.1030802@iol.ie>	<87wrlqm6dy.fsf@cbbrowne.afilias-int.info>	<AANLkTi=bGb8Wbo+csLFYWkBqSAi_SFSEHPs-zQG=Bb0y@mail.gmail.com>	<4D41EC26.6030402@iol.ie>
	<AANLkTi=QMuy755sZAn_t5rqaYfL5Z42SOcJWj-jSO8op@mail.gmail.com>
Message-ID: <4D41F7E9.8040801@iol.ie>

On 27/01/2011 22:08, Scott Marlowe wrote:
> On Thu, Jan 27, 2011 at 3:05 PM, Raymond O'Donnell<rod at iol.ie>  wrote:
>> which I'll have a go at adapting. I'll have a look at daemontools also,
>> as Martijn has suggested.
>
> I vote for daemontools too, we use them in production and it greatly
> simplifies some stuff.  We don't define our dataset in it, just our
> servers, but if you've got 5 or 6 slon machines up and running, it
> makes the /etc/init.d/slony stuff much easier.

I've been skimming through the docs on the daemontools site, and it 
seems like what I need. I'll have a go at it tomorrow.... too tired now 
to take anything else in. :-)

Thanks again for the help.

Ray.

-- 
Raymond O'Donnell :: Galway :: Ireland
rod at iol.ie

