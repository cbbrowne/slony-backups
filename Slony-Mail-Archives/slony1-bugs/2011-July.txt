From bugzilla-daemon at main.slony.info  Fri Jul  1 08:04:07 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri,  1 Jul 2011 08:04:07 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 224] New: slonik_build_env generates incorrect
 variable name @KEYEDTABLES
Message-ID: <bug-224-4@http.www.slony.info/bugzilla/>

http://www.slony.info/bugzilla/show_bug.cgi?id=224

           Summary: slonik_build_env generates incorrect variable name
                    @KEYEDTABLES
           Product: Slony-I
           Version: 2.0
          Platform: PC
        OS/Version: Linux
            Status: NEW
          Severity: major
          Priority: low
         Component: altperl
        AssignedTo: slony1-bugs at lists.slony.info
        ReportedBy: mark at mitsein.net
                CC: slony1-bugs at lists.slony.info
   Estimated Hours: 0.0


Created an attachment (id=111)
 --> (http://www.slony.info/bugzilla/attachment.cgi?id=111)
patch to fix slonik_build_env

slonik_build_env puts tables that have explicit primary keys into a
@KEYEDTABLES variable.  It should be @PKEYEDTABLES - there is no @KEYEDTABLES
variable used in any of the altperl scripts.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Mon Jul  4 07:50:44 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Mon,  4 Jul 2011 07:50:44 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 218] slon often has to retry transactions due to
 concurrent update in 2.1.0.b2
In-Reply-To: <bug-218-4@http.www.slony.info/bugzilla/>
References: <bug-218-4@http.www.slony.info/bugzilla/>
Message-ID: <20110704145044.98085290DED@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=218

--- Comment #16 from Steve Singer <ssinger at ca.afilias.info> 2011-07-04 07:50:44 PDT ---
(In reply to comment #15)
> (In reply to comment #14)
> > Also remember to remove the 'LOCK @NAMESPACE at .sl_config_lock' lines from
> > slony_funcs.sql - since a) the locking is now being done elsewhere, no point in
> > paying a penalty twice.  b) Leaving it in there is a bit confusing since
> > someone else might come along and think that it is okay to obtain
> > sl_config_lock in the stored functions
> 
> Good point, though the price isn't too terribly high.
> 
> Have done so, and had a successful run of all the regression tests against
> this.
> 
> https://github.com/cbbrowne/slony1-engine/commit/35fbb13b44e2136b808a5cd7e8457f616fcc5ccb

in cleanupThread.c  there is no explicit transaction (that I can see)

This means that the LOCK TABLE  a and the 'select ..cleanupEvent(...) are done
in separate transactions, so the lock is already released before the call to
cleanupEvent.

in remote_worker.c you seem to lock config_lock before event_lock while in
slonik.c you lock event_lock before config_lock.  We should try to always get
these locks in the same order (I am not sure which order is better or if it
matters)

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Mon Jul  4 07:51:39 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Mon,  4 Jul 2011 07:51:39 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 218] slon often has to retry transactions due to
 concurrent update in 2.1.0.b2
In-Reply-To: <bug-218-4@http.www.slony.info/bugzilla/>
References: <bug-218-4@http.www.slony.info/bugzilla/>
Message-ID: <20110704145139.CE17E290DF2@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=218

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         AssignedTo|ssinger at ca.afilias.info     |cbbrowne at ca.afilias.info

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Mon Jul  4 10:27:19 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Mon,  4 Jul 2011 10:27:19 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 223] slonik can wait for a node it just
	uninstalled
In-Reply-To: <bug-223-4@http.www.slony.info/bugzilla/>
References: <bug-223-4@http.www.slony.info/bugzilla/>
Message-ID: <20110704172719.9A418290DEB@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=223

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         AssignedTo|slony1-bugs at lists.slony.inf |ssinger at ca.afilias.info
                   |o                           |
             Status|NEW                         |ASSIGNED

--- Comment #1 from Steve Singer <ssinger at ca.afilias.info> 2011-07-04 10:27:19 PDT ---
Created an attachment (id=112)
 --> (http://www.slony.info/bugzilla/attachment.cgi?id=112)
fix for bug 223

Fix for bug #223

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Mon Jul  4 10:29:06 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Mon,  4 Jul 2011 10:29:06 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 223] slonik can wait for a node it just
	uninstalled
In-Reply-To: <bug-223-4@http.www.slony.info/bugzilla/>
References: <bug-223-4@http.www.slony.info/bugzilla/>
Message-ID: <20110704172906.61923290DE7@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=223

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         AssignedTo|ssinger at ca.afilias.info     |janwieck at yahoo.com

--- Comment #2 from Steve Singer <ssinger at ca.afilias.info> 2011-07-04 10:29:06 PDT ---
Please arrange a review for this patch.
Attached or available at https://github.com/ssinger/slony1-engine/tree/bug223

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Tue Jul  5 13:45:19 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Tue,  5 Jul 2011 13:45:19 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 218] slon often has to retry transactions due to
 concurrent update in 2.1.0.b2
In-Reply-To: <bug-218-4@http.www.slony.info/bugzilla/>
References: <bug-218-4@http.www.slony.info/bugzilla/>
Message-ID: <20110705204519.296B6290D33@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=218

--- Comment #17 from Steve Singer <ssinger at ca.afilias.info> 2011-07-05 13:45:19 PDT ---
I am starting to suspect that commit 9f0ff6c21eb9f7493de01a4bda16f178e97c80aa
is causing the disorder tests (Move Set, when run as part of a larger set) to
fail.

It *seems* that prior to this commit it passes while after I get failures.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Wed Jul  6 08:41:48 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed,  6 Jul 2011 08:41:48 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 218] slon often has to retry transactions due to
 concurrent update in 2.1.0.b2
In-Reply-To: <bug-218-4@http.www.slony.info/bugzilla/>
References: <bug-218-4@http.www.slony.info/bugzilla/>
Message-ID: <20110706154149.0736C290D77@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=218

--- Comment #18 from Christopher Browne <cbbrowne at ca.afilias.info> 2011-07-06 08:41:48 PDT ---
(In reply to comment #16)
> in cleanupThread.c  there is no explicit transaction (that I can see)
> 
> This means that the LOCK TABLE  a and the 'select ..cleanupEvent(...) are done
> in separate transactions, so the lock is already released before the call to
> cleanupEvent.

Eek, yes, that's doubtless so.

There wasn't an explicit transaction because the cleanup thread used to have,
as a major component, running VACUUM against Slony's tables, and that can't
take place inside a transaction.

We clearly have activity that needs a transaction, so this needs to complicate
a little bit.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Wed Jul  6 09:32:55 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed,  6 Jul 2011 09:32:55 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 224] slonik_build_env generates incorrect
 variable name @KEYEDTABLES
In-Reply-To: <bug-224-4@http.www.slony.info/bugzilla/>
References: <bug-224-4@http.www.slony.info/bugzilla/>
Message-ID: <20110706163255.A983A290DE4@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=224

Christopher Browne <cbbrowne at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|                            |FIXED
             Status|NEW                         |RESOLVED

--- Comment #1 from Christopher Browne <cbbrowne at ca.afilias.info> 2011-07-06 09:32:55 PDT ---
Applied to 3 branches:

a) master

http://git.postgresql.org/gitweb?p=slony1-engine.git;a=commit;h=9bf3e9a47cc198d40250fc01f4276ee9e0cca2a2

b) 2.0

http://git.postgresql.org/gitweb?p=slony1-engine.git;a=commit;h=573778393e0a084e67c2ff4b5e4c59c08f7a7c48

c) 1.2

http://git.postgresql.org/gitweb?p=slony1-engine.git;a=commit;h=26e9c679cc90d8e6587d7ef1893f2e0bb055baff

Thanks!

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Thu Jul  7 07:19:08 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Thu,  7 Jul 2011 07:19:08 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 223] slonik can wait for a node it just
	uninstalled
In-Reply-To: <bug-223-4@http.www.slony.info/bugzilla/>
References: <bug-223-4@http.www.slony.info/bugzilla/>
Message-ID: <20110707141908.77A9A290DA4@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=223

Jan Wieck <janwieck at yahoo.com> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         AssignedTo|janwieck at yahoo.com          |ssinger at ca.afilias.info

--- Comment #3 from Jan Wieck <janwieck at yahoo.com> 2011-07-07 07:19:08 PDT ---
Looks like the right solution to me.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Thu Jul  7 07:26:27 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Thu,  7 Jul 2011 07:26:27 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 222] cleanup thread can lock out new application
	connections
In-Reply-To: <bug-222-4@http.www.slony.info/bugzilla/>
References: <bug-222-4@http.www.slony.info/bugzilla/>
Message-ID: <20110707142627.AD2B5290DE9@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=222

Jan Wieck <janwieck at yahoo.com> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         AssignedTo|janwieck at yahoo.com          |ssinger at ca.afilias.info

--- Comment #5 from Jan Wieck <janwieck at yahoo.com> 2011-07-07 07:26:27 PDT ---
The patch looks good to me.

I wonder if the passing of the LOCK TABLE ... NO WAIT is a bug that needs to be
fixed in PostgreSQL though.


Jan

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Thu Jul  7 07:59:29 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Thu,  7 Jul 2011 07:59:29 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 216] monitor threads don't work on Win32
In-Reply-To: <bug-216-4@http.www.slony.info/bugzilla/>
References: <bug-216-4@http.www.slony.info/bugzilla/>
Message-ID: <20110707145929.E2E41290DE9@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=216

Jan Wieck <janwieck at yahoo.com> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         AssignedTo|janwieck at yahoo.com          |ssinger at ca.afilias.info

--- Comment #5 from Jan Wieck <janwieck at yahoo.com> 2011-07-07 07:59:30 PDT ---
This patch definitely gets us into the list of systems affected by the UNIX
time stamp problem, that will happen on January 19, 2038. Other than that it
looks OK to me.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Thu Jul  7 14:33:44 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Thu,  7 Jul 2011 14:33:44 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 222] cleanup thread can lock out new application
	connections
In-Reply-To: <bug-222-4@http.www.slony.info/bugzilla/>
References: <bug-222-4@http.www.slony.info/bugzilla/>
Message-ID: <20110707213344.8FF61290DE0@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=222

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|                            |FIXED
             Status|ASSIGNED                    |RESOLVED

--- Comment #6 from Steve Singer <ssinger at ca.afilias.info> 2011-07-07 14:33:44 PDT ---
Fixed in master for the next 2.1.0 beta

http://git.postgresql.org/gitweb/?p=slony1-engine.git;a=commit;h=b9ef590e56fab3fa6f3d06192a3ea73650036284

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Thu Jul  7 14:34:17 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Thu,  7 Jul 2011 14:34:17 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 223] slonik can wait for a node it just
	uninstalled
In-Reply-To: <bug-223-4@http.www.slony.info/bugzilla/>
References: <bug-223-4@http.www.slony.info/bugzilla/>
Message-ID: <20110707213417.6EE0D290DE7@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=223

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|                            |FIXED
             Status|ASSIGNED                    |RESOLVED

--- Comment #4 from Steve Singer <ssinger at ca.afilias.info> 2011-07-07 14:34:17 PDT ---
http://git.postgresql.org/gitweb/?p=slony1-engine.git;a=commit;h=dc61270672c3fbb2c49e8b0b1894b7bf72b02d6d

Fixed in 2.1.0 for the next beta

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Thu Jul  7 14:34:50 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Thu,  7 Jul 2011 14:34:50 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 216] monitor threads don't work on Win32
In-Reply-To: <bug-216-4@http.www.slony.info/bugzilla/>
References: <bug-216-4@http.www.slony.info/bugzilla/>
Message-ID: <20110707213450.123CA290DE5@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=216

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|                            |FIXED
             Status|ASSIGNED                    |RESOLVED

--- Comment #6 from Steve Singer <ssinger at ca.afilias.info> 2011-07-07 14:34:50 PDT ---
http://git.postgresql.org/gitweb/?p=slony1-engine.git;a=commit;h=aab898de15ac5f135b2f6ece105d82a0bcfed023

Fixed for the next beta of 2.1.0

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Thu Jul  7 14:58:51 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Thu,  7 Jul 2011 14:58:51 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 218] slon often has to retry transactions due to
 concurrent update in 2.1.0.b2
In-Reply-To: <bug-218-4@http.www.slony.info/bugzilla/>
References: <bug-218-4@http.www.slony.info/bugzilla/>
Message-ID: <20110707215851.13972290DE2@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=218

Christopher Browne <cbbrowne at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         AssignedTo|cbbrowne at ca.afilias.info    |ssinger at ca.afilias.info

--- Comment #19 from Christopher Browne <cbbrowne at ca.afilias.info> 2011-07-07 14:58:51 PDT ---
I have committed the BEGIN/COMMIT addition...  Over to you, Steve...

https://github.com/cbbrowne/slony1-engine/commit/f3e0776f33c345227df64f06275679ed15bf1a83

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Fri Jul  8 11:21:16 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri,  8 Jul 2011 11:21:16 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 218] slon often has to retry transactions due to
 concurrent update in 2.1.0.b2
In-Reply-To: <bug-218-4@http.www.slony.info/bugzilla/>
References: <bug-218-4@http.www.slony.info/bugzilla/>
Message-ID: <20110708182116.1AC8D290DA4@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=218

--- Comment #20 from Steve Singer <ssinger at ca.afilias.info> 2011-07-08 11:21:15 PDT ---
(In reply to comment #19)
> I have committed the BEGIN/COMMIT addition...  Over to you, Steve...
> 
> https://github.com/cbbrowne/slony1-engine/commit/f3e0776f33c345227df64f06275679ed15bf1a83

This looks okay to me, this type of change requires a fair amount of testing
but it is probably best to commit this to master so it can be part of all the
other beta testing.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Fri Jul  8 11:41:56 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri,  8 Jul 2011 11:41:56 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 212] moveSet leaves cluster with no origin
In-Reply-To: <bug-212-4@http.www.slony.info/bugzilla/>
References: <bug-212-4@http.www.slony.info/bugzilla/>
Message-ID: <20110708184156.5AAA1290DA4@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=212

--- Comment #1 from Steve Singer <ssinger at ca.afilias.info> 2011-07-08 11:41:56 PDT ---
It is possible that commit 40560a4515b3febfdd368cca89ad4c3c73456ae2 fixed the
underlying cause but since this issue wasn't easily reproducible it is hard to
say.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Mon Jul 11 11:40:32 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Mon, 11 Jul 2011 11:40:32 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 218] slon often has to retry transactions due to
 concurrent update in 2.1.0.b2
In-Reply-To: <bug-218-4@http.www.slony.info/bugzilla/>
References: <bug-218-4@http.www.slony.info/bugzilla/>
Message-ID: <20110711184032.4DF49290DED@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=218

Christopher Browne <cbbrowne at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|                            |FIXED
             Status|REOPENED                    |RESOLVED

--- Comment #21 from Christopher Browne <cbbrowne at ca.afilias.info> 2011-07-11 11:40:32 PDT ---
Committed latest changes...

http://git.postgresql.org/gitweb/?p=slony1-engine.git;a=commit;h=30023c6980f09cba689ca3ae4bc694ba54be559d

http://git.postgresql.org/gitweb/?p=slony1-engine.git;a=commit;h=ab1853d75628fa483328a4e54a82895d6ef93a19

That's not a very nice set of patches, unfortunately.  I didn't "squash" it
hard enough :-(.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Tue Jul 19 07:15:54 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Tue, 19 Jul 2011 07:15:54 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 225] New: checking PostgreSQL for
 thread-safety... configure: error: PQisthreadsafe test failed - PostgreSQL
 needs to be compiled with --enable-thread-safety
Message-ID: <bug-225-4@http.www.slony.info/bugzilla/>

http://www.slony.info/bugzilla/show_bug.cgi?id=225

           Summary: checking PostgreSQL for thread-safety... configure:
                    error: PQisthreadsafe test failed - PostgreSQL needs
                    to be compiled with --enable-thread-safety
           Product: Slony-I
           Version: 2.0
          Platform: Other
        OS/Version: Linux
            Status: NEW
          Severity: critical
          Priority: low
         Component: website
        AssignedTo: slony1-bugs at lists.slony.info
        ReportedBy: douganla at gru.com
                CC: slony1-bugs at lists.slony.info
   Estimated Hours: 0.0


After emerging [ebuild     U ] dev-db/slony1-2.0.6 [2.0.4] USE="perl"
I am getting this error:checking PostgreSQL for thread-safety... configure:
error: PQisthreadsafe test failed - PostgreSQL needs to be compiled with
--enable-thread-safety

I tried compiling postgres with 
USE="enable-thread-safety" emerge postgresql-server 
but it still gave me the same error when trying emerge slony. Any help with
this would be greatly appreciated.



Portage 2.1.9.42 (default/linux/x86/10.0, gcc-4.3.4, glibc-2.10.1-r1,
2.6.38-gentoo-r6 i686)
=================================================================
                        System Settings
=================================================================
System uname:
Linux-2.6.38-gentoo-r6-i686-Intel-R-_Xeon-R-_CPU_L5520_ at _2.27GHz-with-gentoo-2.0.2
Timestamp of tree: Mon, 27 Jun 2011 16:30:01 +0000
app-shells/bash:     4.1_p9
dev-lang/python:     2.6.6-r2, 3.1.3-r1
dev-util/pkgconfig:  0.25-r2
sys-apps/baselayout: 2.0.2
sys-apps/openrc:     0.8.2-r1
sys-apps/sandbox:    2.4
sys-devel/autoconf:  2.68
sys-devel/automake:  1.10.3, 1.11.1
sys-devel/binutils:  2.20.1-r1
sys-devel/gcc:       4.3.4, 4.4.5
sys-devel/gcc-config: 1.4.1-r1
sys-devel/libtool:   2.2.10
sys-devel/make:      3.82
sys-kernel/linux-headers: 2.6.36.1
sys-libs/glibc:      2.10.1-r1
virtual/os-headers:  0
ACCEPT_KEYWORDS="x86"
ACCEPT_LICENSE="* - at EULA"
CBUILD="i686-pc-linux-gnu"
CFLAGS="-march=native -O2 -pipe"
CHOST="i686-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/share/gnupg/qualified.txt"
CONFIG_PROTECT_MASK="/etc/ca-certificates.conf /etc/env.d /etc/gconf
/etc/gentoo-release /etc/php/apache2-php5.3/ext-active/
/etc/php/cgi-php5.3/ext-active/ /etc/php/cli-php5.3/ext-active/
/etc/revdep-rebuild /etc/sandbox.d /etc/terminfo"
CXXFLAGS="-march=native -O2 -pipe"
DISTDIR="/usr/portage/distfiles"
FEATURES="assume-digests binpkg-logs distlocks fixlafiles fixpackages news
parallel-fetch protect-owned sandbox sfperms strict unknown-features-warn
unmerge-logs unmerge-orphans userfetch"
FFLAGS=""
GENTOO_MIRRORS="http://distfiles.gentoo.org"
LDFLAGS="-Wl,-O1 -Wl,--as-needed"
PKGDIR="/usr/portage/packages"
PORTAGE_CONFIGROOT="/"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress
--force --whole-file --delete --stats --timeout=180 --exclude=/distfiles
--exclude=/local --exclude=/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/usr/local/portage"
SYNC="rsync://rsync.gentoo.org/gentoo-portage"
USE="acl apache2 bzip2 cli cracklib cups cxx dri fortran gpm iconv modules
mudflap ncurses nls nptl nptlonly openmp pcre perl postgres pppd python
readline session ssl sysfs tcpd unicode x86 xorg" ALSA_CARDS="ali5451 als4000
atiixp atiixp-modem bt87x ca0106 cmipci emu10k1 emu10k1x ens1370 ens1371 es1938
es1968 fm801 hda-intel intel8x0 intel8x0m maestro3 trident usb-audio via82xx
via82xx-modem ymfpci" ALSA_PCM_PLUGINS="adpcm alaw asym copy dmix dshare dsnoop
empty extplug file hooks iec958 ioplug ladspa lfloat linear meter mmap_emul
mulaw multi null plug rate route share shm softvol" APACHE2_MODULES="actions
alias auth_basic authn_alias authn_anon authn_dbm authn_default authn_file
authz_dbm authz_default authz_groupfile authz_host authz_owner authz_user
autoindex cache cgi cgid dav dav_fs dav_lock deflate dir disk_cache env expires
ext_filter file_cache filter headers include info log_config logio mem_cache
mime mime_magic negotiation rewrite setenvif speling status unique_id userdir
usertrack vhost_alias" CALLIGRA_FEATURES="braindump flow karbon kexi kpresenter
krita tables words" CAMERAS="ptp2" COLLECTD_PLUGINS="df interface irq load
memory rrdtool swap syslog" ELIBC="glibc" GPSD_PROTOCOLS="ashtech aivdm
earthmate evermore fv18 garmin garmintxt gpsclock itrax mtk3301 nmea ntrip
navcom oceanserver oldstyle oncore rtcm104v2 rtcm104v3 sirf superstar2 timing
tsip tripmate tnt ubx" INPUT_DEVICES="keyboard mouse evdev" KERNEL="linux"
LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses
text" PHP_TARGETS="php5-3" RUBY_TARGETS="ruby18" USERLAND="GNU"
VIDEO_CARDS="fbdev glint intel mach64 mga neomagic nouveau nv r128 radeon
savage sis tdfx trident vesa via vmware dummy v4l" XTABLES_ADDONS="quota2 psd
pknock lscan length2 ipv4options ipset ipp2p iface geoip fuzzy condition tee
tarpit sysrq steal rawnat logmark ipmark dhcpmac delude chaos account"
Unset:  CPPFLAGS, CTARGET, EMERGE_DEFAULT_OPTS, INSTALL_MASK, LANG, LC_ALL,
LINGUAS, MAKEOPTS, PORTAGE_BUNZIP2_COMMAND, PORTAGE_COMPRESS,
PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS


 * Package:    dev-db/slony1-2.0.6
 * Repository: gentoo
 * Maintainer: pgsql-bugs at gentoo.org
 * USE:        elibc_glibc kernel_linux perl userland_GNU x86
 * FEATURES:   sandbox
>>> Unpacking source...
>>> Unpacking slony1-2.0.6.tar.bz2 to /var/tmp/portage/dev-db/slony1-2.0.6/work
>>> Source unpacked in /var/tmp/portage/dev-db/slony1-2.0.6/work
>>> Compiling source in /var/tmp/portage/dev-db/slony1-2.0.6/work/slony1-2.0.6 ...
 * econf: updating slony1-2.0.6/config/config.guess with
/usr/share/gnuconfig/config.guess
 * econf: updating slony1-2.0.6/config/config.sub with
/usr/share/gnuconfig/config.sub
./configure --prefix=/usr --build=i686-pc-linux-gnu --host=i686-pc-linux-gnu
--mandir=/usr/share/man --infodir=/usr/share/info --datadir=/usr/share
--sysconfdir=/etc --localstatedir=/var/lib
--with-pgincludedir=/usr/include/postgresql/pgsql
--with-pgincludeserverdir=/usr/include/postgresql/server --with-perltools
checking build system type... i686-pc-linux-gnu
checking host system type... i686-pc-linux-gnu
checking which template to use... linux
configure: using CFLAGS=-march=native -O2 -pipe
checking for i686-pc-linux-gnu-gcc... i686-pc-linux-gnu-gcc
checking whether the C compiler works... yes
checking for C compiler default output file name... a.out
checking for suffix of executables...
checking whether we are cross compiling... no
checking for suffix of object files... o
checking whether we are using the GNU C compiler... yes
checking whether i686-pc-linux-gnu-gcc accepts -g... yes
checking for i686-pc-linux-gnu-gcc option to accept ISO C89... none needed
checking for ld used by GCC... /usr/i686-pc-linux-gnu/bin/ld
checking if the linker (/usr/i686-pc-linux-gnu/bin/ld) is GNU ld... yes
checking for perl... /usr/bin/perl
checking for tar... /bin/tar
checking for bison... bison -y
checking for sed... sed
checking for the pthreads library -lpthreads... no
checking whether pthreads work without any flags... no
checking whether pthreads work with -Kthread... no
checking whether pthreads work with -kthread... no
checking for the pthreads library -llthread... no
checking whether pthreads work with -pthread... yes
checking for joinable pthread attribute... PTHREAD_CREATE_JOINABLE
checking if more special flags are required for pthreads... no
checking for cc_r... i686-pc-linux-gnu-gcc
checking how to run the C preprocessor... i686-pc-linux-gnu-gcc -E
checking for grep that handles long lines and -e... /bin/grep
/var/tmp/portage/dev-db/slony1-2.0.6/temp/build.log lines 1-42/130 40%
checking for egrep... /bin/grep -E
checking for ANSI C header files... yes
checking for sys/types.h... yes
checking for sys/stat.h... yes
checking for stdlib.h... yes
checking for string.h... yes
checking for memory.h... yes
checking for strings.h... yes
checking for inttypes.h... yes
checking for stdint.h... yes
checking for unistd.h... yes
checking fcntl.h usability... yes
checking fcntl.h presence... yes
checking for fcntl.h... yes
checking limits.h usability... yes
checking limits.h presence... yes
checking for limits.h... yes
checking stddef.h usability... yes
checking stddef.h presence... yes
checking for stddef.h... yes
checking sys/socket.h usability... yes
checking sys/socket.h presence... yes
checking for sys/socket.h... yes
checking sys/time.h usability... yes
checking sys/time.h presence... yes
checking for sys/time.h... yes
checking for inttypes.h... (cached) yes
checking for gettimeofday... yes
checking for dup2... yes
checking for alarm... yes
checking for memset... yes
checking for select... yes
checking for strdup... yes
checking for strerror... yes
checking for strtol... yes
checking for strtoul... yes
checking for int32_t... yes
checking for uint32_t... yes
checking for u_int32_t... yes
checking for int64_t... yes
checking for uint64_t... yes
checking for u_int64_t... yes
checking for size_t... yes
checking for ssize_t... yes
checking for POSIX signal interface... yes
checking for flex... /usr/bin/flex
configure: using
checking if you have requested slony1-engine building... yes
./configure: line 4996: cd: /usr/include/postgresql/pgsql: No such file or
directory
overriding pgincludedir with
/var/tmp/portage/dev-db/slony1-2.0.6/work/slony1-2.0.6
overriding pgincludeserverdir with /usr/include/postgresql/server
checking for pg_config... /usr/bin/pg_config
pg_config says pg_bindir is /usr/lib/postgresql-9.0/bin/
pg_config says pg_libdir is /usr/lib/postgresql-9.0/lib/
pg_config says pg_pkglibdir is /usr/lib/postgresql-9.0/lib/
checking for correct version of PostgreSQL... pg_config says pg_sharedir is
/usr/share/postgresql-9.0/
checking for PQunescapeBytea in -lpq... yes
checking libpq-fe.h usability... yes
checking libpq-fe.h presence... yes
checking for libpq-fe.h... yes
checking postgres.h usability... yes
checking postgres.h presence... yes
checking for postgres.h... yes
checking for utils/typcache.h... yes
checking for plpgsql.so... yes
checking for postgresql.conf.sample... skipped due to override
checking for PQputCopyData in -lpq... yes
checking for PQsetNoticeReceiver in -lpq... yes
checking for PQfreemem in -lpq... yes
checking PostgreSQL for thread-safety... configure: error: PQisthreadsafe test
failed - PostgreSQL needs to be compiled with --enable-thread-safety

!!! Please attach the following file when seeking support:
!!! /var/tmp/portage/dev-db/slony1-2.0.6/work/slony1-2.0.6/config.log
 * ERROR: dev-db/slony1-2.0.6 failed (compile phase):
 *   econf failed
 *
 * Call stack:
 *     ebuild.sh, line   56:  Called src_compile
 *   environment, line 2125:  Called econf
'--with-pgincludedir=/usr/include/postgresql/pgsql'
'--with-pgincludeserverdir=/usr/include/postgresql/server' '--with-perltools'
 *     ebuild.sh, line  557:  Called die
 * The specific snippet of code:
 *                      die "econf failed"
 *
 * If you need support, post the output of 'emerge --info
=dev-db/slony1-2.0.6',
 * the complete build log and the output of 'emerge -pqv =dev-db/slony1-2.0.6'.
 * The complete build log is located at
'/var/tmp/portage/dev-db/slony1-2.0.6/temp/build.log'.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Tue Jul 19 07:56:34 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Tue, 19 Jul 2011 07:56:34 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 225] checking PostgreSQL for thread-safety...
 configure: error: PQisthreadsafe test failed - PostgreSQL needs to be
 compiled with --enable-thread-safety
In-Reply-To: <bug-225-4@http.www.slony.info/bugzilla/>
References: <bug-225-4@http.www.slony.info/bugzilla/>
Message-ID: <20110719145634.1FB96290DDD@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=225

--- Comment #1 from Steve Singer <ssinger at ca.afilias.info> 2011-07-19 07:56:34 PDT ---
If you look at the config.log file that is generated by the configure step of
your slony build you can determine which libpq is being picked up.   You need
to verify that this libpq really does have thread safety built in.

You might also want to include the output of pg_config to this report.

Another thing to try might be to build postgreql from the source tarball by
hand and put it in  /usr/local/pgsql and build slony against that version to
try and figure out if it is an issue with your gentoo postgresql-server
package.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Tue Jul 19 08:46:22 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Tue, 19 Jul 2011 08:46:22 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 225] checking PostgreSQL for thread-safety...
 configure: error: PQisthreadsafe test failed - PostgreSQL needs to be
 compiled with --enable-thread-safety
In-Reply-To: <bug-225-4@http.www.slony.info/bugzilla/>
References: <bug-225-4@http.www.slony.info/bugzilla/>
Message-ID: <20110719154622.BC385290E02@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=225

--- Comment #2 from douganla at gru.com 2011-07-19 08:46:22 PDT ---
(In reply to comment #1)
> If you look at the config.log file that is generated by the configure step of
> your slony build you can determine which libpq is being picked up.   You need
> to verify that this libpq really does have thread safety built in.
> You might also want to include the output of pg_config to this report.
> Another thing to try might be to build postgreql from the source tarball by
> hand and put it in  /usr/local/pgsql and build slony against that version to
> try and figure out if it is an issue with your gentoo postgresql-server
> package.

I am new to this so any help would be great I did a grep on config.log and got
this:
# grep "libpq"
/var/tmp/portage/dev-db/slony1-2.0.6/work/slony1-2.0.6/config.log
configure:5235: checking libpq-fe.h usability
configure:5235: checking libpq-fe.h presence
configure:5235: checking for libpq-fe.h
| #include "libpq-fe.h"
ac_cv_header_libpq_fe_h=yes

# grep "LIBPQ"
/var/tmp/portage/dev-db/slony1-2.0.6/work/slony1-2.0.6/config.log
| #define PG_LIBPQ_VERIFIED 1
| #define PG_LIBPQSERVER_VERIFIED 1
#define PG_LIBPQ_VERIFIED 1
#define PG_LIBPQSERVER_VERIFIED 1

I also did a grep on enable-thread-safety but got nothing. How do I determine
if thread safety is built in?


This /usr/lib/postgresql-9.0/bin/pg_config. Is this the right file?

ELF Header:
  Magic:   7f 45 4c 46 01 01 01 00 00 00 00 00 00 00 00 00
  Class:                             ELF32
  Data:                              2's complement, little endian
  Version:                           1 (current)
  OS/ABI:                            UNIX - System V
  ABI Version:                       0
  Type:                              EXEC (Executable file)
  Machine:                           Intel 80386
  Version:                           0x1
  Entry point address:               0x8048d10
  Start of program headers:          52 (bytes into file)
  Start of section headers:          20840 (bytes into file)
  Flags:                             0x0
  Size of this header:               52 (bytes)
  Size of program headers:           32 (bytes)
  Number of program headers:         9
  Size of section headers:           40 (bytes)
  Number of section headers:         26
  Section header string table index: 25

Section Headers:
  [Nr] Name              Type            Addr     Off    Size   ES Flg Lk Inf
Al
  [ 0]                   NULL            00000000 000000 000000 00      0   0 
0
  [ 1] .interp           PROGBITS        08048154 000154 000013 00   A  0   0 
1
  [ 2] .note.ABI-tag     NOTE            08048168 000168 000020 00   A  0   0 
4
  [ 3] .hash             HASH            08048188 000188 0001ec 04   A  5   0 
4
  [ 4] .gnu.hash         GNU_HASH        08048374 000374 000040 04   A  5   0 
4
  [ 5] .dynsym           DYNSYM          080483b4 0003b4 0002c0 10   A  6   1 
4
  [ 6] .dynstr           STRTAB          08048674 000674 0001e8 00   A  0   0 
1
  [ 7] .gnu.version      VERSYM          0804885c 00085c 000058 02   A  5   0 
2
  [ 8] .gnu.version_r    VERNEED         080488b4 0008b4 000060 00   A  6   1 
4
  [ 9] .rel.dyn          REL             08048914 000914 000020 08   A  5   0 
4
  [10] .rel.plt          REL             08048934 000934 000138 08   A  5  12 
4
  [11] .init             PROGBITS        08048a6c 000a6c 000017 00  AX  0   0 
4
  [12] .plt              PROGBITS        08048a84 000a84 000280 04  AX  0   0 
4
  [13] .text             PROGBITS        08048d10 000d10 002334 00  AX  0   0
16
  [14] .fini             PROGBITS        0804b044 003044 00001c 00  AX  0   0 
4
  [15] .rodata           PROGBITS        0804b060 003060 00138c 00   A  0   0
32
  [16] .eh_frame         PROGBITS        0804c3ec 0043ec 000004 00   A  0   0 
4
  [17] .ctors            PROGBITS        0804defc 004efc 000008 00  WA  0   0 
4
  [18] .dtors            PROGBITS        0804df04 004f04 000008 00  WA  0   0 
4
  [19] .jcr              PROGBITS        0804df0c 004f0c 000004 00  WA  0   0 
4
  [20] .dynamic          DYNAMIC         0804df10 004f10 0000e0 08  WA  6   0 
4

[21] .got              PROGBITS        0804dff0 004ff0 000004 04  WA  0   0  4
  [22] .got.plt          PROGBITS        0804dff4 004ff4 0000a8 04  WA  0   0 
4
  [23] .data             PROGBITS        0804e09c 00509c 000008 00  WA  0   0 
4
  [24] .bss              NOBITS          0804e0c0 0050a4 000580 00  WA  0   0
32
  [25] .shstrtab         STRTAB          00000000 0050a4 0000c2 00      0   0 
1
Key to Flags:
  W (write), A (alloc), X (execute), M (merge), S (strings)
  I (info), L (link order), G (group), x (unknown)
  O (extra OS processing required) o (OS specific), p (processor specific)

There are no section groups in this file.

Program Headers:
  Type           Offset   VirtAddr   PhysAddr   FileSiz MemSiz  Flg Align
  PHDR           0x000034 0x08048034 0x08048034 0x00120 0x00120 R E 0x4
  INTERP         0x000154 0x08048154 0x08048154 0x00013 0x00013 R   0x1
      [Requesting program interpreter: /lib/ld-linux.so.2]
  LOAD           0x000000 0x08048000 0x08048000 0x043f0 0x043f0 R E 0x1000
  LOAD           0x004efc 0x0804defc 0x0804defc 0x001a8 0x00744 RW  0x1000
  DYNAMIC        0x004f10 0x0804df10 0x0804df10 0x000e0 0x000e0 RW  0x4
  NOTE           0x000168 0x08048168 0x08048168 0x00020 0x00020 R   0x4
  GNU_STACK      0x000000 0x00000000 0x00000000 0x00000 0x00000 RW  0x4
  GNU_RELRO      0x004efc 0x0804defc 0x0804defc 0x00104 0x00104 R   0x1
  PAX_FLAGS      0x000000 0x00000000 0x00000000 0x00000 0x00000     0x4

 Section to Segment mapping:
  Segment Sections...
   00
   01     .interp
   02     .interp .note.ABI-tag .hash .gnu.hash .dynsym .dynstr .gnu.version
.gnu.version_r .rel.dyn .rel.plt .init .plt .text .fini .rodata .eh_frame
   03     .ctors .dtors .jcr .dynamic .got .got.plt .data .bss
   04     .dynamic
   05     .note.ABI-tag
   06
   07     .ctors .dtors .jcr .dynamic .got
   08

Dynamic section at offset 0x4f10 contains 23 entries:
  Tag        Type                         Name/Value
 0x00000001 (NEEDED)                     Shared library: [libc.so.6]
 0x0000000f (RPATH)                      Library rpath:
[/usr/lib/postgresql-9.0/lib]
 0x0000001d (RUNPATH)                    Library runpath:
[/usr/lib/postgresql-9.0/lib]
 0x0000000c (INIT)                       0x8048a6c
/usr/lib/postgresql-9.0/bin/pg_config lines 45-87
0x0000000d (FINI)                       0x804b044
 0x00000004 (HASH)                       0x8048188
 0x6ffffef5 (GNU_HASH)                   0x8048374
 0x00000005 (STRTAB)                     0x8048674
 0x00000006 (SYMTAB)                     0x80483b4
 0x0000000a (STRSZ)                      488 (bytes)
 0x0000000b (SYMENT)                     16 (bytes)
 0x00000015 (DEBUG)                      0x0
 0x00000003 (PLTGOT)                     0x804dff4
 0x00000002 (PLTRELSZ)                   312 (bytes)
 0x00000014 (PLTREL)                     REL
 0x00000017 (JMPREL)                     0x8048934
 0x00000011 (REL)                        0x8048914
 0x00000012 (RELSZ)                      32 (bytes)
 0x00000013 (RELENT)                     8 (bytes)
 0x6ffffffe (VERNEED)                    0x80488b4
 0x6fffffff (VERNEEDNUM)                 1
 0x6ffffff0 (VERSYM)                     0x804885c
 0x00000000 (NULL)                       0x0

Relocation section '.rel.dyn' at offset 0x914 contains 4 entries:
 Offset     Info    Type            Sym.Value  Sym. Name
0804dff0  00000606 R_386_GLOB_DAT    00000000   __gmon_start__
0804e0c0  00002805 R_386_COPY        0804e0c0   stderr
0804e0e0  00002a05 R_386_COPY        0804e0e0   sys_siglist
0804e200  00002905 R_386_COPY        0804e200   stdout

Relocation section '.rel.plt' at offset 0x934 contains 39 entries:
 Offset     Info    Type            Sym.Value  Sym. Name
0804e000  00000107 R_386_JUMP_SLOT   00000000   __errno_location
0804e004  00000207 R_386_JUMP_SLOT   00000000   popen
0804e008  00000307 R_386_JUMP_SLOT   00000000   strerror
0804e00c  00000407 R_386_JUMP_SLOT   00000000   __strncpy_chk
0804e010  00000507 R_386_JUMP_SLOT   00000000   __fprintf_chk
0804e014  00000607 R_386_JUMP_SLOT   00000000   __gmon_start__
0804e018  00000707 R_386_JUMP_SLOT   00000000   __xstat64
0804e01c  00000807 R_386_JUMP_SLOT   00000000   __printf_chk
0804e020  00000907 R_386_JUMP_SLOT   00000000   getenv
0804e024  00000a07 R_386_JUMP_SLOT   00000000   strncpy
0804e028  00000b07 R_386_JUMP_SLOT   00000000   fgets
0804e02c  00000c07 R_386_JUMP_SLOT   00000000   __libc_start_main
0804e030  00000d07 R_386_JUMP_SLOT   00000000   strrchr
0804e034  00000e07 R_386_JUMP_SLOT   00000000   bindtextdomain
0804e038  00000f07 R_386_JUMP_SLOT   00000000   perror
/usr/lib/postgresql-9.0/bin/pg_config lines 88-131
0804e03c  00001007 R_386_JUMP_SLOT   00000000   __lxstat64
0804e040  00001107 R_386_JUMP_SLOT   00000000   dcgettext
0804e044  00001207 R_386_JUMP_SLOT   00000000   access
0804e048  00001307 R_386_JUMP_SLOT   00000000   fflush
0804e04c  00001407 R_386_JUMP_SLOT   00000000   strlen
0804e050  00001507 R_386_JUMP_SLOT   00000000   getpwuid
0804e054  00001607 R_386_JUMP_SLOT   00000000   setlocale
0804e058  00001707 R_386_JUMP_SLOT   00000000   strcpy
0804e05c  00001807 R_386_JUMP_SLOT   00000000   chdir
0804e060  00001907 R_386_JUMP_SLOT   00000000   putenv
0804e064  00001a07 R_386_JUMP_SLOT   00000000   __strcpy_chk
0804e068  00001b07 R_386_JUMP_SLOT   00000000   strstr
0804e06c  00001c07 R_386_JUMP_SLOT   00000000   fputc
0804e070  00001d07 R_386_JUMP_SLOT   00000000   readlink
0804e074  00001e07 R_386_JUMP_SLOT   00000000   getcwd
0804e078  00001f07 R_386_JUMP_SLOT   00000000   puts
0804e07c  00002007 R_386_JUMP_SLOT   00000000   textdomain
0804e080  00002107 R_386_JUMP_SLOT   00000000   strncmp
0804e084  00002207 R_386_JUMP_SLOT   00000000   __snprintf_chk
0804e088  00002307 R_386_JUMP_SLOT   00000000   strcmp
0804e08c  00002407 R_386_JUMP_SLOT   00000000   __strdup
0804e090  00002507 R_386_JUMP_SLOT   00000000   exit
0804e094  00002607 R_386_JUMP_SLOT   00000000   pclose
0804e098  00002707 R_386_JUMP_SLOT   00000000   geteuid

There are no unwind sections in this file.

Symbol table '.dynsym' contains 44 entries:
   Num:    Value  Size Type    Bind   Vis      Ndx Name
     0: 00000000     0 NOTYPE  LOCAL  DEFAULT  UND
     1: 00000000     0 FUNC    GLOBAL DEFAULT  UND __errno_location at GLIBC_2.0
(2)
     2: 00000000     0 FUNC    GLOBAL DEFAULT  UND popen at GLIBC_2.1 (3)
     3: 00000000     0 FUNC    GLOBAL DEFAULT  UND strerror at GLIBC_2.0 (2)
     4: 00000000     0 FUNC    GLOBAL DEFAULT  UND __strncpy_chk at GLIBC_2.3.4
(4)
     5: 00000000     0 FUNC    GLOBAL DEFAULT  UND __fprintf_chk at GLIBC_2.3.4
(4)
     6: 00000000     0 NOTYPE  WEAK   DEFAULT  UND __gmon_start__
     7: 00000000     0 FUNC    GLOBAL DEFAULT  UND __xstat64 at GLIBC_2.2 (5)
     8: 00000000     0 FUNC    GLOBAL DEFAULT  UND __printf_chk at GLIBC_2.3.4 (4)
     9: 00000000     0 FUNC    GLOBAL DEFAULT  UND getenv at GLIBC_2.0 (2)
    10: 00000000     0 FUNC    GLOBAL DEFAULT  UND strncpy at GLIBC_2.0 (2)
    11: 00000000     0 FUNC    GLOBAL DEFAULT  UND fgets at GLIBC_2.0 (2)
    12: 00000000     0 FUNC    GLOBAL DEFAULT  UND __libc_start_main at GLIBC_2.0
(2)
    13: 00000000     0 FUNC    GLOBAL DEFAULT  UND strrchr at GLIBC_2.0 (2)
    14: 00000000     0 FUNC    GLOBAL DEFAULT  UND bindtextdomain at GLIBC_2.0 (2)
/usr/lib/postgresql-9.0/bin/pg_config lines 132-175
  15: 00000000     0 FUNC    GLOBAL DEFAULT  UND perror at GLIBC_2.0 (2)
    16: 00000000     0 FUNC    GLOBAL DEFAULT  UND __lxstat64 at GLIBC_2.2 (5)
    17: 00000000     0 FUNC    GLOBAL DEFAULT  UND dcgettext at GLIBC_2.0 (2)
    18: 00000000     0 FUNC    GLOBAL DEFAULT  UND access at GLIBC_2.0 (2)
    19: 00000000     0 FUNC    GLOBAL DEFAULT  UND fflush at GLIBC_2.0 (2)
    20: 00000000     0 FUNC    GLOBAL DEFAULT  UND strlen at GLIBC_2.0 (2)
    21: 00000000     0 FUNC    GLOBAL DEFAULT  UND getpwuid at GLIBC_2.0 (2)
    22: 00000000     0 FUNC    GLOBAL DEFAULT  UND setlocale at GLIBC_2.0 (2)
    23: 00000000     0 FUNC    GLOBAL DEFAULT  UND strcpy at GLIBC_2.0 (2)
    24: 00000000     0 FUNC    GLOBAL DEFAULT  UND chdir at GLIBC_2.0 (2)
    25: 00000000     0 FUNC    GLOBAL DEFAULT  UND putenv at GLIBC_2.0 (2)
    26: 00000000     0 FUNC    GLOBAL DEFAULT  UND __strcpy_chk at GLIBC_2.3.4 (4)
    27: 00000000     0 FUNC    GLOBAL DEFAULT  UND strstr at GLIBC_2.0 (2)
    28: 00000000     0 FUNC    GLOBAL DEFAULT  UND fputc at GLIBC_2.0 (2)
    29: 00000000     0 FUNC    GLOBAL DEFAULT  UND readlink at GLIBC_2.0 (2)
    30: 00000000     0 FUNC    GLOBAL DEFAULT  UND getcwd at GLIBC_2.0 (2)
    31: 00000000     0 FUNC    GLOBAL DEFAULT  UND puts at GLIBC_2.0 (2)
    32: 00000000     0 FUNC    GLOBAL DEFAULT  UND textdomain at GLIBC_2.0 (2)
    33: 00000000     0 FUNC    GLOBAL DEFAULT  UND strncmp at GLIBC_2.0 (2)
    34: 00000000     0 FUNC    GLOBAL DEFAULT  UND __snprintf_chk at GLIBC_2.3.4
(4)
    35: 00000000     0 FUNC    GLOBAL DEFAULT  UND strcmp at GLIBC_2.0 (2)
    36: 00000000     0 FUNC    GLOBAL DEFAULT  UND __strdup at GLIBC_2.0 (2)
    37: 00000000     0 FUNC    GLOBAL DEFAULT  UND exit at GLIBC_2.0 (2)
    38: 00000000     0 FUNC    GLOBAL DEFAULT  UND pclose at GLIBC_2.1 (3)
    39: 00000000     0 FUNC    GLOBAL DEFAULT  UND geteuid at GLIBC_2.0 (2)
    40: 0804e0c0     4 OBJECT  GLOBAL DEFAULT   24 stderr at GLIBC_2.0 (2)
    41: 0804e200     4 OBJECT  GLOBAL DEFAULT   24 stdout at GLIBC_2.0 (2)
    42: 0804e0e0   260 OBJECT  GLOBAL DEFAULT   24 sys_siglist at GLIBC_2.3.3 (6)
    43: 0804b064     4 OBJECT  GLOBAL DEFAULT   15 _IO_stdin_used

Histogram for bucket list length (total of 77 buckets):
 Length  Number     % of total  Coverage
      0  42         ( 54.5%)
      1  27         ( 35.1%)     62.8%
      2  8          ( 10.4%)    100.0%

Histogram for `.gnu.hash' bucket list length (total of 7 buckets):
 Length  Number     % of total  Coverage
      0  3          ( 42.9%)
      1  4          ( 57.1%)    100.0%

Version symbols section '.gnu.version' contains 44 entries:
 Addr: 000000000804885c  Offset: 0x00085c  Link: 5 (.dynsym)
  000:   0 (*local*)       2 (GLIBC_2.0)     3 (GLIBC_2.1)     2 (GLIBC_2.0)
004:   4 (GLIBC_2.3.4)   4 (GLIBC_2.3.4)   0 (*local*)       5 (GLIBC_2.2)
  008:   4 (GLIBC_2.3.4)   2 (GLIBC_2.0)     2 (GLIBC_2.0)     2 (GLIBC_2.0)
  00c:   2 (GLIBC_2.0)     2 (GLIBC_2.0)     2 (GLIBC_2.0)     2 (GLIBC_2.0)
  010:   5 (GLIBC_2.2)     2 (GLIBC_2.0)     2 (GLIBC_2.0)     2 (GLIBC_2.0)
  014:   2 (GLIBC_2.0)     2 (GLIBC_2.0)     2 (GLIBC_2.0)     2 (GLIBC_2.0)
  018:   2 (GLIBC_2.0)     2 (GLIBC_2.0)     4 (GLIBC_2.3.4)   2 (GLIBC_2.0)
  01c:   2 (GLIBC_2.0)     2 (GLIBC_2.0)     2 (GLIBC_2.0)     2 (GLIBC_2.0)
  020:   2 (GLIBC_2.0)     2 (GLIBC_2.0)     4 (GLIBC_2.3.4)   2 (GLIBC_2.0)
  024:   2 (GLIBC_2.0)     2 (GLIBC_2.0)     3 (GLIBC_2.1)     2 (GLIBC_2.0)
  028:   2 (GLIBC_2.0)     2 (GLIBC_2.0)     6 (GLIBC_2.3.3)   1 (*global*)

Version needs section '.gnu.version_r' contains 1 entries:
 Addr: 0x00000000080488b4  Offset: 0x0008b4  Link: 6 (.dynstr)
  000000: Version: 1  File: libc.so.6  Cnt: 5
  0x0010:   Name: GLIBC_2.3.3  Flags: none  Version: 6
  0x0020:   Name: GLIBC_2.2  Flags: none  Version: 5
  0x0030:   Name: GLIBC_2.3.4  Flags: none  Version: 4
  0x0040:   Name: GLIBC_2.1  Flags: none  Version: 3
  0x0050:   Name: GLIBC_2.0  Flags: none  Version: 2

Notes at offset 0x00000168 with length 0x00000020:
  Owner         Data size       Description
  GNU           0x00000010      NT_GNU_ABI_TAG (ABI version tag)

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Tue Jul 19 08:53:13 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Tue, 19 Jul 2011 08:53:13 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 225] checking PostgreSQL for thread-safety...
 configure: error: PQisthreadsafe test failed - PostgreSQL needs to be
 compiled with --enable-thread-safety
In-Reply-To: <bug-225-4@http.www.slony.info/bugzilla/>
References: <bug-225-4@http.www.slony.info/bugzilla/>
Message-ID: <20110719155313.617E2290DF4@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=225

--- Comment #3 from Steve Singer <ssinger at ca.afilias.info> 2011-07-19 08:53:13 PDT ---
If you attach the slony config.log to this bug I can take a look at it.

for pg_config you should run the program.  pg_config prints out the command
line options it was built with when you run it.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Tue Jul 19 09:00:05 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Tue, 19 Jul 2011 09:00:05 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 225] checking PostgreSQL for thread-safety...
 configure: error: PQisthreadsafe test failed - PostgreSQL needs to be
 compiled with --enable-thread-safety
In-Reply-To: <bug-225-4@http.www.slony.info/bugzilla/>
References: <bug-225-4@http.www.slony.info/bugzilla/>
Message-ID: <20110719160005.9168C290DEF@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=225

--- Comment #4 from douganla at gru.com 2011-07-19 09:00:05 PDT ---
(In reply to comment #3)
> If you attach the slony config.log to this bug I can take a look at it.
> for pg_config you should run the program.  pg_config prints out the command
> line options it was built with when you run it.

Oh, I see that is not enabled after running pg_config see below. 
'--disable-thread-safety'
Do I need to run emerge --config =dev-db/postgresql-server-9.0.4-r1 like this
instead?
emerge --config --enable-thread-safety =dev-db/postgresql-server-9.0.4-r1

 # pg_config
BINDIR = /usr/lib/postgresql-9.0/bin
DOCDIR = /usr/share/doc/postgresql-9.0
HTMLDIR = /usr/share/doc/postgresql-9.0
INCLUDEDIR = /usr/include/postgresql-9.0
PKGINCLUDEDIR = /usr/include/postgresql-9.0
INCLUDEDIR-SERVER = /usr/include/postgresql-9.0/server
LIBDIR = /usr/lib/postgresql-9.0/lib
PKGLIBDIR = /usr/lib/postgresql-9.0/lib
LOCALEDIR = /usr/lib/postgresql-9.0/share/locale
MANDIR = /usr/share/postgresql-9.0/man
SHAREDIR = /usr/share/postgresql-9.0
SYSCONFDIR = /etc/postgresql-9.0
PGXS = /usr/lib/postgresql-9.0/lib/pgxs/src/makefiles/pgxs.mk
CONFIGURE = '--prefix=/usr' '--build=i686-pc-linux-gnu'
'--host=i686-pc-linux-gnu' '--mandir=/usr/share/man'
'--infodir=/usr/share/info' '--datadir=/usr/share' '--sysconfdir=/etc'
'--localstatedir=/var/lib' '--prefix=/usr/lib/postgresql-9.0'
'--datadir=/usr/share/postgresql-9.0' '--docdir=/usr/share/doc/postgresql-9.0'
'--includedir=/usr/include/postgresql-9.0'
'--mandir=/usr/share/postgresql-9.0/man' '--sysconfdir=/etc/postgresql-9.0'
'--enable-depend' '--without-tcl' '--without-perl' '--without-python'
'--without-krb5' '--without-gssapi' '--without-ldap' '--enable-nls='
'--without-pam' '--enable-integer-datetimes' '--with-readline' '--with-openssl'
'--disable-thread-safety' '--without-zlib' 'build_alias=i686-pc-linux-gnu'
'host_alias=i686-pc-linux-gnu' 'CFLAGS=-march=native -O2 -pipe'
'LDFLAGS=-Wl,-O1 -Wl,--as-needed' 'LDFLAGS_EX=-Wl,-O1 -Wl,--as-needed'
'LDFLAGS_SL=-Wl,-O1 -Wl,--as-needed'
CC = i686-pc-linux-gnu-gcc
CPPFLAGS = -D_GNU_SOURCE
CFLAGS = -march=native -O2 -pipe -Wall -Wmissing-prototypes -Wpointer-arith
-Wdeclaration-after-statement -Wendif-labels -fno-strict-aliasing -fwrapv
CFLAGS_SL = -fpic
LDFLAGS = -Wl,-O1 -Wl,--as-needed -Wl,--as-needed
-Wl,-rpath,'/usr/lib/postgresql-9.0/lib',--enable-new-dtags
LDFLAGS_EX = -Wl,-O1 -Wl,--as-needed
LDFLAGS_SL = -Wl,-O1 -Wl,--as-needed -Wl,-O1 -Wl,--as-needed -Wl,-O1
-Wl,--as-needed -Wl,-O1 -Wl,--as-needed -Wl,-O1 -Wl,--as-needed
LIBS = -lpgport -lssl -lcrypto -lreadline -lcrypt -ldl -lm
VERSION = PostgreSQL 9.0.4

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Tue Jul 19 10:47:13 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Tue, 19 Jul 2011 10:47:13 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 225] checking PostgreSQL for thread-safety...
 configure: error: PQisthreadsafe test failed - PostgreSQL needs to be
 compiled with --enable-thread-safety
In-Reply-To: <bug-225-4@http.www.slony.info/bugzilla/>
References: <bug-225-4@http.www.slony.info/bugzilla/>
Message-ID: <20110719174713.E30BE2903BD@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=225

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|                            |INVALID
             Status|NEW                         |RESOLVED

--- Comment #5 from Steve Singer <ssinger at ca.afilias.info> 2011-07-19 10:47:14 PDT ---
Sorry, I have not really used gentoo and I don't know anything about using
emerge so I can't help you.  

Since this doesn't sound like a Slony bug I am marking the bug closed.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Wed Jul 20 08:24:51 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed, 20 Jul 2011 08:24:51 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 203] Use of "name" type conflicts with pg_upgrade
In-Reply-To: <bug-203-4@http.www.slony.info/bugzilla/>
References: <bug-203-4@http.www.slony.info/bugzilla/>
Message-ID: <20110720152451.65181290DA4@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=203

--- Comment #1 from Jan Wieck <janwieck at yahoo.com> 2011-07-20 08:24:51 PDT ---
When switching to "text", will we have to add explicit casting to all the
queries that use those columns?

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Thu Jul 21 20:28:00 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Thu, 21 Jul 2011 20:28:00 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 226] New: When the cleanupEvent was called,
 the slon worker process restarted
Message-ID: <bug-226-4@http.www.slony.info/bugzilla/>

http://www.slony.info/bugzilla/show_bug.cgi?id=226

           Summary: When the cleanupEvent was called, the slon worker
                    process restarted
           Product: Slony-I
           Version: devel
          Platform: PC
        OS/Version: Linux
            Status: NEW
          Severity: normal
          Priority: low
         Component: slon
        AssignedTo: slony1-bugs at lists.slony.info
        ReportedBy: hirano.hiroyuki at oss.ntt.co.jp
                CC: slony1-bugs at lists.slony.info
   Estimated Hours: 0.0


I'm testing Slony-I 2.1.0b3.

When the cleanupEvent was called, the slon worker process restarted
with the following messages:
-----
2011-07-19 15:22:00 JST FATAL  cleanupThread: "begin;lock table
"_replication".sl_config_lock;select "_replication".cleanupEvent('10
minutes'::interval);commit;" -
2011-07-19 15:22:00 JST CONFIG slon: child terminated signal: 9; pid: 2911,
current worker pid: 2911
2011-07-19 15:22:00 JST  CONFIG slon: restart of worker in 10 seconds
-----

This might be regression.


In cleanupThred_main, the query is multi-statement:
  ----
    slon_mkquery(&query_baseclean,
                 "begin;"
                 "lock table %s.sl_config_lock;"
                 "select %s.cleanupEvent('%s'::interval);"
                 "commit;",
                 rtcfg_namespace,
                 rtcfg_namespace,
                 cleanup_interval
        );
  ----

Then, PQresultStatus would not return "PGRES_TUPLES_OK" but
"PGRES_COMMAND_OK", falling into error handling:
  ----
        if (PQresultStatus(res) != PGRES_TUPLES_OK)
        {
            slon_log(SLON_FATAL,
                     "cleanupThread: \"%s\" - %s",
                  dstring_data(&query_baseclean), PQresultErrorMessage(res));
            PQclear(res);
            slon_retry();
            break;
  ----


Thoughts?

NTT OSS Center
  Hiroyuki Hirano

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Fri Jul 22 10:35:27 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri, 22 Jul 2011 10:35:27 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 226] When the cleanupEvent was called,
 the slon worker process restarted
In-Reply-To: <bug-226-4@http.www.slony.info/bugzilla/>
References: <bug-226-4@http.www.slony.info/bugzilla/>
Message-ID: <20110722173527.7C4F0290DE4@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=226

Christopher Browne <cbbrowne at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         AssignedTo|slony1-bugs at lists.slony.inf |cbbrowne at ca.afilias.info
                   |o                           |
             Status|NEW                         |ASSIGNED

--- Comment #1 from Christopher Browne <cbbrowne at ca.afilias.info> 2011-07-22 10:35:27 PDT ---
You're right - changes made to the query mean that it will not be returning
tuples.

That looks like the right change; I'm running some tests to validate, and
expect I'll commit that soon.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Fri Jul 22 12:29:50 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri, 22 Jul 2011 12:29:50 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 226] When the cleanupEvent was called,
 the slon worker process restarted
In-Reply-To: <bug-226-4@http.www.slony.info/bugzilla/>
References: <bug-226-4@http.www.slony.info/bugzilla/>
Message-ID: <20110722192950.7B214290DEE@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=226

Christopher Browne <cbbrowne at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|                            |FIXED
             Status|ASSIGNED                    |RESOLVED

--- Comment #2 from Christopher Browne <cbbrowne at ca.afilias.info> 2011-07-22 12:29:50 PDT ---
Committed, along with change to release notes:

http://git.postgresql.org/gitweb/?p=slony1-engine.git;a=commit;h=55b61d511045c766e3d04cc8777c4bef6717d0a7

I reviewed similar queries elsewhere in the code base; this seems to be the
only one which should be thus altered.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Fri Jul 22 13:41:21 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri, 22 Jul 2011 13:41:21 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 203] Use of "name" type conflicts with pg_upgrade
In-Reply-To: <bug-203-4@http.www.slony.info/bugzilla/>
References: <bug-203-4@http.www.slony.info/bugzilla/>
Message-ID: <20110722204121.E55EC290DF6@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=203

--- Comment #2 from Christopher Browne <cbbrowne at ca.afilias.info> 2011-07-22 13:41:22 PDT ---
I just made the changes on sl_table/sl_sequence, and ran one of the old
regression tests.

No problems encountered.

https://github.com/cbbrowne/slony1-engine/tree/bug203

I did not do any casting changes, and experienced no problems, so I don't
expect any explicit casting should be necessary.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Fri Jul 29 05:56:27 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri, 29 Jul 2011 05:56:27 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 227] New: slonik tries to add views to a set
Message-ID: <bug-227-4@http.www.slony.info/bugzilla/>

http://www.slony.info/bugzilla/show_bug.cgi?id=227

           Summary: slonik tries to add views to a set
           Product: Slony-I
           Version: devel
          Platform: PC
        OS/Version: Linux
            Status: NEW
          Severity: enhancement
          Priority: low
         Component: slonik
        AssignedTo: slony1-bugs at lists.slony.info
        ReportedBy: ssinger at ca.afilias.info
                CC: slony1-bugs at lists.slony.info
   Estimated Hours: 0.0


This was reported against 2.1.0 b3 by a tester

If you have a database schema with views and try to add all of the tables in
the schema, ie  'set add table(set id=1, tables='public.x*'); 
it will try to add the view to the set but fail.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Fri Jul 29 05:57:10 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri, 29 Jul 2011 05:57:10 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 227] slonik tries to add views to a set
In-Reply-To: <bug-227-4@http.www.slony.info/bugzilla/>
References: <bug-227-4@http.www.slony.info/bugzilla/>
Message-ID: <20110729125711.010A9290D57@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=227

--- Comment #1 from Steve Singer <ssinger at ca.afilias.info> 2011-07-29 05:57:11 PDT ---
Created an attachment (id=113)
 --> (http://www.slony.info/bugzilla/attachment.cgi?id=113)
add a test case for this issue

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Fri Jul 29 05:57:31 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri, 29 Jul 2011 05:57:31 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 227] slonik tries to add views to a set
In-Reply-To: <bug-227-4@http.www.slony.info/bugzilla/>
References: <bug-227-4@http.www.slony.info/bugzilla/>
Message-ID: <20110729125731.D3128290D57@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=227

--- Comment #2 from Steve Singer <ssinger at ca.afilias.info> 2011-07-29 05:57:31 PDT ---
Created an attachment (id=114)
 --> (http://www.slony.info/bugzilla/attachment.cgi?id=114)
patch to fix the issue

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Fri Jul 29 05:57:59 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri, 29 Jul 2011 05:57:59 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 227] slonik tries to add views to a set
In-Reply-To: <bug-227-4@http.www.slony.info/bugzilla/>
References: <bug-227-4@http.www.slony.info/bugzilla/>
Message-ID: <20110729125759.87576290D57@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=227

--- Comment #3 from Steve Singer <ssinger at ca.afilias.info> 2011-07-29 05:57:59 PDT ---
Created an attachment (id=115)
 --> (http://www.slony.info/bugzilla/attachment.cgi?id=115)
related documentation fix

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Fri Jul 29 05:58:25 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri, 29 Jul 2011 05:58:25 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 227] slonik tries to add views to a set
In-Reply-To: <bug-227-4@http.www.slony.info/bugzilla/>
References: <bug-227-4@http.www.slony.info/bugzilla/>
Message-ID: <20110729125825.14CDA290D57@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=227

--- Comment #4 from Steve Singer <ssinger at ca.afilias.info> 2011-07-29 05:58:25 PDT ---
Created an attachment (id=116)
 --> (http://www.slony.info/bugzilla/attachment.cgi?id=116)
additional doc fix

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Fri Jul 29 06:02:13 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri, 29 Jul 2011 06:02:13 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 227] slonik tries to add views to a set
In-Reply-To: <bug-227-4@http.www.slony.info/bugzilla/>
References: <bug-227-4@http.www.slony.info/bugzilla/>
Message-ID: <20110729130213.AD315290DF5@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=227

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         AssignedTo|slony1-bugs at lists.slony.inf |janwieck at yahoo.com
                   |o                           |
             Status|NEW                         |ASSIGNED

--- Comment #5 from Steve Singer <ssinger at ca.afilias.info> 2011-07-29 06:02:13 PDT ---
A fix for this bug is attached or available at 

https://github.com/ssinger/slony1-engine/tree/bug227

Please arrange for a review.

The patch also includes a fix for related problem with regex escaping

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Fri Jul 29 06:29:39 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri, 29 Jul 2011 06:29:39 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 227] slonik tries to add views to a set
In-Reply-To: <bug-227-4@http.www.slony.info/bugzilla/>
References: <bug-227-4@http.www.slony.info/bugzilla/>
Message-ID: <20110729132939.DB95A290DF5@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=227

Jan Wieck <janwieck at yahoo.com> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         AssignedTo|janwieck at yahoo.com          |ssinger at ca.afilias.info

--- Comment #6 from Jan Wieck <janwieck at yahoo.com> 2011-07-29 06:29:40 PDT ---
Patch looks good to me.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Fri Jul 29 07:21:02 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri, 29 Jul 2011 07:21:02 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 227] slonik tries to add views to a set
In-Reply-To: <bug-227-4@http.www.slony.info/bugzilla/>
References: <bug-227-4@http.www.slony.info/bugzilla/>
Message-ID: <20110729142102.814D1290DF5@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=227

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|                            |FIXED
             Status|ASSIGNED                    |RESOLVED

--- Comment #7 from Steve Singer <ssinger at ca.afilias.info> 2011-07-29 07:21:02 PDT ---

Committed to master for the next 2.1.0 whatever release

http://git.postgresql.org/gitweb/?p=slony1-engine.git;a=commit;h=b1162e018680cb6c06667cf76254080d129fff13

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

