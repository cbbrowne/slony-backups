From bugzilla-daemon at main.slony.info  Fri Nov  4 13:02:08 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri,  4 Nov 2011 13:02:08 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 247] New: Slony log shipper doesn't parse
	TRUNCATE
Message-ID: <bug-247-4@http.www.slony.info/bugzilla/>

http://www.slony.info/bugzilla/show_bug.cgi?id=247

           Summary: Slony log shipper doesn't parse TRUNCATE
           Product: Slony-I
           Version: devel
          Platform: PC
        OS/Version: Linux
            Status: NEW
          Severity: enhancement
          Priority: low
         Component: slony_logshipper
        AssignedTo: slony1-bugs at lists.slony.info
        ReportedBy: ssinger at ca.afilias.info
                CC: slony1-bugs at lists.slony.info
   Estimated Hours: 0.0


This bug applies to 2.1 and master (2.2)

Slony 2.1 added support for replicating TRUNCATE commands.

The slony_logshipper daemon has a parser.y that it uses to parse the log ship
files generated by slon.  The grammer in this file (and associated handling
code) can not deal with TRUNCATE commands.

You get the following error
ERROR 2011-11-04 15:55:28 >
/tmp/logreformat/slony1_log_4_00000000000000000139.sql:12: ERROR syntax error
at or near TRUNCATE

from a line in the log file like:
TRUNCATE ONLY "disorder"."do_item_review" CASCADE;

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Fri Nov  4 13:21:10 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri,  4 Nov 2011 13:21:10 -0700 (PDT)
Subject: [Slony1-bugs] [Bug 248] New: Log shipper targets can't add
 sequences after initial setup
Message-ID: <bug-248-4@http.www.slony.info/bugzilla/>

http://www.slony.info/bugzilla/show_bug.cgi?id=248

           Summary: Log shipper targets can't add sequences after initial
                    setup
           Product: Slony-I
           Version: 2.0
          Platform: PC
        OS/Version: Linux
            Status: NEW
          Severity: enhancement
          Priority: low
         Component: slon
        AssignedTo: slony1-bugs at lists.slony.info
        ReportedBy: ssinger at ca.afilias.info
                CC: slony1-bugs at lists.slony.info
   Estimated Hours: 0.0


The slony1_dump.sh creates a sl_sequence_offline table for tracking sequences
on a log shipping target.

If you add+subscribe a new sequence to a new set after the log shipping slave
has been setup then the slon generating the log ship files will not generate
any SQL to update sl_sequence_offline to reflect the new sequence.  Updates to
the sequence then fail on the log shipping target.

I have changes to the LogShipping.js disorder test to replicate this issue that
I will include with the fix.

I think 2.0 2.1 and 2.2 all have this bug (I haven't looked at the log shipping
code in 1.2)

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Mon Nov  7 07:36:56 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Mon,  7 Nov 2011 07:36:56 -0800 (PST)
Subject: [Slony1-bugs] [Bug 248] Log shipper targets can't add sequences
 after initial setup
In-Reply-To: <bug-248-4@http.www.slony.info/bugzilla/>
References: <bug-248-4@http.www.slony.info/bugzilla/>
Message-ID: <20111107153656.63FE0290E6C@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=248

--- Comment #1 from Steve Singer <ssinger at ca.afilias.info> 2011-11-07 07:36:56 PST ---
Created an attachment (id=129)
 --> (http://www.slony.info/bugzilla/attachment.cgi?id=129)
Unit test changes to trigger this bug

Adding unit tests to trigger this bug.
This test can also trigger bug 247.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Mon Nov  7 07:38:03 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Mon,  7 Nov 2011 07:38:03 -0800 (PST)
Subject: [Slony1-bugs] [Bug 248] Log shipper targets can't add sequences
 after initial setup
In-Reply-To: <bug-248-4@http.www.slony.info/bugzilla/>
References: <bug-248-4@http.www.slony.info/bugzilla/>
Message-ID: <20111107153803.B34C7290E3E@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=248

--- Comment #2 from Steve Singer <ssinger at ca.afilias.info> 2011-11-07 07:38:03 PST ---
Created an attachment (id=130)
 --> (http://www.slony.info/bugzilla/attachment.cgi?id=130)
Fix for bug 248

This is a fix for bug248.
It was developed against REL_2_1_STABLE but should apply against 2.0 (excluding
the unit test change)

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Mon Nov  7 09:48:53 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Mon,  7 Nov 2011 09:48:53 -0800 (PST)
Subject: [Slony1-bugs] [Bug 247] Slony log shipper doesn't parse TRUNCATE
In-Reply-To: <bug-247-4@http.www.slony.info/bugzilla/>
References: <bug-247-4@http.www.slony.info/bugzilla/>
Message-ID: <20111107174853.0ECAE290E60@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=247

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         AssignedTo|slony1-bugs at lists.slony.inf |ssinger at ca.afilias.info
                   |o                           |
             Status|NEW                         |ASSIGNED

--- Comment #1 from Steve Singer <ssinger at ca.afilias.info> 2011-11-07 09:48:52 PST ---
Created an attachment (id=131)
 --> (http://www.slony.info/bugzilla/attachment.cgi?id=131)
Fix for bug 247

Fix for bug 247.

A unit test to check for this condition is attached to bug248.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Mon Nov  7 09:59:12 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Mon,  7 Nov 2011 09:59:12 -0800 (PST)
Subject: [Slony1-bugs] [Bug 248] Log shipper targets can't add sequences
 after initial setup
In-Reply-To: <bug-248-4@http.www.slony.info/bugzilla/>
References: <bug-248-4@http.www.slony.info/bugzilla/>
Message-ID: <20111107175912.97424290E5A@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=248

--- Comment #3 from Steve Singer <ssinger at ca.afilias.info> 2011-11-07 09:59:12 PST ---
We also have no code to drop sequences from the _offline tracking table in
response to a DROP_SET or DROP_SEQUENCE.  This sounds like it could cause
problems if later you add the set/sequence back again.

Also if someone changes the name of the sequence via EXECUTE SCRIPT things will
again break.

Why are we tracking the relationship between the sequence id and the sequence
name?  Would we be better off not passing the name instead of the id to
sequenceSetValue_offline?  Does anyone remember the reason why the tracking
table was added in the first place?

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Tue Nov  8 10:16:21 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Tue,  8 Nov 2011 10:16:21 -0800 (PST)
Subject: [Slony1-bugs] [Bug 248] Log shipper targets can't add sequences
 after initial setup
In-Reply-To: <bug-248-4@http.www.slony.info/bugzilla/>
References: <bug-248-4@http.www.slony.info/bugzilla/>
Message-ID: <20111108181621.7C29D290E6C@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=248

--- Comment #4 from Steve Singer <ssinger at ca.afilias.info> 2011-11-08 10:16:21 PST ---
Created an attachment (id=132)
 --> (http://www.slony.info/bugzilla/attachment.cgi?id=132)
Alternate fix, stop using the sequence table

An alternate fix for bug248. This stops tracking sequences in a table and
instead includes the sequence name (from the node running the slon that
generates the log ship files) in the .SQL files.

I do not feel this patch is suitable for 2.1.x or 2.0.x because it changes the
arguments of functions + eliminates a table.  I think it is the preferred
approach for 2.2

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Tue Nov  8 10:58:45 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Tue,  8 Nov 2011 10:58:45 -0800 (PST)
Subject: [Slony1-bugs] [Bug 237] drop set does not remove truncate triggers
In-Reply-To: <bug-237-4@http.www.slony.info/bugzilla/>
References: <bug-237-4@http.www.slony.info/bugzilla/>
Message-ID: <20111108185845.E0A5D290E5E@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=237

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|                            |FIXED
             Status|ASSIGNED                    |RESOLVED

--- Comment #6 from Steve Singer <ssinger at ca.afilias.info> 2011-11-08 10:58:45 PST ---
This was merged into 2.1.0 
6838c614d10368500abce2c12490935bdea0da3d

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Tue Nov  8 11:00:14 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Tue,  8 Nov 2011 11:00:14 -0800 (PST)
Subject: [Slony1-bugs] [Bug 229] creating a set then adding a table to a
 different set can deadlock
In-Reply-To: <bug-229-4@http.www.slony.info/bugzilla/>
References: <bug-229-4@http.www.slony.info/bugzilla/>
Message-ID: <20111108190015.05E98290E6D@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=229

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|                            |FIXED
             Status|ASSIGNED                    |RESOLVED

--- Comment #12 from Steve Singer <ssinger at ca.afilias.info> 2011-11-08 11:00:15 PST ---
This was fixed in 2.1.0 with commit 95d82dc387deaaa6d47bf97087dac32176abf648

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Tue Nov  8 12:02:46 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Tue,  8 Nov 2011 12:02:46 -0800 (PST)
Subject: [Slony1-bugs] [Bug 248] Log shipper targets can't add sequences
 after initial setup
In-Reply-To: <bug-248-4@http.www.slony.info/bugzilla/>
References: <bug-248-4@http.www.slony.info/bugzilla/>
Message-ID: <20111108200246.C82D1290E5B@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=248

--- Comment #5 from Steve Singer <ssinger at ca.afilias.info> 2011-11-08 12:02:46 PST ---
Another related question is how do we tell users of log shipping what SQL they
need to execute against the log shipping target node to apply these changes.

I can attach a SQL command list to the bug but does that go in the manual? In a
shell script like slony1_dump.sh?

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Tue Nov  8 13:16:51 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Tue,  8 Nov 2011 13:16:51 -0800 (PST)
Subject: [Slony1-bugs] [Bug 248] Log shipper targets can't add sequences
 after initial setup
In-Reply-To: <bug-248-4@http.www.slony.info/bugzilla/>
References: <bug-248-4@http.www.slony.info/bugzilla/>
Message-ID: <20111108211651.D44E2290E5A@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=248

--- Comment #6 from Steve Singer <ssinger at ca.afilias.info> 2011-11-08 13:16:51 PST ---
Created an attachment (id=133)
 --> (http://www.slony.info/bugzilla/attachment.cgi?id=133)
Add OMIT_COPY option to slony1_dump.sh to support upgrades

To address the upgrade problem I have modified slony1_dump.sh to do a dump
without the data.  The upgrade instructions would be
1. stop the slon
2. drop schema $clustername cascade; from the log ship target
3. slony1_dump.sh -omit_copy
4. restart the slons.

Log shipping should resume from where it left off but with the new slony
version.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Wed Nov  9 06:09:14 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed,  9 Nov 2011 06:09:14 -0800 (PST)
Subject: [Slony1-bugs] [Bug 244] create set is not well parsed
In-Reply-To: <bug-244-4@http.www.slony.info/bugzilla/>
References: <bug-244-4@http.www.slony.info/bugzilla/>
Message-ID: <20111109140914.D939A290E6D@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=244

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
             Status|NEW                         |ASSIGNED

--- Comment #1 from Steve Singer <ssinger at ca.afilias.info> 2011-11-09 06:09:14 PST ---
The bug here is that create set does not require a set id.
It defaults to set id=-1;

The create set actually creates a set with -1.

The 'set add table' is correct to fail with the message 'can't find origin for
set 1' because set 1 does not exist.

As the bug title implies we should make create set require a set id.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Wed Nov  9 06:15:53 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed,  9 Nov 2011 06:15:53 -0800 (PST)
Subject: [Slony1-bugs] [Bug 244] create set is not well parsed
In-Reply-To: <bug-244-4@http.www.slony.info/bugzilla/>
References: <bug-244-4@http.www.slony.info/bugzilla/>
Message-ID: <20111109141553.A1061290E6D@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=244

--- Comment #2 from Steve Singer <ssinger at ca.afilias.info> 2011-11-09 06:15:53 PST ---
Created an attachment (id=134)
 --> (http://www.slony.info/bugzilla/attachment.cgi?id=134)
Patch to require  a set id

This patch makes create set require a set id.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Wed Nov  9 06:18:18 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed,  9 Nov 2011 06:18:18 -0800 (PST)
Subject: [Slony1-bugs] [Bug 244] create set is not well parsed
In-Reply-To: <bug-244-4@http.www.slony.info/bugzilla/>
References: <bug-244-4@http.www.slony.info/bugzilla/>
Message-ID: <20111109141818.AFAE2290E6D@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=244

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         AssignedTo|slony1-bugs at lists.slony.inf |janwieck at yahoo.com
                   |o                           |

--- Comment #3 from Steve Singer <ssinger at ca.afilias.info> 2011-11-09 06:18:18 PST ---
Please arrange for a code review.
https://github.com/ssinger/slony1-engine/commit/0573d0d049c596bc837840160f16d49e48947123

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Wed Nov  9 08:44:01 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed,  9 Nov 2011 08:44:01 -0800 (PST)
Subject: [Slony1-bugs] [Bug 161] EXECUTE SCRIPT fails to execute multi-line
	commands
In-Reply-To: <bug-161-4@http.www.slony.info/bugzilla/>
References: <bug-161-4@http.www.slony.info/bugzilla/>
Message-ID: <20111109164401.815A7290E3E@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=161

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|                            |FIXED
             Status|NEW                         |RESOLVED

--- Comment #3 from Steve Singer <ssinger at ca.afilias.info> 2011-11-09 08:44:01 PST ---
Applied to REL_2_1_STABLE and master.  I am not sure why this wasn't committed
when a year ago when Chris gave the okay.

http://git.postgresql.org/gitweb/?p=slony1-engine.git;a=commit;h=96a7cad9f90758677273aa9a4e95c9a30062e62e
http://git.postgresql.org/gitweb/?p=slony1-engine.git;a=commit;h=0b6ee7ebcde56ff2f9819341547b9e147f8e1ff1

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Wed Nov  9 09:00:36 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed,  9 Nov 2011 09:00:36 -0800 (PST)
Subject: [Slony1-bugs] [Bug 197] Documentation Images Don't Work
In-Reply-To: <bug-197-4@http.www.slony.info/bugzilla/>
References: <bug-197-4@http.www.slony.info/bugzilla/>
Message-ID: <20111109170036.45359290E5E@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=197

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|                            |FIXED
             Status|NEW                         |RESOLVED

--- Comment #1 from Steve Singer <ssinger at ca.afilias.info> 2011-11-09 09:00:36 PST ---
This should be fixed with CVS version 1.19 of index.php in the website
repository.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Wed Nov  9 14:56:58 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Wed,  9 Nov 2011 14:56:58 -0800 (PST)
Subject: [Slony1-bugs] [Bug 137] execute script does not get applied in the
	correct order
In-Reply-To: <bug-137-4@http.www.slony.info/bugzilla/>
References: <bug-137-4@http.www.slony.info/bugzilla/>
Message-ID: <20111109225658.94D83290E3B@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=137

Christopher Browne <cbbrowne at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         AssignedTo|cbbrowne at ca.afilias.info    |janwieck at yahoo.com

--- Comment #8 from Christopher Browne <cbbrowne at ca.afilias.info> 2011-11-09 14:56:58 PST ---
A version of this that functions against version 2.2 may be found here:
https://github.com/cbbrowne/slony1-engine/tree/bug137-squashed

Note that this branch was arrived at by merging Jan's 2.2 branch and Steve's
remote worker changes atop "master":

https://github.com/wieck/slony1-engine/tree/copy-protocol-22
https://github.com/ssinger/slony1-engine/tree/copy-protocol_22_remoteworker

In practice, I think my changes are all expressed by one patch thus:
https://github.com/cbbrowne/slony1-engine/commit/5187d5343145c3c145e328ad05912d35334cd601

I'll be poking further at the documentation, as some of the old docs are
invalidated by this change.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Thu Nov 10 14:15:29 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Thu, 10 Nov 2011 14:15:29 -0800 (PST)
Subject: [Slony1-bugs] [Bug 235] SYNC GROUP size bugs
In-Reply-To: <bug-235-4@http.www.slony.info/bugzilla/>
References: <bug-235-4@http.www.slony.info/bugzilla/>
Message-ID: <20111110221529.E3074290D8A@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=235

Christopher Browne <cbbrowne at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         AssignedTo|janwieck at yahoo.com          |ssinger at ca.afilias.info

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Thu Nov 10 14:16:57 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Thu, 10 Nov 2011 14:16:57 -0800 (PST)
Subject: [Slony1-bugs] [Bug 248] Log shipper targets can't add sequences
 after initial setup
In-Reply-To: <bug-248-4@http.www.slony.info/bugzilla/>
References: <bug-248-4@http.www.slony.info/bugzilla/>
Message-ID: <20111110221657.CE371290E75@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=248

Christopher Browne <cbbrowne at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         AssignedTo|slony1-bugs at lists.slony.inf |ssinger at ca.afilias.info
                   |o                           |

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Mon Nov 14 08:52:50 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Mon, 14 Nov 2011 08:52:50 -0800 (PST)
Subject: [Slony1-bugs] [Bug 248] Log shipper targets can't add sequences
 after initial setup
In-Reply-To: <bug-248-4@http.www.slony.info/bugzilla/>
References: <bug-248-4@http.www.slony.info/bugzilla/>
Message-ID: <20111114165250.EE71F290E6D@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=248

--- Comment #7 from Christopher Browne <cbbrowne at ca.afilias.info> 2011-11-14 08:52:50 PST ---
Vis-a-vis "so, why was it this way?", I think we created the tracking table for
the sequence in order to most nearly parallel what we do with online nodes.

I'm fine with dropping that out, and directly using the sequence name.  That
doesn't seem to be a terribly costly change.  After all, the slon process
already is marshalling the sequence name+namespace in order to check the value,
so any cost to this is pretty trivial.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Mon Nov 14 09:43:39 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Mon, 14 Nov 2011 09:43:39 -0800 (PST)
Subject: [Slony1-bugs] [Bug 248] Log shipper targets can't add sequences
 after initial setup
In-Reply-To: <bug-248-4@http.www.slony.info/bugzilla/>
References: <bug-248-4@http.www.slony.info/bugzilla/>
Message-ID: <20111114174339.2E629290E78@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=248

Christopher Browne <cbbrowne at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
             Status|NEW                         |ASSIGNED

--- Comment #8 from Christopher Browne <cbbrowne at ca.afilias.info> 2011-11-14 09:43:39 PST ---
I like the approach recommended for v2.2, removing the sequence table, and
adding the "omit copy" option to the dump tool.

+1 from me.

I haven't run a test, but the code does look fine.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Mon Nov 14 10:21:03 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Mon, 14 Nov 2011 10:21:03 -0800 (PST)
Subject: [Slony1-bugs] [Bug 249] New: TRUNCATE log trigger not working quite
	right
Message-ID: <bug-249-4@http.www.slony.info/bugzilla/>

http://www.slony.info/bugzilla/show_bug.cgi?id=249

           Summary: TRUNCATE log trigger not working quite right
           Product: Slony-I
           Version: devel
          Platform: PC
        OS/Version: Linux
            Status: ASSIGNED
          Severity: enhancement
          Priority: low
         Component: stored procedures
        AssignedTo: cbbrowne at ca.afilias.info
        ReportedBy: cbbrowne at ca.afilias.info
                CC: slony1-bugs at lists.slony.info
   Estimated Hours: 0.0


slonyregress1 at localhost->  truncate table5;
ERROR:  missing FROM-clause entry for table "pg_catalog"
LINE 2:         values (c_node, pg_catalog.txid_current, c_tabid, ne...
                                ^
QUERY:  insert into "_slony_regress1".sl_log_2 (log_origin, log_txid,
log_tableid, log_actionseq, log_cmdtype, log_cmddata)
                      values (c_node, pg_catalog.txid_current, c_tabid,
nextval('_slony_regress1.sl_action_seq'), 'T', c_command)
CONTEXT:  PL/pgSQL function "log_truncate" line 17 at SQL statement
slonyregress1 at localhost->

The entry for sl_log_2 is missing parentheses for the call to txid_current().

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Mon Nov 14 15:14:49 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Mon, 14 Nov 2011 15:14:49 -0800 (PST)
Subject: [Slony1-bugs] [Bug 250] New: Log shipper does not report
	application name
Message-ID: <bug-250-4@http.www.slony.info/bugzilla/>

http://www.slony.info/bugzilla/show_bug.cgi?id=250

           Summary: Log shipper does not report application name
           Product: Slony-I
           Version: devel
          Platform: PC
        OS/Version: Linux
            Status: ASSIGNED
          Severity: enhancement
          Priority: low
         Component: slony_logshipper
        AssignedTo: cbbrowne at ca.afilias.info
        ReportedBy: cbbrowne at ca.afilias.info
                CC: slony1-bugs at lists.slony.info
   Estimated Hours: 0.0


slonyregress1 at localhost->  select * from pg_stat_activity where datname =
'logship';
  datid  | datname | procpid | usesysid | usename  | application_name |
client_addr | client_port |         backend_start         | xact_start |       
  query_start          | waiting | current_query
---------+---------+---------+----------+----------+------------------+-------------+-------------+-------------------------------+------------+-------------------------------+---------+---------------
 1005078 | logship |    6077 |       10 | postgres |                  | ::1    
    |       33703 | 2011-11-14 23:04:52.249876+00 |            | 2011-11-14
23:04:52.269174+00 | f       | <IDLE>
(1 row)

Should augment the log shipper to set the GUC.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Mon Nov 14 15:33:54 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Mon, 14 Nov 2011 15:33:54 -0800 (PST)
Subject: [Slony1-bugs] [Bug 247] Slony log shipper doesn't parse TRUNCATE
In-Reply-To: <bug-247-4@http.www.slony.info/bugzilla/>
References: <bug-247-4@http.www.slony.info/bugzilla/>
Message-ID: <20111114233355.09BB3290E3B@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=247

--- Comment #2 from Christopher Browne <cbbrowne at ca.afilias.info> 2011-11-14 15:33:55 PST ---
I found what appeared a problem, as TRUNCATE requests seemed to generate extra
semicolons.

-> % grep TRUNCATE /tmp/archive/slony1_log_2_00000000000000000341.sql
TRUNCATE TABLE ONLY "public"."table5" CASCADE;;
TRUNCATE TABLE ONLY "public"."table5" CASCADE;;
TRUNCATE TABLE ONLY "public"."table5" CASCADE;;
TRUNCATE TABLE ONLY "public"."table5" CASCADE;;
TRUNCATE TABLE ONLY "public"."table5" CASCADE;;
TRUNCATE TABLE ONLY "public"."table5" CASCADE;;
TRUNCATE TABLE ONLY "public"."table5" CASCADE;;
TRUNCATE TABLE ONLY "public"."table5" CASCADE;;
TRUNCATE TABLE ONLY "public"."table5" CASCADE;;
TRUNCATE TABLE ONLY "public"."table5" CASCADE;;
TRUNCATE TABLE ONLY "public"."table5" CASCADE;;
TRUNCATE TABLE ONLY "public"."table5" CASCADE;;
TRUNCATE TABLE ONLY "public"."table5" CASCADE;;

This causes the log shipper to error out thus:

INFO  2011-11-14 18:21:54 > NOTICE:  Slony-I: Process archive with counter 341
created 2011-11-14 23:16:56.845883
ERROR 2011-11-14 18:21:54 >
/tmp/archive/slony1_log_2_00000000000000000341.sql:138: ERROR syntax error at
or near ;
WARN  2011-11-14 18:21:54 > waiting for resume

[Rummaging around to see where the spurious ; comes from...]

Ah.  I have half the change in place...

- you have removed the semicolon from src/backend/slony1_funcs.sql, at the
point at which it's generated.  And I'm not yet running that version of the
function; I only added in the updated log shipper binaries.

- you added semicolon to src/slon/remote_worker.c, at the point at which the
SQL is processed.  And I *am* running the newer slon...

So, with the caveat that we should watch out for 
   TRUNCATE TABLE ONLY "public"."table5" CASCADE;;
, I am happy with this one.

FYI, I noticed that the log shipper doesn't set the application name GUC; I
opened bug #250 for that.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Tue Nov 15 09:43:56 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Tue, 15 Nov 2011 09:43:56 -0800 (PST)
Subject: [Slony1-bugs] [Bug 250] Log shipper does not report application name
In-Reply-To: <bug-250-4@http.www.slony.info/bugzilla/>
References: <bug-250-4@http.www.slony.info/bugzilla/>
Message-ID: <20111115174356.D6CA0290E72@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=250

--- Comment #1 from Christopher Browne <cbbrowne at ca.afilias.info> 2011-11-15 09:43:56 PST ---
With patch...

-> % psql slonyregress1
Line style is ascii.                                                           
                                                                               
                                                                               
                               psql (9.0.5)
Type "help" for help.

slonyregress1 at localhost->  select * from pg_stat_activity where datname =
'logship';
  datid  | datname | procpid | usesysid | usename  | application_name |
client_addr | client_port |         backend_start         | xact_start |       
  query_start          | waiting | current_query
---------+---------+---------+----------+----------+------------------+-------------+-------------+-------------------------------+------------+-------------------------------+---------+---------------
 1006040 | logship |   14348 |       10 | postgres | slony_logshipper | ::1    
    |       38232 | 2011-11-15 17:40:15.623945+00 |            | 2011-11-15
17:40:15.673026+00 | f       | <IDLE>
(1 row)

Set up branch:
https://github.com/cbbrowne/slony1-engine/tree/bug250

Patch that adds GUC:
https://github.com/cbbrowne/slony1-engine/commit/9007a3548b89135d5886c13f223743cbd7c75866

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Tue Nov 15 09:44:12 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Tue, 15 Nov 2011 09:44:12 -0800 (PST)
Subject: [Slony1-bugs] [Bug 250] Log shipper does not report application name
In-Reply-To: <bug-250-4@http.www.slony.info/bugzilla/>
References: <bug-250-4@http.www.slony.info/bugzilla/>
Message-ID: <20111115174412.E1B78290E72@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=250

Christopher Browne <cbbrowne at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         AssignedTo|cbbrowne at ca.afilias.info    |janwieck at yahoo.com

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Tue Nov 15 09:44:26 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Tue, 15 Nov 2011 09:44:26 -0800 (PST)
Subject: [Slony1-bugs] [Bug 250] Log shipper does not report application name
In-Reply-To: <bug-250-4@http.www.slony.info/bugzilla/>
References: <bug-250-4@http.www.slony.info/bugzilla/>
Message-ID: <20111115174426.0D67D290E7A@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=250

--- Comment #2 from Christopher Browne <cbbrowne at ca.afilias.info> 2011-11-15 09:44:26 PST ---
Ready for review

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Tue Nov 15 11:01:48 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Tue, 15 Nov 2011 11:01:48 -0800 (PST)
Subject: [Slony1-bugs] [Bug 236] misformatted log messages
In-Reply-To: <bug-236-4@http.www.slony.info/bugzilla/>
References: <bug-236-4@http.www.slony.info/bugzilla/>
Message-ID: <20111115190148.D6A7F290E6B@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=236

Christopher Browne <cbbrowne at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         AssignedTo|cbbrowne at ca.afilias.info    |janwieck at yahoo.com

--- Comment #4 from Christopher Browne <cbbrowne at ca.afilias.info> 2011-11-15 11:01:48 PST ---
This should probably get an extra set of eyes before going in?

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Tue Nov 15 11:01:56 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Tue, 15 Nov 2011 11:01:56 -0800 (PST)
Subject: [Slony1-bugs] [Bug 236] misformatted log messages
In-Reply-To: <bug-236-4@http.www.slony.info/bugzilla/>
References: <bug-236-4@http.www.slony.info/bugzilla/>
Message-ID: <20111115190156.D3518290E6B@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=236

Christopher Browne <cbbrowne at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
             Status|NEW                         |ASSIGNED

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Tue Nov 15 13:04:19 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Tue, 15 Nov 2011 13:04:19 -0800 (PST)
Subject: [Slony1-bugs] [Bug 137] execute script does not get applied in the
	correct order
In-Reply-To: <bug-137-4@http.www.slony.info/bugzilla/>
References: <bug-137-4@http.www.slony.info/bugzilla/>
Message-ID: <20111115210419.CF881290E32@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=137

--- Comment #9 from Steve Singer <ssinger at ca.afilias.info> 2011-11-15 13:04:19 PST ---
I have looked at your changes.

Here is my review



1. Your unit test changes should be to the javascript version of the regression
ones not the shell ones

2. It would be nice if we could be syntax backwards compatible on EXECUTE
SCRIPT.
ie 
EXECUTE SCRIPT(set id=1, FILENAME='foo', EXECUTE ONLY ON=1, EVENT NODE=1); 

should still work. The grammer accepts this, it is the code in assign_options
that need to have an INT_OR_STR option. or something.  We would also need to
make event_node optional if only 1 ONLY ON node is specifid.  



3.  In ddlchanges.sgml item 3
I am opposed to saying in the manual that DDL can be submitted directly with
the ddlCapture SQL function.  I feel that only slonik should be calling these
slony functions.  By telling people in the manual that they can do this then we
are committing to a somewhat stable API.
I think it will also encourage people to call other slony SQL functions
directly.


The counter argument is that now that ddlChange() isn't an event it actually
can be safely called by someone other than slonik and it allows applications
(ie java, php,perl,python etc...) do do there own DDL without having to make a
system() call to slonik.  I am somewhat sympathetic to this but I remind people
that in any version prior to 2.2 this was a really bad/broken idea. Even in 2.2
calling ddlChange() outside of slonik with more than one EVENT NODE can expose
you to race conditions.


In slonik_ref.sgml
I would like to see any encouragement to calling ddlCapture() directly removed
(see above for reasons)


slony1_funcs.sql

In 2.1 the ddlSCript_complete_int() function calls repair_log_triggers() and
updateRelname() to fixup the slony sl_table and log triggers after a DDL event.
 I don't see these being used in 2.2.  I *think* the log_apply trigger needs to
perform both of these actions after executing the SQL.

slony1_base.sql

In sl_log_script definition we are using bigint for log_txid and int8 for
log_actionseq.  I see sl_log_1 sl_log_2 are defined the same way.  Is there a
difference between bigint and int8?  Should we be consistnet? Should we be
changing sl_log_1 and sl_log_2 (since the 2.2 upgrade code is dropping sl_log_1
anyway)?


slonik.c
--------------

slonik_ddl_script

We don't free res1 in the happy path, just in the error case.

If the SET ID is never used should we make it an optional element in the
grammer (script_check_stmtS)




remote_worker.c
----------------------

Create a two node test case.

create set(set id=1, origin=1);
set add table(set id=1, fully qualified name='public.foo');
subscribe set(id=1,provider=1,receiver=2);
execute script(set id=1, filename='bar.sql', execute on=2);

The script gets executed on node 2 but never on node 1.  Even though I didn't
submit a 'EXECUTE ONLY ON'.  The problem is that if a node 1 is not receiving
any subscription sets from node 2 the node 1 will never see any DDL from node 2
because the provider structures in the remoteWorker don't have it listening for
these events.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Tue Nov 15 13:23:32 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Tue, 15 Nov 2011 13:23:32 -0800 (PST)
Subject: [Slony1-bugs] [Bug 247] Slony log shipper doesn't parse TRUNCATE
In-Reply-To: <bug-247-4@http.www.slony.info/bugzilla/>
References: <bug-247-4@http.www.slony.info/bugzilla/>
Message-ID: <20111115212332.9E827290E54@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=247

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|                            |FIXED
             Status|ASSIGNED                    |RESOLVED

--- Comment #3 from Steve Singer <ssinger at ca.afilias.info> 2011-11-15 13:23:32 PST ---

Applied on master (2.2) and 2.1
http://git.postgresql.org/gitweb/?p=slony1-engine.git;a=commit;h=e3361ae91d869cbc010b3f893acdf23868835bdd
http://git.postgresql.org/gitweb/?p=slony1-engine.git;a=commit;h=a2f20fad7212e997586570499e63d7f6914a7aeb

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Tue Nov 15 13:25:58 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Tue, 15 Nov 2011 13:25:58 -0800 (PST)
Subject: [Slony1-bugs] [Bug 248] Log shipper targets can't add sequences
 after initial setup
In-Reply-To: <bug-248-4@http.www.slony.info/bugzilla/>
References: <bug-248-4@http.www.slony.info/bugzilla/>
Message-ID: <20111115212558.8FDFF290E54@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=248

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|                            |FIXED
             Status|ASSIGNED                    |RESOLVED

--- Comment #9 from Steve Singer <ssinger at ca.afilias.info> 2011-11-15 13:25:58 PST ---
Committed to 2.2 (master) using the no sequence table option.
slony1_dump.sh was also modified to have an omit_copy option.

http://git.postgresql.org/gitweb/?p=slony1-engine.git;a=commit;h=4b502d83cdcd072e023068d2d2b9a80c3a6e197e

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Tue Nov 15 14:41:24 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Tue, 15 Nov 2011 14:41:24 -0800 (PST)
Subject: [Slony1-bugs] [Bug 137] execute script does not get applied in the
	correct order
In-Reply-To: <bug-137-4@http.www.slony.info/bugzilla/>
References: <bug-137-4@http.www.slony.info/bugzilla/>
Message-ID: <20111115224125.0434D290E3B@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=137

--- Comment #10 from Christopher Browne <cbbrowne at ca.afilias.info> 2011-11-15 14:41:25 PST ---
(In reply to comment #9)
> I have looked at your changes.
> 
> 1. Your unit test changes should be to the javascript version of the regression
> ones not the shell ones

Good point; I have patched the clustertest tests.

https://github.com/cbbrowne/slony1-engine/commit/e6eb7808f6cc3124385c974c235bb48e925af4f7

https://github.com/cbbrowne/slony1-engine/commit/8065a2e4c4426f8f66a9a276fd90a90407bc9dd0

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Tue Nov 15 15:00:08 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Tue, 15 Nov 2011 15:00:08 -0800 (PST)
Subject: [Slony1-bugs] [Bug 137] execute script does not get applied in the
	correct order
In-Reply-To: <bug-137-4@http.www.slony.info/bugzilla/>
References: <bug-137-4@http.www.slony.info/bugzilla/>
Message-ID: <20111115230008.F23FF290E3B@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=137

--- Comment #11 from Christopher Browne <cbbrowne at ca.afilias.info> 2011-11-15 15:00:09 PST ---
(In reply to comment #9)
> 2. It would be nice if we could be syntax backwards compatible on EXECUTE
> SCRIPT.
> ie 
> EXECUTE SCRIPT(set id=1, FILENAME='foo', EXECUTE ONLY ON=1, EVENT NODE=1); 
> 
> should still work. The grammer accepts this, it is the code in assign_options
> that need to have an INT_OR_STR option. or something.  We would also need to
> make event_node optional if only 1 ONLY ON node is specifid.  

Good points.  I'm taking a poke at this.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Thu Nov 17 10:00:30 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Thu, 17 Nov 2011 10:00:30 -0800 (PST)
Subject: [Slony1-bugs] [Bug 137] execute script does not get applied in the
	correct order
In-Reply-To: <bug-137-4@http.www.slony.info/bugzilla/>
References: <bug-137-4@http.www.slony.info/bugzilla/>
Message-ID: <20111117180030.84FAB290E57@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=137

--- Comment #12 from Christopher Browne <cbbrowne at ca.afilias.info> 2011-11-17 10:00:30 PST ---
(In reply to comment #9)
> 2. It would be nice if we could be syntax backwards compatible on EXECUTE
> SCRIPT.
> ie 
> EXECUTE SCRIPT(set id=1, FILENAME='foo', EXECUTE ONLY ON=1, EVENT NODE=1); 
> 
> should still work. The grammer accepts this, it is the code in assign_options
> that need to have an INT_OR_STR option. or something.

https://github.com/cbbrowne/slony1-engine/commit/30912a5af6a1077e07437e96a09d788dd412e544

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Thu Nov 17 10:04:55 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Thu, 17 Nov 2011 10:04:55 -0800 (PST)
Subject: [Slony1-bugs] [Bug 137] execute script does not get applied in the
	correct order
In-Reply-To: <bug-137-4@http.www.slony.info/bugzilla/>
References: <bug-137-4@http.www.slony.info/bugzilla/>
Message-ID: <20111117180455.780CE290E6E@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=137

--- Comment #13 from Christopher Browne <cbbrowne at ca.afilias.info> 2011-11-17 10:04:55 PST ---
(In reply to comment #9)
> 3.  In ddlchanges.sgml item 3
> I am opposed to saying in the manual that DDL can be submitted directly with
> the ddlCapture SQL function.  I feel that only slonik should be calling these
> slony functions.  By telling people in the manual that they can do this then we
> are committing to a somewhat stable API.
> I think it will also encourage people to call other slony SQL functions
> directly.
> 
> 
> The counter argument is that now that ddlChange() isn't an event it actually
> can be safely called by someone other than slonik and it allows applications
> (ie java, php,perl,python etc...) do do there own DDL without having to make a
> system() call to slonik.  I am somewhat sympathetic to this but I remind people
> that in any version prior to 2.2 this was a really bad/broken idea. Even in 2.2
> calling ddlChange() outside of slonik with more than one EVENT NODE can expose
> you to race conditions.

https://github.com/cbbrowne/slony1-engine/commit/af54adb535146a84923ae3e59c1c6c27217e1ab8

> In slonik_ref.sgml
> I would like to see any encouragement to calling ddlCapture() directly removed
> (see above for reasons)

https://github.com/cbbrowne/slony1-engine/commit/789534ca1658bcc685a59f325fe2658827d3de5c

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Thu Nov 17 11:41:30 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Thu, 17 Nov 2011 11:41:30 -0800 (PST)
Subject: [Slony1-bugs] [Bug 251] New: RPM Repository link on page 19 is out
	of date
Message-ID: <bug-251-4@http.www.slony.info/bugzilla/>

http://www.slony.info/bugzilla/show_bug.cgi?id=251

           Summary: RPM Repository link on page 19 is out of date
           Product: Slony-I
           Version: 2.0
          Platform: All
        OS/Version: All
            Status: NEW
          Severity: trivial
          Priority: low
         Component: docs
        AssignedTo: slony1-bugs at lists.slony.info
        ReportedBy: vitaliy.se at gmail.com
                CC: slony1-bugs at lists.slony.info
   Estimated Hours: 0.0


RPM Repository link on page 19 is out of date

it refers to 
https://public.commandprompt.com/projects/pgcore/wiki
which says that project is depricated
and the correct link is 
http://yum.postgresql.org

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Fri Nov 18 09:07:28 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri, 18 Nov 2011 09:07:28 -0800 (PST)
Subject: [Slony1-bugs] [Bug 137] execute script does not get applied in the
	correct order
In-Reply-To: <bug-137-4@http.www.slony.info/bugzilla/>
References: <bug-137-4@http.www.slony.info/bugzilla/>
Message-ID: <20111118170728.F406F290E6E@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=137

--- Comment #14 from Christopher Browne <cbbrowne at ca.afilias.info> 2011-11-18 09:07:28 PST ---
(In reply to comment #9)
> 2. It would be nice if we could be syntax backwards compatible on EXECUTE
> SCRIPT.
> ie 
> EXECUTE SCRIPT(set id=1, FILENAME='foo', EXECUTE ONLY ON=1, EVENT NODE=1); 
> 
> should still work. The grammer accepts this, it is the code in assign_options
> that need to have an INT_OR_STR option. or something.  We would also need to
> make event_node optional if only 1 ONLY ON node is specifid.  

Added this to docs:

https://github.com/cbbrowne/slony1-engine/commit/6dc3401b52b3ee03dd26b0a6d87c22101a19fffb

Added regression tests for several cases surrounding this:

https://github.com/cbbrowne/slony1-engine/commit/4e6e90dd332c965dea399abde2266b2b9cdc5063

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Fri Nov 18 09:40:02 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri, 18 Nov 2011 09:40:02 -0800 (PST)
Subject: [Slony1-bugs] [Bug 137] execute script does not get applied in the
	correct order
In-Reply-To: <bug-137-4@http.www.slony.info/bugzilla/>
References: <bug-137-4@http.www.slony.info/bugzilla/>
Message-ID: <20111118174002.7C764290E75@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=137

--- Comment #15 from Christopher Browne <cbbrowne at ca.afilias.info> 2011-11-18 09:40:02 PST ---
(In reply to comment #9)
> slony1_funcs.sql
> 
> In 2.1 the ddlSCript_complete_int() function calls repair_log_triggers() and
> updateRelname() to fixup the slony sl_table and log triggers after a DDL event.
>  I don't see these being used in 2.2.  I *think* the log_apply trigger needs to
> perform both of these actions after executing the SQL.

Yep, quite right.

Call these functions:
https://github.com/cbbrowne/slony1-engine/commit/b07cf0014b8e52b7c597b54a4765ee3cda6d421e

Optimization: only fix values that are busted
https://github.com/cbbrowne/slony1-engine/commit/bd913b2adbe356e15b3a59c85a830ea4269d403a

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Tue Nov 22 04:46:10 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Tue, 22 Nov 2011 04:46:10 -0800 (PST)
Subject: [Slony1-bugs] [Bug 252] New: cloneNodePrepare() stores invalid
	conninfo in sl_path
Message-ID: <bug-252-4@http.www.slony.info/bugzilla/>

http://www.slony.info/bugzilla/show_bug.cgi?id=252

           Summary: cloneNodePrepare() stores invalid conninfo in sl_path
           Product: Slony-I
           Version: 2.0
          Platform: PC
        OS/Version: Linux
            Status: NEW
          Severity: normal
          Priority: low
         Component: stored procedures
        AssignedTo: slony1-bugs at lists.slony.info
        ReportedBy: womagrid at gmail.com
                CC: slony1-bugs at lists.slony.info
   Estimated Hours: 0.0


The cloneNodePrepare() function sets sl_path.pa_conninfo to 'Event pending'.

I believe this is a bug for the following reasons...

1) All other functions seem to store '<event pending>' or a valid conninfo
string containing connection parameters.

2) slon complains that 'Event pending' is not a valid name-value pair.

2011-11-22 12:40:04 GMTERROR  slon_connectdb: PQconnectdb("Event pending")
failed - missing "=" after "Event" in connection info string
2011-11-22 12:40:04 GMTWARN   remoteListenThread_4: DB connection failed -
sleep 10 seconds

Despite this, it is possible to clone a node and restore its sync.

My concern is that, as well as generating unnecessary log noise, this bug
leaves behind an invalid and incomplete path configuration.

As a result, it may not be possible to perform subsequent operations, such as
revising the subscription information and paths for a cloned node to achieve
cascading replication.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Tue Nov 22 12:20:33 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Tue, 22 Nov 2011 12:20:33 -0800 (PST)
Subject: [Slony1-bugs] [Bug 250] Log shipper does not report application name
In-Reply-To: <bug-250-4@http.www.slony.info/bugzilla/>
References: <bug-250-4@http.www.slony.info/bugzilla/>
Message-ID: <20111122202033.CD0DD290DF6@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=250

--- Comment #3 from Steve Singer <ssinger at ca.afilias.info> 2011-11-22 12:20:33 PST ---
(In reply to comment #2)
> Ready for review

+   dstring_init(&query);
+   slon_mkquery(&query,"select 1 from pg_catalog.pg_settings where name=
'application_name'; ");
+   res = PQexec (dbconn, dstring_data(&query));
+   
+   if (PQresultStatus(res) != PGRES_TUPLES_OK)
+           return -1;

&query should be free'd before the return
Just free it before the PQresultStatus  call.

+   dstring_free(&query); 
+
+   if (PQntuples(res) == 0)
+   {
+           PQclear(res);
+   } else {
+           PQclear(res);
+           dstring_init(&query);
+           slon_mkquery(&query,"SET application_name TO 'slony_logshipper';
");
+           res=PQexec(dbconn, dstring_data(&query));
+           dstring_free(&query); 
+           PQclear(res);
+   }
+

Otherwise this seems fine for checkin.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Tue Nov 22 12:22:35 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Tue, 22 Nov 2011 12:22:35 -0800 (PST)
Subject: [Slony1-bugs] [Bug 249] TRUNCATE log trigger not working quite right
In-Reply-To: <bug-249-4@http.www.slony.info/bugzilla/>
References: <bug-249-4@http.www.slony.info/bugzilla/>
Message-ID: <20111122202235.6914E290E44@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=249

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|                            |FIXED
             Status|ASSIGNED                    |RESOLVED

--- Comment #1 from Steve Singer <ssinger at ca.afilias.info> 2011-11-22 12:22:34 PST ---
This was committed

http://git.postgresql.org/gitweb/?p=slony1-engine.git;a=commit;h=72f87b48e4211d60981363de3579091372c6f9e4
http://git.postgresql.org/gitweb/?p=slony1-engine.git;a=commit;h=b06e5007a52f0457cf382a130b135e9e13de3e58

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Tue Nov 22 12:30:29 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Tue, 22 Nov 2011 12:30:29 -0800 (PST)
Subject: [Slony1-bugs] [Bug 251] RPM Repository link on page 19 is out of
	date
In-Reply-To: <bug-251-4@http.www.slony.info/bugzilla/>
References: <bug-251-4@http.www.slony.info/bugzilla/>
Message-ID: <20111122203029.925EA290E02@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=251

--- Comment #1 from Steve Singer <ssinger at ca.afilias.info> 2011-11-22 12:30:29 PST ---
Page 19 of what document are you referring to?  Please provide a URL.

I am having a hard time finding references to the old site in the documentation
for any of

2.1.0
2.0.7
1.2.22

Even the 1.2 branch
http://www.slony.info/documentation/1.2/installation.html

refers to the yum.postgresql.org site.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Tue Nov 22 12:50:35 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Tue, 22 Nov 2011 12:50:35 -0800 (PST)
Subject: [Slony1-bugs] [Bug 250] Log shipper does not report application name
In-Reply-To: <bug-250-4@http.www.slony.info/bugzilla/>
References: <bug-250-4@http.www.slony.info/bugzilla/>
Message-ID: <20111122205035.D58EA290E81@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=250

Christopher Browne <cbbrowne at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|                            |FIXED
             Status|ASSIGNED                    |RESOLVED

--- Comment #4 from Christopher Browne <cbbrowne at ca.afilias.info> 2011-11-22 12:50:35 PST ---
Changed, per Steve's recommendation, and committed to master.

http://git.postgresql.org/gitweb/?p=slony1-engine.git;a=commit;h=2af7fd8ba9e09eb78c9d28f69396b4a6182e7f95

http://git.postgresql.org/gitweb/?p=slony1-engine.git;a=commit;h=c3197bd68a5da9829d89469fb835a10278f7ab4f

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Tue Nov 22 14:10:26 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Tue, 22 Nov 2011 14:10:26 -0800 (PST)
Subject: [Slony1-bugs] [Bug 192] Cluster test output not specific enough
In-Reply-To: <bug-192-4@http.www.slony.info/bugzilla/>
References: <bug-192-4@http.www.slony.info/bugzilla/>
Message-ID: <20111122221026.E0807290E81@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=192

Christopher Browne <cbbrowne at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|                            |FIXED
             Status|ASSIGNED                    |RESOLVED

--- Comment #1 from Christopher Browne <cbbrowne at ca.afilias.info> 2011-11-22 14:10:26 PST ---
Both of these have been committed to master, so can be treated as complete.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Tue Nov 22 14:11:38 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Tue, 22 Nov 2011 14:11:38 -0800 (PST)
Subject: [Slony1-bugs] [Bug 236] misformatted log messages
In-Reply-To: <bug-236-4@http.www.slony.info/bugzilla/>
References: <bug-236-4@http.www.slony.info/bugzilla/>
Message-ID: <20111122221138.2827C290E81@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=236

Christopher Browne <cbbrowne at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         AssignedTo|janwieck at yahoo.com          |ssinger at ca.afilias.info

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Tue Nov 22 14:11:48 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Tue, 22 Nov 2011 14:11:48 -0800 (PST)
Subject: [Slony1-bugs] [Bug 236] misformatted log messages
In-Reply-To: <bug-236-4@http.www.slony.info/bugzilla/>
References: <bug-236-4@http.www.slony.info/bugzilla/>
Message-ID: <20111122221148.60982290E83@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=236

--- Comment #5 from Christopher Browne <cbbrowne at ca.afilias.info> 2011-11-22 14:11:47 PST ---
Please review.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Tue Nov 22 14:21:54 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Tue, 22 Nov 2011 14:21:54 -0800 (PST)
Subject: [Slony1-bugs] [Bug 236] misformatted log messages
In-Reply-To: <bug-236-4@http.www.slony.info/bugzilla/>
References: <bug-236-4@http.www.slony.info/bugzilla/>
Message-ID: <20111122222154.814B1290E81@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=236

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|                            |FIXED
             Status|ASSIGNED                    |RESOLVED

--- Comment #6 from Steve Singer <ssinger at ca.afilias.info> 2011-11-22 14:21:54 PST ---
This had been committed as part of 2.1.0

dec4af90ff6abe0521be90fef3149f8225888d88

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Thu Nov 24 07:10:10 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Thu, 24 Nov 2011 07:10:10 -0800 (PST)
Subject: [Slony1-bugs] [Bug 235] SYNC GROUP size bugs
In-Reply-To: <bug-235-4@http.www.slony.info/bugzilla/>
References: <bug-235-4@http.www.slony.info/bugzilla/>
Message-ID: <20111124151010.0EFC0290E6B@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=235

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         AssignedTo|ssinger at ca.afilias.info     |cbbrowne at ca.afilias.info

--- Comment #13 from Steve Singer <ssinger at ca.afilias.info> 2011-11-24 07:10:09 PST ---
I've taken a lot at the rebased against the current master (2.2).


--- 249,263 ----
  time_t        explain_lastsec;
  int            explain_thistime;

! typedef enum
! {
!     SYNC_INITIAL = 1,
!     SYNC_PENDING,
!     SYNC_SUCCESS,
!     SYNC_FAILURE
! 
! } SlonSyncStatus;

SYNC_FAILURE is a state that is never actually set/checked.  In the event of a
failure applying the sync the remote worker causes the slon to restart
resetting the count to the inital state.  None of the logic to decrease the
group size is used.   We should either get the remote_worker to detect+recover
from this error OR remove the FAILURE state and /2 logic and add a comment that
we depend on restart.

In confoptions.c  
{
        {
            (const char *) "sync_group_maxsize",
            gettext_noop("sync group"),
            gettext_noop("sync group"),
            SLON_C_INT
        },
        &sync_group_maxsize,
        20,
        0,
        10000
    },

isn't part of you diff but should be.   The description (inside gettext_noop)
is insufficient.  It should say something like "The maximum number of SYNC
events that will be applied as part of the same transaction"   

I tested the doubling logic and it seemed fine.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Thu Nov 24 09:22:48 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Thu, 24 Nov 2011 09:22:48 -0800 (PST)
Subject: [Slony1-bugs] [Bug 235] SYNC GROUP size bugs
In-Reply-To: <bug-235-4@http.www.slony.info/bugzilla/>
References: <bug-235-4@http.www.slony.info/bugzilla/>
Message-ID: <20111124172248.BED6D290E57@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=235

--- Comment #14 from Christopher Browne <cbbrowne at ca.afilias.info> 2011-11-24 09:22:48 PST ---
(In reply to comment #13)
> I've taken a lot at the rebased against the current master (2.2).
> 
> 
> --- 249,263 ----
>   time_t        explain_lastsec;
>   int            explain_thistime;
> 
> ! typedef enum
> ! {
> !     SYNC_INITIAL = 1,
> !     SYNC_PENDING,
> !     SYNC_SUCCESS,
> !     SYNC_FAILURE
> ! 
> ! } SlonSyncStatus;
> 
> SYNC_FAILURE is a state that is never actually set/checked.  In the event of a
> failure applying the sync the remote worker causes the slon to restart
> resetting the count to the inital state.  None of the logic to decrease the
> group size is used.   We should either get the remote_worker to detect+recover
> from this error OR remove the FAILURE state and /2 logic and add a comment that
> we depend on restart.

Agreed, SYNC_FAILURE can't occur, as it is never set in the code.  In
principle, the code that checks for SYNC_SUCCESS can "accept" SYNC_FAILURE (at
which point it would does the divide-by-2 logic), but it's fair to say that
this doesn't really occur.

I don't think it makes sense to try to get the remote worker thread to detect
failure and keep the old grouping size between invocations of the thread; that
would be considerable work, with limited value.  So I have added comment that
the logic for the "not SYNC_SUCCESS" amounts to setting the value to 1, as
restarting the remote worker thread forces the value back to 1.

https://github.com/cbbrowne/slony1-engine/commit/4e1d743c9c8f1d170abb1473907d5aef8dc06de4

> In confoptions.c  
> {
>         {
>             (const char *) "sync_group_maxsize",
>             gettext_noop("sync group"),
>             gettext_noop("sync group"),
>             SLON_C_INT
>         },
>         &sync_group_maxsize,
>         20,
>         0,
>         10000
>     },
> 
> isn't part of you diff but should be.   The description (inside gettext_noop)
> is insufficient.  It should say something like "The maximum number of SYNC
> events that will be applied as part of the same transaction"   

Good call.

https://github.com/cbbrowne/slony1-engine/commit/424f4df643e014bd5358dbec47fd3c665efb5ce1

> I tested the doubling logic and it seemed fine.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Thu Nov 24 09:50:07 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Thu, 24 Nov 2011 09:50:07 -0800 (PST)
Subject: [Slony1-bugs] [Bug 244] create set is not well parsed
In-Reply-To: <bug-244-4@http.www.slony.info/bugzilla/>
References: <bug-244-4@http.www.slony.info/bugzilla/>
Message-ID: <20111124175007.731F9290E6A@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=244

Christopher Browne <cbbrowne at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         AssignedTo|janwieck at yahoo.com          |ssinger at ca.afilias.info

--- Comment #4 from Christopher Browne <cbbrowne at ca.afilias.info> 2011-11-24 09:50:07 PST ---
Applies fine, and is a good change.

Would it make any sense to bother addding a regression test for this?

I'd be fine with applying this to master, and wouldn't object to backpatching
2.0/2.1.

The only additional thing needed (which would certainly vary if applying to old
branches) is release notes.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Fri Nov 25 06:07:33 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri, 25 Nov 2011 06:07:33 -0800 (PST)
Subject: [Slony1-bugs] [Bug 235] SYNC GROUP size bugs
In-Reply-To: <bug-235-4@http.www.slony.info/bugzilla/>
References: <bug-235-4@http.www.slony.info/bugzilla/>
Message-ID: <20111125140733.30CC2290E57@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=235

--- Comment #15 from Steve Singer <ssinger at ca.afilias.info> 2011-11-25 06:07:33 PST ---
This verison looks fine, except the text you added to the release notes looks a
bit out of place.  The rest of the release notes seem to be 1 or two sentences.

Maybe

- Bug #235 :: SYNC GROUP sizes are now dynamically grow between 2 and a maximum
 size set in the config file.  The old logic based on time it took to complete
the last SYNC has been removed.

What you put in the release notes might be a good commit comment for git.
I would recommend squashing all of your smaller commits into 1 commit + 1
encompassing comment when you merge to master.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Fri Nov 25 06:24:06 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri, 25 Nov 2011 06:24:06 -0800 (PST)
Subject: [Slony1-bugs] [Bug 244] create set is not well parsed
In-Reply-To: <bug-244-4@http.www.slony.info/bugzilla/>
References: <bug-244-4@http.www.slony.info/bugzilla/>
Message-ID: <20111125142406.D2600290E77@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=244

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|                            |FIXED
             Status|ASSIGNED                    |RESOLVED

--- Comment #5 from Steve Singer <ssinger at ca.afilias.info> 2011-11-25 06:24:06 PST ---
I have applied this agains master and REL_2_1_STABLE
http://git.postgresql.org/gitweb/?p=slony1-engine.git;a=commit;h=003a9e025244a16266e0c4b1cc1335ab8fa33d77

http://git.postgresql.org/gitweb/?p=slony1-engine.git;a=commit;h=b940c9eb667151a48e1e203a7eed585832cc9b94

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Fri Nov 25 08:47:08 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri, 25 Nov 2011 08:47:08 -0800 (PST)
Subject: [Slony1-bugs] [Bug 235] SYNC GROUP size bugs
In-Reply-To: <bug-235-4@http.www.slony.info/bugzilla/>
References: <bug-235-4@http.www.slony.info/bugzilla/>
Message-ID: <20111125164708.14388290E20@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=235

Christopher Browne <cbbrowne at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|                            |FIXED
             Status|ASSIGNED                    |RESOLVED

--- Comment #16 from Christopher Browne <cbbrowne at ca.afilias.info> 2011-11-25 08:47:07 PST ---
Merged into a single commit.

http://git.postgresql.org/gitweb/?p=slony1-engine.git;a=commit;h=e0301ce99d8385b592ae5753572f6527fa4c447b

Note that I dropped out the 2.1 and earlier release notes, as that's not going
to be relevant to 2.2 anymore

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.

From bugzilla-daemon at main.slony.info  Fri Nov 25 10:12:18 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri, 25 Nov 2011 10:12:18 -0800 (PST)
Subject: [Slony1-bugs] [Bug 251] RPM Repository link on page 19 is out of
	date
In-Reply-To: <bug-251-4@http.www.slony.info/bugzilla/>
References: <bug-251-4@http.www.slony.info/bugzilla/>
Message-ID: <20111125181218.4BC22290E79@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=251

--- Comment #2 from vitaliy <vitaliy.se at gmail.com> 2011-11-25 10:12:18 PST ---
http://slony.info/adminguide/2.1/doc/adminguide/slony.pdf

document on page 19 has a link to PostgreSQL RPM Repository.

you need to click on "PostgreSQL RPM Repository" to get to
https://public.commandprompt.com/projects/pgcore/wiki

which says it is deprecated and you need to use  http://yum.postgresql.org
instead

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Fri Nov 25 13:59:38 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Fri, 25 Nov 2011 13:59:38 -0800 (PST)
Subject: [Slony1-bugs] [Bug 251] RPM Repository link on page 19 is out of
	date
In-Reply-To: <bug-251-4@http.www.slony.info/bugzilla/>
References: <bug-251-4@http.www.slony.info/bugzilla/>
Message-ID: <20111125215938.66901290E76@main.slony.info>

http://www.slony.info/bugzilla/show_bug.cgi?id=251

Steve Singer <ssinger at ca.afilias.info> changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
         Resolution|                            |FIXED
             Status|NEW                         |RESOLVED

--- Comment #3 from Steve Singer <ssinger at ca.afilias.info> 2011-11-25 13:59:38 PST ---
Thanks I now see the URL.  

I have updated this in the source tree.  The PDF will be updated the next time
we package a release (2.1.1)

http://git.postgresql.org/gitweb/?p=slony1-engine.git;a=commit;h=4e8dcf2ea27ddb8df9095b8def42288340414e85

http://git.postgresql.org/gitweb/?p=slony1-engine.git;a=commit;h=0a9346436b0369b887945219bd43b611fd79c6ca

http://git.postgresql.org/gitweb/?p=slony1-engine.git;a=commit;h=9b5569289e4aa3751330bda258ec050f74ba2ba6

Thanks for reporting this.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

From bugzilla-daemon at main.slony.info  Mon Nov 28 04:40:20 2011
From: bugzilla-daemon at main.slony.info (bugzilla-daemon at main.slony.info)
Date: Mon, 28 Nov 2011 04:40:20 -0800 (PST)
Subject: [Slony1-bugs] [Bug 253] New: In the event of OID mismatch,
 slon confirms replication events without actually actioning them
Message-ID: <bug-253-4@http.www.slony.info/bugzilla/>

http://www.slony.info/bugzilla/show_bug.cgi?id=253

           Summary: In the event of OID mismatch, slon confirms
                    replication events without actually actioning them
           Product: Slony-I
           Version: 2.0
          Platform: PC
        OS/Version: Linux
            Status: NEW
          Severity: normal
          Priority: low
         Component: slon
        AssignedTo: slony1-bugs at lists.slony.info
        ReportedBy: womagrid at gmail.com
                CC: slony1-bugs at lists.slony.info
   Estimated Hours: 0.0


1) Create any Slony cluster e.g. 1 x master, 1 x slave, 1 x set

2) On the slave, stop slon

3) On the slave, perform an operation that invalidates an OID stored in
sl_table or sl_sequence e.g. DROP TABLE <table> and CREATE TABLE <table>

4) On the slave, start slon

The Slony log will show that the slave's slon is receiving replication and
events and also confirming them.  The problem is that none of the changes are
actually being applied on the slave due to the mismatched OID.

5) Fix the OID in sl_path or sl_sequence after obtaining the correct OID from
pg_class (presumably this could also be done via slonik_repair_config)

6) Restart slon on the slave

Now, new events are confirmed AND actioned but the events that were previously
confirmed are lost forever.

Effectively, replication events are skipped over and cannot be replayed.  The
only option is to resync the slave.

Suggestion: slon should not confirm replication events involving a relation
with mismatched OID but instead log an error.

This would create the opportunity for a manual repair of the mismatched OID,
after which all lagging events would be actioned and slave sync could be
restored with minimal effort.

-- 
Configure bugmail: http://www.slony.info/bugzilla/userprefs.cgi?tab=email
------- You are receiving this mail because: -------
You are on the CC list for the bug.
You are the assignee for the bug.

