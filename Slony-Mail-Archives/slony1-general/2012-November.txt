From luiz.matsumura at gmail.com  Tue Nov  6 17:02:05 2012
From: luiz.matsumura at gmail.com (Luiz Matsumura)
Date: Tue, 6 Nov 2012 23:02:05 -0200
Subject: [Slony1-general] Altperl tools changes
In-Reply-To: <CANfbgbb6dnsqe0cO+2DhWGho2boU1WkmaMCOQf4__CSJJbepAA@mail.gmail.com>
References: <CAC6zyU7YsbgKL+8C5EAxUzsvwYpZ6hEX7EOhLr_07oat8mPMRw@mail.gmail.com>
	<CANfbgbb6dnsqe0cO+2DhWGho2boU1WkmaMCOQf4__CSJJbepAA@mail.gmail.com>
Message-ID: <CAC6zyU7sFvCjF3c=o8cQ1-wL3JC0ERVBbKvRviSAvBvuMsLZNA@mail.gmail.com>

2012/10/29 Christopher Browne <cbbrowne at afilias.info>:
>
> I should probably take a peek at this later in the week; a good place
> to go next would be to review your changes in place, and add comments
> to the patches if there's anything that seems controversial.  From
> what you're describing, the changes sound generally reasonable.

Hi Christopher !
I made changes on the controversial parts based on solutions suggested
by Steve Singer.

I don?t know if github warns about the changes to you, so sorry by the
noise if they do.

Can you review again if the changes are satisfactory ?

Thanks in advance.

https://github.com/lkmatsumura/slony1-engine/commits/altperl
https://github.com/lkmatsumura/slony1-engine/commits/master

From glynastill at yahoo.co.uk  Thu Nov  8 09:31:45 2012
From: glynastill at yahoo.co.uk (Glyn Astill)
Date: Thu, 8 Nov 2012 17:31:45 +0000 (GMT)
Subject: [Slony1-general] Lock set behaviour difference between 2.0 and 2.1
Message-ID: <1352395905.8369.YahooMailNeo@web133204.mail.ir2.yahoo.com>

Hi Guys,

I was just taking a look at the changes to lockset() between 2.0 and 2.1 and noticed it now uses a lock on the row in sl_set rather than a table lock on sl_config_lock.

I was wondering, does this now make it possible to do something along the lines of:

TRY {
LOCK SET ( ID = 1, ORIGIN = 1);
LOCK SET ( ID = 2, ORIGIN = 1);
}
ON ERROR ( blah }
MOVE SET ( ID = 1, OLD ORIGIN = 1, NEW ORIGIN = 2);
WAIT FOR EVENT (ORIGIN = 1, CONFIRMED = ALL, WAIT ON = 1, TIMEOUT = 0);
MOVE SET ( ID = 2, OLD ORIGIN = 1, NEW ORIGIN = 2);
WAIT FOR EVENT (ORIGIN = 1, CONFIRMED = ALL, WAIT ON = 1, TIMEOUT = 0);

(Or even wrap the move sets in a try too?)

The reason I ask is we're currently using 2.0.7 and when we move a bunch of sets between nodes it'd be ideal if they were all locked before they were moved.

Sorry if I've got the wrong end of the stick here, or this has already been answered somewhere, I did do a good search before posting!

Thanks
Glyn
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20121108/5b888eff/attachment.htm 

From efraindector at motumweb.com  Fri Nov  9 07:52:38 2012
From: efraindector at motumweb.com (=?utf-8?Q?Efra=C3=ADn_D=C3=A9ctor?=)
Date: Fri, 9 Nov 2012 09:52:38 -0600
Subject: [Slony1-general] Adding a table to replication using Altperl
Message-ID: <97DBC550801546B0A7A02A9FD2AE4120@CMOTUM25PC>

Hello. I?ve read that it is possible to add a table to a running replication (http://slony.info/documentation/2.1/modifyingthings.html), currently I?m using altperl scripts to manage the replication, I would like to know if its possible to add a new table using altperl scripts, can you guys please point me in the right direction?.

Thanks a lot.


-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20121109/d69787b5/attachment.htm 

From gmc at esilibrary.com  Fri Nov  9 07:58:09 2012
From: gmc at esilibrary.com (Galen Charlton)
Date: Fri, 9 Nov 2012 07:58:09 -0800
Subject: [Slony1-general] Adding a table to replication using Altperl
In-Reply-To: <97DBC550801546B0A7A02A9FD2AE4120@CMOTUM25PC>
References: <97DBC550801546B0A7A02A9FD2AE4120@CMOTUM25PC>
Message-ID: <CAPLnt64Voe_T=n5KfxQdamtdL8rttyzKKt8SgcyMx8fb00J4Tw@mail.gmail.com>

Hi,

On Fri, Nov 9, 2012 at 7:52 AM, Efra?n D?ctor <efraindector at motumweb.com>wrote:

>   Hello. I?ve read that it is possible to add a table to a running
> replication (http://slony.info/documentation/2.1/modifyingthings.html),
> currently I?m using altperl scripts to manage the replication, I would like
> to know if its possible to add a new table using altperl scripts, can you
> guys please point me in the right direction?.
>

One approach to take is to first define a new set in slon_tools.conf that
includes the new table, then use the altperl tools to create the new set,
subscribe nodes to it, then finally (if you want) merge the new set into
the existing replication set.  If you do merge sets, the final step is to
edit slon_tools.conf to remove the new set and and move the new table in
the existing set.

Regards,

Galen
-- 
Galen Charlton
Director of Implementation
Equinox Software, Inc. / The Open Source Experts
email:  gmc at esilibrary.com
direct: +1 770-709-5581
cell:   +1 404-984-4366
skype:  gmcharlt
web:    http://www.esilibrary.com/
Supporting Koha and Evergreen: http://koha-community.org &
http://evergreen-ils.org
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20121109/027cc3d8/attachment.htm 

From efraindector at motumweb.com  Fri Nov  9 08:26:22 2012
From: efraindector at motumweb.com (=?Windows-1252?Q?Efra=EDn_D=E9ctor?=)
Date: Fri, 9 Nov 2012 10:26:22 -0600
Subject: [Slony1-general] Adding a table to replication using Altperl
In-Reply-To: <CAPLnt64Voe_T=n5KfxQdamtdL8rttyzKKt8SgcyMx8fb00J4Tw@mail.gmail.com>
References: <97DBC550801546B0A7A02A9FD2AE4120@CMOTUM25PC>
	<CAPLnt64Voe_T=n5KfxQdamtdL8rttyzKKt8SgcyMx8fb00J4Tw@mail.gmail.com>
Message-ID: <1F78E2E7C85A487EBFCD5F88443EA777@CMOTUM25PC>

Hello. 

Thank you for your response. If I understand correctly what I have to do is this: 

On the slon_tool.conf I have only to add this:


"set2" => {
"set_id" => 2,
"table_id" => 2,
"sequence_id" => 2,
"pkeyedtables" => ["testtable"],
#"keyedtables" => {},
#"sequences" => [],
},

And leave everything else intact (set 1, name of cluster, etc). Then I have to run this commands:

# slonik_create_set 2 | slonik 
# slonik_subscribe_set 2 2 | slonik (number of set: 2, number of node 2)
# slonik_subscribe_set 2 3 | slonik (number of set: 2, number of node 3)

Do I have to run slon_kill and then slon_start ?

Thanks

From: Galen Charlton 
Sent: Friday, November 09, 2012 9:58 AM
To: Efra?n D?ctor 
Cc: slony1-general at lists.slony.info 
Subject: Re: [Slony1-general] Adding a table to replication using Altperl

Hi, 

On Fri, Nov 9, 2012 at 7:52 AM, Efra?n D?ctor <efraindector at motumweb.com> wrote:

  Hello. I?ve read that it is possible to add a table to a running replication (http://slony.info/documentation/2.1/modifyingthings.html), currently I?m using altperl scripts to manage the replication, I would like to know if its possible to add a new table using altperl scripts, can you guys please point me in the right direction?.

One approach to take is to first define a new set in slon_tools.conf that includes the new table, then use the altperl tools to create the new set, subscribe nodes to it, then finally (if you want) merge the new set into the existing replication set.  If you do merge sets, the final step is to edit slon_tools.conf to remove the new set and and move the new table in the existing set.

Regards,

Galen 
-- 

Galen Charlton
Director of Implementation
Equinox Software, Inc. / The Open Source Experts
email:  gmc at esilibrary.com
direct: +1 770-709-5581
cell:   +1 404-984-4366
skype:  gmcharlt
web:    http://www.esilibrary.com/
Supporting Koha and Evergreen: http://koha-community.org & http://evergreen-ils.org
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20121109/2643eda8/attachment.htm 

From gmc at esilibrary.com  Fri Nov  9 08:28:23 2012
From: gmc at esilibrary.com (Galen Charlton)
Date: Fri, 9 Nov 2012 08:28:23 -0800
Subject: [Slony1-general] Adding a table to replication using Altperl
In-Reply-To: <1F78E2E7C85A487EBFCD5F88443EA777@CMOTUM25PC>
References: <97DBC550801546B0A7A02A9FD2AE4120@CMOTUM25PC>
	<CAPLnt64Voe_T=n5KfxQdamtdL8rttyzKKt8SgcyMx8fb00J4Tw@mail.gmail.com>
	<1F78E2E7C85A487EBFCD5F88443EA777@CMOTUM25PC>
Message-ID: <CAPLnt65ge4vD59rN5vfGxg=gUZK2f9VaLf3RTPKV9BXuqMTcZw@mail.gmail.com>

Hi,


On Fri, Nov 9, 2012 at 8:26 AM, Efra?n D?ctor <efraindector at motumweb.com>wrote:

>   Thank you for your response. If I understand correctly what I have to
> do is this:
>
> On the slon_tool.conf I have only to add this:
>
> "set2" => {
> "set_id" => 2,
> "table_id" => 2,
> "sequence_id" => 2,
> "pkeyedtables" => ["testtable"],
> #"keyedtables" => {},
> #"sequences" => [],
> },
>

I think you'll need to increase the table_id and sequence_ids to account
for the tables already in set1.


> # slonik_create_set 2 | slonik
> # slonik_subscribe_set 2 2 | slonik (number of set: 2, number of node 2)
> # slonik_subscribe_set 2 3 | slonik (number of set: 2, number of node 3)
>

Yes.


> Do I have to run slon_kill and then slon_start ?
>

No, that won't be necessary.

Regards,

Galen
-- 
Galen Charlton
Director of Implementation
Equinox Software, Inc. / The Open Source Experts
email:  gmc at esilibrary.com
direct: +1 770-709-5581
cell:   +1 404-984-4366
skype:  gmcharlt
web:    http://www.esilibrary.com/
Supporting Koha and Evergreen: http://koha-community.org &
http://evergreen-ils.org
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20121109/b4eb71d0/attachment.htm 

From ssinger at ca.afilias.info  Fri Nov  9 10:13:54 2012
From: ssinger at ca.afilias.info (Steve Singer)
Date: Fri, 09 Nov 2012 13:13:54 -0500
Subject: [Slony1-general] Lock set behaviour difference between 2.0 and
 2.1
In-Reply-To: <1352395905.8369.YahooMailNeo@web133204.mail.ir2.yahoo.com>
References: <1352395905.8369.YahooMailNeo@web133204.mail.ir2.yahoo.com>
Message-ID: <509D47E2.2010308@ca.afilias.info>

On 12-11-08 12:31 PM, Glyn Astill wrote:
> Hi Guys,
>
> I was just taking a look at the changes to lockset() between 2.0 and 2.1
> and noticed it now uses a lock on the row in sl_set rather than a table
> lock on sl_config_lock.
>
> I was wondering, does this now make it possible to do something along
> the lines of:
>
> TRY {
> LOCK SET ( ID = 1, ORIGIN = 1);
> LOCK SET ( ID = 2, ORIGIN = 1);
> }
> ON ERROR ( blah }
> MOVE SET ( ID = 1, OLD ORIGIN = 1, NEW ORIGIN = 2);
>

No the LOCK SET needs to be done as part of the same transaction as the 
MOVE SET.  You can't do that across the bounds of a try block. You also 
can't do WAIT FOR EVENT inside of a try block.

WAIT FOR EVENT (ORIGIN = 1, CONFIRMED = ALL, WAIT ON = 1, TIMEOUT = 0);
> MOVE SET ( ID = 2, OLD ORIGIN = 1, NEW ORIGIN = 2);
> WAIT FOR EVENT (ORIGIN = 1, CONFIRMED = ALL, WAIT ON = 1, TIMEOUT = 0);
>
> (Or even wrap the move sets in a try too?)

Why can't you just do

try {
LOCK SET ( ID = 1, ORIGIN = 1);
LOCK SET ( ID = 2, ORIGIN = 1);
MOVE SET ( ID = 1, OLD ORIGIN = 1, NEW ORIGIN = 2);
MOVE SET ( ID = 2, OLD ORIGIN = 1, NEW ORIGIN = 2);
}
WAIT FOR EVENT(ORIGIN=1, CONFIRMED=ALL...)

(I haven't actually tested the above but I think it will work in cases 
were both sets are on the same origin).


>
> The reason I ask is we're currently using 2.0.7 and when we move a bunch
> of sets between nodes it'd be ideal if they were all locked before they
> were moved.
>
> Sorry if I've got the wrong end of the stick here, or this has already
> been answered somewhere, I did do a good search before posting!
>
> Thanks
> Glyn
>
>
>
>
>
>
> _______________________________________________
> Slony1-general mailing list
> Slony1-general at lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
>


From efraindector at motumweb.com  Fri Nov  9 15:36:00 2012
From: efraindector at motumweb.com (=?iso-8859-1?Q?Efra=EDn_D=E9ctor?=)
Date: Fri, 9 Nov 2012 17:36:00 -0600
Subject: [Slony1-general] Adding a table to replication using Altperl
In-Reply-To: <CAPLnt65ge4vD59rN5vfGxg=gUZK2f9VaLf3RTPKV9BXuqMTcZw@mail.gmail.com>
References: <97DBC550801546B0A7A02A9FD2AE4120@CMOTUM25PC><CAPLnt64Voe_T=n5KfxQdamtdL8rttyzKKt8SgcyMx8fb00J4Tw@mail.gmail.com><1F78E2E7C85A487EBFCD5F88443EA777@CMOTUM25PC>
	<CAPLnt65ge4vD59rN5vfGxg=gUZK2f9VaLf3RTPKV9BXuqMTcZw@mail.gmail.com>
Message-ID: <34F451E3613F4ED09E15492CEC5D476F@CMOTUM25PC>

Hello. I just wanted to let you know that thanks to your advice adding new tables to the replication has worked perfectly, including merging the sets.

Thanks a lot.

From: Galen Charlton 
Sent: Friday, November 09, 2012 10:28 AM
To: Efra?n D?ctor 
Cc: slony1-general at lists.slony.info 
Subject: Re: [Slony1-general] Adding a table to replication using Altperl

Hi, 



On Fri, Nov 9, 2012 at 8:26 AM, Efra?n D?ctor <efraindector at motumweb.com> wrote:

  Thank you for your response. If I understand correctly what I have to do is this: 

  On the slon_tool.conf I have only to add this:


  "set2" => {
  "set_id" => 2,
  "table_id" => 2,
  "sequence_id" => 2,
  "pkeyedtables" => ["testtable"],
  #"keyedtables" => {},
  #"sequences" => [],
  },


I think you'll need to increase the table_id and sequence_ids to account for the tables already in set1.

  # slonik_create_set 2 | slonik 
  # slonik_subscribe_set 2 2 | slonik (number of set: 2, number of node 2)
  # slonik_subscribe_set 2 3 | slonik (number of set: 2, number of node 3)

Yes.

  Do I have to run slon_kill and then slon_start ?


No, that won't be necessary.

Regards,

Galen
-- 

Galen Charlton
Director of Implementation
Equinox Software, Inc. / The Open Source Experts
email:  gmc at esilibrary.com
direct: +1 770-709-5581
cell:   +1 404-984-4366
skype:  gmcharlt
web:    http://www.esilibrary.com/
Supporting Koha and Evergreen: http://koha-community.org & http://evergreen-ils.org
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20121109/50bd27ae/attachment.htm 

From glynastill at yahoo.co.uk  Mon Nov 12 04:35:28 2012
From: glynastill at yahoo.co.uk (Glyn Astill)
Date: Mon, 12 Nov 2012 12:35:28 +0000 (GMT)
Subject: [Slony1-general] Lock set behaviour difference between 2.0 and
	2.1
In-Reply-To: <509D47E2.2010308@ca.afilias.info>
References: <1352395905.8369.YahooMailNeo@web133204.mail.ir2.yahoo.com>
	<509D47E2.2010308@ca.afilias.info>
Message-ID: <1352723728.46750.YahooMailNeo@web133202.mail.ir2.yahoo.com>

> From: Steve Singer <ssinger at ca.afilias.info>

>To: Glyn Astill <glynastill at yahoo.co.uk> 
>Cc: slony <slony1-general at lists.slony.info> 
>Sent: Friday, 9 November 2012, 18:13
>Subject: Re: [Slony1-general] Lock set behaviour difference between 2.0 and 2.1
> 
>
>Why can't you just do
>
>try {
>LOCK SET ( ID = 1, ORIGIN = 1);
>LOCK SET ( ID = 2, ORIGIN = 1);
>MOVE SET ( ID = 1, OLD ORIGIN = 1, NEW ORIGIN = 2);
>MOVE SET ( ID = 2, OLD ORIGIN = 1, NEW ORIGIN = 2);
>}
>WAIT FOR EVENT(ORIGIN=1, CONFIRMED=ALL...)
>
>(I haven't actually tested the above but I think it will work in cases 
>were both sets are on the same origin).
>
>

Hi Steve,

I've just tried the above on 2.1.2 and I get the same error message as on 2.0.7? when I try to lock the second set:


"cannot lock set - admin connection already in transaction"

I'm guessing "lock set" and "move set" have to be run consecutively?

From ssinger at ca.afilias.info  Mon Nov 12 06:09:44 2012
From: ssinger at ca.afilias.info (Steve Singer)
Date: Mon, 12 Nov 2012 09:09:44 -0500
Subject: [Slony1-general] Lock set behaviour difference between 2.0 and
 2.1
In-Reply-To: <1352723728.46750.YahooMailNeo@web133202.mail.ir2.yahoo.com>
References: <1352395905.8369.YahooMailNeo@web133204.mail.ir2.yahoo.com>
	<509D47E2.2010308@ca.afilias.info>
	<1352723728.46750.YahooMailNeo@web133202.mail.ir2.yahoo.com>
Message-ID: <50A10328.9050105@ca.afilias.info>

On 12-11-12 07:35 AM, Glyn Astill wrote:
>>
>
> Hi Steve,
>
> I've just tried the above on 2.1.2 and I get the same error message as on 2.0.7  when I try to lock the second set:
>
>
> "cannot lock set - admin connection already in transaction"
>
> I'm guessing "lock set" and "move set" have to be run consecutively?
>

Actually the issue is that the lock set needs to be in its own 
transaction so it can't really be used in an 'active' try block except 
as the first command (which the documentation say)

The message you are getting was apparently added with this commit.

commit d013758b4823e2d386a2a0738e0d9a5534f11556
Author: Jan Wieck <JanWieck at yahoo.com>
Date:   Thu Mar 18 22:47:00 2004 +0000

     Added "lock set", "unlock set" and "move set" commands
     to slonik. "lock set" requires to be the first statement
     in a transaction since it actually needs to commit the
     lockSet() call and then wait until the lock's xmax <=
     xmin. To prevent accidential misuse we don't allow other
     statements in the same transaction.

     Jan


One solution is to allow LOCK SET to take/lock multiple sets at once 
(this change won't happen before slony 2.3), but I'm not sure if there 
is a different solution.

I think you could still do

LOCK SET(...)
LOCK SET(...)
MOVE SET(...)
MOVE SET(...)

just NOT inside of a TRY block.


From glynastill at yahoo.co.uk  Mon Nov 12 08:29:28 2012
From: glynastill at yahoo.co.uk (Glyn Astill)
Date: Mon, 12 Nov 2012 16:29:28 +0000 (GMT)
Subject: [Slony1-general] Lock set behaviour difference between 2.0 and
	2.1
In-Reply-To: <50A10328.9050105@ca.afilias.info>
References: <1352395905.8369.YahooMailNeo@web133204.mail.ir2.yahoo.com>
	<509D47E2.2010308@ca.afilias.info>
	<1352723728.46750.YahooMailNeo@web133202.mail.ir2.yahoo.com>
	<50A10328.9050105@ca.afilias.info>
Message-ID: <1352737768.85604.YahooMailNeo@web133202.mail.ir2.yahoo.com>

----- Original Message -----

> From: Steve Singer <ssinger at ca.afilias.info>
> To: Glyn Astill <glynastill at yahoo.co.uk>
> Cc: slony <slony1-general at lists.slony.info>
> Sent: Monday, 12 November 2012, 14:09
> Subject: Re: [Slony1-general] Lock set behaviour difference between 2.0 and 2.1
> 
> On 12-11-12 07:35 AM, Glyn Astill wrote:
>>> 
>> 
>>  Hi Steve,
>> 
>>  I've just tried the above on 2.1.2 and I get the same error message as 
> on 2.0.7? when I try to lock the second set:
>> 
>> 
>>  "cannot lock set - admin connection already in transaction"
>> 
>>  I'm guessing "lock set" and "move set" have to be 
> run consecutively?
>> 
> 
> Actually the issue is that the lock set needs to be in its own transaction so it 
> can't really be used in an 'active' try block except as the first 
> command (which the documentation say)
> 
> The message you are getting was apparently added with this commit.
> 
> commit d013758b4823e2d386a2a0738e0d9a5534f11556
> Author: Jan Wieck <JanWieck at yahoo.com>
> Date:?  Thu Mar 18 22:47:00 2004 +0000
> 
> ? ? Added "lock set", "unlock set" and "move set" 
> commands
> ? ? to slonik. "lock set" requires to be the first statement
> ? ? in a transaction since it actually needs to commit the
> ? ? lockSet() call and then wait until the lock's xmax <=
> ? ? xmin. To prevent accidential misuse we don't allow other
> ? ? statements in the same transaction.
> 
> ? ? Jan
> 
> 
> One solution is to allow LOCK SET to take/lock multiple sets at once (this 
> change won't happen before slony 2.3), but I'm not sure if there is a 
> different solution.

Ah that's what I was hoping for!

> 
> I think you could still do
> 
> LOCK SET(...)
> LOCK SET(...)
> MOVE SET(...)
> MOVE SET(...)
> 
> just NOT inside of a TRY block.
>

Yeah, it's just nice to be able to unlock the sets locked so far if something goes wrong half way through.


From mark at summersault.com  Mon Nov 12 11:33:54 2012
From: mark at summersault.com (Mark Stosberg)
Date: Mon, 12 Nov 2012 14:33:54 -0500
Subject: [Slony1-general] replication fails to due bad DNS at startup,
 requires slony restart to fix
Message-ID: <k7riv0$dnv$1@ger.gmane.org>


This feedback concerns Slony 2.1.2, being used with PostgreSQL 9.1.

We're using it on Amazon EC2, which ads the complication that the
internal IP address of the machine changes every time it starts up.

On Friday, our underlying hardware failed on the master, and we had to
stop/start the master DB instance, to move it to new hardware.

When slony started, the name of the server itself was still resolving to
the old internal IP, so this happened:

###
2012-11-09 21:35:20 EST FATAL  main: Cannot connect to local database -
could not connect to server: Con
nection timed out
        Is the server running on host "db.example.com" (10.79.78.214)
and accepting
        TCP/IP connections on port 5432?
###

After that, Slony was never able to correct itself, even long after the
TTL for the related DNS record would have expired. It took a manual
stop/start to get things going in.

Perhaps Slony aggressively caches DNS? Or perhaps it could recover from
this "FATAL" condition? Is this expected behavior, or should slony
behave better in the face of temporary DNS problems?

Thanks for insights!

   Mark


From vivek at khera.org  Mon Nov 12 12:51:16 2012
From: vivek at khera.org (Vick Khera)
Date: Mon, 12 Nov 2012 15:51:16 -0500
Subject: [Slony1-general] replication fails to due bad DNS at startup,
 requires slony restart to fix
In-Reply-To: <k7riv0$dnv$1@ger.gmane.org>
References: <k7riv0$dnv$1@ger.gmane.org>
Message-ID: <CALd+dcfH9YajUT_6NvOiJPzuyQa3aW7VzGDn8C7iwLy2uGN45Q@mail.gmail.com>

I don't think most programs do any sort of TTL expiry of DNS lookups. It
seems reasonable to me to restart a program upon DNS configuration changes.

On Mon, Nov 12, 2012 at 2:33 PM, Mark Stosberg <mark at summersault.com> wrote:

> Perhaps Slony aggressively caches DNS? Or perhaps it could recover from
> this "FATAL" condition? Is this expected behavior, or should slony
> behave better in the face of temporary DNS problems?
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20121112/0e59329a/attachment.htm 

From cbbrowne at afilias.info  Mon Nov 12 13:05:37 2012
From: cbbrowne at afilias.info (Christopher Browne)
Date: Mon, 12 Nov 2012 16:05:37 -0500
Subject: [Slony1-general] replication fails to due bad DNS at startup,
 requires slony restart to fix
In-Reply-To: <k7riv0$dnv$1@ger.gmane.org>
References: <k7riv0$dnv$1@ger.gmane.org>
Message-ID: <CANfbgbata6wcP=cdhbwDfMHEFiQNrBS0-hjsxiR98Dm4Yk4ByA@mail.gmail.com>

On Mon, Nov 12, 2012 at 2:33 PM, Mark Stosberg <mark at summersault.com> wrote:
> Perhaps Slony aggressively caches DNS? Or perhaps it could recover from
> this "FATAL" condition? Is this expected behavior, or should slony
> behave better in the face of temporary DNS problems?

Slony does nothing concerning cacheing DNS.

It simply uses the libpq function, PQconnectdb(conninfo) to connect to
databases.

All the relevant code is localized to src/slon/dbutils.c, so you can
poke at the code if you want to.

I think you'll find that other clients that attempted to use libpq,
such as psql, would fail pretty much identically.

Is it possible that your libc is doing cacheing?  If *that's* the
case, and I'm suspicious of it, then you really would need to restart
the slon to get "unstuck" from what libc has cached on you...

From ajs at crankycanuck.ca  Mon Nov 12 13:15:33 2012
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Mon, 12 Nov 2012 16:15:33 -0500
Subject: [Slony1-general] replication fails to due bad DNS at startup,
 requires slony restart to fix
In-Reply-To: <CANfbgbata6wcP=cdhbwDfMHEFiQNrBS0-hjsxiR98Dm4Yk4ByA@mail.gmail.com>
References: <k7riv0$dnv$1@ger.gmane.org>
	<CANfbgbata6wcP=cdhbwDfMHEFiQNrBS0-hjsxiR98Dm4Yk4ByA@mail.gmail.com>
Message-ID: <20121112211533.GF82038@crankycanuck.ca>

On Mon, Nov 12, 2012 at 04:05:37PM -0500, Christopher Browne wrote:
> Is it possible that your libc is doing cacheing?  If *that's* the
> case, and I'm suspicious of it, then you really would need to restart
> the slon to get "unstuck" from what libc has cached on you...

More likely, the system resolver is pointing at a caching name server.

Best,

A

-- 
Andrew Sullivan
ajs at crankycanuck.ca

From mark at summersault.com  Tue Nov 13 11:06:18 2012
From: mark at summersault.com (Mark Stosberg)
Date: Tue, 13 Nov 2012 14:06:18 -0500
Subject: [Slony1-general] replication fails to due bad DNS at startup,
 requires slony restart to fix
In-Reply-To: <20121112211533.GF82038@crankycanuck.ca>
References: <k7riv0$dnv$1@ger.gmane.org>
	<CANfbgbata6wcP=cdhbwDfMHEFiQNrBS0-hjsxiR98Dm4Yk4ByA@mail.gmail.com>
	<20121112211533.GF82038@crankycanuck.ca>
Message-ID: <50A29A2A.1000103@summersault.com>



On 11/12/2012 04:15 PM, Andrew Sullivan wrote:
> On Mon, Nov 12, 2012 at 04:05:37PM -0500, Christopher Browne wrote:
>> Is it possible that your libc is doing cacheing?  If *that's* the
>> case, and I'm suspicious of it, then you really would need to restart
>> the slon to get "unstuck" from what libc has cached on you...
> 
> More likely, the system resolver is pointing at a caching name server.

Thanks for prompt answers, everyone.

I'll pursue this as an issue with our use of Ubuntu on Amazon/EC2.

   Mark



From smccloud at geo-comm.com  Wed Nov 14 11:36:26 2012
From: smccloud at geo-comm.com (Shaun McCloud)
Date: Wed, 14 Nov 2012 19:36:26 +0000
Subject: [Slony1-general] Slony1 2.1.2 Windows Issue
Message-ID: <7742DD496427B743BC8B7BBF6D380BA040A6A187@EXCHANGE10.geo-comm.local>

I have compiled Slony1 2.1.2 on Windows Server 2008 R2 (x64) against PostgreSQL 9.0 x64 and I am getting the following errors on startup.


*         Slony-I schema version is 2.1.2

*         please upgrade Slony-I schema to version 2.1.1

*         main: Node has wrong Slony-I schema or module version loaded

The machines I am trying to run 2.1.2 has never had another version of Slony1 on them.  Why would Slony1 2.1.2 want the 2.1.1 schema?  And what can I do to resolve the issue?


Shaun McCloud, MCDST | Associate Software Developer
Geo-Comm Inc. | www.geo-comm.com<http://www.geo-comm.com/>
601 W. Saint Germain St., St. Cloud, MN, 56301
Office: 320.240.0040 or 888.436.2666 Fax: 320.240.2389

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20121114/899e94d2/attachment.htm 

From ssinger at ca.afilias.info  Wed Nov 14 11:41:58 2012
From: ssinger at ca.afilias.info (Steve Singer)
Date: Wed, 14 Nov 2012 14:41:58 -0500
Subject: [Slony1-general] Slony1 2.1.2 Windows Issue
In-Reply-To: <7742DD496427B743BC8B7BBF6D380BA040A6A187@EXCHANGE10.geo-comm.local>
References: <7742DD496427B743BC8B7BBF6D380BA040A6A187@EXCHANGE10.geo-comm.local>
Message-ID: <50A3F406.1010406@ca.afilias.info>

On 12-11-14 02:36 PM, Shaun McCloud wrote:
> I have compiled Slony1 2.1.2 on Windows Server 2008 R2 (x64) against
> PostgreSQL 9.0 x64 and I am getting the following errors on startup.
>
> ?Slony-I schema version is 2.1.2
>
> ?please upgrade Slony-I schema to version 2.1.1
>
> ?main: Node has wrong Slony-I schema or module version loaded
>
> The machines I am trying to run 2.1.2 has never had another version of
> Slony1 on them.  Why would Slony1 2.1.2 want the 2.1.1 schema?  And what
> can I do to resolve the issue?

Sorry, my bad I think.
Change the file
config_msvc.h

#define SLONY_I_VERSION_STRING  "2.1.1"
#define SLONY_I_VERSION_STRING_DEC 2,1,1

To instead say
#define SLONY_I_VERSION_STRING  "2.1.2"
#define SLONY_I_VERSION_STRING_DEC 2,1,2


and recompile everything




>
> Shaun McCloud, MCDST | Associate Software Developer
>
> Geo-Comm Inc. | www.geo-comm.com <http://www.geo-comm.com/>
>
> 601 W. Saint Germain St., St. Cloud, MN, 56301
>
> Office: 320.240.0040 or 888.436.2666 Fax: 320.240.2389
>
>
>
> _______________________________________________
> Slony1-general mailing list
> Slony1-general at lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
>


From smccloud at geo-comm.com  Wed Nov 14 11:53:42 2012
From: smccloud at geo-comm.com (Shaun McCloud)
Date: Wed, 14 Nov 2012 19:53:42 +0000
Subject: [Slony1-general] Slony1 2.1.2 Windows Issue
In-Reply-To: <50A3F406.1010406@ca.afilias.info>
References: <7742DD496427B743BC8B7BBF6D380BA040A6A187@EXCHANGE10.geo-comm.local>
	<50A3F406.1010406@ca.afilias.info>
Message-ID: <7742DD496427B743BC8B7BBF6D380BA040A6A214@EXCHANGE10.geo-comm.local>

That fixed that issue.

Now I am getting "please upgrade Slony-I shared module to version 2.1.2"

Shaun McCloud, MCDST | Associate Software Developer
Geo-Comm Inc. | www.geo-comm.com

-----Original Message-----
From: Steve Singer [mailto:ssinger at ca.afilias.info] 
Sent: Wednesday, November 14, 2012 13:42
To: Shaun McCloud
Cc: slony1-general at lists.slony.info
Subject: Re: [Slony1-general] Slony1 2.1.2 Windows Issue

On 12-11-14 02:36 PM, Shaun McCloud wrote:
> I have compiled Slony1 2.1.2 on Windows Server 2008 R2 (x64) against 
> PostgreSQL 9.0 x64 and I am getting the following errors on startup.
>
> *Slony-I schema version is 2.1.2
>
> *please upgrade Slony-I schema to version 2.1.1
>
> *main: Node has wrong Slony-I schema or module version loaded
>
> The machines I am trying to run 2.1.2 has never had another version of
> Slony1 on them.  Why would Slony1 2.1.2 want the 2.1.1 schema?  And 
> what can I do to resolve the issue?

Sorry, my bad I think.
Change the file
config_msvc.h

#define SLONY_I_VERSION_STRING  "2.1.1"
#define SLONY_I_VERSION_STRING_DEC 2,1,1

To instead say
#define SLONY_I_VERSION_STRING  "2.1.2"
#define SLONY_I_VERSION_STRING_DEC 2,1,2


and recompile everything




>
> Shaun McCloud, MCDST | Associate Software Developer
>
> Geo-Comm Inc. | www.geo-comm.com <http://www.geo-comm.com/>
>
> 601 W. Saint Germain St., St. Cloud, MN, 56301
>
> Office: 320.240.0040 or 888.436.2666 Fax: 320.240.2389
>
>
>
> _______________________________________________
> Slony1-general mailing list
> Slony1-general at lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
>


From ssinger at ca.afilias.info  Wed Nov 14 12:07:15 2012
From: ssinger at ca.afilias.info (Steve Singer)
Date: Wed, 14 Nov 2012 15:07:15 -0500
Subject: [Slony1-general] Slony1 2.1.2 Windows Issue
In-Reply-To: <7742DD496427B743BC8B7BBF6D380BA040A6A214@EXCHANGE10.geo-comm.local>
References: <7742DD496427B743BC8B7BBF6D380BA040A6A187@EXCHANGE10.geo-comm.local>
	<50A3F406.1010406@ca.afilias.info>
	<7742DD496427B743BC8B7BBF6D380BA040A6A214@EXCHANGE10.geo-comm.local>
Message-ID: <50A3F9F3.9060005@ca.afilias.info>

On 12-11-14 02:53 PM, Shaun McCloud wrote:
> That fixed that issue.
>
> Now I am getting "please upgrade Slony-I shared module to version 2.1.2"

Did you do a clean compile (and then install) the slony1_funcs.dll ?

>
> Shaun McCloud, MCDST | Associate Software Developer
> Geo-Comm Inc. | www.geo-comm.com
>
> -----Original Message-----
> From: Steve Singer [mailto:ssinger at ca.afilias.info]
> Sent: Wednesday, November 14, 2012 13:42
> To: Shaun McCloud
> Cc: slony1-general at lists.slony.info
> Subject: Re: [Slony1-general] Slony1 2.1.2 Windows Issue
>
> On 12-11-14 02:36 PM, Shaun McCloud wrote:
>> I have compiled Slony1 2.1.2 on Windows Server 2008 R2 (x64) against
>> PostgreSQL 9.0 x64 and I am getting the following errors on startup.
>>
>> *Slony-I schema version is 2.1.2
>>
>> *please upgrade Slony-I schema to version 2.1.1
>>
>> *main: Node has wrong Slony-I schema or module version loaded
>>
>> The machines I am trying to run 2.1.2 has never had another version of
>> Slony1 on them.  Why would Slony1 2.1.2 want the 2.1.1 schema?  And
>> what can I do to resolve the issue?
>
> Sorry, my bad I think.
> Change the file
> config_msvc.h
>
> #define SLONY_I_VERSION_STRING  "2.1.1"
> #define SLONY_I_VERSION_STRING_DEC 2,1,1
>
> To instead say
> #define SLONY_I_VERSION_STRING  "2.1.2"
> #define SLONY_I_VERSION_STRING_DEC 2,1,2
>
>
> and recompile everything
>
>
>
>
>>
>> Shaun McCloud, MCDST | Associate Software Developer
>>
>> Geo-Comm Inc. | www.geo-comm.com <http://www.geo-comm.com/>
>>
>> 601 W. Saint Germain St., St. Cloud, MN, 56301
>>
>> Office: 320.240.0040 or 888.436.2666 Fax: 320.240.2389
>>
>>
>>
>> _______________________________________________
>> Slony1-general mailing list
>> Slony1-general at lists.slony.info
>> http://lists.slony.info/mailman/listinfo/slony1-general
>>
>


From smccloud at geo-comm.com  Wed Nov 14 12:09:45 2012
From: smccloud at geo-comm.com (Shaun McCloud)
Date: Wed, 14 Nov 2012 20:09:45 +0000
Subject: [Slony1-general] Slony1 2.1.2 Windows Issue
In-Reply-To: <50A3F9F3.9060005@ca.afilias.info>
References: <7742DD496427B743BC8B7BBF6D380BA040A6A187@EXCHANGE10.geo-comm.local>
	<50A3F406.1010406@ca.afilias.info>
	<7742DD496427B743BC8B7BBF6D380BA040A6A214@EXCHANGE10.geo-comm.local>
	<50A3F9F3.9060005@ca.afilias.info>
Message-ID: <7742DD496427B743BC8B7BBF6D380BA040A6A271@EXCHANGE10.geo-comm.local>

Yes,

Deleted my old source folder, copied a clean one in place, made the change, then compiled.

Shaun McCloud, MCDST | Associate Software Developer
Geo-Comm Inc. | www.geo-comm.com


-----Original Message-----
From: Steve Singer [mailto:ssinger at ca.afilias.info] 
Sent: Wednesday, November 14, 2012 14:07
To: Shaun McCloud
Cc: slony1-general at lists.slony.info
Subject: Re: [Slony1-general] Slony1 2.1.2 Windows Issue

On 12-11-14 02:53 PM, Shaun McCloud wrote:
> That fixed that issue.
>
> Now I am getting "please upgrade Slony-I shared module to version 2.1.2"

Did you do a clean compile (and then install) the slony1_funcs.dll ?

>
> Shaun McCloud, MCDST | Associate Software Developer Geo-Comm Inc. | 
> www.geo-comm.com
>
> -----Original Message-----
> From: Steve Singer [mailto:ssinger at ca.afilias.info]
> Sent: Wednesday, November 14, 2012 13:42
> To: Shaun McCloud
> Cc: slony1-general at lists.slony.info
> Subject: Re: [Slony1-general] Slony1 2.1.2 Windows Issue
>
> On 12-11-14 02:36 PM, Shaun McCloud wrote:
>> I have compiled Slony1 2.1.2 on Windows Server 2008 R2 (x64) against 
>> PostgreSQL 9.0 x64 and I am getting the following errors on startup.
>>
>> *Slony-I schema version is 2.1.2
>>
>> *please upgrade Slony-I schema to version 2.1.1
>>
>> *main: Node has wrong Slony-I schema or module version loaded
>>
>> The machines I am trying to run 2.1.2 has never had another version 
>> of
>> Slony1 on them.  Why would Slony1 2.1.2 want the 2.1.1 schema?  And 
>> what can I do to resolve the issue?
>
> Sorry, my bad I think.
> Change the file
> config_msvc.h
>
> #define SLONY_I_VERSION_STRING  "2.1.1"
> #define SLONY_I_VERSION_STRING_DEC 2,1,1
>
> To instead say
> #define SLONY_I_VERSION_STRING  "2.1.2"
> #define SLONY_I_VERSION_STRING_DEC 2,1,2
>
>
> and recompile everything
>
>
>
>
>>
>> Shaun McCloud, MCDST | Associate Software Developer
>>
>> Geo-Comm Inc. | www.geo-comm.com <http://www.geo-comm.com/>
>>
>> 601 W. Saint Germain St., St. Cloud, MN, 56301
>>
>> Office: 320.240.0040 or 888.436.2666 Fax: 320.240.2389
>>
>>
>>
>> _______________________________________________
>> Slony1-general mailing list
>> Slony1-general at lists.slony.info
>> http://lists.slony.info/mailman/listinfo/slony1-general
>>
>


From ssinger at ca.afilias.info  Wed Nov 14 12:31:28 2012
From: ssinger at ca.afilias.info (Steve Singer)
Date: Wed, 14 Nov 2012 15:31:28 -0500
Subject: [Slony1-general] Slony1 2.1.2 Windows Issue
In-Reply-To: <7742DD496427B743BC8B7BBF6D380BA040A6A271@EXCHANGE10.geo-comm.local>
References: <7742DD496427B743BC8B7BBF6D380BA040A6A187@EXCHANGE10.geo-comm.local>
	<50A3F406.1010406@ca.afilias.info>
	<7742DD496427B743BC8B7BBF6D380BA040A6A214@EXCHANGE10.geo-comm.local>
	<50A3F9F3.9060005@ca.afilias.info>
	<7742DD496427B743BC8B7BBF6D380BA040A6A271@EXCHANGE10.geo-comm.local>
Message-ID: <50A3FFA0.8090508@ca.afilias.info>

On 12-11-14 03:09 PM, Shaun McCloud wrote:
> Yes,
>
> Deleted my old source folder, copied a clean one in place, made the change, then compiled.
>

Do you maybe have to restart the postgres.exe service after copying the 
new slony1_funcs.dll into the lib directory? (I'm guessing, I don't see 
another obvious reference to 2.1.1 in the code for the DLL and setting 
up a windows development box always takes me a bit of time)



> Shaun McCloud, MCDST | Associate Software Developer
> Geo-Comm Inc. | www.geo-comm.com
>
>
> -----Original Message-----
> From: Steve Singer [mailto:ssinger at ca.afilias.info]
> Sent: Wednesday, November 14, 2012 14:07
> To: Shaun McCloud
> Cc: slony1-general at lists.slony.info
> Subject: Re: [Slony1-general] Slony1 2.1.2 Windows Issue
>
> On 12-11-14 02:53 PM, Shaun McCloud wrote:
>> That fixed that issue.
>>
>> Now I am getting "please upgrade Slony-I shared module to version 2.1.2"
>
> Did you do a clean compile (and then install) the slony1_funcs.dll ?
>
>>
>> Shaun McCloud, MCDST | Associate Software Developer Geo-Comm Inc. |
>> www.geo-comm.com
>>
>> -----Original Message-----
>> From: Steve Singer [mailto:ssinger at ca.afilias.info]
>> Sent: Wednesday, November 14, 2012 13:42
>> To: Shaun McCloud
>> Cc: slony1-general at lists.slony.info
>> Subject: Re: [Slony1-general] Slony1 2.1.2 Windows Issue
>>
>> On 12-11-14 02:36 PM, Shaun McCloud wrote:
>>> I have compiled Slony1 2.1.2 on Windows Server 2008 R2 (x64) against
>>> PostgreSQL 9.0 x64 and I am getting the following errors on startup.
>>>
>>> *Slony-I schema version is 2.1.2
>>>
>>> *please upgrade Slony-I schema to version 2.1.1
>>>
>>> *main: Node has wrong Slony-I schema or module version loaded
>>>
>>> The machines I am trying to run 2.1.2 has never had another version
>>> of
>>> Slony1 on them.  Why would Slony1 2.1.2 want the 2.1.1 schema?  And
>>> what can I do to resolve the issue?
>>
>> Sorry, my bad I think.
>> Change the file
>> config_msvc.h
>>
>> #define SLONY_I_VERSION_STRING  "2.1.1"
>> #define SLONY_I_VERSION_STRING_DEC 2,1,1
>>
>> To instead say
>> #define SLONY_I_VERSION_STRING  "2.1.2"
>> #define SLONY_I_VERSION_STRING_DEC 2,1,2
>>
>>
>> and recompile everything
>>
>>
>>
>>
>>>
>>> Shaun McCloud, MCDST | Associate Software Developer
>>>
>>> Geo-Comm Inc. | www.geo-comm.com <http://www.geo-comm.com/>
>>>
>>> 601 W. Saint Germain St., St. Cloud, MN, 56301
>>>
>>> Office: 320.240.0040 or 888.436.2666 Fax: 320.240.2389
>>>
>>>
>>>
>>> _______________________________________________
>>> Slony1-general mailing list
>>> Slony1-general at lists.slony.info
>>> http://lists.slony.info/mailman/listinfo/slony1-general
>>>
>>
>


From smccloud at geo-comm.com  Wed Nov 14 12:34:50 2012
From: smccloud at geo-comm.com (Shaun McCloud)
Date: Wed, 14 Nov 2012 20:34:50 +0000
Subject: [Slony1-general] Slony1 2.1.2 Windows Issue
In-Reply-To: <50A3FFA0.8090508@ca.afilias.info>
References: <7742DD496427B743BC8B7BBF6D380BA040A6A187@EXCHANGE10.geo-comm.local>
	<50A3F406.1010406@ca.afilias.info>
	<7742DD496427B743BC8B7BBF6D380BA040A6A214@EXCHANGE10.geo-comm.local>
	<50A3F9F3.9060005@ca.afilias.info>
	<7742DD496427B743BC8B7BBF6D380BA040A6A271@EXCHANGE10.geo-comm.local>
	<50A3FFA0.8090508@ca.afilias.info>
Message-ID: <7742DD496427B743BC8B7BBF6D380BA040A6A2BB@EXCHANGE10.geo-comm.local>

Yep,

Restarted the service after copying the new slon1_funcs.dll.  If you want, I can setup a Windows Development machine for you once I get home as I can determine who gets access to that easier than I can at work.

Shaun McCloud, MCDST | Associate Software Developer
Geo-Comm Inc. | www.geo-comm.com


-----Original Message-----
From: Steve Singer [mailto:ssinger at ca.afilias.info] 
Sent: Wednesday, November 14, 2012 14:31
To: Shaun McCloud
Cc: slony1-general at lists.slony.info
Subject: Re: [Slony1-general] Slony1 2.1.2 Windows Issue

On 12-11-14 03:09 PM, Shaun McCloud wrote:
> Yes,
>
> Deleted my old source folder, copied a clean one in place, made the change, then compiled.
>

Do you maybe have to restart the postgres.exe service after copying the new slony1_funcs.dll into the lib directory? (I'm guessing, I don't see another obvious reference to 2.1.1 in the code for the DLL and setting up a windows development box always takes me a bit of time)



> Shaun McCloud, MCDST | Associate Software Developer Geo-Comm Inc. | 
> www.geo-comm.com
>
>
> -----Original Message-----
> From: Steve Singer [mailto:ssinger at ca.afilias.info]
> Sent: Wednesday, November 14, 2012 14:07
> To: Shaun McCloud
> Cc: slony1-general at lists.slony.info
> Subject: Re: [Slony1-general] Slony1 2.1.2 Windows Issue
>
> On 12-11-14 02:53 PM, Shaun McCloud wrote:
>> That fixed that issue.
>>
>> Now I am getting "please upgrade Slony-I shared module to version 2.1.2"
>
> Did you do a clean compile (and then install) the slony1_funcs.dll ?
>
>>
>> Shaun McCloud, MCDST | Associate Software Developer Geo-Comm Inc. | 
>> www.geo-comm.com
>>
>> -----Original Message-----
>> From: Steve Singer [mailto:ssinger at ca.afilias.info]
>> Sent: Wednesday, November 14, 2012 13:42
>> To: Shaun McCloud
>> Cc: slony1-general at lists.slony.info
>> Subject: Re: [Slony1-general] Slony1 2.1.2 Windows Issue
>>
>> On 12-11-14 02:36 PM, Shaun McCloud wrote:
>>> I have compiled Slony1 2.1.2 on Windows Server 2008 R2 (x64) against 
>>> PostgreSQL 9.0 x64 and I am getting the following errors on startup.
>>>
>>> *Slony-I schema version is 2.1.2
>>>
>>> *please upgrade Slony-I schema to version 2.1.1
>>>
>>> *main: Node has wrong Slony-I schema or module version loaded
>>>
>>> The machines I am trying to run 2.1.2 has never had another version 
>>> of
>>> Slony1 on them.  Why would Slony1 2.1.2 want the 2.1.1 schema?  And 
>>> what can I do to resolve the issue?
>>
>> Sorry, my bad I think.
>> Change the file
>> config_msvc.h
>>
>> #define SLONY_I_VERSION_STRING  "2.1.1"
>> #define SLONY_I_VERSION_STRING_DEC 2,1,1
>>
>> To instead say
>> #define SLONY_I_VERSION_STRING  "2.1.2"
>> #define SLONY_I_VERSION_STRING_DEC 2,1,2
>>
>>
>> and recompile everything
>>
>>
>>
>>
>>>
>>> Shaun McCloud, MCDST | Associate Software Developer
>>>
>>> Geo-Comm Inc. | www.geo-comm.com <http://www.geo-comm.com/>
>>>
>>> 601 W. Saint Germain St., St. Cloud, MN, 56301
>>>
>>> Office: 320.240.0040 or 888.436.2666 Fax: 320.240.2389
>>>
>>>
>>>
>>> _______________________________________________
>>> Slony1-general mailing list
>>> Slony1-general at lists.slony.info
>>> http://lists.slony.info/mailman/listinfo/slony1-general
>>>
>>
>


From ssinger at ca.afilias.info  Wed Nov 14 20:17:30 2012
From: ssinger at ca.afilias.info (Steve Singer)
Date: Wed, 14 Nov 2012 23:17:30 -0500
Subject: [Slony1-general] Slony1 2.1.2 Windows Issue
In-Reply-To: <7742DD496427B743BC8B7BBF6D380BA040A6A2BB@EXCHANGE10.geo-comm.local>
References: <7742DD496427B743BC8B7BBF6D380BA040A6A187@EXCHANGE10.geo-comm.local>
	<50A3F406.1010406@ca.afilias.info>
	<7742DD496427B743BC8B7BBF6D380BA040A6A214@EXCHANGE10.geo-comm.local>
	<50A3F9F3.9060005@ca.afilias.info>
	<7742DD496427B743BC8B7BBF6D380BA040A6A271@EXCHANGE10.geo-comm.local>
	<50A3FFA0.8090508@ca.afilias.info>
	<7742DD496427B743BC8B7BBF6D380BA040A6A2BB@EXCHANGE10.geo-comm.local>
Message-ID: <50A46CDA.6040403@ca.afilias.info>

On 12-11-14 03:34 PM, Shaun McCloud wrote:
> Yep,
>
> Restarted the service after copying the new slon1_funcs.dll.  If you want, I can setup a Windows Development machine for you once I get home as I can determine who gets access to that easier than I can at work.
>

I have images on go-grid that I can bring up for windows development. 
Starting one up, grabing the version of slony in question, compiling it 
etc, I just need to have the time to do that. I'll try to get to it 
later this week but no promises.


> Shaun McCloud, MCDST | Associate Software Developer
> Geo-Comm Inc. | www.geo-comm.com
>
>
> -----Original Message-----
> From: Steve Singer [mailto:ssinger at ca.afilias.info]
> Sent: Wednesday, November 14, 2012 14:31
> To: Shaun McCloud
> Cc: slony1-general at lists.slony.info
> Subject: Re: [Slony1-general] Slony1 2.1.2 Windows Issue
>
> On 12-11-14 03:09 PM, Shaun McCloud wrote:
>> Yes,
>>
>> Deleted my old source folder, copied a clean one in place, made the change, then compiled.
>>
>
> Do you maybe have to restart the postgres.exe service after copying the new slony1_funcs.dll into the lib directory? (I'm guessing, I don't see another obvious reference to 2.1.1 in the code for the DLL and setting up a windows development box always takes me a bit of time)
>
>
>
>> Shaun McCloud, MCDST | Associate Software Developer Geo-Comm Inc. |
>> www.geo-comm.com
>>
>>
>> -----Original Message-----
>> From: Steve Singer [mailto:ssinger at ca.afilias.info]
>> Sent: Wednesday, November 14, 2012 14:07
>> To: Shaun McCloud
>> Cc: slony1-general at lists.slony.info
>> Subject: Re: [Slony1-general] Slony1 2.1.2 Windows Issue
>>
>> On 12-11-14 02:53 PM, Shaun McCloud wrote:
>>> That fixed that issue.
>>>
>>> Now I am getting "please upgrade Slony-I shared module to version 2.1.2"
>>
>> Did you do a clean compile (and then install) the slony1_funcs.dll ?
>>
>>>
>>> Shaun McCloud, MCDST | Associate Software Developer Geo-Comm Inc. |
>>> www.geo-comm.com
>>>
>>> -----Original Message-----
>>> From: Steve Singer [mailto:ssinger at ca.afilias.info]
>>> Sent: Wednesday, November 14, 2012 13:42
>>> To: Shaun McCloud
>>> Cc: slony1-general at lists.slony.info
>>> Subject: Re: [Slony1-general] Slony1 2.1.2 Windows Issue
>>>
>>> On 12-11-14 02:36 PM, Shaun McCloud wrote:
>>>> I have compiled Slony1 2.1.2 on Windows Server 2008 R2 (x64) against
>>>> PostgreSQL 9.0 x64 and I am getting the following errors on startup.
>>>>
>>>> *Slony-I schema version is 2.1.2
>>>>
>>>> *please upgrade Slony-I schema to version 2.1.1
>>>>
>>>> *main: Node has wrong Slony-I schema or module version loaded
>>>>
>>>> The machines I am trying to run 2.1.2 has never had another version
>>>> of
>>>> Slony1 on them.  Why would Slony1 2.1.2 want the 2.1.1 schema?  And
>>>> what can I do to resolve the issue?
>>>
>>> Sorry, my bad I think.
>>> Change the file
>>> config_msvc.h
>>>
>>> #define SLONY_I_VERSION_STRING  "2.1.1"
>>> #define SLONY_I_VERSION_STRING_DEC 2,1,1
>>>
>>> To instead say
>>> #define SLONY_I_VERSION_STRING  "2.1.2"
>>> #define SLONY_I_VERSION_STRING_DEC 2,1,2
>>>
>>>
>>> and recompile everything
>>>
>>>
>>>
>>>
>>>>
>>>> Shaun McCloud, MCDST | Associate Software Developer
>>>>
>>>> Geo-Comm Inc. | www.geo-comm.com <http://www.geo-comm.com/>
>>>>
>>>> 601 W. Saint Germain St., St. Cloud, MN, 56301
>>>>
>>>> Office: 320.240.0040 or 888.436.2666 Fax: 320.240.2389
>>>>
>>>>
>>>>
>>>> _______________________________________________
>>>> Slony1-general mailing list
>>>> Slony1-general at lists.slony.info
>>>> http://lists.slony.info/mailman/listinfo/slony1-general
>>>>
>>>
>>
>


From JanWieck at Yahoo.com  Thu Nov 15 07:44:38 2012
From: JanWieck at Yahoo.com (Jan Wieck)
Date: Thu, 15 Nov 2012 10:44:38 -0500
Subject: [Slony1-general] replication fails to due bad DNS at startup,
 requires slony restart to fix
In-Reply-To: <50A29A2A.1000103@summersault.com>
References: <k7riv0$dnv$1@ger.gmane.org>
	<CANfbgbata6wcP=cdhbwDfMHEFiQNrBS0-hjsxiR98Dm4Yk4ByA@mail.gmail.com>
	<20121112211533.GF82038@crankycanuck.ca>
	<50A29A2A.1000103@summersault.com>
Message-ID: <50A50DE6.6030909@Yahoo.com>




On 11/13/2012 2:06 PM, Mark Stosberg wrote:
>
>
> On 11/12/2012 04:15 PM, Andrew Sullivan wrote:
>> On Mon, Nov 12, 2012 at 04:05:37PM -0500, Christopher Browne wrote:
>>> Is it possible that your libc is doing cacheing?  If *that's* the
>>> case, and I'm suspicious of it, then you really would need to restart
>>> the slon to get "unstuck" from what libc has cached on you...
>>
>> More likely, the system resolver is pointing at a caching name server.
>
> Thanks for prompt answers, everyone.
>
> I'll pursue this as an issue with our use of Ubuntu on Amazon/EC2.

I don't think that restarting the slon manually is the right solution to 
this problem.

Whatever really causes it (libc probably) doesn't matter. Changing DNS 
entries to redirect services to a different IP address is often used in 
disaster recovery procedures (failover). We should not require an 
outside process or worse an admin to restart things in a case like that.

I don't know what exactly is the right answer. From behind libpq it is 
rather difficult to tell what exactly went wrong when trying to connect 
to a database. A generic answer to that would be to do only X attempts 
to (re)connect, then restart the entire slon process. But that has 
pitfalls. If someone has shut down a replica for maintenance purposes, 
all slons would constantly restart in that interval, which would prevent 
longer running tasks like subscriptions. So this would have to go hand 
in hand with some new configuration option(s), like "ignore connection 
failures to this node WRT restarting".

Some input from the user community would certainly help.


Jan

-- 
Anyone who trades liberty for security deserves neither
liberty nor security. -- Benjamin Franklin



From ssinger at ca.afilias.info  Thu Nov 15 14:47:48 2012
From: ssinger at ca.afilias.info (Steve Singer)
Date: Thu, 15 Nov 2012 17:47:48 -0500
Subject: [Slony1-general] Slony1 2.1.2 Windows Issue
In-Reply-To: <7742DD496427B743BC8B7BBF6D380BA040A6A2BB@EXCHANGE10.geo-comm.local>
References: <7742DD496427B743BC8B7BBF6D380BA040A6A187@EXCHANGE10.geo-comm.local>
	<50A3F406.1010406@ca.afilias.info>
	<7742DD496427B743BC8B7BBF6D380BA040A6A214@EXCHANGE10.geo-comm.local>
	<50A3F9F3.9060005@ca.afilias.info>
	<7742DD496427B743BC8B7BBF6D380BA040A6A271@EXCHANGE10.geo-comm.local>
	<50A3FFA0.8090508@ca.afilias.info>
	<7742DD496427B743BC8B7BBF6D380BA040A6A2BB@EXCHANGE10.geo-comm.local>
Message-ID: <50A57114.8060603@ca.afilias.info>

On 12-11-14 03:34 PM, Shaun McCloud wrote:
> Yep,
>
> Restarted the service after copying the new slon1_funcs.dll.  If you want, I can setup a Windows Development machine for you once I get home as I can determine who gets access to that easier than I can at work.

Did you also stop the windows slon service, copy the new slon.exe and 
then restart it? ( if you don't stop the service before copying slon.exe 
the copy will fail because the file is in use)

I've  tried the 2.1.2 tar from the website plus the two changes I 
mentioned in config_msvc.h on a Win32 (not 64) machine and I am able to 
init the cluster via slonik and the slons seem to be running.

Do you have a clean machine you can install this on? ie not the machine 
that had binaries of your previous 2.1.2 without the fix installed?  I'm 
not sure why this works for me but not for you.



>
> Shaun McCloud, MCDST | Associate Software Developer
> Geo-Comm Inc. | www.geo-comm.com
>
>
> -----Original Message-----
> From: Steve Singer [mailto:ssinger at ca.afilias.info]
> Sent: Wednesday, November 14, 2012 14:31
> To: Shaun McCloud
> Cc: slony1-general at lists.slony.info
> Subject: Re: [Slony1-general] Slony1 2.1.2 Windows Issue
>
> On 12-11-14 03:09 PM, Shaun McCloud wrote:
>> Yes,
>>
>> Deleted my old source folder, copied a clean one in place, made the change, then compiled.
>>
>
> Do you maybe have to restart the postgres.exe service after copying the new slony1_funcs.dll into the lib directory? (I'm guessing, I don't see another obvious reference to 2.1.1 in the code for the DLL and setting up a windows development box always takes me a bit of time)
>
>
>
>> Shaun McCloud, MCDST | Associate Software Developer Geo-Comm Inc. |
>> www.geo-comm.com
>>
>>
>> -----Original Message-----
>> From: Steve Singer [mailto:ssinger at ca.afilias.info]
>> Sent: Wednesday, November 14, 2012 14:07
>> To: Shaun McCloud
>> Cc: slony1-general at lists.slony.info
>> Subject: Re: [Slony1-general] Slony1 2.1.2 Windows Issue
>>
>> On 12-11-14 02:53 PM, Shaun McCloud wrote:
>>> That fixed that issue.
>>>
>>> Now I am getting "please upgrade Slony-I shared module to version 2.1.2"
>>
>> Did you do a clean compile (and then install) the slony1_funcs.dll ?
>>
>>>
>>> Shaun McCloud, MCDST | Associate Software Developer Geo-Comm Inc. |
>>> www.geo-comm.com
>>>
>>> -----Original Message-----
>>> From: Steve Singer [mailto:ssinger at ca.afilias.info]
>>> Sent: Wednesday, November 14, 2012 13:42
>>> To: Shaun McCloud
>>> Cc: slony1-general at lists.slony.info
>>> Subject: Re: [Slony1-general] Slony1 2.1.2 Windows Issue
>>>
>>> On 12-11-14 02:36 PM, Shaun McCloud wrote:
>>>> I have compiled Slony1 2.1.2 on Windows Server 2008 R2 (x64) against
>>>> PostgreSQL 9.0 x64 and I am getting the following errors on startup.
>>>>
>>>> *Slony-I schema version is 2.1.2
>>>>
>>>> *please upgrade Slony-I schema to version 2.1.1
>>>>
>>>> *main: Node has wrong Slony-I schema or module version loaded
>>>>
>>>> The machines I am trying to run 2.1.2 has never had another version
>>>> of
>>>> Slony1 on them.  Why would Slony1 2.1.2 want the 2.1.1 schema?  And
>>>> what can I do to resolve the issue?
>>>
>>> Sorry, my bad I think.
>>> Change the file
>>> config_msvc.h
>>>
>>> #define SLONY_I_VERSION_STRING  "2.1.1"
>>> #define SLONY_I_VERSION_STRING_DEC 2,1,1
>>>
>>> To instead say
>>> #define SLONY_I_VERSION_STRING  "2.1.2"
>>> #define SLONY_I_VERSION_STRING_DEC 2,1,2
>>>
>>>
>>> and recompile everything
>>>
>>>
>>>
>>>
>>>>
>>>> Shaun McCloud, MCDST | Associate Software Developer
>>>>
>>>> Geo-Comm Inc. | www.geo-comm.com <http://www.geo-comm.com/>
>>>>
>>>> 601 W. Saint Germain St., St. Cloud, MN, 56301
>>>>
>>>> Office: 320.240.0040 or 888.436.2666 Fax: 320.240.2389
>>>>
>>>>
>>>>
>>>> _______________________________________________
>>>> Slony1-general mailing list
>>>> Slony1-general at lists.slony.info
>>>> http://lists.slony.info/mailman/listinfo/slony1-general
>>>>
>>>
>>
>


