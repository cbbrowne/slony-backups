From luiz.matsumura at gmail.com  Tue Nov  6 17:02:05 2012
From: luiz.matsumura at gmail.com (Luiz Matsumura)
Date: Tue, 6 Nov 2012 23:02:05 -0200
Subject: [Slony1-general] Altperl tools changes
In-Reply-To: <CANfbgbb6dnsqe0cO+2DhWGho2boU1WkmaMCOQf4__CSJJbepAA@mail.gmail.com>
References: <CAC6zyU7YsbgKL+8C5EAxUzsvwYpZ6hEX7EOhLr_07oat8mPMRw@mail.gmail.com>
	<CANfbgbb6dnsqe0cO+2DhWGho2boU1WkmaMCOQf4__CSJJbepAA@mail.gmail.com>
Message-ID: <CAC6zyU7sFvCjF3c=o8cQ1-wL3JC0ERVBbKvRviSAvBvuMsLZNA@mail.gmail.com>

2012/10/29 Christopher Browne <cbbrowne at afilias.info>:
>
> I should probably take a peek at this later in the week; a good place
> to go next would be to review your changes in place, and add comments
> to the patches if there's anything that seems controversial.  From
> what you're describing, the changes sound generally reasonable.

Hi Christopher !
I made changes on the controversial parts based on solutions suggested
by Steve Singer.

I don?t know if github warns about the changes to you, so sorry by the
noise if they do.

Can you review again if the changes are satisfactory ?

Thanks in advance.

https://github.com/lkmatsumura/slony1-engine/commits/altperl
https://github.com/lkmatsumura/slony1-engine/commits/master

From glynastill at yahoo.co.uk  Thu Nov  8 09:31:45 2012
From: glynastill at yahoo.co.uk (Glyn Astill)
Date: Thu, 8 Nov 2012 17:31:45 +0000 (GMT)
Subject: [Slony1-general] Lock set behaviour difference between 2.0 and 2.1
Message-ID: <1352395905.8369.YahooMailNeo@web133204.mail.ir2.yahoo.com>

Hi Guys,

I was just taking a look at the changes to lockset() between 2.0 and 2.1 and noticed it now uses a lock on the row in sl_set rather than a table lock on sl_config_lock.

I was wondering, does this now make it possible to do something along the lines of:

TRY {
LOCK SET ( ID = 1, ORIGIN = 1);
LOCK SET ( ID = 2, ORIGIN = 1);
}
ON ERROR ( blah }
MOVE SET ( ID = 1, OLD ORIGIN = 1, NEW ORIGIN = 2);
WAIT FOR EVENT (ORIGIN = 1, CONFIRMED = ALL, WAIT ON = 1, TIMEOUT = 0);
MOVE SET ( ID = 2, OLD ORIGIN = 1, NEW ORIGIN = 2);
WAIT FOR EVENT (ORIGIN = 1, CONFIRMED = ALL, WAIT ON = 1, TIMEOUT = 0);

(Or even wrap the move sets in a try too?)

The reason I ask is we're currently using 2.0.7 and when we move a bunch of sets between nodes it'd be ideal if they were all locked before they were moved.

Sorry if I've got the wrong end of the stick here, or this has already been answered somewhere, I did do a good search before posting!

Thanks
Glyn
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20121108/5b888eff/attachment.htm 

From efraindector at motumweb.com  Fri Nov  9 07:52:38 2012
From: efraindector at motumweb.com (=?utf-8?Q?Efra=C3=ADn_D=C3=A9ctor?=)
Date: Fri, 9 Nov 2012 09:52:38 -0600
Subject: [Slony1-general] Adding a table to replication using Altperl
Message-ID: <97DBC550801546B0A7A02A9FD2AE4120@CMOTUM25PC>

Hello. I?ve read that it is possible to add a table to a running replication (http://slony.info/documentation/2.1/modifyingthings.html), currently I?m using altperl scripts to manage the replication, I would like to know if its possible to add a new table using altperl scripts, can you guys please point me in the right direction?.

Thanks a lot.


-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20121109/d69787b5/attachment.htm 

From gmc at esilibrary.com  Fri Nov  9 07:58:09 2012
From: gmc at esilibrary.com (Galen Charlton)
Date: Fri, 9 Nov 2012 07:58:09 -0800
Subject: [Slony1-general] Adding a table to replication using Altperl
In-Reply-To: <97DBC550801546B0A7A02A9FD2AE4120@CMOTUM25PC>
References: <97DBC550801546B0A7A02A9FD2AE4120@CMOTUM25PC>
Message-ID: <CAPLnt64Voe_T=n5KfxQdamtdL8rttyzKKt8SgcyMx8fb00J4Tw@mail.gmail.com>

Hi,

On Fri, Nov 9, 2012 at 7:52 AM, Efra?n D?ctor <efraindector at motumweb.com>wrote:

>   Hello. I?ve read that it is possible to add a table to a running
> replication (http://slony.info/documentation/2.1/modifyingthings.html),
> currently I?m using altperl scripts to manage the replication, I would like
> to know if its possible to add a new table using altperl scripts, can you
> guys please point me in the right direction?.
>

One approach to take is to first define a new set in slon_tools.conf that
includes the new table, then use the altperl tools to create the new set,
subscribe nodes to it, then finally (if you want) merge the new set into
the existing replication set.  If you do merge sets, the final step is to
edit slon_tools.conf to remove the new set and and move the new table in
the existing set.

Regards,

Galen
-- 
Galen Charlton
Director of Implementation
Equinox Software, Inc. / The Open Source Experts
email:  gmc at esilibrary.com
direct: +1 770-709-5581
cell:   +1 404-984-4366
skype:  gmcharlt
web:    http://www.esilibrary.com/
Supporting Koha and Evergreen: http://koha-community.org &
http://evergreen-ils.org
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20121109/027cc3d8/attachment.htm 

From efraindector at motumweb.com  Fri Nov  9 08:26:22 2012
From: efraindector at motumweb.com (=?Windows-1252?Q?Efra=EDn_D=E9ctor?=)
Date: Fri, 9 Nov 2012 10:26:22 -0600
Subject: [Slony1-general] Adding a table to replication using Altperl
In-Reply-To: <CAPLnt64Voe_T=n5KfxQdamtdL8rttyzKKt8SgcyMx8fb00J4Tw@mail.gmail.com>
References: <97DBC550801546B0A7A02A9FD2AE4120@CMOTUM25PC>
	<CAPLnt64Voe_T=n5KfxQdamtdL8rttyzKKt8SgcyMx8fb00J4Tw@mail.gmail.com>
Message-ID: <1F78E2E7C85A487EBFCD5F88443EA777@CMOTUM25PC>

Hello. 

Thank you for your response. If I understand correctly what I have to do is this: 

On the slon_tool.conf I have only to add this:


"set2" => {
"set_id" => 2,
"table_id" => 2,
"sequence_id" => 2,
"pkeyedtables" => ["testtable"],
#"keyedtables" => {},
#"sequences" => [],
},

And leave everything else intact (set 1, name of cluster, etc). Then I have to run this commands:

# slonik_create_set 2 | slonik 
# slonik_subscribe_set 2 2 | slonik (number of set: 2, number of node 2)
# slonik_subscribe_set 2 3 | slonik (number of set: 2, number of node 3)

Do I have to run slon_kill and then slon_start ?

Thanks

From: Galen Charlton 
Sent: Friday, November 09, 2012 9:58 AM
To: Efra?n D?ctor 
Cc: slony1-general at lists.slony.info 
Subject: Re: [Slony1-general] Adding a table to replication using Altperl

Hi, 

On Fri, Nov 9, 2012 at 7:52 AM, Efra?n D?ctor <efraindector at motumweb.com> wrote:

  Hello. I?ve read that it is possible to add a table to a running replication (http://slony.info/documentation/2.1/modifyingthings.html), currently I?m using altperl scripts to manage the replication, I would like to know if its possible to add a new table using altperl scripts, can you guys please point me in the right direction?.

One approach to take is to first define a new set in slon_tools.conf that includes the new table, then use the altperl tools to create the new set, subscribe nodes to it, then finally (if you want) merge the new set into the existing replication set.  If you do merge sets, the final step is to edit slon_tools.conf to remove the new set and and move the new table in the existing set.

Regards,

Galen 
-- 

Galen Charlton
Director of Implementation
Equinox Software, Inc. / The Open Source Experts
email:  gmc at esilibrary.com
direct: +1 770-709-5581
cell:   +1 404-984-4366
skype:  gmcharlt
web:    http://www.esilibrary.com/
Supporting Koha and Evergreen: http://koha-community.org & http://evergreen-ils.org
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20121109/2643eda8/attachment.htm 

From gmc at esilibrary.com  Fri Nov  9 08:28:23 2012
From: gmc at esilibrary.com (Galen Charlton)
Date: Fri, 9 Nov 2012 08:28:23 -0800
Subject: [Slony1-general] Adding a table to replication using Altperl
In-Reply-To: <1F78E2E7C85A487EBFCD5F88443EA777@CMOTUM25PC>
References: <97DBC550801546B0A7A02A9FD2AE4120@CMOTUM25PC>
	<CAPLnt64Voe_T=n5KfxQdamtdL8rttyzKKt8SgcyMx8fb00J4Tw@mail.gmail.com>
	<1F78E2E7C85A487EBFCD5F88443EA777@CMOTUM25PC>
Message-ID: <CAPLnt65ge4vD59rN5vfGxg=gUZK2f9VaLf3RTPKV9BXuqMTcZw@mail.gmail.com>

Hi,


On Fri, Nov 9, 2012 at 8:26 AM, Efra?n D?ctor <efraindector at motumweb.com>wrote:

>   Thank you for your response. If I understand correctly what I have to
> do is this:
>
> On the slon_tool.conf I have only to add this:
>
> "set2" => {
> "set_id" => 2,
> "table_id" => 2,
> "sequence_id" => 2,
> "pkeyedtables" => ["testtable"],
> #"keyedtables" => {},
> #"sequences" => [],
> },
>

I think you'll need to increase the table_id and sequence_ids to account
for the tables already in set1.


> # slonik_create_set 2 | slonik
> # slonik_subscribe_set 2 2 | slonik (number of set: 2, number of node 2)
> # slonik_subscribe_set 2 3 | slonik (number of set: 2, number of node 3)
>

Yes.


> Do I have to run slon_kill and then slon_start ?
>

No, that won't be necessary.

Regards,

Galen
-- 
Galen Charlton
Director of Implementation
Equinox Software, Inc. / The Open Source Experts
email:  gmc at esilibrary.com
direct: +1 770-709-5581
cell:   +1 404-984-4366
skype:  gmcharlt
web:    http://www.esilibrary.com/
Supporting Koha and Evergreen: http://koha-community.org &
http://evergreen-ils.org
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20121109/b4eb71d0/attachment.htm 

From ssinger at ca.afilias.info  Fri Nov  9 10:13:54 2012
From: ssinger at ca.afilias.info (Steve Singer)
Date: Fri, 09 Nov 2012 13:13:54 -0500
Subject: [Slony1-general] Lock set behaviour difference between 2.0 and
 2.1
In-Reply-To: <1352395905.8369.YahooMailNeo@web133204.mail.ir2.yahoo.com>
References: <1352395905.8369.YahooMailNeo@web133204.mail.ir2.yahoo.com>
Message-ID: <509D47E2.2010308@ca.afilias.info>

On 12-11-08 12:31 PM, Glyn Astill wrote:
> Hi Guys,
>
> I was just taking a look at the changes to lockset() between 2.0 and 2.1
> and noticed it now uses a lock on the row in sl_set rather than a table
> lock on sl_config_lock.
>
> I was wondering, does this now make it possible to do something along
> the lines of:
>
> TRY {
> LOCK SET ( ID = 1, ORIGIN = 1);
> LOCK SET ( ID = 2, ORIGIN = 1);
> }
> ON ERROR ( blah }
> MOVE SET ( ID = 1, OLD ORIGIN = 1, NEW ORIGIN = 2);
>

No the LOCK SET needs to be done as part of the same transaction as the 
MOVE SET.  You can't do that across the bounds of a try block. You also 
can't do WAIT FOR EVENT inside of a try block.

WAIT FOR EVENT (ORIGIN = 1, CONFIRMED = ALL, WAIT ON = 1, TIMEOUT = 0);
> MOVE SET ( ID = 2, OLD ORIGIN = 1, NEW ORIGIN = 2);
> WAIT FOR EVENT (ORIGIN = 1, CONFIRMED = ALL, WAIT ON = 1, TIMEOUT = 0);
>
> (Or even wrap the move sets in a try too?)

Why can't you just do

try {
LOCK SET ( ID = 1, ORIGIN = 1);
LOCK SET ( ID = 2, ORIGIN = 1);
MOVE SET ( ID = 1, OLD ORIGIN = 1, NEW ORIGIN = 2);
MOVE SET ( ID = 2, OLD ORIGIN = 1, NEW ORIGIN = 2);
}
WAIT FOR EVENT(ORIGIN=1, CONFIRMED=ALL...)

(I haven't actually tested the above but I think it will work in cases 
were both sets are on the same origin).


>
> The reason I ask is we're currently using 2.0.7 and when we move a bunch
> of sets between nodes it'd be ideal if they were all locked before they
> were moved.
>
> Sorry if I've got the wrong end of the stick here, or this has already
> been answered somewhere, I did do a good search before posting!
>
> Thanks
> Glyn
>
>
>
>
>
>
> _______________________________________________
> Slony1-general mailing list
> Slony1-general at lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
>


From efraindector at motumweb.com  Fri Nov  9 15:36:00 2012
From: efraindector at motumweb.com (=?iso-8859-1?Q?Efra=EDn_D=E9ctor?=)
Date: Fri, 9 Nov 2012 17:36:00 -0600
Subject: [Slony1-general] Adding a table to replication using Altperl
In-Reply-To: <CAPLnt65ge4vD59rN5vfGxg=gUZK2f9VaLf3RTPKV9BXuqMTcZw@mail.gmail.com>
References: <97DBC550801546B0A7A02A9FD2AE4120@CMOTUM25PC><CAPLnt64Voe_T=n5KfxQdamtdL8rttyzKKt8SgcyMx8fb00J4Tw@mail.gmail.com><1F78E2E7C85A487EBFCD5F88443EA777@CMOTUM25PC>
	<CAPLnt65ge4vD59rN5vfGxg=gUZK2f9VaLf3RTPKV9BXuqMTcZw@mail.gmail.com>
Message-ID: <34F451E3613F4ED09E15492CEC5D476F@CMOTUM25PC>

Hello. I just wanted to let you know that thanks to your advice adding new tables to the replication has worked perfectly, including merging the sets.

Thanks a lot.

From: Galen Charlton 
Sent: Friday, November 09, 2012 10:28 AM
To: Efra?n D?ctor 
Cc: slony1-general at lists.slony.info 
Subject: Re: [Slony1-general] Adding a table to replication using Altperl

Hi, 



On Fri, Nov 9, 2012 at 8:26 AM, Efra?n D?ctor <efraindector at motumweb.com> wrote:

  Thank you for your response. If I understand correctly what I have to do is this: 

  On the slon_tool.conf I have only to add this:


  "set2" => {
  "set_id" => 2,
  "table_id" => 2,
  "sequence_id" => 2,
  "pkeyedtables" => ["testtable"],
  #"keyedtables" => {},
  #"sequences" => [],
  },


I think you'll need to increase the table_id and sequence_ids to account for the tables already in set1.

  # slonik_create_set 2 | slonik 
  # slonik_subscribe_set 2 2 | slonik (number of set: 2, number of node 2)
  # slonik_subscribe_set 2 3 | slonik (number of set: 2, number of node 3)

Yes.

  Do I have to run slon_kill and then slon_start ?


No, that won't be necessary.

Regards,

Galen
-- 

Galen Charlton
Director of Implementation
Equinox Software, Inc. / The Open Source Experts
email:  gmc at esilibrary.com
direct: +1 770-709-5581
cell:   +1 404-984-4366
skype:  gmcharlt
web:    http://www.esilibrary.com/
Supporting Koha and Evergreen: http://koha-community.org & http://evergreen-ils.org
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20121109/50bd27ae/attachment.htm 

