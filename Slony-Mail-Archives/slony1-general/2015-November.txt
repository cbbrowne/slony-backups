From jan at wi3ck.info  Tue Nov  3 05:50:31 2015
From: jan at wi3ck.info (Jan Wieck)
Date: Tue, 3 Nov 2015 08:50:31 -0500
Subject: [Slony1-general] Slony Replication Startup Speed
In-Reply-To: <CAHD_kvm=hUgL6d86zeQ_zuNLSV58f=bCkZccv+FgdRJ+TzGSOA@mail.gmail.com>
References: <CAHD_kvnWruCyJsX_=xFHMiWkvxahY1U0wLtKpRonCLAHBAUQag@mail.gmail.com>
	<CAOR=d=01EHSAEm80iFyQBbqzFkHrf8e6WZnVOhS9yZnL7ER27g@mail.gmail.com>
	<CAHD_kvkNTx7zm2fmiJGYO96x9OT21kcsLa7JM=vmj6ekzn5+hw@mail.gmail.com>
	<CAOR=d=3m8HwyzDLdpwq9d6Ptfc8A_-BVUB5PeZECFAkcFwJAWg@mail.gmail.com>
	<CAHD_kvk+C-HAgAY+KmqNUPWs4TsH4gOFS14-Mg-BVam0+ticOA@mail.gmail.com>
	<CAOR=d=3zx_vBDQoE3yNdcNvnnSWdBC75UyMgE9hDrdD=_p6Tzw@mail.gmail.com>
	<CAHD_kvm=hUgL6d86zeQ_zuNLSV58f=bCkZccv+FgdRJ+TzGSOA@mail.gmail.com>
Message-ID: <5638BBA7.1030204@wi3ck.info>

On 10/29/2015 09:49 PM, Sung Hsin Lei wrote:
> Actually, node 2 is correct. I have 2 different clusters. Each cluster
> has node 1 and node 2. Each cluster replicates to 1 db.

What is the reason for this setup? If the two slaves are subscribed to 
different sets of tables, then the same can be achieved by creating 
multiple sets and subscribing the slaves to individual combinations of 
them.


Regards, Jan


>
> On Thu, Oct 29, 2015 at 8:39 PM, Scott Marlowe <scott.marlowe at gmail.com
> <mailto:scott.marlowe at gmail.com>> wrote:
>
>     On Thu, Oct 29, 2015 at 6:06 PM, Sung Hsin Lei <sungh.lei at gmail.com
>     <mailto:sungh.lei at gmail.com>> wrote:
>     > Hello,
>     >
>     > I successfully update the main db and one replicated db with the following:
>     >
>     > cluster name = slony_rep1
>     >
>     > node 1 admin conninfo = 'dbname = MyDB host = localhost user = slony1
>     > password = Ejhfg33EdddsufhErR76 port = 6234';
>     > node 2 admin conninfo = 'dbname = MyDB host = 86.88.5.4 user = slony1
>     > password = Ejhfg33EdddsufhErR76 port = 6234';
>     >
>     > EXECUTE SCRIPT
>     > (
>     >     SQL = 'ALTER TABLE operators RENAME COLUMN firstname TO lastname;',
>     >     EVENT NODE = 1
>     > );
>     >
>     >
>     >
>     >
>     > However, I have 1 main db to 2 replicated db. The second replicated db has
>     > the following cluster name and node information:
>     >
>     > cluster name = slony_rep2
>     >
>     > node 1 admin conninfo = 'dbname = MyDB host = localhost user = slony2
>     > password = Ejhfg33EdddsufhErR76 port = 6234';
>     > node 2 admin conninfo = 'dbname = MyDB host = 86.88.5.17 user = slony2
>     > password = Ejhfg33EdddsufhErR76 port = 6234';
>
>     Shouldn't that be node 3 not node 2?
>
>     > Do I need to run slonik twice with different cluster and node indo? That
>     > does not seem right. After running the first time, the main db and the first
>     > replicated db will be consistent but not the second replicated db. Also, if
>     > I run it a second time, wouldn't the main db already be updated hence the
>     > sql statements used for the original update will surely fail?
>
>     You can just run it on all three at once.
>
>     node 1 admin conninfo = 'dbname = MyDB host = localhost user = slony1
>     password = Ejhfg33EdddsufhErR76 port = 6234';
>     node 2 admin conninfo = 'dbname = MyDB host = 86.88.5.4 user = slony1
>     password = Ejhfg33EdddsufhErR76 port = 6234';
>     node 3 admin conninfo = 'dbname = MyDB host = 86.88.5.17 user = slony2
>     password = Ejhfg33EdddsufhErR76 port = 6234';
>
>     EXECUTE SCRIPT
>     (
>          SQL = 'ALTER TABLE operators RENAME COLUMN firstname TO lastname;',
>          EVENT NODE = 1
>     );
>
>
>
>
> _______________________________________________
> Slony1-general mailing list
> Slony1-general at lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
>


-- 
Jan Wieck
Senior Software Engineer
http://slony.info

From sungh.lei at gmail.com  Thu Nov  5 20:04:39 2015
From: sungh.lei at gmail.com (Sung Hsin Lei)
Date: Thu, 5 Nov 2015 23:04:39 -0500
Subject: [Slony1-general] Slony Replication Startup Speed
In-Reply-To: <5638BBA7.1030204@wi3ck.info>
References: <CAHD_kvnWruCyJsX_=xFHMiWkvxahY1U0wLtKpRonCLAHBAUQag@mail.gmail.com>
	<CAOR=d=01EHSAEm80iFyQBbqzFkHrf8e6WZnVOhS9yZnL7ER27g@mail.gmail.com>
	<CAHD_kvkNTx7zm2fmiJGYO96x9OT21kcsLa7JM=vmj6ekzn5+hw@mail.gmail.com>
	<CAOR=d=3m8HwyzDLdpwq9d6Ptfc8A_-BVUB5PeZECFAkcFwJAWg@mail.gmail.com>
	<CAHD_kvk+C-HAgAY+KmqNUPWs4TsH4gOFS14-Mg-BVam0+ticOA@mail.gmail.com>
	<CAOR=d=3zx_vBDQoE3yNdcNvnnSWdBC75UyMgE9hDrdD=_p6Tzw@mail.gmail.com>
	<CAHD_kvm=hUgL6d86zeQ_zuNLSV58f=bCkZccv+FgdRJ+TzGSOA@mail.gmail.com>
	<5638BBA7.1030204@wi3ck.info>
Message-ID: <CAHD_kvnFAnM4=DasvHxHDVGLBLYwMB+8hp1UsoqqsYVkYs69ig@mail.gmail.com>

No reason besides we were new to slony and had no idea what we were doing
at the beginning and now it will be a hassle to change for everyone that
has this.

On Tue, Nov 3, 2015 at 8:50 AM, Jan Wieck <jan at wi3ck.info> wrote:

> On 10/29/2015 09:49 PM, Sung Hsin Lei wrote:
>
>> Actually, node 2 is correct. I have 2 different clusters. Each cluster
>> has node 1 and node 2. Each cluster replicates to 1 db.
>>
>
> What is the reason for this setup? If the two slaves are subscribed to
> different sets of tables, then the same can be achieved by creating
> multiple sets and subscribing the slaves to individual combinations of them.
>
>
> Regards, Jan
>
>
>
>> On Thu, Oct 29, 2015 at 8:39 PM, Scott Marlowe <scott.marlowe at gmail.com
>> <mailto:scott.marlowe at gmail.com>> wrote:
>>
>>     On Thu, Oct 29, 2015 at 6:06 PM, Sung Hsin Lei <sungh.lei at gmail.com
>>     <mailto:sungh.lei at gmail.com>> wrote:
>>     > Hello,
>>     >
>>     > I successfully update the main db and one replicated db with the
>> following:
>>     >
>>     > cluster name = slony_rep1
>>     >
>>     > node 1 admin conninfo = 'dbname = MyDB host = localhost user =
>> slony1
>>     > password = Ejhfg33EdddsufhErR76 port = 6234';
>>     > node 2 admin conninfo = 'dbname = MyDB host = 86.88.5.4 user =
>> slony1
>>     > password = Ejhfg33EdddsufhErR76 port = 6234';
>>     >
>>     > EXECUTE SCRIPT
>>     > (
>>     >     SQL = 'ALTER TABLE operators RENAME COLUMN firstname TO
>> lastname;',
>>     >     EVENT NODE = 1
>>     > );
>>     >
>>     >
>>     >
>>     >
>>     > However, I have 1 main db to 2 replicated db. The second replicated
>> db has
>>     > the following cluster name and node information:
>>     >
>>     > cluster name = slony_rep2
>>     >
>>     > node 1 admin conninfo = 'dbname = MyDB host = localhost user =
>> slony2
>>     > password = Ejhfg33EdddsufhErR76 port = 6234';
>>     > node 2 admin conninfo = 'dbname = MyDB host = 86.88.5.17 user =
>> slony2
>>     > password = Ejhfg33EdddsufhErR76 port = 6234';
>>
>>     Shouldn't that be node 3 not node 2?
>>
>>     > Do I need to run slonik twice with different cluster and node indo?
>> That
>>     > does not seem right. After running the first time, the main db and
>> the first
>>     > replicated db will be consistent but not the second replicated db.
>> Also, if
>>     > I run it a second time, wouldn't the main db already be updated
>> hence the
>>     > sql statements used for the original update will surely fail?
>>
>>     You can just run it on all three at once.
>>
>>     node 1 admin conninfo = 'dbname = MyDB host = localhost user = slony1
>>     password = Ejhfg33EdddsufhErR76 port = 6234';
>>     node 2 admin conninfo = 'dbname = MyDB host = 86.88.5.4 user = slony1
>>     password = Ejhfg33EdddsufhErR76 port = 6234';
>>     node 3 admin conninfo = 'dbname = MyDB host = 86.88.5.17 user = slony2
>>     password = Ejhfg33EdddsufhErR76 port = 6234';
>>
>>     EXECUTE SCRIPT
>>     (
>>          SQL = 'ALTER TABLE operators RENAME COLUMN firstname TO
>> lastname;',
>>          EVENT NODE = 1
>>     );
>>
>>
>>
>>
>> _______________________________________________
>> Slony1-general mailing list
>> Slony1-general at lists.slony.info
>> http://lists.slony.info/mailman/listinfo/slony1-general
>>
>>
>
> --
> Jan Wieck
> Senior Software Engineer
> http://slony.info
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20151105/1e9c0216/attachment.htm 

From ssinger at ca.afilias.info  Mon Nov  9 13:12:57 2015
From: ssinger at ca.afilias.info (Steve Singer)
Date: Mon, 09 Nov 2015 16:12:57 -0500
Subject: [Slony1-general] adding a replication node instructions update?
In-Reply-To: <CAJKUy5jr=Ua-deX=DQGL4ZkEQk-q3P6u=B2Qp5F3E2tuccf+yA@mail.gmail.com>
References: <87d1wltbwv.fsf@alice.fifthhorseman.net>
	<CAJKUy5jr=Ua-deX=DQGL4ZkEQk-q3P6u=B2Qp5F3E2tuccf+yA@mail.gmail.com>
Message-ID: <56410C59.8090105@ca.afilias.info>

On 10/29/2015 03:58 PM, Jaime Casanova wrote:
\
>> namespace into the new replication database.  This causes the subsequent
>> STORE NODE command to fail with a complaint that the _$CLUSTER_NAME
>> schema is already present.
>>
>> I think if you add -N _$CLUSTERNAME to the pg_dump side of the pipeline,
>> then the rest of the directions should complete OK.
>>
>> Is this a bug in the documentation, or have i misunderstood something?
>>
>
> looks like a bug in documentation, yes
>

I've committed a change to the documentation to include a 
--exclude-schema on the pg_dump command in that sample


From jan at wi3ck.info  Mon Nov  9 14:23:16 2015
From: jan at wi3ck.info (Jan Wieck)
Date: Mon, 9 Nov 2015 17:23:16 -0500
Subject: [Slony1-general] Slony Replication Startup Speed
In-Reply-To: <CAHD_kvnFAnM4=DasvHxHDVGLBLYwMB+8hp1UsoqqsYVkYs69ig@mail.gmail.com>
References: <CAHD_kvnWruCyJsX_=xFHMiWkvxahY1U0wLtKpRonCLAHBAUQag@mail.gmail.com>
	<CAOR=d=01EHSAEm80iFyQBbqzFkHrf8e6WZnVOhS9yZnL7ER27g@mail.gmail.com>
	<CAHD_kvkNTx7zm2fmiJGYO96x9OT21kcsLa7JM=vmj6ekzn5+hw@mail.gmail.com>
	<CAOR=d=3m8HwyzDLdpwq9d6Ptfc8A_-BVUB5PeZECFAkcFwJAWg@mail.gmail.com>
	<CAHD_kvk+C-HAgAY+KmqNUPWs4TsH4gOFS14-Mg-BVam0+ticOA@mail.gmail.com>
	<CAOR=d=3zx_vBDQoE3yNdcNvnnSWdBC75UyMgE9hDrdD=_p6Tzw@mail.gmail.com>
	<CAHD_kvm=hUgL6d86zeQ_zuNLSV58f=bCkZccv+FgdRJ+TzGSOA@mail.gmail.com>
	<5638BBA7.1030204@wi3ck.info>
	<CAHD_kvnFAnM4=DasvHxHDVGLBLYwMB+8hp1UsoqqsYVkYs69ig@mail.gmail.com>
Message-ID: <56411CD4.2020404@wi3ck.info>

On 11/05/2015 11:04 PM, Sung Hsin Lei wrote:
> No reason besides we were new to slony and had no idea what we were
> doing at the beginning and now it will be a hassle to change for
> everyone that has this.

The hassle right now seems to be that you can submit the EXECUTE SCRIPT 
only to one of the two clusters. With this setup it is impossible to do 
it for both.

So you can either deal with the hassle of changing the setup to a single 
cluster with multiple subscriber (slave) nodes, or figure out a way to 
do the schema changes without using EXECUTE SCRIPT. Pick your lesser hassle.


Regards, Jan


>
> On Tue, Nov 3, 2015 at 8:50 AM, Jan Wieck <jan at wi3ck.info
> <mailto:jan at wi3ck.info>> wrote:
>
>     On 10/29/2015 09:49 PM, Sung Hsin Lei wrote:
>
>         Actually, node 2 is correct. I have 2 different clusters. Each
>         cluster
>         has node 1 and node 2. Each cluster replicates to 1 db.
>
>
>     What is the reason for this setup? If the two slaves are subscribed
>     to different sets of tables, then the same can be achieved by
>     creating multiple sets and subscribing the slaves to individual
>     combinations of them.
>
>
>     Regards, Jan
>
>
>
>         On Thu, Oct 29, 2015 at 8:39 PM, Scott Marlowe
>         <scott.marlowe at gmail.com <mailto:scott.marlowe at gmail.com>
>         <mailto:scott.marlowe at gmail.com
>         <mailto:scott.marlowe at gmail.com>>> wrote:
>
>              On Thu, Oct 29, 2015 at 6:06 PM, Sung Hsin Lei
>         <sungh.lei at gmail.com <mailto:sungh.lei at gmail.com>
>              <mailto:sungh.lei at gmail.com <mailto:sungh.lei at gmail.com>>>
>         wrote:
>              > Hello,
>              >
>              > I successfully update the main db and one replicated db
>         with the following:
>              >
>              > cluster name = slony_rep1
>              >
>              > node 1 admin conninfo = 'dbname = MyDB host = localhost
>         user = slony1
>              > password = Ejhfg33EdddsufhErR76 port = 6234';
>              > node 2 admin conninfo = 'dbname = MyDB host = 86.88.5.4
>         user = slony1
>              > password = Ejhfg33EdddsufhErR76 port = 6234';
>              >
>              > EXECUTE SCRIPT
>              > (
>              >     SQL = 'ALTER TABLE operators RENAME COLUMN firstname
>         TO lastname;',
>              >     EVENT NODE = 1
>              > );
>              >
>              >
>              >
>              >
>              > However, I have 1 main db to 2 replicated db. The second
>         replicated db has
>              > the following cluster name and node information:
>              >
>              > cluster name = slony_rep2
>              >
>              > node 1 admin conninfo = 'dbname = MyDB host = localhost
>         user = slony2
>              > password = Ejhfg33EdddsufhErR76 port = 6234';
>              > node 2 admin conninfo = 'dbname = MyDB host = 86.88.5.17
>         user = slony2
>              > password = Ejhfg33EdddsufhErR76 port = 6234';
>
>              Shouldn't that be node 3 not node 2?
>
>              > Do I need to run slonik twice with different cluster and
>         node indo? That
>              > does not seem right. After running the first time, the
>         main db and the first
>              > replicated db will be consistent but not the second
>         replicated db. Also, if
>              > I run it a second time, wouldn't the main db already be
>         updated hence the
>              > sql statements used for the original update will surely fail?
>
>              You can just run it on all three at once.
>
>              node 1 admin conninfo = 'dbname = MyDB host = localhost
>         user = slony1
>              password = Ejhfg33EdddsufhErR76 port = 6234';
>              node 2 admin conninfo = 'dbname = MyDB host = 86.88.5.4
>         user = slony1
>              password = Ejhfg33EdddsufhErR76 port = 6234';
>              node 3 admin conninfo = 'dbname = MyDB host = 86.88.5.17
>         user = slony2
>              password = Ejhfg33EdddsufhErR76 port = 6234';
>
>              EXECUTE SCRIPT
>              (
>                   SQL = 'ALTER TABLE operators RENAME COLUMN firstname
>         TO lastname;',
>                   EVENT NODE = 1
>              );
>
>
>
>
>         _______________________________________________
>         Slony1-general mailing list
>         Slony1-general at lists.slony.info
>         <mailto:Slony1-general at lists.slony.info>
>         http://lists.slony.info/mailman/listinfo/slony1-general
>
>
>
>     --
>     Jan Wieck
>     Senior Software Engineer
>     http://slony.info
>
>


-- 
Jan Wieck
Senior Software Engineer
http://slony.info

From ludovic.toinel at capgemini.com  Tue Nov 10 01:51:29 2015
From: ludovic.toinel at capgemini.com (TOINEL, Ludovic)
Date: Tue, 10 Nov 2015 09:51:29 +0000
Subject: [Slony1-general] Network connection from slaves to the master
Message-ID: <6DE56644D894504CB303B3830CEEB36126B96E95@DE-CM-MBX06.corp.capgemini.com>

Hi,

I would like to use Slony without any network connection from the slaves to the master.
The network allows only flows from master to slaves.

Is there any option that I missed to do that ?

Thank-you in advance.

Regards,

Ludovic Toinel
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20151110/e0842f24/attachment.htm 

From ajs at crankycanuck.ca  Tue Nov 10 03:26:05 2015
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Tue, 10 Nov 2015 06:26:05 -0500
Subject: [Slony1-general] Network connection from slaves to the master
In-Reply-To: <6DE56644D894504CB303B3830CEEB36126B96E95@DE-CM-MBX06.corp.capgemini.com>
References: <6DE56644D894504CB303B3830CEEB36126B96E95@DE-CM-MBX06.corp.capgemini.com>
Message-ID: <20151110112605.GA18808@crankycanuck.ca>

On Tue, Nov 10, 2015 at 09:51:29AM +0000, TOINEL, Ludovic wrote:
> The network allows only flows from master to slaves.
> 
> Is there any option that I missed to do that ?

Not really.  In principle you could do this with the log shipping
mode, but I don't recall whether doing that on the master was not
possible or just a really bad idea.  (You could do this with the
built-in standby mechanisms of Postgres, though.

I do wonder why you have it set up this way, however.  Why do you
control the flows this way?

A

-- 
Andrew Sullivan
ajs at crankycanuck.ca

