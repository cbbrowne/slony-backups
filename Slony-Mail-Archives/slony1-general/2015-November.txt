From jan at wi3ck.info  Tue Nov  3 05:50:31 2015
From: jan at wi3ck.info (Jan Wieck)
Date: Tue, 3 Nov 2015 08:50:31 -0500
Subject: [Slony1-general] Slony Replication Startup Speed
In-Reply-To: <CAHD_kvm=hUgL6d86zeQ_zuNLSV58f=bCkZccv+FgdRJ+TzGSOA@mail.gmail.com>
References: <CAHD_kvnWruCyJsX_=xFHMiWkvxahY1U0wLtKpRonCLAHBAUQag@mail.gmail.com>
	<CAOR=d=01EHSAEm80iFyQBbqzFkHrf8e6WZnVOhS9yZnL7ER27g@mail.gmail.com>
	<CAHD_kvkNTx7zm2fmiJGYO96x9OT21kcsLa7JM=vmj6ekzn5+hw@mail.gmail.com>
	<CAOR=d=3m8HwyzDLdpwq9d6Ptfc8A_-BVUB5PeZECFAkcFwJAWg@mail.gmail.com>
	<CAHD_kvk+C-HAgAY+KmqNUPWs4TsH4gOFS14-Mg-BVam0+ticOA@mail.gmail.com>
	<CAOR=d=3zx_vBDQoE3yNdcNvnnSWdBC75UyMgE9hDrdD=_p6Tzw@mail.gmail.com>
	<CAHD_kvm=hUgL6d86zeQ_zuNLSV58f=bCkZccv+FgdRJ+TzGSOA@mail.gmail.com>
Message-ID: <5638BBA7.1030204@wi3ck.info>

On 10/29/2015 09:49 PM, Sung Hsin Lei wrote:
> Actually, node 2 is correct. I have 2 different clusters. Each cluster
> has node 1 and node 2. Each cluster replicates to 1 db.

What is the reason for this setup? If the two slaves are subscribed to 
different sets of tables, then the same can be achieved by creating 
multiple sets and subscribing the slaves to individual combinations of 
them.


Regards, Jan


>
> On Thu, Oct 29, 2015 at 8:39 PM, Scott Marlowe <scott.marlowe at gmail.com
> <mailto:scott.marlowe at gmail.com>> wrote:
>
>     On Thu, Oct 29, 2015 at 6:06 PM, Sung Hsin Lei <sungh.lei at gmail.com
>     <mailto:sungh.lei at gmail.com>> wrote:
>     > Hello,
>     >
>     > I successfully update the main db and one replicated db with the following:
>     >
>     > cluster name = slony_rep1
>     >
>     > node 1 admin conninfo = 'dbname = MyDB host = localhost user = slony1
>     > password = Ejhfg33EdddsufhErR76 port = 6234';
>     > node 2 admin conninfo = 'dbname = MyDB host = 86.88.5.4 user = slony1
>     > password = Ejhfg33EdddsufhErR76 port = 6234';
>     >
>     > EXECUTE SCRIPT
>     > (
>     >     SQL = 'ALTER TABLE operators RENAME COLUMN firstname TO lastname;',
>     >     EVENT NODE = 1
>     > );
>     >
>     >
>     >
>     >
>     > However, I have 1 main db to 2 replicated db. The second replicated db has
>     > the following cluster name and node information:
>     >
>     > cluster name = slony_rep2
>     >
>     > node 1 admin conninfo = 'dbname = MyDB host = localhost user = slony2
>     > password = Ejhfg33EdddsufhErR76 port = 6234';
>     > node 2 admin conninfo = 'dbname = MyDB host = 86.88.5.17 user = slony2
>     > password = Ejhfg33EdddsufhErR76 port = 6234';
>
>     Shouldn't that be node 3 not node 2?
>
>     > Do I need to run slonik twice with different cluster and node indo? That
>     > does not seem right. After running the first time, the main db and the first
>     > replicated db will be consistent but not the second replicated db. Also, if
>     > I run it a second time, wouldn't the main db already be updated hence the
>     > sql statements used for the original update will surely fail?
>
>     You can just run it on all three at once.
>
>     node 1 admin conninfo = 'dbname = MyDB host = localhost user = slony1
>     password = Ejhfg33EdddsufhErR76 port = 6234';
>     node 2 admin conninfo = 'dbname = MyDB host = 86.88.5.4 user = slony1
>     password = Ejhfg33EdddsufhErR76 port = 6234';
>     node 3 admin conninfo = 'dbname = MyDB host = 86.88.5.17 user = slony2
>     password = Ejhfg33EdddsufhErR76 port = 6234';
>
>     EXECUTE SCRIPT
>     (
>          SQL = 'ALTER TABLE operators RENAME COLUMN firstname TO lastname;',
>          EVENT NODE = 1
>     );
>
>
>
>
> _______________________________________________
> Slony1-general mailing list
> Slony1-general at lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
>


-- 
Jan Wieck
Senior Software Engineer
http://slony.info

From sungh.lei at gmail.com  Thu Nov  5 20:04:39 2015
From: sungh.lei at gmail.com (Sung Hsin Lei)
Date: Thu, 5 Nov 2015 23:04:39 -0500
Subject: [Slony1-general] Slony Replication Startup Speed
In-Reply-To: <5638BBA7.1030204@wi3ck.info>
References: <CAHD_kvnWruCyJsX_=xFHMiWkvxahY1U0wLtKpRonCLAHBAUQag@mail.gmail.com>
	<CAOR=d=01EHSAEm80iFyQBbqzFkHrf8e6WZnVOhS9yZnL7ER27g@mail.gmail.com>
	<CAHD_kvkNTx7zm2fmiJGYO96x9OT21kcsLa7JM=vmj6ekzn5+hw@mail.gmail.com>
	<CAOR=d=3m8HwyzDLdpwq9d6Ptfc8A_-BVUB5PeZECFAkcFwJAWg@mail.gmail.com>
	<CAHD_kvk+C-HAgAY+KmqNUPWs4TsH4gOFS14-Mg-BVam0+ticOA@mail.gmail.com>
	<CAOR=d=3zx_vBDQoE3yNdcNvnnSWdBC75UyMgE9hDrdD=_p6Tzw@mail.gmail.com>
	<CAHD_kvm=hUgL6d86zeQ_zuNLSV58f=bCkZccv+FgdRJ+TzGSOA@mail.gmail.com>
	<5638BBA7.1030204@wi3ck.info>
Message-ID: <CAHD_kvnFAnM4=DasvHxHDVGLBLYwMB+8hp1UsoqqsYVkYs69ig@mail.gmail.com>

No reason besides we were new to slony and had no idea what we were doing
at the beginning and now it will be a hassle to change for everyone that
has this.

On Tue, Nov 3, 2015 at 8:50 AM, Jan Wieck <jan at wi3ck.info> wrote:

> On 10/29/2015 09:49 PM, Sung Hsin Lei wrote:
>
>> Actually, node 2 is correct. I have 2 different clusters. Each cluster
>> has node 1 and node 2. Each cluster replicates to 1 db.
>>
>
> What is the reason for this setup? If the two slaves are subscribed to
> different sets of tables, then the same can be achieved by creating
> multiple sets and subscribing the slaves to individual combinations of them.
>
>
> Regards, Jan
>
>
>
>> On Thu, Oct 29, 2015 at 8:39 PM, Scott Marlowe <scott.marlowe at gmail.com
>> <mailto:scott.marlowe at gmail.com>> wrote:
>>
>>     On Thu, Oct 29, 2015 at 6:06 PM, Sung Hsin Lei <sungh.lei at gmail.com
>>     <mailto:sungh.lei at gmail.com>> wrote:
>>     > Hello,
>>     >
>>     > I successfully update the main db and one replicated db with the
>> following:
>>     >
>>     > cluster name = slony_rep1
>>     >
>>     > node 1 admin conninfo = 'dbname = MyDB host = localhost user =
>> slony1
>>     > password = Ejhfg33EdddsufhErR76 port = 6234';
>>     > node 2 admin conninfo = 'dbname = MyDB host = 86.88.5.4 user =
>> slony1
>>     > password = Ejhfg33EdddsufhErR76 port = 6234';
>>     >
>>     > EXECUTE SCRIPT
>>     > (
>>     >     SQL = 'ALTER TABLE operators RENAME COLUMN firstname TO
>> lastname;',
>>     >     EVENT NODE = 1
>>     > );
>>     >
>>     >
>>     >
>>     >
>>     > However, I have 1 main db to 2 replicated db. The second replicated
>> db has
>>     > the following cluster name and node information:
>>     >
>>     > cluster name = slony_rep2
>>     >
>>     > node 1 admin conninfo = 'dbname = MyDB host = localhost user =
>> slony2
>>     > password = Ejhfg33EdddsufhErR76 port = 6234';
>>     > node 2 admin conninfo = 'dbname = MyDB host = 86.88.5.17 user =
>> slony2
>>     > password = Ejhfg33EdddsufhErR76 port = 6234';
>>
>>     Shouldn't that be node 3 not node 2?
>>
>>     > Do I need to run slonik twice with different cluster and node indo?
>> That
>>     > does not seem right. After running the first time, the main db and
>> the first
>>     > replicated db will be consistent but not the second replicated db.
>> Also, if
>>     > I run it a second time, wouldn't the main db already be updated
>> hence the
>>     > sql statements used for the original update will surely fail?
>>
>>     You can just run it on all three at once.
>>
>>     node 1 admin conninfo = 'dbname = MyDB host = localhost user = slony1
>>     password = Ejhfg33EdddsufhErR76 port = 6234';
>>     node 2 admin conninfo = 'dbname = MyDB host = 86.88.5.4 user = slony1
>>     password = Ejhfg33EdddsufhErR76 port = 6234';
>>     node 3 admin conninfo = 'dbname = MyDB host = 86.88.5.17 user = slony2
>>     password = Ejhfg33EdddsufhErR76 port = 6234';
>>
>>     EXECUTE SCRIPT
>>     (
>>          SQL = 'ALTER TABLE operators RENAME COLUMN firstname TO
>> lastname;',
>>          EVENT NODE = 1
>>     );
>>
>>
>>
>>
>> _______________________________________________
>> Slony1-general mailing list
>> Slony1-general at lists.slony.info
>> http://lists.slony.info/mailman/listinfo/slony1-general
>>
>>
>
> --
> Jan Wieck
> Senior Software Engineer
> http://slony.info
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20151105/1e9c0216/attachment.htm 

From ssinger at ca.afilias.info  Mon Nov  9 13:12:57 2015
From: ssinger at ca.afilias.info (Steve Singer)
Date: Mon, 09 Nov 2015 16:12:57 -0500
Subject: [Slony1-general] adding a replication node instructions update?
In-Reply-To: <CAJKUy5jr=Ua-deX=DQGL4ZkEQk-q3P6u=B2Qp5F3E2tuccf+yA@mail.gmail.com>
References: <87d1wltbwv.fsf@alice.fifthhorseman.net>
	<CAJKUy5jr=Ua-deX=DQGL4ZkEQk-q3P6u=B2Qp5F3E2tuccf+yA@mail.gmail.com>
Message-ID: <56410C59.8090105@ca.afilias.info>

On 10/29/2015 03:58 PM, Jaime Casanova wrote:
\
>> namespace into the new replication database.  This causes the subsequent
>> STORE NODE command to fail with a complaint that the _$CLUSTER_NAME
>> schema is already present.
>>
>> I think if you add -N _$CLUSTERNAME to the pg_dump side of the pipeline,
>> then the rest of the directions should complete OK.
>>
>> Is this a bug in the documentation, or have i misunderstood something?
>>
>
> looks like a bug in documentation, yes
>

I've committed a change to the documentation to include a 
--exclude-schema on the pg_dump command in that sample


From jan at wi3ck.info  Mon Nov  9 14:23:16 2015
From: jan at wi3ck.info (Jan Wieck)
Date: Mon, 9 Nov 2015 17:23:16 -0500
Subject: [Slony1-general] Slony Replication Startup Speed
In-Reply-To: <CAHD_kvnFAnM4=DasvHxHDVGLBLYwMB+8hp1UsoqqsYVkYs69ig@mail.gmail.com>
References: <CAHD_kvnWruCyJsX_=xFHMiWkvxahY1U0wLtKpRonCLAHBAUQag@mail.gmail.com>
	<CAOR=d=01EHSAEm80iFyQBbqzFkHrf8e6WZnVOhS9yZnL7ER27g@mail.gmail.com>
	<CAHD_kvkNTx7zm2fmiJGYO96x9OT21kcsLa7JM=vmj6ekzn5+hw@mail.gmail.com>
	<CAOR=d=3m8HwyzDLdpwq9d6Ptfc8A_-BVUB5PeZECFAkcFwJAWg@mail.gmail.com>
	<CAHD_kvk+C-HAgAY+KmqNUPWs4TsH4gOFS14-Mg-BVam0+ticOA@mail.gmail.com>
	<CAOR=d=3zx_vBDQoE3yNdcNvnnSWdBC75UyMgE9hDrdD=_p6Tzw@mail.gmail.com>
	<CAHD_kvm=hUgL6d86zeQ_zuNLSV58f=bCkZccv+FgdRJ+TzGSOA@mail.gmail.com>
	<5638BBA7.1030204@wi3ck.info>
	<CAHD_kvnFAnM4=DasvHxHDVGLBLYwMB+8hp1UsoqqsYVkYs69ig@mail.gmail.com>
Message-ID: <56411CD4.2020404@wi3ck.info>

On 11/05/2015 11:04 PM, Sung Hsin Lei wrote:
> No reason besides we were new to slony and had no idea what we were
> doing at the beginning and now it will be a hassle to change for
> everyone that has this.

The hassle right now seems to be that you can submit the EXECUTE SCRIPT 
only to one of the two clusters. With this setup it is impossible to do 
it for both.

So you can either deal with the hassle of changing the setup to a single 
cluster with multiple subscriber (slave) nodes, or figure out a way to 
do the schema changes without using EXECUTE SCRIPT. Pick your lesser hassle.


Regards, Jan


>
> On Tue, Nov 3, 2015 at 8:50 AM, Jan Wieck <jan at wi3ck.info
> <mailto:jan at wi3ck.info>> wrote:
>
>     On 10/29/2015 09:49 PM, Sung Hsin Lei wrote:
>
>         Actually, node 2 is correct. I have 2 different clusters. Each
>         cluster
>         has node 1 and node 2. Each cluster replicates to 1 db.
>
>
>     What is the reason for this setup? If the two slaves are subscribed
>     to different sets of tables, then the same can be achieved by
>     creating multiple sets and subscribing the slaves to individual
>     combinations of them.
>
>
>     Regards, Jan
>
>
>
>         On Thu, Oct 29, 2015 at 8:39 PM, Scott Marlowe
>         <scott.marlowe at gmail.com <mailto:scott.marlowe at gmail.com>
>         <mailto:scott.marlowe at gmail.com
>         <mailto:scott.marlowe at gmail.com>>> wrote:
>
>              On Thu, Oct 29, 2015 at 6:06 PM, Sung Hsin Lei
>         <sungh.lei at gmail.com <mailto:sungh.lei at gmail.com>
>              <mailto:sungh.lei at gmail.com <mailto:sungh.lei at gmail.com>>>
>         wrote:
>              > Hello,
>              >
>              > I successfully update the main db and one replicated db
>         with the following:
>              >
>              > cluster name = slony_rep1
>              >
>              > node 1 admin conninfo = 'dbname = MyDB host = localhost
>         user = slony1
>              > password = Ejhfg33EdddsufhErR76 port = 6234';
>              > node 2 admin conninfo = 'dbname = MyDB host = 86.88.5.4
>         user = slony1
>              > password = Ejhfg33EdddsufhErR76 port = 6234';
>              >
>              > EXECUTE SCRIPT
>              > (
>              >     SQL = 'ALTER TABLE operators RENAME COLUMN firstname
>         TO lastname;',
>              >     EVENT NODE = 1
>              > );
>              >
>              >
>              >
>              >
>              > However, I have 1 main db to 2 replicated db. The second
>         replicated db has
>              > the following cluster name and node information:
>              >
>              > cluster name = slony_rep2
>              >
>              > node 1 admin conninfo = 'dbname = MyDB host = localhost
>         user = slony2
>              > password = Ejhfg33EdddsufhErR76 port = 6234';
>              > node 2 admin conninfo = 'dbname = MyDB host = 86.88.5.17
>         user = slony2
>              > password = Ejhfg33EdddsufhErR76 port = 6234';
>
>              Shouldn't that be node 3 not node 2?
>
>              > Do I need to run slonik twice with different cluster and
>         node indo? That
>              > does not seem right. After running the first time, the
>         main db and the first
>              > replicated db will be consistent but not the second
>         replicated db. Also, if
>              > I run it a second time, wouldn't the main db already be
>         updated hence the
>              > sql statements used for the original update will surely fail?
>
>              You can just run it on all three at once.
>
>              node 1 admin conninfo = 'dbname = MyDB host = localhost
>         user = slony1
>              password = Ejhfg33EdddsufhErR76 port = 6234';
>              node 2 admin conninfo = 'dbname = MyDB host = 86.88.5.4
>         user = slony1
>              password = Ejhfg33EdddsufhErR76 port = 6234';
>              node 3 admin conninfo = 'dbname = MyDB host = 86.88.5.17
>         user = slony2
>              password = Ejhfg33EdddsufhErR76 port = 6234';
>
>              EXECUTE SCRIPT
>              (
>                   SQL = 'ALTER TABLE operators RENAME COLUMN firstname
>         TO lastname;',
>                   EVENT NODE = 1
>              );
>
>
>
>
>         _______________________________________________
>         Slony1-general mailing list
>         Slony1-general at lists.slony.info
>         <mailto:Slony1-general at lists.slony.info>
>         http://lists.slony.info/mailman/listinfo/slony1-general
>
>
>
>     --
>     Jan Wieck
>     Senior Software Engineer
>     http://slony.info
>
>


-- 
Jan Wieck
Senior Software Engineer
http://slony.info

From ludovic.toinel at capgemini.com  Tue Nov 10 01:51:29 2015
From: ludovic.toinel at capgemini.com (TOINEL, Ludovic)
Date: Tue, 10 Nov 2015 09:51:29 +0000
Subject: [Slony1-general] Network connection from slaves to the master
Message-ID: <6DE56644D894504CB303B3830CEEB36126B96E95@DE-CM-MBX06.corp.capgemini.com>

Hi,

I would like to use Slony without any network connection from the slaves to the master.
The network allows only flows from master to slaves.

Is there any option that I missed to do that ?

Thank-you in advance.

Regards,

Ludovic Toinel
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20151110/e0842f24/attachment.htm 

From ajs at crankycanuck.ca  Tue Nov 10 03:26:05 2015
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Tue, 10 Nov 2015 06:26:05 -0500
Subject: [Slony1-general] Network connection from slaves to the master
In-Reply-To: <6DE56644D894504CB303B3830CEEB36126B96E95@DE-CM-MBX06.corp.capgemini.com>
References: <6DE56644D894504CB303B3830CEEB36126B96E95@DE-CM-MBX06.corp.capgemini.com>
Message-ID: <20151110112605.GA18808@crankycanuck.ca>

On Tue, Nov 10, 2015 at 09:51:29AM +0000, TOINEL, Ludovic wrote:
> The network allows only flows from master to slaves.
> 
> Is there any option that I missed to do that ?

Not really.  In principle you could do this with the log shipping
mode, but I don't recall whether doing that on the master was not
possible or just a really bad idea.  (You could do this with the
built-in standby mechanisms of Postgres, though.

I do wonder why you have it set up this way, however.  Why do you
control the flows this way?

A

-- 
Andrew Sullivan
ajs at crankycanuck.ca

From ludovic.toinel at capgemini.com  Tue Nov 10 05:03:07 2015
From: ludovic.toinel at capgemini.com (TOINEL, Ludovic)
Date: Tue, 10 Nov 2015 13:03:07 +0000
Subject: [Slony1-general] Network connection from slaves to the master
In-Reply-To: <20151110112605.GA18808@crankycanuck.ca>
References: <6DE56644D894504CB303B3830CEEB36126B96E95@DE-CM-MBX06.corp.capgemini.com>
	<20151110112605.GA18808@crankycanuck.ca>
Message-ID: <6DE56644D894504CB303B3830CEEB36126B971E6@DE-CM-MBX06.corp.capgemini.com>

Thanks Andrew,

We are not allowed to have network connection from the slaves to the master (for security constraints). Only master can communicate with slaves.
We need database on slaves with mix replicates tables and read/write tables.

The solution could be maybe that solution using a slony master has an Hot standby of a master protected somewhere ? 

[slony slaves] <-----> [slony master - Standby node] <----(log shipping)--|firewall|-- [master protected somewhere]

Do you think this solution can work with slony ?

Regards,

Ludovic Toinel

-----Message d'origine-----
De?: slony1-general-bounces at lists.slony.info [mailto:slony1-general-bounces at lists.slony.info] De la part de Andrew Sullivan
Envoy??: mardi 10 novembre 2015 12:26
??: slony1-general at lists.slony.info
Objet?: Re: [Slony1-general] Network connection from slaves to the master

On Tue, Nov 10, 2015 at 09:51:29AM +0000, TOINEL, Ludovic wrote:
> The network allows only flows from master to slaves.
> 
> Is there any option that I missed to do that ?

Not really.  In principle you could do this with the log shipping mode, but I don't recall whether doing that on the master was not possible or just a really bad idea.  (You could do this with the built-in standby mechanisms of Postgres, though.

I do wonder why you have it set up this way, however.  Why do you control the flows this way?

A

--
Andrew Sullivan
ajs at crankycanuck.ca
_______________________________________________
Slony1-general mailing list
Slony1-general at lists.slony.info
http://lists.slony.info/mailman/listinfo/slony1-general

From guillaume at lelarge.info  Tue Nov 10 05:16:57 2015
From: guillaume at lelarge.info (Guillaume Lelarge)
Date: Tue, 10 Nov 2015 14:16:57 +0100
Subject: [Slony1-general] Network connection from slaves to the master
In-Reply-To: <6DE56644D894504CB303B3830CEEB36126B971E6@DE-CM-MBX06.corp.capgemini.com>
References: <6DE56644D894504CB303B3830CEEB36126B96E95@DE-CM-MBX06.corp.capgemini.com>
	<20151110112605.GA18808@crankycanuck.ca>
	<6DE56644D894504CB303B3830CEEB36126B971E6@DE-CM-MBX06.corp.capgemini.com>
Message-ID: <CAECtzeWStSQoai40QOQoqgPwRLM1x1aKjWzzJ2AUFxQs1Y0t8Q@mail.gmail.com>

Le 10 nov. 2015 2:03 PM, "TOINEL, Ludovic" <ludovic.toinel at capgemini.com> a
?crit :
>
> Thanks Andrew,
>
> We are not allowed to have network connection from the slaves to the
master (for security constraints). Only master can communicate with slaves.
> We need database on slaves with mix replicates tables and read/write
tables.
>
> The solution could be maybe that solution using a slony master has an Hot
standby of a master protected somewhere ?
>
> [slony slaves] <-----> [slony master - Standby node] <----(log
shipping)--|firewall|-- [master protected somewhere]
>
> Do you think this solution can work with slony ?
>

This will work as long as you don't try to execute write queries on the
slony master, because it's a standby node and, as such, can only execute
read queries. Meaning I'm wondering why you would use such a scheme.

> Regards,
>
> Ludovic Toinel
>
> -----Message d'origine-----
> De : slony1-general-bounces at lists.slony.info [mailto:
slony1-general-bounces at lists.slony.info] De la part de Andrew Sullivan
> Envoy? : mardi 10 novembre 2015 12:26
> ? : slony1-general at lists.slony.info
> Objet : Re: [Slony1-general] Network connection from slaves to the master
>
> On Tue, Nov 10, 2015 at 09:51:29AM +0000, TOINEL, Ludovic wrote:
> > The network allows only flows from master to slaves.
> >
> > Is there any option that I missed to do that ?
>
> Not really.  In principle you could do this with the log shipping mode,
but I don't recall whether doing that on the master was not possible or
just a really bad idea.  (You could do this with the built-in standby
mechanisms of Postgres, though.
>
> I do wonder why you have it set up this way, however.  Why do you control
the flows this way?
>
> A
>
> --
> Andrew Sullivan
> ajs at crankycanuck.ca
> _______________________________________________
> Slony1-general mailing list
> Slony1-general at lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
> _______________________________________________
> Slony1-general mailing list
> Slony1-general at lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20151110/cc897fac/attachment-0001.htm 

From ludovic.toinel at capgemini.com  Tue Nov 10 05:43:07 2015
From: ludovic.toinel at capgemini.com (TOINEL, Ludovic)
Date: Tue, 10 Nov 2015 13:43:07 +0000
Subject: [Slony1-general] Network connection from slaves to the master
In-Reply-To: <CAECtzeWStSQoai40QOQoqgPwRLM1x1aKjWzzJ2AUFxQs1Y0t8Q@mail.gmail.com>
References: <6DE56644D894504CB303B3830CEEB36126B96E95@DE-CM-MBX06.corp.capgemini.com>
	<20151110112605.GA18808@crankycanuck.ca>
	<6DE56644D894504CB303B3830CEEB36126B971E6@DE-CM-MBX06.corp.capgemini.com>
	<CAECtzeWStSQoai40QOQoqgPwRLM1x1aKjWzzJ2AUFxQs1Y0t8Q@mail.gmail.com>
Message-ID: <6DE56644D894504CB303B3830CEEB36126B9760A@DE-CM-MBX06.corp.capgemini.com>

I?m trying to find the best way to separate the master from the slaves for security requirements.

In terms of network, I?m not allow to get connection from slaves to master.
In terms of database, I use per table granularity replication.

Any other idea ?

De : Guillaume Lelarge [mailto:guillaume at lelarge.info]
Envoy? : mardi 10 novembre 2015 14:17
? : TOINEL, Ludovic
Cc : slony1-general at lists.slony.info; Andrew Sullivan
Objet : Re: [Slony1-general] Network connection from slaves to the master


Le 10 nov. 2015 2:03 PM, "TOINEL, Ludovic" <ludovic.toinel at capgemini.com<mailto:ludovic.toinel at capgemini.com>> a ?crit :
>
> Thanks Andrew,
>
> We are not allowed to have network connection from the slaves to the master (for security constraints). Only master can communicate with slaves.
> We need database on slaves with mix replicates tables and read/write tables.
>
> The solution could be maybe that solution using a slony master has an Hot standby of a master protected somewhere ?
>
> [slony slaves] <-----> [slony master - Standby node] <----(log shipping)--|firewall|-- [master protected somewhere]
>
> Do you think this solution can work with slony ?
>

This will work as long as you don't try to execute write queries on the slony master, because it's a standby node and, as such, can only execute read queries. Meaning I'm wondering why you would use such a scheme.

> Regards,
>
> Ludovic Toinel
>
> -----Message d'origine-----
> De : slony1-general-bounces at lists.slony.info<mailto:slony1-general-bounces at lists.slony.info> [mailto:slony1-general-bounces at lists.slony.info<mailto:slony1-general-bounces at lists.slony.info>] De la part de Andrew Sullivan
> Envoy? : mardi 10 novembre 2015 12:26
> ? : slony1-general at lists.slony.info<mailto:slony1-general at lists.slony.info>
> Objet : Re: [Slony1-general] Network connection from slaves to the master
>
> On Tue, Nov 10, 2015 at 09:51:29AM +0000, TOINEL, Ludovic wrote:
> > The network allows only flows from master to slaves.
> >
> > Is there any option that I missed to do that ?
>
> Not really.  In principle you could do this with the log shipping mode, but I don't recall whether doing that on the master was not possible or just a really bad idea.  (You could do this with the built-in standby mechanisms of Postgres, though.
>
> I do wonder why you have it set up this way, however.  Why do you control the flows this way?
>
> A
>
> --
> Andrew Sullivan
> ajs at crankycanuck.ca<mailto:ajs at crankycanuck.ca>
> _______________________________________________
> Slony1-general mailing list
> Slony1-general at lists.slony.info<mailto:Slony1-general at lists.slony.info>
> http://lists.slony.info/mailman/listinfo/slony1-general
> _______________________________________________
> Slony1-general mailing list
> Slony1-general at lists.slony.info<mailto:Slony1-general at lists.slony.info>
> http://lists.slony.info/mailman/listinfo/slony1-general
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20151110/8a080143/attachment.htm 

From stephane.schildknecht at postgres.fr  Tue Nov 10 05:45:17 2015
From: stephane.schildknecht at postgres.fr (=?UTF-8?B?U3TDqXBoYW5lIFNjaGlsZGtuZWNodA==?=)
Date: Tue, 10 Nov 2015 14:45:17 +0100
Subject: [Slony1-general] Network connection from slaves to the master
In-Reply-To: <6DE56644D894504CB303B3830CEEB36126B971E6@DE-CM-MBX06.corp.capgemini.com>
References: <6DE56644D894504CB303B3830CEEB36126B96E95@DE-CM-MBX06.corp.capgemini.com>	<20151110112605.GA18808@crankycanuck.ca>
	<6DE56644D894504CB303B3830CEEB36126B971E6@DE-CM-MBX06.corp.capgemini.com>
Message-ID: <5641F4ED.3010909@postgres.fr>

On 10/11/2015 14:03, TOINEL, Ludovic wrote:
> Thanks Andrew,
> 
> We are not allowed to have network connection from the slaves to the master (for security constraints).

You really should think about a VPN between nodes. It would simplify your
architecture.

But, in theory, subscriber nodes could be on a DMZ. They can be accessed by
daemons, but you don't need them to access providers.
Your daemons would run on a node that can access every other node.


BTW, there are no real master and slaves in Slony. There are nodes, which can
be subscribers (receiving modifications readonly), and providers (read/write).
And you can have a subscriber of a set that is provider of another.

 Only master can communicate with slaves.
> We need database on slaves with mix replicates tables and read/write tables.
> 
> The solution could be maybe that solution using a slony master has an Hot standby of a master protected somewhere ? 
> 
> [slony slaves] <-----> [slony master - Standby node] <----(log shipping)--|firewall|-- [master protected somewhere]
> 
> Do you think this solution can work with slony ?
> 
> Regards,
> 
> Ludovic Toinel
> 
> -----Message d'origine-----
> De : slony1-general-bounces at lists.slony.info [mailto:slony1-general-bounces at lists.slony.info] De la part de Andrew Sullivan
> Envoy? : mardi 10 novembre 2015 12:26
> ? : slony1-general at lists.slony.info
> Objet : Re: [Slony1-general] Network connection from slaves to the master
> 
> On Tue, Nov 10, 2015 at 09:51:29AM +0000, TOINEL, Ludovic wrote:
>> The network allows only flows from master to slaves.
>>
>> Is there any option that I missed to do that ?
> 
> Not really.  In principle you could do this with the log shipping mode, but I don't recall whether doing that on the master was not possible or just a really bad idea.  (You could do this with the built-in standby mechanisms of Postgres, though.
> 
> I do wonder why you have it set up this way, however.  Why do you control the flows this way?
> 
> A
> 
> --
> Andrew Sullivan
> ajs at crankycanuck.ca


-- 
St?phane Schildknecht
Contact r?gional PostgreSQL pour l'Europe francophone
Loxodata - Conseil, expertise et formations
06.17.11.37.42

From ludovic.toinel at capgemini.com  Tue Nov 10 05:49:52 2015
From: ludovic.toinel at capgemini.com (TOINEL, Ludovic)
Date: Tue, 10 Nov 2015 13:49:52 +0000
Subject: [Slony1-general] Network connection from slaves to the master
In-Reply-To: <5641F4ED.3010909@postgres.fr>
References: <6DE56644D894504CB303B3830CEEB36126B96E95@DE-CM-MBX06.corp.capgemini.com>
	<20151110112605.GA18808@crankycanuck.ca>
	<6DE56644D894504CB303B3830CEEB36126B971E6@DE-CM-MBX06.corp.capgemini.com>
	<5641F4ED.3010909@postgres.fr>
Message-ID: <6DE56644D894504CB303B3830CEEB36126B976E7@DE-CM-MBX06.corp.capgemini.com>

Is there a way to have subscribers with no direct SQL access to the provider ? 

The provider write the data on the subscribers directly.

-----Message d'origine-----
De?: slony1-general-bounces at lists.slony.info [mailto:slony1-general-bounces at lists.slony.info] De la part de St?phane Schildknecht
Envoy??: mardi 10 novembre 2015 14:45
??: slony1-general at lists.slony.info
Objet?: Re: [Slony1-general] Network connection from slaves to the master

On 10/11/2015 14:03, TOINEL, Ludovic wrote:
> Thanks Andrew,
> 
> We are not allowed to have network connection from the slaves to the master (for security constraints).

You really should think about a VPN between nodes. It would simplify your architecture.

But, in theory, subscriber nodes could be on a DMZ. They can be accessed by daemons, but you don't need them to access providers.
Your daemons would run on a node that can access every other node.


BTW, there are no real master and slaves in Slony. There are nodes, which can be subscribers (receiving modifications readonly), and providers (read/write).
And you can have a subscriber of a set that is provider of another.

 Only master can communicate with slaves.
> We need database on slaves with mix replicates tables and read/write tables.
> 
> The solution could be maybe that solution using a slony master has an Hot standby of a master protected somewhere ? 
> 
> [slony slaves] <-----> [slony master - Standby node] <----(log 
> shipping)--|firewall|-- [master protected somewhere]
> 
> Do you think this solution can work with slony ?
> 
> Regards,
> 
> Ludovic Toinel
> 
> -----Message d'origine-----
> De : slony1-general-bounces at lists.slony.info 
> [mailto:slony1-general-bounces at lists.slony.info] De la part de Andrew 
> Sullivan Envoy? : mardi 10 novembre 2015 12:26 ? : 
> slony1-general at lists.slony.info Objet : Re: [Slony1-general] Network 
> connection from slaves to the master
> 
> On Tue, Nov 10, 2015 at 09:51:29AM +0000, TOINEL, Ludovic wrote:
>> The network allows only flows from master to slaves.
>>
>> Is there any option that I missed to do that ?
> 
> Not really.  In principle you could do this with the log shipping mode, but I don't recall whether doing that on the master was not possible or just a really bad idea.  (You could do this with the built-in standby mechanisms of Postgres, though.
> 
> I do wonder why you have it set up this way, however.  Why do you control the flows this way?
> 
> A
> 
> --
> Andrew Sullivan
> ajs at crankycanuck.ca


--
St?phane Schildknecht
Contact r?gional PostgreSQL pour l'Europe francophone Loxodata - Conseil, expertise et formations
06.17.11.37.42
_______________________________________________
Slony1-general mailing list
Slony1-general at lists.slony.info
http://lists.slony.info/mailman/listinfo/slony1-general

From stephane.schildknecht at postgres.fr  Tue Nov 10 06:23:35 2015
From: stephane.schildknecht at postgres.fr (=?UTF-8?B?U3TDqXBoYW5lIFNjaGlsZGtuZWNodA==?=)
Date: Tue, 10 Nov 2015 15:23:35 +0100
Subject: [Slony1-general] Network connection from slaves to the master
In-Reply-To: <6DE56644D894504CB303B3830CEEB36126B976E7@DE-CM-MBX06.corp.capgemini.com>
References: <6DE56644D894504CB303B3830CEEB36126B96E95@DE-CM-MBX06.corp.capgemini.com>	<20151110112605.GA18808@crankycanuck.ca>	<6DE56644D894504CB303B3830CEEB36126B971E6@DE-CM-MBX06.corp.capgemini.com>
	<5641F4ED.3010909@postgres.fr>
	<6DE56644D894504CB303B3830CEEB36126B976E7@DE-CM-MBX06.corp.capgemini.com>
Message-ID: <5641FDE7.5010603@postgres.fr>

On 10/11/2015 14:49, TOINEL, Ludovic wrote:
> Is there a way to have subscribers with no direct SQL access to the provider ? 
> 
> The provider write the data on the subscribers directly.

(Top-posting makes it really hard to follow discussions in a thread.)

Your slon daemons need to run on a node that can see everyone.

So, for instance, you can have them on node A which is provider for SET 1 and
2, but subscriber of SET 3 from node B.
And you can't psql from NodeB to NodeA.


Should work.

(The provider logs modification on a log table, which is read by daemons. And
propagated to other nodes.)

> 
> -----Message d'origine-----
> De : slony1-general-bounces at lists.slony.info [mailto:slony1-general-bounces at lists.slony.info] De la part de St?phane Schildknecht
> Envoy? : mardi 10 novembre 2015 14:45
> ? : slony1-general at lists.slony.info
> Objet : Re: [Slony1-general] Network connection from slaves to the master
> 
> On 10/11/2015 14:03, TOINEL, Ludovic wrote:
>> Thanks Andrew,
>>
>> We are not allowed to have network connection from the slaves to the master (for security constraints).
> 
> You really should think about a VPN between nodes. It would simplify your architecture.
> 
> But, in theory, subscriber nodes could be on a DMZ. They can be accessed by daemons, but you don't need them to access providers.
> Your daemons would run on a node that can access every other node.
> 
> 
> BTW, there are no real master and slaves in Slony. There are nodes, which can be subscribers (receiving modifications readonly), and providers (read/write).
> And you can have a subscriber of a set that is provider of another.
> 
>  Only master can communicate with slaves.
>> We need database on slaves with mix replicates tables and read/write tables.
>>
>> The solution could be maybe that solution using a slony master has an Hot standby of a master protected somewhere ? 
>>
>> [slony slaves] <-----> [slony master - Standby node] <----(log 
>> shipping)--|firewall|-- [master protected somewhere]
>>
>> Do you think this solution can work with slony ?
>>
>> Regards,
>>
>> Ludovic Toinel
>>
>> -----Message d'origine-----
>> De : slony1-general-bounces at lists.slony.info 
>> [mailto:slony1-general-bounces at lists.slony.info] De la part de Andrew 
>> Sullivan Envoy? : mardi 10 novembre 2015 12:26 ? : 
>> slony1-general at lists.slony.info Objet : Re: [Slony1-general] Network 
>> connection from slaves to the master
>>
>> On Tue, Nov 10, 2015 at 09:51:29AM +0000, TOINEL, Ludovic wrote:
>>> The network allows only flows from master to slaves.
>>>
>>> Is there any option that I missed to do that ?
>>
>> Not really.  In principle you could do this with the log shipping mode, but I don't recall whether doing that on the master was not possible or just a really bad idea.  (You could do this with the built-in standby mechanisms of Postgres, though.
>>
>> I do wonder why you have it set up this way, however.  Why do you control the flows this way?
>>
>> A
>>
>> --
>> Andrew Sullivan
>> ajs at crankycanuck.ca
> 
> 
> --
> St?phane Schildknecht
> Contact r?gional PostgreSQL pour l'Europe francophone Loxodata - Conseil, expertise et formations
> 06.17.11.37.42
> _______________________________________________
> Slony1-general mailing list
> Slony1-general at lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
> 


-- 
St?phane Schildknecht
Contact r?gional PostgreSQL pour l'Europe francophone
Loxodata - Conseil, expertise et formations
06.17.11.37.42

From ssinger at ca.afilias.info  Tue Nov 10 06:36:29 2015
From: ssinger at ca.afilias.info (Steve Singer)
Date: Tue, 10 Nov 2015 09:36:29 -0500
Subject: [Slony1-general] Network connection from slaves to the master
In-Reply-To: <6DE56644D894504CB303B3830CEEB36126B976E7@DE-CM-MBX06.corp.capgemini.com>
References: <6DE56644D894504CB303B3830CEEB36126B96E95@DE-CM-MBX06.corp.capgemini.com>	<20151110112605.GA18808@crankycanuck.ca>	<6DE56644D894504CB303B3830CEEB36126B971E6@DE-CM-MBX06.corp.capgemini.com>	<5641F4ED.3010909@postgres.fr>
	<6DE56644D894504CB303B3830CEEB36126B976E7@DE-CM-MBX06.corp.capgemini.com>
Message-ID: <564200ED.4050301@ca.afilias.info>

On 11/10/2015 08:49 AM, TOINEL, Ludovic wrote:
> Is there a way to have subscribers with no direct SQL access to the provider ?
>
> The provider write the data on the subscribers directly.
>

To repeat what Stephane said

The slon daemon doesn't need to run on the same server as the replica 
database.

You can put the slon dameons for both the replicas and the orign on the 
origin node (or some other node that can access all nodes).  That way 
the replica database server doesn't need to open network connections 
anywhere.

The slon for the replica (which you are running on the originr or 
somewhere similar) can connect to both the replica and origin database 
servers.




> -----Message d'origine-----
> De : slony1-general-bounces at lists.slony.info [mailto:slony1-general-bounces at lists.slony.info] De la part de St?phane Schildknecht
> Envoy? : mardi 10 novembre 2015 14:45
> ? : slony1-general at lists.slony.info
> Objet : Re: [Slony1-general] Network connection from slaves to the master
>
> On 10/11/2015 14:03, TOINEL, Ludovic wrote:
>> Thanks Andrew,
>>
>> We are not allowed to have network connection from the slaves to the master (for security constraints).
>
> You really should think about a VPN between nodes. It would simplify your architecture.
>
> But, in theory, subscriber nodes could be on a DMZ. They can be accessed by daemons, but you don't need them to access providers.
> Your daemons would run on a node that can access every other node.
>
>
> BTW, there are no real master and slaves in Slony. There are nodes, which can be subscribers (receiving modifications readonly), and providers (read/write).
> And you can have a subscriber of a set that is provider of another.
>
>   Only master can communicate with slaves.
>> We need database on slaves with mix replicates tables and read/write tables.
>>
>> The solution could be maybe that solution using a slony master has an Hot standby of a master protected somewhere ?
>>
>> [slony slaves] <-----> [slony master - Standby node] <----(log
>> shipping)--|firewall|-- [master protected somewhere]
>>
>> Do you think this solution can work with slony ?
>>
>> Regards,
>>
>> Ludovic Toinel
>>
>> -----Message d'origine-----
>> De : slony1-general-bounces at lists.slony.info
>> [mailto:slony1-general-bounces at lists.slony.info] De la part de Andrew
>> Sullivan Envoy? : mardi 10 novembre 2015 12:26 ? :
>> slony1-general at lists.slony.info Objet : Re: [Slony1-general] Network
>> connection from slaves to the master
>>
>> On Tue, Nov 10, 2015 at 09:51:29AM +0000, TOINEL, Ludovic wrote:
>>> The network allows only flows from master to slaves.
>>>
>>> Is there any option that I missed to do that ?
>>
>> Not really.  In principle you could do this with the log shipping mode, but I don't recall whether doing that on the master was not possible or just a really bad idea.  (You could do this with the built-in standby mechanisms of Postgres, though.
>>
>> I do wonder why you have it set up this way, however.  Why do you control the flows this way?
>>
>> A
>>
>> --
>> Andrew Sullivan
>> ajs at crankycanuck.ca
>
>
> --
> St?phane Schildknecht
> Contact r?gional PostgreSQL pour l'Europe francophone Loxodata - Conseil, expertise et formations
> 06.17.11.37.42
> _______________________________________________
> Slony1-general mailing list
> Slony1-general at lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
> _______________________________________________
> Slony1-general mailing list
> Slony1-general at lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
>


From jan at wi3ck.info  Tue Nov 10 06:36:37 2015
From: jan at wi3ck.info (Jan Wieck)
Date: Tue, 10 Nov 2015 09:36:37 -0500
Subject: [Slony1-general] Network connection from slaves to the master
In-Reply-To: <6DE56644D894504CB303B3830CEEB36126B971E6@DE-CM-MBX06.corp.capgemini.com>
References: <6DE56644D894504CB303B3830CEEB36126B96E95@DE-CM-MBX06.corp.capgemini.com>
	<20151110112605.GA18808@crankycanuck.ca>
	<6DE56644D894504CB303B3830CEEB36126B971E6@DE-CM-MBX06.corp.capgemini.com>
Message-ID: <564200F5.5050004@wi3ck.info>

On 11/10/2015 08:03 AM, TOINEL, Ludovic wrote:
> Thanks Andrew,
>
> We are not allowed to have network connection from the slaves to the master (for security constraints). Only master can communicate with slaves.
> We need database on slaves with mix replicates tables and read/write tables.

I presume that this is a restriction on your routers or gateways and 
that the initiating SYN packet for a new TCP connection cannot come from 
what you envision to be the Slave.

If that is correct, you can run all the slon daemons on what you 
consider the Master. All TCP connections are then initiated from the 
Master. This has little to no effect on how Slony functions.


Regards, Jan


>
> The solution could be maybe that solution using a slony master has an Hot standby of a master protected somewhere ?
>
> [slony slaves] <-----> [slony master - Standby node] <----(log shipping)--|firewall|-- [master protected somewhere]
>
> Do you think this solution can work with slony ?
>
> Regards,
>
> Ludovic Toinel
>
> -----Message d'origine-----
> De : slony1-general-bounces at lists.slony.info [mailto:slony1-general-bounces at lists.slony.info] De la part de Andrew Sullivan
> Envoy? : mardi 10 novembre 2015 12:26
> ? : slony1-general at lists.slony.info
> Objet : Re: [Slony1-general] Network connection from slaves to the master
>
> On Tue, Nov 10, 2015 at 09:51:29AM +0000, TOINEL, Ludovic wrote:
>> The network allows only flows from master to slaves.
>>
>> Is there any option that I missed to do that ?
>
> Not really.  In principle you could do this with the log shipping mode, but I don't recall whether doing that on the master was not possible or just a really bad idea.  (You could do this with the built-in standby mechanisms of Postgres, though.
>
> I do wonder why you have it set up this way, however.  Why do you control the flows this way?
>
> A
>
> --
> Andrew Sullivan
> ajs at crankycanuck.ca
> _______________________________________________
> Slony1-general mailing list
> Slony1-general at lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
> _______________________________________________
> Slony1-general mailing list
> Slony1-general at lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
>


-- 
Jan Wieck
Senior Software Engineer
http://slony.info

From ludovic.toinel at capgemini.com  Tue Nov 10 06:59:29 2015
From: ludovic.toinel at capgemini.com (TOINEL, Ludovic)
Date: Tue, 10 Nov 2015 14:59:29 +0000
Subject: [Slony1-general] Network connection from slaves to the master
In-Reply-To: <564200ED.4050301@ca.afilias.info>
References: <6DE56644D894504CB303B3830CEEB36126B96E95@DE-CM-MBX06.corp.capgemini.com>
	<20151110112605.GA18808@crankycanuck.ca>
	<6DE56644D894504CB303B3830CEEB36126B971E6@DE-CM-MBX06.corp.capgemini.com>
	<5641F4ED.3010909@postgres.fr>
	<6DE56644D894504CB303B3830CEEB36126B976E7@DE-CM-MBX06.corp.capgemini.com>,
	<564200ED.4050301@ca.afilias.info>
Message-ID: <B695AF2A-4703-4375-BDBC-CED9BBE589C8@capgemini.com>

Excellent ! That solution solve my problem. We can deploy the Slony subscriber on the protected zone.

Thank-you for your feedbacks.

Regards,

Ludovic Toinel


> Le 10 nov. 2015 ? 15:36, Steve Singer <ssinger at ca.afilias.info> a ?crit :
> 
>> On 11/10/2015 08:49 AM, TOINEL, Ludovic wrote:
>> Is there a way to have subscribers with no direct SQL access to the provider ?
>> 
>> The provider write the data on the subscribers directly.
> 
> To repeat what Stephane said
> 
> The slon daemon doesn't need to run on the same server as the replica database.
> 
> You can put the slon dameons for both the replicas and the orign on the origin node (or some other node that can access all nodes).  That way the replica database server doesn't need to open network connections anywhere.
> 
> The slon for the replica (which you are running on the originr or somewhere similar) can connect to both the replica and origin database servers.
> 
> 
> 
> 
>> -----Message d'origine-----
>> De : slony1-general-bounces at lists.slony.info [mailto:slony1-general-bounces at lists.slony.info] De la part de St?phane Schildknecht
>> Envoy? : mardi 10 novembre 2015 14:45
>> ? : slony1-general at lists.slony.info
>> Objet : Re: [Slony1-general] Network connection from slaves to the master
>> 
>>> On 10/11/2015 14:03, TOINEL, Ludovic wrote:
>>> Thanks Andrew,
>>> 
>>> We are not allowed to have network connection from the slaves to the master (for security constraints).
>> 
>> You really should think about a VPN between nodes. It would simplify your architecture.
>> 
>> But, in theory, subscriber nodes could be on a DMZ. They can be accessed by daemons, but you don't need them to access providers.
>> Your daemons would run on a node that can access every other node.
>> 
>> 
>> BTW, there are no real master and slaves in Slony. There are nodes, which can be subscribers (receiving modifications readonly), and providers (read/write).
>> And you can have a subscriber of a set that is provider of another.
>> 
>>  Only master can communicate with slaves.
>>> We need database on slaves with mix replicates tables and read/write tables.
>>> 
>>> The solution could be maybe that solution using a slony master has an Hot standby of a master protected somewhere ?
>>> 
>>> [slony slaves] <-----> [slony master - Standby node] <----(log
>>> shipping)--|firewall|-- [master protected somewhere]
>>> 
>>> Do you think this solution can work with slony ?
>>> 
>>> Regards,
>>> 
>>> Ludovic Toinel
>>> 
>>> -----Message d'origine-----
>>> De : slony1-general-bounces at lists.slony.info
>>> [mailto:slony1-general-bounces at lists.slony.info] De la part de Andrew
>>> Sullivan Envoy? : mardi 10 novembre 2015 12:26 ? :
>>> slony1-general at lists.slony.info Objet : Re: [Slony1-general] Network
>>> connection from slaves to the master
>>> 
>>>> On Tue, Nov 10, 2015 at 09:51:29AM +0000, TOINEL, Ludovic wrote:
>>>> The network allows only flows from master to slaves.
>>>> 
>>>> Is there any option that I missed to do that ?
>>> 
>>> Not really.  In principle you could do this with the log shipping mode, but I don't recall whether doing that on the master was not possible or just a really bad idea.  (You could do this with the built-in standby mechanisms of Postgres, though.
>>> 
>>> I do wonder why you have it set up this way, however.  Why do you control the flows this way?
>>> 
>>> A
>>> 
>>> --
>>> Andrew Sullivan
>>> ajs at crankycanuck.ca
>> 
>> 
>> --
>> St?phane Schildknecht
>> Contact r?gional PostgreSQL pour l'Europe francophone Loxodata - Conseil, expertise et formations
>> 06.17.11.37.42
>> _______________________________________________
>> Slony1-general mailing list
>> Slony1-general at lists.slony.info
>> http://lists.slony.info/mailman/listinfo/slony1-general
>> _______________________________________________
>> Slony1-general mailing list
>> Slony1-general at lists.slony.info
>> http://lists.slony.info/mailman/listinfo/slony1-general
> 
This message contains information that may be privileged or confidential and is the property of the Capgemini Group. It is intended only for the person to whom it is addressed. If you are not the intended recipient, you are not authorized to read, print, retain, copy, disseminate, distribute, or use this message or any part thereof. If you receive this message in error, please notify the sender immediately and delete all copies of this message.


From ttignor at akamai.com  Mon Nov 16 05:52:00 2015
From: ttignor at akamai.com (Tignor, Tom)
Date: Mon, 16 Nov 2015 13:52:00 +0000
Subject: [Slony1-general] remote listener serializability
Message-ID: <D26F49AE.41208%ttignor@akamai.com>


Hello slony1 community,
I'm part of a team at Akamai working on a notification service based on postgres. (We call it an Alert Management System.) We're at the point where we need to scale past the single instance DB and so have been working with slony1-2.2.4 (and postgresql-9.1.18) to make that happen. Most tests in the past few months have been great, but in recent tests the reassuring SYNC-event-output-per-two-seconds suddenly disappeared. Throughout the day, it returns for a few minutes (normally less than 5, never 10) and then re-enters limbo. Vigorous debugging ensued, and the problem was proven to be the serializable isolation level set in slon/remote_listen.c. Our recent test environment doesn't have a tremendous write rate (measured in KB/s), but it does have 200-400 clients at any one time, which may be a factor. Below is the stack shown in gdb of the postgres server proc (identified via pg_stat_activity) while slon is in limbo.
What are the thoughts on possible changes to the remote listener isolation level and their impact? I've tested changes using repeatable read instead, and also with serializable but dropping the deferrable option. The latter offers little improvement if any, but the former seems to return us to healthy replication. In searching around, I found Jan W filed Bug 336 last year (link below) which suggests we could relax the isolation level here and elsewhere. If it was helpful, I could verify an agreed solution and submit it back as a patch. (Not really in the slony community yet, just looking at the process now.)
Thanks in advance,

http://www.slony.info/bugzilla/show_bug.cgi?id=336



(gdb) thread apply all bt


Thread 1 (process 13052):

#0  0xffffe430 in __kernel_vsyscall ()

#1  0xf76d2c0f in semop () from /lib32/libc.so.6

#2  0x08275a26 in PGSemaphoreLock (sema=0xf69d6784, interruptOK=1 '\001') at pg_sema.c:424

#3  0x082b52cb in ProcWaitForSignal () at proc.c:1443

#4  0x082bb57a in GetSafeSnapshot (origSnapshot=<optimized out>) at predicate.c:1520

#5  RegisterSerializableTransaction (snapshot=0x88105a0) at predicate.c:1580

#6  0x083b3f35 in GetTransactionSnapshot () at snapmgr.c:138

#7  0x082c460a in exec_simple_query (

    query_string=0xa87d248 "select ev_origin, ev_seqno, ev_timestamp,        ev_snapshot,        \"pg_catalog\".txid_snapshot_xmin(ev_snapshot),        \"pg_catalog\".txid_snapshot_xmax(ev_snapshot),        ev_type,        ev_data1,"...)

    at postgres.c:948

#8  PostgresMain (argc=1, argv=0xa7cd1e0, dbname=0xa7cd1d0 "ams", username=0xa7cd1b8 "ams_slony") at postgres.c:4021

#9  0x08284a58 in BackendRun (port=0xa808118) at postmaster.c:3657

#10 BackendStartup (port=0xa808118) at postmaster.c:3330

#11 ServerLoop () at postmaster.c:1483

#12 0x082854d8 in PostmasterMain (argc=3, argv=0xa7ccb58) at postmaster.c:1144

#13 0x080cb430 in main (argc=3, argv=0xa7ccb58) at main.c:210

(gdb)


Tom    :-)


-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20151116/1908a779/attachment.htm 

From ssinger at ca.afilias.info  Mon Nov 16 10:28:11 2015
From: ssinger at ca.afilias.info (Steve Singer)
Date: Mon, 16 Nov 2015 13:28:11 -0500
Subject: [Slony1-general] remote listener serializability
In-Reply-To: <D26F49AE.41208%ttignor@akamai.com>
References: <D26F49AE.41208%ttignor@akamai.com>
Message-ID: <564A203B.9030806@ca.afilias.info>

On 11/16/2015 08:52 AM, Tignor, Tom wrote:
>
> Hello slony1 community,
> I?m part of a team at Akamai working on a notification service based on
> postgres. (We call it an Alert Management System.) We?re at the point
> where we need to scale past the single instance DB and so have been
> working with slony1-2.2.4 (and postgresql-9.1.18) to make that happen.
> Most tests in the past few months have been great, but in recent tests
> the reassuring SYNC-event-output-per-two-seconds suddenly disappeared.
> Throughout the day, it returns for a few minutes (normally less than 5,
> never 10) and then re-enters limbo. Vigorous debugging ensued, and the
> problem was proven to be the serializable isolation level set in
> slon/remote_listen.c. Our recent test environment doesn?t have a
> tremendous write rate (measured in KB/s), but it does have 200-400
> clients at any one time, which may be a factor. Below is the stack shown
> in gdb of the postgres server proc (identified via pg_stat_activity)
> while slon is in limbo.

> What are the thoughts on possible changes to the remote listener
> isolation level and their impact? I?ve tested changes using repeatable
> read instead, and also with serializable but dropping the deferrable
> option. The latter offers little improvement if any, but the former
> seems to return us to healthy replication. In searching around, I found
> Jan W filed Bug 336 last year (link below) which suggests we could relax
> the isolation level here and elsewhere. If it was helpful, I could
> verify an agreed solution and submit it back as a patch. (Not really in
> the slony community yet, just looking at the process now.)
> Thanks in advance,

The last time we had a change to isolation levels was in response to 
this thread


http://lists.slony.info/pipermail/slony1-general/2011-November/011939.html

Also know as bug #255 (http://www.slony.info/bugzilla/show_bug.cgi?id=255)

I can't recall if anyone figured out if we could reduce the remote 
listener isolation level to read committed - read only or not.

One concern at the back of my mind is if a read only repeatable read 
transactions would result in more pivot conflicts than a read only 
serializable deferrable transaction where the conflicts are with a 
serializable transaction running on the origin by some application 
transaction.






>
> http://www.slony.info/bugzilla/show_bug.cgi?id=336
>
>
> (gdb) thread apply all bt
>
>
> Thread 1 (process 13052):
>
> #0  0xffffe430 in __kernel_vsyscall ()
>
> #1  0xf76d2c0f in semop () from /lib32/libc.so.6
>
> #2  0x08275a26 in PGSemaphoreLock (sema=0xf69d6784, interruptOK=1
> '\001') at pg_sema.c:424
>
> #3  0x082b52cb in ProcWaitForSignal () at proc.c:1443
>
> #4  0x082bb57a in GetSafeSnapshot (origSnapshot=<optimized out>) at
> predicate.c:1520
>
> #5  RegisterSerializableTransaction (snapshot=0x88105a0) at predicate.c:1580
>
> #6  0x083b3f35 in GetTransactionSnapshot () at snapmgr.c:138
>
> #7  0x082c460a in exec_simple_query (
>
>      query_string=0xa87d248 "select ev_origin, ev_seqno, ev_timestamp,
>        ev_snapshot,
> \"pg_catalog\".txid_snapshot_xmin(ev_snapshot),
> \"pg_catalog\".txid_snapshot_xmax(ev_snapshot),        ev_type,
> ev_data1,"...)
>
>      at postgres.c:948
>
> #8  PostgresMain (argc=1, argv=0xa7cd1e0, dbname=0xa7cd1d0 "ams",
> username=0xa7cd1b8 "ams_slony") at postgres.c:4021
>
> #9  0x08284a58 in BackendRun (port=0xa808118) at postmaster.c:3657
>
> #10 BackendStartup (port=0xa808118) at postmaster.c:3330
>
> #11 ServerLoop () at postmaster.c:1483
>
> #12 0x082854d8 in PostmasterMain (argc=3, argv=0xa7ccb58) at
> postmaster.c:1144
>
> #13 0x080cb430 in main (argc=3, argv=0xa7ccb58) at main.c:210
>
> (gdb)
>
>
>
> Tom    :-)
>
>
>
>
> _______________________________________________
> Slony1-general mailing list
> Slony1-general at lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
>


From armand.pirvu at gmail.com  Mon Nov 16 19:32:14 2015
From: armand.pirvu at gmail.com (Armand Pirvu (home))
Date: Mon, 16 Nov 2015 21:32:14 -0600
Subject: [Slony1-general] slony newbie setup trouble
Message-ID: <42B5229E-D607-439E-A90D-5CAFD005F4C0@gmail.com>

Hi

Please pardon the length of this email but I felt it is best to give a global view

I was looking at slonik for a project. 
All the setup info, tutorials etc etc seems to vary

http://raghavt.blogspot.com/2012/07/simple-slony-i-replication-setup.html
and
http://www.linuxjournal.com/article/7834

Just to name two sources of study


So I used two approaches

1 - Passing commands to slonik directly. All ok 
2 - Using the provided perl scripts . Not ok and this is where I would like some tips , guidance

master node: 192.168.5.221
master db: primdb


slave node: 192.168.5.222
slave db: bkdb

I use .pgpass 


/etc/slony1-94/slon_tools.conf

I stripped out all comments to keep things to a minimum


     1	# 
     2	# Author: Christopher Browne
     3	# Copyright 2004-2009 Afilias Canada
     4	# Revised extensively by Steve Simms
     5	
     6	# Keeping the following three lines for backwards compatibility in
     7	# case this gets incorporated into a 1.0.6 release.
     8	#
     9	# TODO: The scripts should check for an environment variable
    10	# containing the location of a configuration file.  That would
    11	# simplify this configuration file and allow Slony-I tools to still work
    12	# in situations where it doesn't exist.
    13	#
    14	if ($ENV{"SLONYNODES"}) {
    15	    require $ENV{"SLONYNODES"};
    16	} else {
    17	
    21	    $CLUSTER_NAME = 'armandpc';
    26	    $PIDFILE_DIR = '/var/run/slony1';
    36	    $LOGDIR = '/var/log/slony1-94';
    53	    $MASTERNODE = 1;
    56	    $DEBUGLEVEL = 2;
    63	    $SLEEP_TIME = 60;
    64	
    65	    # Watchdog version to use 1 or 2 (default 1)
    66	    # $WATCHDOG_VERSION = 1;
    67	    # Be verbose (default 1)
    68	    $WATCHDOG_VERBOSE = 0;
    75	    add_node(node     => 1,
    76		     host     => '192.168.5.221',
    77		     dbname   => 'primdb',
    78		     port     => 5432,
    79		     user     => 'postgres',
    80	             password => '',
    81	             config   => '/etc/slony1-94/slon_tools.conf');
    83	    add_node(node     => 2,
    84		     host     => '192.168.5.222',
    85		     dbname   => 'bkdb',
    86		     port     => 5432,
    87		     user     => 'postgres',
    88	             password => '',
    89	             config   => '/etc/slony1-94/slon_tools.conf');
    91	}
    96	$SLONY_SETS = {
    98	    # A unique name for the set
    99	    "set1_1" => {
   101		# The set_id, also unique
   102		"set_id" => 1,
   127		"table_id"    => 1,
   128		"sequence_id" => 1,
   132	        "pkeyedtables" => [
   133				   'test1',
   134				   ],
   138		"keyedtables" => {},
   139		"sequences" => [],
   140	    },
   142	};
   152	if ($ENV{"SLONYSET"}) {
   153	    require $ENV{"SLONYSET"};
   154	}
   156	# Please do not add or change anything below this point.
   157	1;


And now the questions/steps

a	-     add_node(node     => 1,
             host     => '192.168.5.221',
             dbname   => 'primdb',
             port     => 5432,
             user     => 'postgres',
             password => '',
             config   => '/path/to/node1_config_file.conf');




I presume this would be config   => '/etc/slony1-94/slon_tools.conf' or am I wrong ?

b	-         "pkeyedtables" => [
                           'test1',
                           ],

The table name in single or double quotes ? I saw an example with double quotes

c	-	steps done

/usr/pgsql-9.4/bin/slonik_init_cluster -c /etc/slony1-94/slon_tools.conf

# INIT CLUSTER
cluster name = armandpc;
 node 1 admin conninfo='host=192.168.5.221 dbname=primdb user=postgres port=5432';
 node 2 admin conninfo='host=192.168.5.222 dbname=bkdb user=postgres port=5432';
  init cluster (id = 1, comment = 'Node 1 - primdb at 192.168.5.221');

# STORE NODE
  store node (id = 2, event node = 1, comment = 'Node 2 - bkdb at 192.168.5.222');
  echo 'Set up replication nodes';

# STORE PATH
  echo 'Next: configure paths for each node/origin';
  store path (server = 1, client = 2, conninfo = 'host=192.168.5.221 dbname=primdb user=postgres port=5432');
  store path (server = 2, client = 1, conninfo = 'host=192.168.5.222 dbname=bkdb user=postgres port=5432');
  echo 'Replication nodes prepared';
  echo 'Please start a slon replication daemon for each node';


-bash-4.1$ /usr/pgsql-9.4/bin/slonik_init_cluster -c /etc/slony1-94/slon_tools.conf |/usr/pgsql-9.4/bin/slonik
<stdin>:10: Set up replication nodes
<stdin>:13: Next: configure paths for each node/origin
<stdin>:16: Replication nodes prepared
<stdin>:17: Please start a slon replication daemon for each node



/usr/pgsql-9.4/bin/slonik_create_set -c /etc/slony1-94/slon_tools.conf  1   

cluster name = armandpc;
 node 1 admin conninfo='host=192.168.5.221 dbname=primdb user=postgres port=5432';
 node 2 admin conninfo='host=192.168.5.222 dbname=bkdb user=postgres port=5432';

# TABLE ADD KEY

# CREATE SET
    create set (id = 1, origin = 1, comment = 'Set 1 (set1_1) for armandpc');

# SET ADD TABLE
  echo 'Subscription set 1 (set1_1) created';
  echo 'Adding tables to the subscription set';
  set add table (set id = 1, origin = 1, id = 1,
                 full qualified name = 'public.test1',
                 comment = 'Table public.test1 with primary key');
  echo 'Add primary keyed table public.test1';

# SET ADD SEQUENCE
  echo 'Adding sequences to the subscription set';
  echo 'All tables added';

/usr/pgsql-9.4/bin/slonik_create_set -c slon.conf 1|/usr/pgsql-9.4/bin/slonik   

<stdin>:11: Subscription set 1 (set1_1) created
<stdin>:12: Adding tables to the subscription set
<stdin>:16: Add primary keyed table public.test1
<stdin>:19: Adding sequences to the subscription set
<stdin>:20: All tables added


/usr/pgsql-9.4/bin/slon_start -c /etc/slony1-94/slon_tools.conf 1  &
fails to start

2015-11-16 20:59:50 CST ERROR  syntax error in file "/etc/slony1-94/slon_tools.conf" line 13, near end of line
2015-11-16 20:59:50 CST CONFIG main: slon version 2.2.4 starting up
usage: /usr/pgsql-9.4/bin/slon [options] clustername conninfo

Options:
    -h                    print usage message and exit
    -v                    print version and exit
    -d <debuglevel>       verbosity of logging (1..4)
    -s <milliseconds>     SYNC check interval (default 10000)
    -t <milliseconds>     SYNC interval timeout (default 60000)
    -o <milliseconds>     desired subscriber SYNC processing time
    -g <num>              maximum SYNC group size (default 6)
    -c <num>              how often to vacuum in cleanup cycles
    -p <filename>         slon pid file
    -f <filename>         slon configuration file
    -a <directory>        directory to store SYNC archive files
    -x <command>          program to run after writing archive file
    -q <num>              Terminate when this node reaches # of SYNCs
    -r <num>              # of syncs for -q option
    -l <interval>         this node should lag providers by this interval


So what gives ? How do I debug, fix , move forward ? Aside the doc which maybe I missed , has an example which yes it works but it not going in all these details, any other examples and so on ?


Many thanks
Armand




From ssinger at ca.afilias.info  Mon Nov 16 19:52:55 2015
From: ssinger at ca.afilias.info (Steve Singer)
Date: Mon, 16 Nov 2015 22:52:55 -0500
Subject: [Slony1-general] slony newbie setup trouble
In-Reply-To: <42B5229E-D607-439E-A90D-5CAFD005F4C0@gmail.com>
References: <42B5229E-D607-439E-A90D-5CAFD005F4C0@gmail.com>
Message-ID: <564AA497.8060808@ca.afilias.info>

On 11/16/2015 10:32 PM, Armand Pirvu (home) wrote:
> Hi
>
> Please pardon the length of this email but I felt it is best to give a global view
>
> I was looking at slonik for a project.
> All the setup info, tutorials etc etc seems to vary
>
> http://raghavt.blogspot.com/2012/07/simple-slony-i-replication-setup.html
> and
> http://www.linuxjournal.com/article/7834
>

>
>
> /usr/pgsql-9.4/bin/slon_start -c /etc/slony1-94/slon_tools.conf 1  &
> fails to start
>

I think the config file should be to slon config file not a slon_tools.conf

ie the format is

cluster_name=myrep
pid_file='/opt/PostgreSQL/9.1/data/master_slon.pid'
conn_info='host=localhost dbname=master user=postgres port=5432'

http://www.slony.info/documentation/2.2/runtime-config.html

Or see  slon_node.conf.sample which I think is included with the perl tools



> 2015-11-16 20:59:50 CST ERROR  syntax error in file "/etc/slony1-94/slon_tools.conf" line 13, near end of line
> 2015-11-16 20:59:50 CST CONFIG main: slon version 2.2.4 starting up
> usage: /usr/pgsql-9.4/bin/slon [options] clustername conninfo
>
> Options:
>      -h                    print usage message and exit
>      -v                    print version and exit
>      -d <debuglevel>       verbosity of logging (1..4)
>      -s <milliseconds>     SYNC check interval (default 10000)
>      -t <milliseconds>     SYNC interval timeout (default 60000)
>      -o <milliseconds>     desired subscriber SYNC processing time
>      -g <num>              maximum SYNC group size (default 6)
>      -c <num>              how often to vacuum in cleanup cycles
>      -p <filename>         slon pid file
>      -f <filename>         slon configuration file
>      -a <directory>        directory to store SYNC archive files
>      -x <command>          program to run after writing archive file
>      -q <num>              Terminate when this node reaches # of SYNCs
>      -r <num>              # of syncs for -q option
>      -l <interval>         this node should lag providers by this interval
>
>
> So what gives ? How do I debug, fix , move forward ? Aside the doc which maybe I missed , has an example which yes it works but it not going in all these details, any other examples and so on ?
>
>
> Many thanks
> Armand
>
>
>
> _______________________________________________
> Slony1-general mailing list
> Slony1-general at lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
>


From armand.pirvu at gmail.com  Tue Nov 17 19:11:41 2015
From: armand.pirvu at gmail.com (Armand Pirvu (home))
Date: Tue, 17 Nov 2015 21:11:41 -0600
Subject: [Slony1-general] slony newbie setup trouble
In-Reply-To: <564AA497.8060808@ca.afilias.info>
References: <42B5229E-D607-439E-A90D-5CAFD005F4C0@gmail.com>
	<564AA497.8060808@ca.afilias.info>
Message-ID: <A9305678-8968-4A25-86CA-7AE45329A05D@gmail.com>

Hi Steve


Thank you for your reply

I guess that would be /etc/slony1-94/slon.conf



But see what confuses me is this. All slonik* perl script reference this

slonik_drop_node:$CONFIG_FILE = '/etc/slony1-94/slon_tools.conf';


I guess then /etc/slony1-94/slon_tools.conf should be referencing /etc/slony1-94/slon.conf


Will try that and see how that goes


Thanks
Armand

On Nov 16, 2015, at 9:52 PM, Steve Singer <ssinger at ca.afilias.info> wrote:

> On 11/16/2015 10:32 PM, Armand Pirvu (home) wrote:
>> Hi
>> 
>> Please pardon the length of this email but I felt it is best to give a global view
>> 
>> I was looking at slonik for a project.
>> All the setup info, tutorials etc etc seems to vary
>> 
>> http://raghavt.blogspot.com/2012/07/simple-slony-i-replication-setup.html
>> and
>> http://www.linuxjournal.com/article/7834
>> 
> 
>> 
>> 
>> /usr/pgsql-9.4/bin/slon_start -c /etc/slony1-94/slon_tools.conf 1  &
>> fails to start
>> 
> 
> I think the config file should be to slon config file not a slon_tools.conf
> 
> ie the format is
> 
> cluster_name=myrep
> pid_file='/opt/PostgreSQL/9.1/data/master_slon.pid'
> conn_info='host=localhost dbname=master user=postgres port=5432'
> 
> http://www.slony.info/documentation/2.2/runtime-config.html
> 
> Or see  slon_node.conf.sample which I think is included with the perl tools
> 
> 
> 
>> 2015-11-16 20:59:50 CST ERROR  syntax error in file "/etc/slony1-94/slon_tools.conf" line 13, near end of line
>> 2015-11-16 20:59:50 CST CONFIG main: slon version 2.2.4 starting up
>> usage: /usr/pgsql-9.4/bin/slon [options] clustername conninfo
>> 
>> Options:
>>     -h                    print usage message and exit
>>     -v                    print version and exit
>>     -d <debuglevel>       verbosity of logging (1..4)
>>     -s <milliseconds>     SYNC check interval (default 10000)
>>     -t <milliseconds>     SYNC interval timeout (default 60000)
>>     -o <milliseconds>     desired subscriber SYNC processing time
>>     -g <num>              maximum SYNC group size (default 6)
>>     -c <num>              how often to vacuum in cleanup cycles
>>     -p <filename>         slon pid file
>>     -f <filename>         slon configuration file
>>     -a <directory>        directory to store SYNC archive files
>>     -x <command>          program to run after writing archive file
>>     -q <num>              Terminate when this node reaches # of SYNCs
>>     -r <num>              # of syncs for -q option
>>     -l <interval>         this node should lag providers by this interval
>> 
>> 
>> So what gives ? How do I debug, fix , move forward ? Aside the doc which maybe I missed , has an example which yes it works but it not going in all these details, any other examples and so on ?
>> 
>> 
>> Many thanks
>> Armand
>> 
>> 
>> 
>> _______________________________________________
>> Slony1-general mailing list
>> Slony1-general at lists.slony.info
>> http://lists.slony.info/mailman/listinfo/slony1-general

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20151117/c80bef9d/attachment.htm 

From ttignor at akamai.com  Wed Nov 18 06:26:15 2015
From: ttignor at akamai.com (Tignor, Tom)
Date: Wed, 18 Nov 2015 14:26:15 +0000
Subject: [Slony1-general] remote listener serializability
In-Reply-To: <564A203B.9030806@ca.afilias.info>
References: <D26F49AE.41208%ttignor@akamai.com>
	<564A203B.9030806@ca.afilias.info>
Message-ID: <D271E352.42CC8%ttignor@akamai.com>

	
	Hi Steve,
	Sorry for the delay getting back. Inspired by your questions, I?ve been
reading up on SSI, the Cahill paper and slony1 and postgres code. To
answer your question, I don?t believe reducing the isolation level for the
remote listener can increase pivot conflicts. As I understand pivots, they
sit in the middle of a ?dangerous structure,? on either side of an
rw-dependency relationship for two other transactions. So a read-only
transaction can?t be a pivot. Also, since we?re not changing the data
remote listener reads, I don?t believe we?d be creating new
rw-dependencies and so making pivots of other transactions.
	For us, I think there is a broader issue. I found the README-SSI in the
postgres 9.1.18 package. It seems clear the benefits of SSI in postgres
only arrive if all your transactions are serializable.

??
    * Any transaction which is run at a transaction isolation level
other than SERIALIZABLE will not be affected by SSI.  If you want to
enforce business rules through SSI, all transactions should be run at
the SERIALIZABLE transaction isolation level, and that should
probably be set as the default.

??

	Comments in predicate.c also seem to support the idea.
	I believe all the apps in our DB (other than slony1) are using the
default read committed isolation level. As I review our DB-facing procs, I
can see listeners have rw-dependencies on the remote worker (via sl_event)
and the remote worker has an rw-dependency on any of our clients writing
to sl_log_1/2. As I understand SSI, that constitutes a ?dangerous
structure,? but we still can?t expect postgres SSI to save us if the
clients are non-serializable. Under these conditions, what benefit comes
from serializable slony1 transactions?
	Maybe a solution could be to provide a reduced serialization level as a
runtime option? Requirements vary between apps. For bank transactions,
it?s certainly clear that everything should be bulletproof. Far better to
get it done late than to do it wrong. For our notification service,
though, timeliness is more important. No ones likes losing data, but the
value of the data degrades in minutes (and unaddressed alarms are likely
to be regenerated.) It?s far less tolerable to stop replication in its
tracks for long periods in order to achieve serializability.
	I see this message has gotten long. Thanks in advance for your time and
consideration.

	Tom    :-)



On 11/16/15, 1:28 PM, "Steve Singer" <ssinger at ca.afilias.info> wrote:

>On 11/16/2015 08:52 AM, Tignor, Tom wrote:
>>
>> Hello slony1 community,
>> I?m part of a team at Akamai working on a notification service based on
>> postgres. (We call it an Alert Management System.) We?re at the point
>> where we need to scale past the single instance DB and so have been
>> working with slony1-2.2.4 (and postgresql-9.1.18) to make that happen.
>> Most tests in the past few months have been great, but in recent tests
>> the reassuring SYNC-event-output-per-two-seconds suddenly disappeared.
>> Throughout the day, it returns for a few minutes (normally less than 5,
>> never 10) and then re-enters limbo. Vigorous debugging ensued, and the
>> problem was proven to be the serializable isolation level set in
>> slon/remote_listen.c. Our recent test environment doesn?t have a
>> tremendous write rate (measured in KB/s), but it does have 200-400
>> clients at any one time, which may be a factor. Below is the stack shown
>> in gdb of the postgres server proc (identified via pg_stat_activity)
>> while slon is in limbo.
>
>> What are the thoughts on possible changes to the remote listener
>> isolation level and their impact? I?ve tested changes using repeatable
>> read instead, and also with serializable but dropping the deferrable
>> option. The latter offers little improvement if any, but the former
>> seems to return us to healthy replication. In searching around, I found
>> Jan W filed Bug 336 last year (link below) which suggests we could relax
>> the isolation level here and elsewhere. If it was helpful, I could
>> verify an agreed solution and submit it back as a patch. (Not really in
>> the slony community yet, just looking at the process now.)
>> Thanks in advance,
>
>The last time we had a change to isolation levels was in response to
>this thread
>
>
>http://lists.slony.info/pipermail/slony1-general/2011-November/011939.html
>
>Also know as bug #255 (http://www.slony.info/bugzilla/show_bug.cgi?id=255)
>
>I can't recall if anyone figured out if we could reduce the remote
>listener isolation level to read committed - read only or not.
>
>One concern at the back of my mind is if a read only repeatable read
>transactions would result in more pivot conflicts than a read only
>serializable deferrable transaction where the conflicts are with a
>serializable transaction running on the origin by some application
>transaction.
>
>
>
>
>
>
>>
>> http://www.slony.info/bugzilla/show_bug.cgi?id=336
>>
>>
>> (gdb) thread apply all bt
>>
>>
>> Thread 1 (process 13052):
>>
>> #0  0xffffe430 in __kernel_vsyscall ()
>>
>> #1  0xf76d2c0f in semop () from /lib32/libc.so.6
>>
>> #2  0x08275a26 in PGSemaphoreLock (sema=0xf69d6784, interruptOK=1
>> '\001') at pg_sema.c:424
>>
>> #3  0x082b52cb in ProcWaitForSignal () at proc.c:1443
>>
>> #4  0x082bb57a in GetSafeSnapshot (origSnapshot=<optimized out>) at
>> predicate.c:1520
>>
>> #5  RegisterSerializableTransaction (snapshot=0x88105a0) at
>>predicate.c:1580
>>
>> #6  0x083b3f35 in GetTransactionSnapshot () at snapmgr.c:138
>>
>> #7  0x082c460a in exec_simple_query (
>>
>>      query_string=0xa87d248 "select ev_origin, ev_seqno, ev_timestamp,
>>        ev_snapshot,
>> \"pg_catalog\".txid_snapshot_xmin(ev_snapshot),
>> \"pg_catalog\".txid_snapshot_xmax(ev_snapshot),        ev_type,
>> ev_data1,"...)
>>
>>      at postgres.c:948
>>
>> #8  PostgresMain (argc=1, argv=0xa7cd1e0, dbname=0xa7cd1d0 "ams",
>> username=0xa7cd1b8 "ams_slony") at postgres.c:4021
>>
>> #9  0x08284a58 in BackendRun (port=0xa808118) at postmaster.c:3657
>>
>> #10 BackendStartup (port=0xa808118) at postmaster.c:3330
>>
>> #11 ServerLoop () at postmaster.c:1483
>>
>> #12 0x082854d8 in PostmasterMain (argc=3, argv=0xa7ccb58) at
>> postmaster.c:1144
>>
>> #13 0x080cb430 in main (argc=3, argv=0xa7ccb58) at main.c:210
>>
>> (gdb)
>>
>>
>>
>> Tom    :-)
>>
>>
>>
>>
>> _______________________________________________
>> Slony1-general mailing list
>> Slony1-general at lists.slony.info
>> http://lists.slony.info/mailman/listinfo/slony1-general
>>
>


From ajs at crankycanuck.ca  Wed Nov 18 07:21:03 2015
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Wed, 18 Nov 2015 10:21:03 -0500
Subject: [Slony1-general] remote listener serializability
In-Reply-To: <D271E352.42CC8%ttignor@akamai.com>
References: <D26F49AE.41208%ttignor@akamai.com>
	<564A203B.9030806@ca.afilias.info>
	<D271E352.42CC8%ttignor@akamai.com>
Message-ID: <20151118152103.GS30327@crankycanuck.ca>

For whatever it's worth, when Slony was first designed SERIALIZABLE
was the only option -- the alternative was READ COMMITTED and IIRC
there were some corner cases where the data changing in the log tables
could make a big difference (memory fails, but I think it had to do
with log switching).  ISTR it was partly a lesson we learned from
erserver, where some of the basic concepts underlying Slony had been
worked out.

I'd advocate a lot of caution in making changes, ideally by analysing
all the kinds of transaction paths Slony could be seeing.  But with
new isolation levels available, it's probably worth doing some
analysis.

A

On Wed, Nov 18, 2015 at 02:26:15PM +0000, Tignor, Tom wrote:
> 	
> 	Hi Steve,
> 	Sorry for the delay getting back. Inspired by your questions, I?ve been
> reading up on SSI, the Cahill paper and slony1 and postgres code. To
> answer your question, I don?t believe reducing the isolation level for the
> remote listener can increase pivot conflicts. As I understand pivots, they
> sit in the middle of a ?dangerous structure,? on either side of an
> rw-dependency relationship for two other transactions. So a read-only
> transaction can?t be a pivot. Also, since we?re not changing the data
> remote listener reads, I don?t believe we?d be creating new
> rw-dependencies and so making pivots of other transactions.
> 	For us, I think there is a broader issue. I found the README-SSI in the
> postgres 9.1.18 package. It seems clear the benefits of SSI in postgres
> only arrive if all your transactions are serializable.
> 
> ??
>     * Any transaction which is run at a transaction isolation level
> other than SERIALIZABLE will not be affected by SSI.  If you want to
> enforce business rules through SSI, all transactions should be run at
> the SERIALIZABLE transaction isolation level, and that should
> probably be set as the default.
> 
> ??
> 
> 	Comments in predicate.c also seem to support the idea.
> 	I believe all the apps in our DB (other than slony1) are using the
> default read committed isolation level. As I review our DB-facing procs, I
> can see listeners have rw-dependencies on the remote worker (via sl_event)
> and the remote worker has an rw-dependency on any of our clients writing
> to sl_log_1/2. As I understand SSI, that constitutes a ?dangerous
> structure,? but we still can?t expect postgres SSI to save us if the
> clients are non-serializable. Under these conditions, what benefit comes
> from serializable slony1 transactions?
> 	Maybe a solution could be to provide a reduced serialization level as a
> runtime option? Requirements vary between apps. For bank transactions,
> it?s certainly clear that everything should be bulletproof. Far better to
> get it done late than to do it wrong. For our notification service,
> though, timeliness is more important. No ones likes losing data, but the
> value of the data degrades in minutes (and unaddressed alarms are likely
> to be regenerated.) It?s far less tolerable to stop replication in its
> tracks for long periods in order to achieve serializability.
> 	I see this message has gotten long. Thanks in advance for your time and
> consideration.
> 
> 	Tom    :-)
> 
> 
> 
> On 11/16/15, 1:28 PM, "Steve Singer" <ssinger at ca.afilias.info> wrote:
> 
> >On 11/16/2015 08:52 AM, Tignor, Tom wrote:
> >>
> >> Hello slony1 community,
> >> I?m part of a team at Akamai working on a notification service based on
> >> postgres. (We call it an Alert Management System.) We?re at the point
> >> where we need to scale past the single instance DB and so have been
> >> working with slony1-2.2.4 (and postgresql-9.1.18) to make that happen.
> >> Most tests in the past few months have been great, but in recent tests
> >> the reassuring SYNC-event-output-per-two-seconds suddenly disappeared.
> >> Throughout the day, it returns for a few minutes (normally less than 5,
> >> never 10) and then re-enters limbo. Vigorous debugging ensued, and the
> >> problem was proven to be the serializable isolation level set in
> >> slon/remote_listen.c. Our recent test environment doesn?t have a
> >> tremendous write rate (measured in KB/s), but it does have 200-400
> >> clients at any one time, which may be a factor. Below is the stack shown
> >> in gdb of the postgres server proc (identified via pg_stat_activity)
> >> while slon is in limbo.
> >
> >> What are the thoughts on possible changes to the remote listener
> >> isolation level and their impact? I?ve tested changes using repeatable
> >> read instead, and also with serializable but dropping the deferrable
> >> option. The latter offers little improvement if any, but the former
> >> seems to return us to healthy replication. In searching around, I found
> >> Jan W filed Bug 336 last year (link below) which suggests we could relax
> >> the isolation level here and elsewhere. If it was helpful, I could
> >> verify an agreed solution and submit it back as a patch. (Not really in
> >> the slony community yet, just looking at the process now.)
> >> Thanks in advance,
> >
> >The last time we had a change to isolation levels was in response to
> >this thread
> >
> >
> >http://lists.slony.info/pipermail/slony1-general/2011-November/011939.html
> >
> >Also know as bug #255 (http://www.slony.info/bugzilla/show_bug.cgi?id=255)
> >
> >I can't recall if anyone figured out if we could reduce the remote
> >listener isolation level to read committed - read only or not.
> >
> >One concern at the back of my mind is if a read only repeatable read
> >transactions would result in more pivot conflicts than a read only
> >serializable deferrable transaction where the conflicts are with a
> >serializable transaction running on the origin by some application
> >transaction.
> >
> >
> >
> >
> >
> >
> >>
> >> http://www.slony.info/bugzilla/show_bug.cgi?id=336
> >>
> >>
> >> (gdb) thread apply all bt
> >>
> >>
> >> Thread 1 (process 13052):
> >>
> >> #0  0xffffe430 in __kernel_vsyscall ()
> >>
> >> #1  0xf76d2c0f in semop () from /lib32/libc.so.6
> >>
> >> #2  0x08275a26 in PGSemaphoreLock (sema=0xf69d6784, interruptOK=1
> >> '\001') at pg_sema.c:424
> >>
> >> #3  0x082b52cb in ProcWaitForSignal () at proc.c:1443
> >>
> >> #4  0x082bb57a in GetSafeSnapshot (origSnapshot=<optimized out>) at
> >> predicate.c:1520
> >>
> >> #5  RegisterSerializableTransaction (snapshot=0x88105a0) at
> >>predicate.c:1580
> >>
> >> #6  0x083b3f35 in GetTransactionSnapshot () at snapmgr.c:138
> >>
> >> #7  0x082c460a in exec_simple_query (
> >>
> >>      query_string=0xa87d248 "select ev_origin, ev_seqno, ev_timestamp,
> >>        ev_snapshot,
> >> \"pg_catalog\".txid_snapshot_xmin(ev_snapshot),
> >> \"pg_catalog\".txid_snapshot_xmax(ev_snapshot),        ev_type,
> >> ev_data1,"...)
> >>
> >>      at postgres.c:948
> >>
> >> #8  PostgresMain (argc=1, argv=0xa7cd1e0, dbname=0xa7cd1d0 "ams",
> >> username=0xa7cd1b8 "ams_slony") at postgres.c:4021
> >>
> >> #9  0x08284a58 in BackendRun (port=0xa808118) at postmaster.c:3657
> >>
> >> #10 BackendStartup (port=0xa808118) at postmaster.c:3330
> >>
> >> #11 ServerLoop () at postmaster.c:1483
> >>
> >> #12 0x082854d8 in PostmasterMain (argc=3, argv=0xa7ccb58) at
> >> postmaster.c:1144
> >>
> >> #13 0x080cb430 in main (argc=3, argv=0xa7ccb58) at main.c:210
> >>
> >> (gdb)
> >>
> >>
> >>
> >> Tom    :-)
> >>
> >>
> >>
> >>
> >> _______________________________________________
> >> Slony1-general mailing list
> >> Slony1-general at lists.slony.info
> >> http://lists.slony.info/mailman/listinfo/slony1-general
> >>
> >
> 
> _______________________________________________
> Slony1-general mailing list
> Slony1-general at lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general

-- 
Andrew Sullivan
ajs at crankycanuck.ca

From greg at endpoint.com  Wed Nov 18 07:35:49 2015
From: greg at endpoint.com (Greg Sabino Mullane)
Date: Wed, 18 Nov 2015 10:35:49 -0500
Subject: [Slony1-general] remote listener serializability
In-Reply-To: <D271E352.42CC8%ttignor@akamai.com>
References: <D26F49AE.41208%ttignor@akamai.com>
	<564A203B.9030806@ca.afilias.info>
	<D271E352.42CC8%ttignor@akamai.com>
Message-ID: <20151118153548.GG31515@localhost.localdomain>

On Wed, Nov 18, 2015 at 02:26:15PM +0000, Tom Tignor wrote:
...
> Sorry for the delay getting back. Inspired by your questions, I?ve been
> reading up on SSI, the Cahill paper and slony1 and postgres code.
...

It should be pointed out that 9.1 goes EOL (End of Life) in less than 
a year (Sep 2016), and transaction handling has changed a *lot* since then, 
so any changes that core Slony makes may not even work for you.

(FWIW, I think dropping the isolation level in this particular 
instance seems safe, however.)

-- 
Greg Sabino Mullane greg at endpoint.com
End Point Corporation
PGP Key: 0x14964AC8
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 163 bytes
Desc: not available
Url : http://lists.slony.info/pipermail/slony1-general/attachments/20151118/98d6ae60/attachment.pgp 

From ttignor at akamai.com  Thu Nov 19 10:09:54 2015
From: ttignor at akamai.com (Tignor, Tom)
Date: Thu, 19 Nov 2015 18:09:54 +0000
Subject: [Slony1-general] remote listener serializability
In-Reply-To: <20151118153548.GG31515@localhost.localdomain>
References: <D26F49AE.41208%ttignor@akamai.com>
	<564A203B.9030806@ca.afilias.info> <D271E352.42CC8%ttignor@akamai.com>
	<20151118153548.GG31515@localhost.localdomain>
Message-ID: <D2737725.437DF%ttignor@akamai.com>


	Greg, Andrew,
	Thanks for the feedback. Greg, can you describe the transaction handling
changes you?re referring to? I recently got the latest pg 9.4
distribution. The README-SSI is identical and while there have been some
changes in predicate.c, they don?t appear sweeping. The doc on Transaction
Isolation appears pretty much the same too.
	A general question for the group: if we would consider a change like this
(as a runtime option or otherwise), what?s the correct way to move it
forward? Should I file a bug? Are there specific tests or analysis which
should be performed?

	Tom    :-)


On 11/18/15, 10:35 AM, "Greg Sabino Mullane" <greg at endpoint.com> wrote:

>On Wed, Nov 18, 2015 at 02:26:15PM +0000, Tom Tignor wrote:
>...
>> Sorry for the delay getting back. Inspired by your questions, I?ve been
>> reading up on SSI, the Cahill paper and slony1 and postgres code.
>...
>
>It should be pointed out that 9.1 goes EOL (End of Life) in less than
>a year (Sep 2016), and transaction handling has changed a *lot* since
>then, 
>so any changes that core Slony makes may not even work for you.
>
>(FWIW, I think dropping the isolation level in this particular
>instance seems safe, however.)
>
>-- 
>Greg Sabino Mullane greg at endpoint.com
>End Point Corporation
>PGP Key: 0x14964AC8


From ssinger at ca.afilias.info  Fri Nov 20 05:45:28 2015
From: ssinger at ca.afilias.info (Steve Singer)
Date: Fri, 20 Nov 2015 08:45:28 -0500
Subject: [Slony1-general] remote listener serializability
In-Reply-To: <D2737725.437DF%ttignor@akamai.com>
References: <D26F49AE.41208%ttignor@akamai.com>	<564A203B.9030806@ca.afilias.info>
	<D271E352.42CC8%ttignor@akamai.com>	<20151118153548.GG31515@localhost.localdomain>
	<D2737725.437DF%ttignor@akamai.com>
Message-ID: <564F23F8.4010608@ca.afilias.info>

On 11/19/2015 01:09 PM, Tignor, Tom wrote:
> 	A general question for the group: if we would consider a change like this
> (as a runtime option or otherwise), what?s the correct way to move it
> forward? Should I file a bug? Are there specific tests or analysis which
> should be performed?

I would use bug 336 for this.
My gut is to make this a runtime option since I am not confident that
downgrading the isolation level won't impact someones workload, having
said that I am open to being convinced otherwise.  I would also be
inclined to leave the default value unchanged for 2.2.x and then maybe
consider changing the default in 2.3.   If we actually any concrete
plans for a 2.3 version I would say just leave the change for 2.3 but I
don't see a 2.3 release happening soon and I don't want to change the
default behaviour in a minor release.


Generally when we make a change like this I try to do lots of runs
through the disorder/clustertest suite that doesn't cover all types of
workloads.  Have you tried this change on your workload? Does it
actually help things?

It would be great if Jan and Chris were to comment on this thread

> 
> 	Tom    :-)
> 
> 
> On 11/18/15, 10:35 AM, "Greg Sabino Mullane" <greg at endpoint.com> wrote:
> 
>> On Wed, Nov 18, 2015 at 02:26:15PM +0000, Tom Tignor wrote:
>> ...
>>> Sorry for the delay getting back. Inspired by your questions, I?ve been
>>> reading up on SSI, the Cahill paper and slony1 and postgres code.
>> ...
>>
>> It should be pointed out that 9.1 goes EOL (End of Life) in less than
>> a year (Sep 2016), and transaction handling has changed a *lot* since
>> then,
>> so any changes that core Slony makes may not even work for you.
>>
>> (FWIW, I think dropping the isolation level in this particular
>> instance seems safe, however.)
>>
>> -- 
>> Greg Sabino Mullane greg at endpoint.com
>> End Point Corporation
>> PGP Key: 0x14964AC8
> 
> _______________________________________________
> Slony1-general mailing list
> Slony1-general at lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
> 


From ttignor at akamai.com  Fri Nov 20 06:08:25 2015
From: ttignor at akamai.com (Tignor, Tom)
Date: Fri, 20 Nov 2015 14:08:25 +0000
Subject: [Slony1-general] remote listener serializability
In-Reply-To: <564F23F8.4010608@ca.afilias.info>
References: <D26F49AE.41208%ttignor@akamai.com>
	<564A203B.9030806@ca.afilias.info> <D271E352.42CC8%ttignor@akamai.com>
	<20151118153548.GG31515@localhost.localdomain>
	<D2737725.437DF%ttignor@akamai.com> <564F23F8.4010608@ca.afilias.info>
Message-ID: <D2749205.43937%ttignor@akamai.com>


	Yes indeed. With this change, we see replication on all three subscriber
nodes in the 2-5 secs range per SYNC event. (We?re configured with the
2-sec default.) Without it, the subscribers spend most of the day
paralyzed, with sporadic blocks of some minutes of consciousness which
they use to frenetically catch up.
	Figure I?ll await others? comments and then post excerpts to bug 336.
Your point on not impacting others? workloads is very well taken. A
non-default runtime option seems like the right way forward.

	Tom    :-)


On 11/20/15, 8:45 AM, "Steve Singer" <ssinger at ca.afilias.info> wrote:

>On 11/19/2015 01:09 PM, Tignor, Tom wrote:
>> 	A general question for the group: if we would consider a change like
>>this
>> (as a runtime option or otherwise), what?s the correct way to move it
>> forward? Should I file a bug? Are there specific tests or analysis which
>> should be performed?
>
>I would use bug 336 for this.
>My gut is to make this a runtime option since I am not confident that
>downgrading the isolation level won't impact someones workload, having
>said that I am open to being convinced otherwise.  I would also be
>inclined to leave the default value unchanged for 2.2.x and then maybe
>consider changing the default in 2.3.   If we actually any concrete
>plans for a 2.3 version I would say just leave the change for 2.3 but I
>don't see a 2.3 release happening soon and I don't want to change the
>default behaviour in a minor release.
>
>
>Generally when we make a change like this I try to do lots of runs
>through the disorder/clustertest suite that doesn't cover all types of
>workloads.  Have you tried this change on your workload? Does it
>actually help things?
>
>It would be great if Jan and Chris were to comment on this thread
>
>> 
>> 	Tom    :-)
>> 
>> 
>> On 11/18/15, 10:35 AM, "Greg Sabino Mullane" <greg at endpoint.com> wrote:
>> 
>>> On Wed, Nov 18, 2015 at 02:26:15PM +0000, Tom Tignor wrote:
>>> ...
>>>> Sorry for the delay getting back. Inspired by your questions, I?ve
>>>>been
>>>> reading up on SSI, the Cahill paper and slony1 and postgres code.
>>> ...
>>>
>>> It should be pointed out that 9.1 goes EOL (End of Life) in less than
>>> a year (Sep 2016), and transaction handling has changed a *lot* since
>>> then,
>>> so any changes that core Slony makes may not even work for you.
>>>
>>> (FWIW, I think dropping the isolation level in this particular
>>> instance seems safe, however.)
>>>
>>> -- 
>>> Greg Sabino Mullane greg at endpoint.com
>>> End Point Corporation
>>> PGP Key: 0x14964AC8
>> 
>> _______________________________________________
>> Slony1-general mailing list
>> Slony1-general at lists.slony.info
>> http://lists.slony.info/mailman/listinfo/slony1-general
>> 
>


From jan at wi3ck.info  Fri Nov 20 06:56:01 2015
From: jan at wi3ck.info (Jan Wieck)
Date: Fri, 20 Nov 2015 09:56:01 -0500
Subject: [Slony1-general] remote listener serializability
In-Reply-To: <564F23F8.4010608@ca.afilias.info>
References: <D26F49AE.41208%ttignor@akamai.com>
	<564A203B.9030806@ca.afilias.info> <D271E352.42CC8%ttignor@akamai.com>
	<20151118153548.GG31515@localhost.localdomain>
	<D2737725.437DF%ttignor@akamai.com> <564F23F8.4010608@ca.afilias.info>
Message-ID: <564F3481.9050709@wi3ck.info>

On 11/20/2015 08:45 AM, Steve Singer wrote:
> On 11/19/2015 01:09 PM, Tignor, Tom wrote:
>> 	A general question for the group: if we would consider a change like this
>> (as a runtime option or otherwise), what?s the correct way to move it
>> forward? Should I file a bug? Are there specific tests or analysis which
>> should be performed?
> 
> I would use bug 336 for this.
> My gut is to make this a runtime option since I am not confident that
> downgrading the isolation level won't impact someones workload, having
> said that I am open to being convinced otherwise.  I would also be
> inclined to leave the default value unchanged for 2.2.x and then maybe
> consider changing the default in 2.3.   If we actually any concrete
> plans for a 2.3 version I would say just leave the change for 2.3 but I
> don't see a 2.3 release happening soon and I don't want to change the
> default behaviour in a minor release.
> 
> 
> Generally when we make a change like this I try to do lots of runs
> through the disorder/clustertest suite that doesn't cover all types of
> workloads.  Have you tried this change on your workload? Does it
> actually help things?
> 
> It would be great if Jan and Chris were to comment on this thread

Without taking SYNC snapshots in a SERIALIZABLE transaction I believe
that a Slony-I replica could suffer the same inconsistency dangers that
a pg_dump without --serializable-deferrable can suffer. Namely a replica
would not be usable as a source for reporting. From the 9.4 pg_dump docs:

"This option is not beneficial for a dump which is intended only for
disaster recovery. It could be useful for a dump used to load a copy of
the database for reporting or other read-only load sharing while the
original database continues to be updated. Without it the dump may
reflect a state which is not consistent with any serial execution of the
transactions eventually committed. For example, if batch processing
techniques are used, a batch may show as closed in the dump without all
of the items which are in the batch appearing."

Changing the default isolation levels(s) may therefore change, what a
replica can safely be used for and I believe that creating reports is
one of the major use cases. Using options with big, bold, red, flashing
warnings in the documentation would be the only way to go.


Regards, Jan



> 
>>
>> 	Tom    :-)
>>
>>
>> On 11/18/15, 10:35 AM, "Greg Sabino Mullane" <greg at endpoint.com> wrote:
>>
>>> On Wed, Nov 18, 2015 at 02:26:15PM +0000, Tom Tignor wrote:
>>> ...
>>>> Sorry for the delay getting back. Inspired by your questions, I?ve been
>>>> reading up on SSI, the Cahill paper and slony1 and postgres code.
>>> ...
>>>
>>> It should be pointed out that 9.1 goes EOL (End of Life) in less than
>>> a year (Sep 2016), and transaction handling has changed a *lot* since
>>> then,
>>> so any changes that core Slony makes may not even work for you.
>>>
>>> (FWIW, I think dropping the isolation level in this particular
>>> instance seems safe, however.)
>>>
>>> --
>>> Greg Sabino Mullane greg at endpoint.com
>>> End Point Corporation
>>> PGP Key: 0x14964AC8
>>
>> _______________________________________________
>> Slony1-general mailing list
>> Slony1-general at lists.slony.info
>> http://lists.slony.info/mailman/listinfo/slony1-general
>>
> 
> _______________________________________________
> Slony1-general mailing list
> Slony1-general at lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
> 


-- 
Jan Wieck
Senior Software Engineer
http://slony.info

From ssinger at ca.afilias.info  Fri Nov 20 07:04:08 2015
From: ssinger at ca.afilias.info (Steve Singer)
Date: Fri, 20 Nov 2015 10:04:08 -0500
Subject: [Slony1-general] remote listener serializability
In-Reply-To: <564F3481.9050709@wi3ck.info>
References: <D26F49AE.41208%ttignor@akamai.com>
	<564A203B.9030806@ca.afilias.info>
	<D271E352.42CC8%ttignor@akamai.com>
	<20151118153548.GG31515@localhost.localdomain>
	<D2737725.437DF%ttignor@akamai.com>
	<564F23F8.4010608@ca.afilias.info> <564F3481.9050709@wi3ck.info>
Message-ID: <564F3668.5040200@ca.afilias.info>

On 11/20/2015 09:56 AM, Jan Wieck wrote:
> Without taking SYNC snapshots in a SERIALIZABLE transaction I believe
> that a Slony-I replica could suffer the same inconsistency dangers that
> a pg_dump without --serializable-deferrable can suffer. Namely a replica
> would not be usable as a source for reporting. From the 9.4 pg_dump docs:

I was wondering if this is actually possible or not.

The remote slon only selects from  sl_event and sl_log_*.  The remote
worker is only going to see rows that are covered by a snapshot range in
the SYNC in sl_event.  Rows in sl_log_* might be visible from a
transaction point of view but they won't be captured by the where
conditions for pulling from sl_log.

The snapshot for the event in sl_log is done by the local sync
connection which is a read-write connection not by a slon remote
read-only connection.

(I'm ignoring copy_set from the above analysis).


> 
> "This option is not beneficial for a dump which is intended only for
> disaster recovery. It could be useful for a dump used to load a copy of
> the database for reporting or other read-only load sharing while the
> original database continues to be updated. Without it the dump may
> reflect a state which is not consistent with any serial execution of the
> transactions eventually committed. For example, if batch processing
> techniques are used, a batch may show as closed in the dump without all
> of the items which are in the batch appearing."
> 
> Changing the default isolation levels(s) may therefore change, what a
> replica can safely be used for and I believe that creating reports is
> one of the major use cases. Using options with big, bold, red, flashing
> warnings in the documentation would be the only way to go.
> 
> 
> Regards, Jan
> 
> 
> 
>>
>>>
>>> 	Tom    :-)
>>>
>>>
>>> On 11/18/15, 10:35 AM, "Greg Sabino Mullane" <greg at endpoint.com> wrote:
>>>
>>>> On Wed, Nov 18, 2015 at 02:26:15PM +0000, Tom Tignor wrote:
>>>> ...
>>>>> Sorry for the delay getting back. Inspired by your questions, I?ve been
>>>>> reading up on SSI, the Cahill paper and slony1 and postgres code.
>>>> ...
>>>>
>>>> It should be pointed out that 9.1 goes EOL (End of Life) in less than
>>>> a year (Sep 2016), and transaction handling has changed a *lot* since
>>>> then,
>>>> so any changes that core Slony makes may not even work for you.
>>>>
>>>> (FWIW, I think dropping the isolation level in this particular
>>>> instance seems safe, however.)
>>>>
>>>> --
>>>> Greg Sabino Mullane greg at endpoint.com
>>>> End Point Corporation
>>>> PGP Key: 0x14964AC8
>>>
>>> _______________________________________________
>>> Slony1-general mailing list
>>> Slony1-general at lists.slony.info
>>> http://lists.slony.info/mailman/listinfo/slony1-general
>>>
>>
>> _______________________________________________
>> Slony1-general mailing list
>> Slony1-general at lists.slony.info
>> http://lists.slony.info/mailman/listinfo/slony1-general
>>
> 
> 


From ttignor at akamai.com  Fri Nov 20 07:18:11 2015
From: ttignor at akamai.com (Tignor, Tom)
Date: Fri, 20 Nov 2015 15:18:11 +0000
Subject: [Slony1-general] remote listener serializability
In-Reply-To: <564F3668.5040200@ca.afilias.info>
References: <D26F49AE.41208%ttignor@akamai.com>
	<564A203B.9030806@ca.afilias.info> <D271E352.42CC8%ttignor@akamai.com>
	<20151118153548.GG31515@localhost.localdomain>
	<D2737725.437DF%ttignor@akamai.com> <564F23F8.4010608@ca.afilias.info>
	<564F3481.9050709@wi3ck.info> <564F3668.5040200@ca.afilias.info>
Message-ID: <D274A294.4395C%ttignor@akamai.com>


	One point to clarify: while a general review of isolation levels could be
helpful, the problem I saw and addressed was specifically in the remote
listener. The remedy I?ve been working with is a one-line change. The
behavior we had without it seems similar to the observation Jan makes in
the bug 336 description.


--- src/slon/remote_listen.c.SAVE	2015-11-12 11:09:06.405693227 -0500
+++ src/slon/remote_listen.c	2015-11-12 11:13:00.157825287 -0500
@@ -318,7 +318,7 @@
 			}
 			if (PQserverVersion(dbconn) >= 90100)
 			{
-				slon_mkquery(&query1, "SET SESSION CHARACTERISTICS AS TRANSACTION
read only isolation level serializable deferrable");
+				slon_mkquery(&query1, "SET SESSION CHARACTERISTICS AS TRANSACTION
read only isolation level repeatable read");
 				res = PQexec(dbconn, dstring_data(&query1));
 				if (PQresultStatus(res) != PGRES_COMMAND_OK)
 				{

	Tom    :-)




On 11/20/15, 10:04 AM, "Steve Singer" <ssinger at ca.afilias.info> wrote:

>On 11/20/2015 09:56 AM, Jan Wieck wrote:
>> Without taking SYNC snapshots in a SERIALIZABLE transaction I believe
>> that a Slony-I replica could suffer the same inconsistency dangers that
>> a pg_dump without --serializable-deferrable can suffer. Namely a replica
>> would not be usable as a source for reporting. From the 9.4 pg_dump
>>docs:
>
>I was wondering if this is actually possible or not.
>
>The remote slon only selects from  sl_event and sl_log_*.  The remote
>worker is only going to see rows that are covered by a snapshot range in
>the SYNC in sl_event.  Rows in sl_log_* might be visible from a
>transaction point of view but they won't be captured by the where
>conditions for pulling from sl_log.
>
>The snapshot for the event in sl_log is done by the local sync
>connection which is a read-write connection not by a slon remote
>read-only connection.
>
>(I'm ignoring copy_set from the above analysis).
>
>
>> 
>> "This option is not beneficial for a dump which is intended only for
>> disaster recovery. It could be useful for a dump used to load a copy of
>> the database for reporting or other read-only load sharing while the
>> original database continues to be updated. Without it the dump may
>> reflect a state which is not consistent with any serial execution of the
>> transactions eventually committed. For example, if batch processing
>> techniques are used, a batch may show as closed in the dump without all
>> of the items which are in the batch appearing."
>> 
>> Changing the default isolation levels(s) may therefore change, what a
>> replica can safely be used for and I believe that creating reports is
>> one of the major use cases. Using options with big, bold, red, flashing
>> warnings in the documentation would be the only way to go.
>> 
>> 
>> Regards, Jan
>> 
>> 
>> 
>>>
>>>>
>>>> 	Tom    :-)
>>>>
>>>>
>>>> On 11/18/15, 10:35 AM, "Greg Sabino Mullane" <greg at endpoint.com>
>>>>wrote:
>>>>
>>>>> On Wed, Nov 18, 2015 at 02:26:15PM +0000, Tom Tignor wrote:
>>>>> ...
>>>>>> Sorry for the delay getting back. Inspired by your questions, I?ve
>>>>>>been
>>>>>> reading up on SSI, the Cahill paper and slony1 and postgres code.
>>>>> ...
>>>>>
>>>>> It should be pointed out that 9.1 goes EOL (End of Life) in less than
>>>>> a year (Sep 2016), and transaction handling has changed a *lot* since
>>>>> then,
>>>>> so any changes that core Slony makes may not even work for you.
>>>>>
>>>>> (FWIW, I think dropping the isolation level in this particular
>>>>> instance seems safe, however.)
>>>>>
>>>>> --
>>>>> Greg Sabino Mullane greg at endpoint.com
>>>>> End Point Corporation
>>>>> PGP Key: 0x14964AC8
>>>>
>>>> _______________________________________________
>>>> Slony1-general mailing list
>>>> Slony1-general at lists.slony.info
>>>> http://lists.slony.info/mailman/listinfo/slony1-general
>>>>
>>>
>>> _______________________________________________
>>> Slony1-general mailing list
>>> Slony1-general at lists.slony.info
>>> http://lists.slony.info/mailman/listinfo/slony1-general
>>>
>> 
>> 
>


From glynastill at yahoo.co.uk  Fri Nov 20 08:00:30 2015
From: glynastill at yahoo.co.uk (Glyn Astill)
Date: Fri, 20 Nov 2015 16:00:30 +0000 (UTC)
Subject: [Slony1-general] Slony replication lag with moderate quantity of
	deletes
References: <74368944.12953036.1448035230882.JavaMail.yahoo.ref@mail.yahoo.com>
Message-ID: <74368944.12953036.1448035230882.JavaMail.yahoo@mail.yahoo.com>

Using Slony 2.2.4, Pg 9.4.5 I infrequently see replication lag when deleting a moderately large quantity of records.

I've seen this very infrequently (i.e 3 or so times in a year), but came to a dead end investigating the cause last time (previous thread here http://comments.gmane.org/gmane.comp.db.postgresql.slony1.general/11556).  

I'm hoping someone might be able to nudge me in the right direction this time.

The cause seems to be chunks of deletes on 2 specific tables (within a transaction), although I can't see a reason why these specific tables cause issues other than the tables having pretty poor primary keys and 
indexes (Table definitions at the bottom).  

Changes to each table are logged by a table_log trigger (https://github.com/glynastill/pg_table_audit), which we admittedly need to move away from, but I can't see a reason for this to be an issue here either.

There is activity from other tables, but I'm pretty certain it's something to do with deletes from these specific tables, although I can't reliably reproduce the behaviour.

In this case deleting around 100,000 records from each table on the origin (taking around 68 seconds), causes the remote worker thread on all the subscribers to take approximately 90 minutes copying into it's sl_log table. E.g:

2015-11-20 12:28:21 GMT [9843]: [5-1] app=slon.remoteWorkerThread_7,user=slony,db=db,host=10.16.10.101 LOG:  duration: 6096341.085 ms  statement: COPY "_replication"."sl_log_2" ( log_origin, log_txid,log_tableid,log_actionseq,log_tablenspname, log_tablerelname, log_cmdtype, log_cmdupdncols,log_cmdargs) FROM STDIN

The hardware on the subscribers is identical to the origin, and the postgres backend on the subscriber is at 100% cpu during this time.  It's not waiting on I/O, and nothing jumps out to me from pg_locks 
during this time other than the slow deletes:

SELECT pl.*, c.relname FROM pg_locks pl 
LEFT JOIN pg_class c on pl.relation = c.oid 
ORDER BY c.relname;


locktype    | database  |  relation  | page | tuple | virtualxid  | transactionid | classid | objid | objsubid | virtualtransaction |  pid  |       mode       | granted | fastpath |                 relname 
---------------+-----------+------------+------+-------+-------------+---------------+---------+-------+----------+--------------------+-------+------------------+---------+----------+------------------------------------------ 
relation      | 501924233 | 1013283824 |      |       |             |               |         |       |          | 11/764780          | 80081 | RowExclusiveLock | t       | t        | PartInd_main_replication_sl_log_1-node-7 
relation      | 501924233 |  501930895 |      |       |             |               |         |       |          | 11/764780          | 80081 | RowExclusiveLock | t       | f        | at_seats 
relation      | 501924233 |  501930899 |      |       |             |               |         |       |          | 11/764780          | 80081 | RowExclusiveLock | t       | t        | at_seats2 
relation      | 501924233 |  501930902 |      |       |             |               |         |       |          | 11/764780          | 80081 | AccessShareLock  | t       | f        | at_seats2_trigger_id_seq 
relation      | 501924233 |  501930904 |      |       |             |               |         |       |          | 11/764780          | 80081 | AccessShareLock  | t       | f        | at_seats_trigger_id_seq 
relation      | 501924233 |       1259 |      |       |             |               |         |       |          | 11/764780          | 80081 | AccessShareLock  | t       | f        | pg_class 
relation      | 501924233 |       1259 |      |       |             |               |         |       |          | 17/11810762        | 26140 | AccessShareLock  | t       | t        | pg_class 
relation      | 501924233 |       2662 |      |       |             |               |         |       |          | 11/764780          | 80081 | AccessShareLock  | t       | t        | pg_class_oid_index 
relation      | 501924233 |       2662 |      |       |             |               |         |       |          | 17/11810762        | 26140 | AccessShareLock  | t       | t        | pg_class_oid_index 
relation      | 501924233 |       2663 |      |       |             |               |         |       |          | 17/11810762        | 26140 | AccessShareLock  | t       | t        | pg_class_relname_nsp_index 
relation      | 501924233 |       2663 |      |       |             |               |         |       |          | 11/764780          | 80081 | AccessShareLock  | t       | t        | pg_class_relname_nsp_index 
relation      | 501924233 |       3455 |      |       |             |               |         |       |          | 17/11810762        | 26140 | AccessShareLock  | t       | t        | pg_class_tblspc_relfilenode_index 
relation      | 501924233 |       3455 |      |       |             |               |         |       |          | 11/764780          | 80081 | AccessShareLock  | t       | t        | pg_class_tblspc_relfilenode_index 
relation      | 501924233 |      11187 |      |       |             |               |         |       |          | 17/11810762        | 26140 | AccessShareLock  | t       | t        | pg_locks 
relation      | 501924233 |       2615 |      |       |             |               |         |       |          | 11/764780          | 80081 | AccessShareLock  | t       | t        | pg_namespace 
relation      | 501924233 |       2684 |      |       |             |               |         |       |          | 11/764780          | 80081 | AccessShareLock  | t       | t        | pg_namespace_nspname_index 
relation      | 501924233 |       2685 |      |       |             |               |         |       |          | 11/764780          | 80081 | AccessShareLock  | t       | t        | pg_namespace_oid_index 
relation      | 501924233 |  501935104 |      |       |             |               |         |       |          | 11/764780          | 80081 | RowExclusiveLock | t       | f        | seats 
relation      | 501924233 |  501935120 |      |       |             |               |         |       |          | 11/764780          | 80081 | RowExclusiveLock | t       | f        | seats2 
relation      | 501924233 | 1003806325 |      |       |             |               |         |       |          | 11/764780          | 80081 | RowExclusiveLock | t       | f        | seats2_date1 
relation      | 501924233 | 1003806324 |      |       |             |               |         |       |          | 11/764780          | 80081 | RowExclusiveLock | t       | f        | seats2_index00 
relation      | 501924233 |  995705316 |      |       |             |               |         |       |          | 11/764780          | 80081 | RowExclusiveLock | t       | f        | seats2_index01 
relation      | 501924233 | 1003806326 |      |       |             |               |         |       |          | 11/764780          | 80081 | RowExclusiveLock | t       | f        | seats2_index02 
relation      | 501924233 | 1003806328 |      |       |             |               |         |       |          | 11/764780          | 80081 | RowExclusiveLock | t       | f        | seats2_index04 
relation      | 501924233 | 1003806327 |      |       |             |               |         |       |          | 11/764780          | 80081 | RowExclusiveLock | t       | f        | seats2_index05 
relation      | 501924233 | 1003806283 |      |       |             |               |         |       |          | 11/764780          | 80081 | RowExclusiveLock | t       | f        | seats_index00 
relation      | 501924233 |  992270676 |      |       |             |               |         |       |          | 11/764780          | 80081 | RowExclusiveLock | t       | f        | seats_index01 
relation      | 501924233 | 1003806286 |      |       |             |               |         |       |          | 11/764780          | 80081 | RowExclusiveLock | t       | f        | seats_index02 
relation      | 501924233 | 1003806285 |      |       |             |               |         |       |          | 11/764780          | 80081 | RowExclusiveLock | t       | f        | seats_index03 
relation      | 501924233 | 1003806284 |      |       |             |               |         |       |          | 11/764780          | 80081 | RowExclusiveLock | t       | f        | seats_index04 
relation      | 501924233 |  501927863 |      |       |             |               |         |       |          | 11/764780          | 80081 | RowExclusiveLock | t       | f        | sl_apply_stats 
relation      | 501924233 |  501927907 |      |       |             |               |         |       |          | 11/764780          | 80081 | AccessShareLock  | t       | f        | sl_local_node_id 
relation      | 501924233 |  501927909 |      |       |             |               |         |       |          | 11/764780          | 80081 | RowExclusiveLock | t       | t        | sl_log_1 
relation      | 501924233 |  763450577 |      |       |             |               |         |       |          | 11/764780          | 80081 | RowExclusiveLock | t       | t        | sl_log_1_idx1 
relation      | 501924233 |  501927921 |      |       |             |               |         |       |          | 11/764780          | 80081 | RowExclusiveLock | t       | f        | sl_log_script 
relation      | 501924233 |  501927927 |      |       |             |               |         |       |          | 11/764780          | 80081 | AccessShareLock  | t       | t        | sl_log_status 
relation      | 501924233 |  501927956 |      |       |             |               |         |       |          | 11/764780          | 80081 | AccessShareLock  | t       | t        | sl_setsync 
relation      | 501924233 |  758946419 |      |       |             |               |         |       |          | 11/764780          | 80081 | AccessShareLock  | t       | t        | sl_setsync-pkey 
relation      | 501924233 |  501927849 |      |       |             |               |         |       |          | 11/764780          | 80081 | AccessShareLock  | t       | f        | sl_subscribe 
relation      | 501924233 |  755902543 |      |       |             |               |         |       |          | 11/764780          | 80081 | AccessShareLock  | t       | f        | sl_subscribe-pkey 
relation      | 501924233 |  501927833 |      |       |             |               |         |       |          | 11/764780          | 80081 | AccessShareLock  | t       | t        | sl_table 
relation      | 501924233 |  760027156 |      |       |             |               |         |       |          | 11/764780          | 80081 | AccessShareLock  | t       | t        | sl_table-pkey 
relation      | 501924233 |  761881818 |      |       |             |               |         |       |          | 11/764780          | 80081 | AccessShareLock  | t       | t        | sl_table_tab_reloid_key 
transactionid |           |            |      |       |             |       8795986 |         |       |          | 11/764780          | 80081 | ExclusiveLock    | t       | f        | 
virtualxid    |           |            |      |       | 17/11810762 |               |         |       |          | 17/11810762        | 26140 | ExclusiveLock    | t       | t        | 
virtualxid    |           |            |      |       | 11/764780   |               |         |       |          | 11/764780          | 80081 | ExclusiveLock    | t       | t        | 
(46 rows)  

I'm logging apply stats activity, but don't see anything out of the ordinary there except for the unusually large duration of this copy:


as_timestamp        | as_origin | as_num_insert | as_num_update | as_num_delete | as_duration  | as_cache_prepare | as_cache_hit | as_cache_evict | as_cache_prepare_max 
----------------------------+-----------+---------------+---------------+---------------+--------------+------------------+--------------+----------------+---------------------- 
2015-11-20 10:47:01.310719 |         7 |           592 |           713 |            41 | 00:00:04.039 |              523 |          823 |              0 |                    0 
2015-11-20 12:29:01.694959 |         7 |          7312 |         10626 |        200509 | 01:42:16.267 |              605 |       217842 |             77 |                    0 
2015-11-20 12:30:01.947644 |         7 |          7157 |         21813 |         27925 | 00:01:01.226 |              479 |        56416 |            179 |                    0

I was wondering if this could be anything funny happening in logApply, but don't really know enough about that trigger to investigate. Perhaps next time I'll try and get a few backtraces from the backend, but alas 
for now I'm non the wiser.

Any hint's would be greatly appreciated.

Glyn


Table definitions:

db=> \d seating
                                                Table "tickets.seating"
    Column     |            Type             |                               Modifiers
---------------+-----------------------------+-----------------------------------------------------------------------
 recnum        | bigint                      | not null default nextval(('"tickets"."seating_dfseq"'::text)::regclass)
 show          | numeric(8,0)                | not null default 0
 type          | numeric(4,0)                | not null default 0
 block         | character varying(8)        | not null default ' '::character varying
 row           | numeric(14,0)               | not null default 0
 seat          | numeric(8,0)                | not null default 0
 flag          | character varying(15)       | not null default ' '::character varying
 transno       | numeric(8,0)                | not null default 0
 best          | numeric(4,0)                | not null default 0
 user          | character varying(15)       | not null default ' '::character varying
 time          | numeric(10,0)               | not null default 0
 date          | date                        | not null default '0001-01-01'::date
 date_reserved | timestamp without time zone | not null default '0001-01-01 00:00:00'::timestamp without time zone
Indexes:
    "seating_index01" PRIMARY KEY, btree (show, type, best, block, "row", seat)
    "seating_index00" UNIQUE, btree (recnum)
    "seating_index02" UNIQUE, btree (show, type, best, block, flag, "row", seat, recnum)
    "seating_index03" UNIQUE, btree (show, type, flag, best, block, "row", seat, recnum)
    "seating_index04" UNIQUE, btree (date_reserved, recnum)
Triggers:
   
_replication_denyaccess BEFORE INSERT OR DELETE OR UPDATE ON seating 
FOR EACH ROW EXECUTE PROCEDURE _replication.denyaccess('_replication')
    _replication_truncatedeny BEFORE TRUNCATE ON seating FOR EACH STATEMENT EXECUTE PROCEDURE _replication.deny_truncate()
Disabled user triggers:
   
_replication_logtrigger AFTER INSERT OR DELETE OR UPDATE ON seating FOR
EACH ROW EXECUTE PROCEDURE _replication.logtrigger('_replication', 
'813', 'vkkkkkvvk')
   
_replication_truncatetrigger BEFORE TRUNCATE ON seating FOR EACH 
STATEMENT EXECUTE PROCEDURE _replication.log_truncate('813')
Triggers firing always:
   
table_log_trigger AFTER INSERT OR DELETE OR UPDATE ON seating FOR EACH 
ROW EXECUTE PROCEDURE table_log('at_seating', '1', 'audit')    
    
sb=> \d seating2
                                             Table "tickets.seating2"
    Column     |         Type          |                               Modifiers
---------------+-----------------------+------------------------------------------------------------------------
 recnum        | bigint                | not null default nextval(('"tickets"."seating2_dfseq"'::text)::regclass)
 show          | numeric(8,0)          | not null default 0
 type          | numeric(4,0)          | not null default 0
 block         | character varying(8)  | not null default ' '::character varying
 row           | numeric(14,0)         | not null default 0
 seat          | numeric(8,0)          | not null default 0
 flag          | character varying(15) | not null default ' '::character varying
 transno       | numeric(8,0)          | not null default 0
 best          | numeric(4,0)          | not null default 0
 user          | character varying(15) | not null default ' '::character varying
 time          | numeric(10,0)         | not null default 0
 received      | character varying(1)  | not null default ' '::character varying
 asc1          | character varying(20) | not null default ' '::character varying
 asc2          | character varying(20) | not null default ' '::character varying
 num1          | numeric(8,2)          | not null default 0
 num2          | numeric(8,2)          | not null default 0
 date1         | date                  | not null default '0001-01-01'::date
 date2         | date                  | not null default '0001-01-01'::date
 ever_received | boolean               |
Indexes:
    "seating2_index01" PRIMARY KEY, btree (show, type, best, block, "row", seat)
    "seating2_index00" UNIQUE, btree (recnum)
    "seating2_index02" UNIQUE, btree (show, type, block, "row", seat)
    "seating2_index04" UNIQUE, btree (transno, best, block, "row", seat, recnum)
    "seating2_index05" UNIQUE, btree (show, best, block, "row", seat, recnum)
    "seating2_date1" btree (date1)
Triggers:
   
_replication_denyaccess BEFORE INSERT OR DELETE OR UPDATE ON seating2 
FOR EACH ROW EXECUTE PROCEDURE _replication.denyaccess('_replication')
    _replication_truncatedeny BEFORE TRUNCATE ON seating2 FOR EACH STATEMENT EXECUTE PROCEDURE _replication.deny_truncate()
Disabled user triggers:
   
_replication_logtrigger AFTER INSERT OR DELETE OR UPDATE ON seating2 
FOR EACH ROW EXECUTE PROCEDURE _replication.logtrigger('_replication', 
'812', 'vkkkkkvvk')
   
_replication_truncatetrigger BEFORE TRUNCATE ON seating2 FOR EACH 
STATEMENT EXECUTE PROCEDURE _replication.log_truncate('812')
Triggers firing always:
   
table_log_trigger AFTER INSERT OR DELETE OR UPDATE ON seating2 FOR EACH
ROW EXECUTE PROCEDURE table_log('at_seating2', '1', 'audit')    

