From efraindector at motumweb.com  Thu Mar  1 15:42:51 2012
From: efraindector at motumweb.com (=?utf-8?Q?Efra=C3=ADn_D=C3=A9ctor?=)
Date: Thu, 1 Mar 2012 17:42:51 -0600
Subject: [Slony1-general] Cascading replication using altperl scripts
Message-ID: <CBE9D0DADE0A492383F7107721DB9BB4@CMOTUM25PC>

Hello list:
My name is Efrain and this week I?ve been using Slony-I, with the help of the documentation I?ve been able to setup replication between 2 nodes using slonik scripts and also with altperl scripts. For me, using altperl scritps is more comfortable but now I?m stucked trying to set cascading replication. I have this in mind:
A1 ?> B1 ?> B2
Meaning that A1 would be the master to B1 but also B1 would be master of B2. My slon_tools.conf looks like this:
add_node(node => 1,
host => '192.168.1.231',
dbname => 'prueba',
port => 5432,
user => 'postgres',
password => '1');
add_node(node => 2,
host => '192.168.1.232',
dbname => 'prueba',
port => 5432,
noforward => allow,
user => 'pgsql',
password => '2');
add_node(node => 3,
parent => 2,
host => '192.168.1.233',
dbname => 'prueba',
port => 5432,
user => 'pgsql',
password => '3');
I understand that B1 shall be configured to accept forward but I don?t now how to do this.
Any help would be really appreciated.
Thank you.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20120301/cab5e08a/attachment.htm 

From ngramsky at cs.umd.edu  Sat Mar  3 18:53:48 2012
From: ngramsky at cs.umd.edu (NewToSlony)
Date: Sat, 3 Mar 2012 18:53:48 -0800 (PST)
Subject: [Slony1-general]  Slony 2.0 will not install with postgreSQL 8.1
Message-ID: <33436818.post@talk.nabble.com>


If I'm reading the documentation of 2.0 correctly I should be able to install
Slony 2.0 with PostgreSQL versions 7.3.3 and higher.  Yet when I run the
configure script on my box it is giving me an error saying I cannot do so
unless my version is 8.3  Am I missing something?
-- 
View this message in context: http://old.nabble.com/Slony-2.0-will-not-install-with-postgreSQL-8.1-tp33436818p33436818.html
Sent from the Slony-I -- General mailing list archive at Nabble.com.


From steve at ssinger.info  Sat Mar  3 19:03:04 2012
From: steve at ssinger.info (Steve Singer)
Date: Sat, 3 Mar 2012 22:03:04 -0500
Subject: [Slony1-general] Slony 2.0 will not install with postgreSQL 8.1
In-Reply-To: <33436818.post@talk.nabble.com>
References: <33436818.post@talk.nabble.com>
Message-ID: <BLU0-SMTP3310252D872491161E513A2DC530@phx.gbl>

On Sat, 3 Mar 2012, NewToSlony wrote:

>
> If I'm reading the documentation of 2.0 correctly I should be able to install
> Slony 2.0 with PostgreSQL versions 7.3.3 and higher.  Yet when I run the
> configure script on my box it is giving me an error saying I cannot do so
> unless my version is 8.3  Am I missing something?

No Slony 2.0+ requires at least Postgersql 8.3

Slony 1.2.x will work with postgresql 8.1


> -- 
> View this message in context: http://old.nabble.com/Slony-2.0-will-not-install-with-postgreSQL-8.1-tp33436818p33436818.html
> Sent from the Slony-I -- General mailing list archive at Nabble.com.
>
> _______________________________________________
> Slony1-general mailing list
> Slony1-general at lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
>


From ngramsky at cs.umd.edu  Sun Mar  4 15:59:31 2012
From: ngramsky at cs.umd.edu (NewToSlony)
Date: Sun, 4 Mar 2012 15:59:31 -0800 (PST)
Subject: [Slony1-general]  Install without root permissions
Message-ID: <33440610.post@talk.nabble.com>


Is it possible to install Slony without root or sudo permissions?  I've tried
in the past but been unable to do so.  I was using the --with-pgconfigdir
option only but I'm not sure what the other options buy me or if the use of
one of those options lets me accomplish my goal.  It appears they only let
me spread the slony files around my machine.
-- 
View this message in context: http://old.nabble.com/Install-without-root-permissions-tp33440610p33440610.html
Sent from the Slony-I -- General mailing list archive at Nabble.com.


From devrim at gunduz.org  Sun Mar  4 16:23:01 2012
From: devrim at gunduz.org (Devrim =?ISO-8859-1?Q?G=DCND=DCZ?=)
Date: Mon, 05 Mar 2012 02:23:01 +0200
Subject: [Slony1-general] Install without root permissions
In-Reply-To: <33440610.post@talk.nabble.com>
References: <33440610.post@talk.nabble.com>
Message-ID: <1330906981.20792.4.camel@lenovo01-laptop03.gunduz.org>

On Sun, 2012-03-04 at 15:59 -0800, NewToSlony wrote:
> 
> Is it possible to install Slony without root or sudo permissions?  

Use --prefix with configure :

./configure --prefix=/path/to/your/installation 

assuming that the user you compile and install slony has write access to
that specific directory.

-- 
Devrim G?ND?Z
Principal Systems Engineer @ EnterpriseDB: http://www.enterprisedb.com
PostgreSQL Dan??man?/Consultant, Red Hat Certified Engineer
Community: devrim~PostgreSQL.org, devrim.gunduz~linux.org.tr
http://www.gunduz.org  Twitter: http://twitter.com/devrimgunduz
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 198 bytes
Desc: This is a digitally signed message part
Url : http://lists.slony.info/pipermail/slony1-general/attachments/20120305/5c91c6f6/attachment.pgp 

From ngramsky at cs.umd.edu  Sun Mar  4 17:25:57 2012
From: ngramsky at cs.umd.edu (NewToSlony)
Date: Sun, 4 Mar 2012 17:25:57 -0800 (PST)
Subject: [Slony1-general] Install without root permissions
In-Reply-To: <1330906981.20792.4.camel@lenovo01-laptop03.gunduz.org>
References: <33440610.post@talk.nabble.com>
	<1330906981.20792.4.camel@lenovo01-laptop03.gunduz.org>
Message-ID: <33440809.post@talk.nabble.com>


That did not seem to work.  I'm getting the same error I get if I try it with
'with-pgconfigdir.

What I did:

 ./configure --prefix=/var/lib/pgsql/slony
 gmake all
 gmake install

Yet I get the following error:

$ gmake install
gmake[1]: Entering directory `/tmp/slony1-1.2.23/src'
gmake[2]: Entering directory `/tmp/slony1-1.2.23/src/xxid'
/bin/sh /tmp/slony1-1.2.23/config/mkinstalldirs /usr/lib64/pgsql/
/bin/sh /tmp/slony1-1.2.23/config/mkinstalldirs /usr/share/pgsql/
/bin/sh /tmp/slony1-1.2.23/config/install-sh -c -m 755 xxid.so
/usr/lib64/pgsql/
cp: cannot create regular file `/usr/lib64/pgsql//#inst.24369#': Permission
denied
gmake[2]: *** [install] Error 1
gmake[2]: Leaving directory `/tmp/slony1-1.2.23/src/xxid'
gmake[1]: *** [install] Error 2
gmake[1]: Leaving directory `/tmp/slony1-1.2.23/src'
gmake: *** [install] Error 2



I know I have write access as I created the /var/lib/pgsql/slony directory
as the postgres user(the same user I am trying the install as).

Thanks



Devrim G?ND?Z wrote:
> 
> On Sun, 2012-03-04 at 15:59 -0800, NewToSlony wrote:
>> 
>> Is it possible to install Slony without root or sudo permissions?  
> 
> Use --prefix with configure :
> 
> ./configure --prefix=/path/to/your/installation 
> 
> assuming that the user you compile and install slony has write access to
> that specific directory.
> 
> -- 
> Devrim G?ND?Z
> Principal Systems Engineer @ EnterpriseDB: http://www.enterprisedb.com
> PostgreSQL Dan??man?/Consultant, Red Hat Certified Engineer
> Community: devrim~PostgreSQL.org, devrim.gunduz~linux.org.tr
> http://www.gunduz.org  Twitter: http://twitter.com/devrimgunduz
> 
>  
> _______________________________________________
> Slony1-general mailing list
> Slony1-general at lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
> 
> 

-- 
View this message in context: http://old.nabble.com/Install-without-root-permissions-tp33440610p33440809.html
Sent from the Slony-I -- General mailing list archive at Nabble.com.


From jeff at pgexperts.com  Sun Mar  4 18:40:28 2012
From: jeff at pgexperts.com (Jeff Frost)
Date: Sun, 4 Mar 2012 18:40:28 -0800
Subject: [Slony1-general] Install without root permissions
In-Reply-To: <33440809.post@talk.nabble.com>
References: <33440610.post@talk.nabble.com>
	<1330906981.20792.4.camel@lenovo01-laptop03.gunduz.org>
	<33440809.post@talk.nabble.com>
Message-ID: <7D4A6711-CCCC-438F-9AC4-0018B18ABD96@pgexperts.com>

Ah yes, the issue is that you need a few .so files installed in the postgresql libdir.  that appears to be: /usr/lib64/pgsql on your installation.  

BTW, any chance you could subscribe to the mailing list so we don't have to keep moderating each one of your emails to the list?

On Mar 4, 2012, at 5:25 PM, NewToSlony wrote:

> 
> That did not seem to work.  I'm getting the same error I get if I try it with
> 'with-pgconfigdir.
> 
> What I did:
> 
> ./configure --prefix=/var/lib/pgsql/slony
> gmake all
> gmake install
> 
> Yet I get the following error:
> 
> $ gmake install
> gmake[1]: Entering directory `/tmp/slony1-1.2.23/src'
> gmake[2]: Entering directory `/tmp/slony1-1.2.23/src/xxid'
> /bin/sh /tmp/slony1-1.2.23/config/mkinstalldirs /usr/lib64/pgsql/
> /bin/sh /tmp/slony1-1.2.23/config/mkinstalldirs /usr/share/pgsql/
> /bin/sh /tmp/slony1-1.2.23/config/install-sh -c -m 755 xxid.so
> /usr/lib64/pgsql/
> cp: cannot create regular file `/usr/lib64/pgsql//#inst.24369#': Permission
> denied
> gmake[2]: *** [install] Error 1
> gmake[2]: Leaving directory `/tmp/slony1-1.2.23/src/xxid'
> gmake[1]: *** [install] Error 2
> gmake[1]: Leaving directory `/tmp/slony1-1.2.23/src'
> gmake: *** [install] Error 2



From ngramsky at cs.umd.edu  Sun Mar  4 18:55:21 2012
From: ngramsky at cs.umd.edu (NewToSlony)
Date: Sun, 4 Mar 2012 18:55:21 -0800 (PST)
Subject: [Slony1-general] Install without root permissions
In-Reply-To: <7D4A6711-CCCC-438F-9AC4-0018B18ABD96@pgexperts.com>
References: <33440610.post@talk.nabble.com>
	<1330906981.20792.4.camel@lenovo01-laptop03.gunduz.org>
	<33440809.post@talk.nabble.com>
	<7D4A6711-CCCC-438F-9AC4-0018B18ABD96@pgexperts.com>
Message-ID: <33441006.post@talk.nabble.com>


I've subscribed.  Sorry, didn't realize I needed to do something...

About your reply, I'm not sure I completely follow you as I'm a bit green to
PostgreSQL.  What .so files am I missing?  How can they be missing if
PotgreSQL is working fine?  Do I need to specify other Slony options as I
run configure?



Jeff Frost-2 wrote:
> 
> Ah yes, the issue is that you need a few .so files installed in the
> postgresql libdir.  that appears to be: /usr/lib64/pgsql on your
> installation.  
> 
> BTW, any chance you could subscribe to the mailing list so we don't have
> to keep moderating each one of your emails to the list?
> 
> On Mar 4, 2012, at 5:25 PM, NewToSlony wrote:
> 
>> 
>> That did not seem to work.  I'm getting the same error I get if I try it
>> with
>> 'with-pgconfigdir.
>> 
>> What I did:
>> 
>> ./configure --prefix=/var/lib/pgsql/slony
>> gmake all
>> gmake install
>> 
>> Yet I get the following error:
>> 
>> $ gmake install
>> gmake[1]: Entering directory `/tmp/slony1-1.2.23/src'
>> gmake[2]: Entering directory `/tmp/slony1-1.2.23/src/xxid'
>> /bin/sh /tmp/slony1-1.2.23/config/mkinstalldirs /usr/lib64/pgsql/
>> /bin/sh /tmp/slony1-1.2.23/config/mkinstalldirs /usr/share/pgsql/
>> /bin/sh /tmp/slony1-1.2.23/config/install-sh -c -m 755 xxid.so
>> /usr/lib64/pgsql/
>> cp: cannot create regular file `/usr/lib64/pgsql//#inst.24369#':
>> Permission
>> denied
>> gmake[2]: *** [install] Error 1
>> gmake[2]: Leaving directory `/tmp/slony1-1.2.23/src/xxid'
>> gmake[1]: *** [install] Error 2
>> gmake[1]: Leaving directory `/tmp/slony1-1.2.23/src'
>> gmake: *** [install] Error 2
> 
> 
> _______________________________________________
> Slony1-general mailing list
> Slony1-general at lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
> 
> 

-- 
View this message in context: http://old.nabble.com/Install-without-root-permissions-tp33440610p33441006.html
Sent from the Slony-I -- General mailing list archive at Nabble.com.


From ngramsky at cs.umd.edu  Tue Mar  6 08:29:02 2012
From: ngramsky at cs.umd.edu (NewToSlony)
Date: Tue, 6 Mar 2012 08:29:02 -0800 (PST)
Subject: [Slony1-general] How to install slony with more than one version of
 postgres
Message-ID: <33452102.post@talk.nabble.com>


I have a machine with two copies of Postgres on it.  I cannot remove the old
version as the admins will not allow that version to be removed.  The 2nd
version is the version I use and which to install Slony on.  I've used both
--prefix and --with-pgdconfigdir options, but the configure script still
keeps grabbing the other, older, incorrect version.  How can I install slony
and direct it to use only one of the two versions?
-- 
View this message in context: http://old.nabble.com/How-to-install-slony-with-more-than-one-version-of-postgres-tp33452102p33452102.html
Sent from the Slony-I -- General mailing list archive at Nabble.com.


From vivek at khera.org  Tue Mar  6 10:13:52 2012
From: vivek at khera.org (Vick Khera)
Date: Tue, 6 Mar 2012 13:13:52 -0500
Subject: [Slony1-general] How to install slony with more than one
 version of postgres
In-Reply-To: <33452102.post@talk.nabble.com>
References: <33452102.post@talk.nabble.com>
Message-ID: <CALd+dcc2gKPZEaBfW6AfGr+JymD0u8sykEgjR+GyFE7vANJNtA@mail.gmail.com>

On Tue, Mar 6, 2012 at 11:29 AM, NewToSlony <ngramsky at cs.umd.edu> wrote:
> I have a machine with two copies of Postgres on it. ?I cannot remove the old
> version as the admins will not allow that version to be removed. ?The 2nd
> version is the version I use and which to install Slony on. ?I've used both
> --prefix and --with-pgdconfigdir options, but the configure script still
> keeps grabbing the other, older, incorrect version. ?How can I install slony
> and direct it to use only one of the two versions?

Try adjusting your shell PATH such that the new version is always
found first.  You might end up with the scripts finding the older
version's executables, causing such confusion.

From laurapassigni at yahoo.it  Wed Mar  7 02:57:24 2012
From: laurapassigni at yahoo.it (Laura Passigni)
Date: Wed, 7 Mar 2012 10:57:24 +0000 (GMT)
Subject: [Slony1-general] Slow sync
Message-ID: <1331117844.5271.YahooMailNeo@web28504.mail.ukl.yahoo.com>

Hi, 
I have a big database (about 1350GB) with Slony replica (1 master and 1 slave).
Last week I have had a network crash between master and slave server. Unfortunately there was a bulk import in progress in the master database.?As result the slave server?was not in sync with the master for few days. 
There are now about 80.000 records in the sl_event table and the sync is very slow. I have seen in the log file that the sync of each event requires about 1500/2000 seconds. It is a very huge time.
Is there something that I can do? Is there some faster way to sync the databases? 

Thank you,
Laura
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20120307/ee9e7537/attachment.htm 

From atsaloli.tech at gmail.com  Wed Mar  7 12:59:31 2012
From: atsaloli.tech at gmail.com (Aleksey Tsalolikhin)
Date: Wed, 7 Mar 2012 12:59:31 -0800
Subject: [Slony1-general] A 154 GB table swelled to 527 GB on the Slony
	slave. How to compact it?
In-Reply-To: <CA+jMWodz_6rhfCd9APKf3vkun-kp-gSW=-TgH_Fo+SPoQw2X8A@mail.gmail.com>
References: <CA+jMWodz_6rhfCd9APKf3vkun-kp-gSW=-TgH_Fo+SPoQw2X8A@mail.gmail.com>
Message-ID: <CA+jMWodFkAtogPhwk+Tik5Gind+WSFrQZAmkJb6th0OpSD-17A@mail.gmail.com>

Hello,

?We're replicating a PostgreSQL 8.4.x database using Slony1-1.2.x

?The origin database "data/base" directory is 197 GB in size.

?The slave database "data/base" directory is 562 GB in size and is
?over 75% filesystem utilization which has set off the "disk free" siren.

?My biggest table* measures 154 GB on the origin, and 533 GB on
?the slave. ?(*As reported by

?SELECT relname as "Table", pg_size_pretty(pg_total_relation_size(relid))
? As "Size" from pg_catalog.pg_statio_user_tables
? ORDER BY pg_total_relation_size(relid) DESC;
?)

?I took a peek at this table on the slave using pgadmin3. The table
?has auto-vacuum enabled, and TOAST autovacuum enabled.

?There are 8.6 million live tuples, and 1.5 million dead tuples.

?Last autovacuum was over a month ago.

?Last autoanalyze was 3 hours ago.

?Table size is 4 Gigs, and TOAST table size is 527 Gigs.
?Indexes size is 3 Gigs.

?Autovacuum threshold is 20%, and the table is just under that threshold.

?I ran vacuum analyze verbose. ?But the filesystem is still at 76%
utilization.
?In fact, now, the "data/base" directory has grown to 565 GB.

?Why is my slave bigger than my master? ?How can I compact it, please?

Best,
Aleksey

From ssinger at ca.afilias.info  Wed Mar  7 14:29:06 2012
From: ssinger at ca.afilias.info (Steve Singer)
Date: Wed, 07 Mar 2012 17:29:06 -0500
Subject: [Slony1-general] Slow sync
In-Reply-To: <1331117844.5271.YahooMailNeo@web28504.mail.ukl.yahoo.com>
References: <1331117844.5271.YahooMailNeo@web28504.mail.ukl.yahoo.com>
Message-ID: <4F57E132.3050607@ca.afilias.info>

On 12-03-07 05:57 AM, Laura Passigni wrote:
> Hi,
> I have a big database (about 1350GB) with Slony replica (1 master and 1
> slave).
> Last week I have had a network crash between master and slave server.
> Unfortunately there was a bulk import in progress in the master
> database. As result the slave server was not in sync with the master for
> few days.
> There are now about 80.000 records in the sl_event table and the sync is
> very slow. I have seen in the log file that the sync of each event
> requires about 1500/2000 seconds. It is a very huge time.
> Is there something that I can do? Is there some faster way to sync the
> databases?
> Thank you,
> Laura
>

It is possible that your issue is what we have been referring to as bug 
167.  This has been fixed in slony 2.1.0.  What happens is that when 
sl_log_1 or sl_log_2 grows beyond a certain size the query turns into a 
sequential scan.

Other than upgrading,  you need to push the sync interval up so you 
generate fewer syncs, and increase the sync_groupsize so it processes 
more syncs together.  This might allow slony to catch up.  Once it is 
caught up your sl_log tables will get truncated and you can go back to 
normal settings/operations.


>
>
> _______________________________________________
> Slony1-general mailing list
> Slony1-general at lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general


From ssinger at ca.afilias.info  Wed Mar  7 14:37:55 2012
From: ssinger at ca.afilias.info (Steve Singer)
Date: Wed, 07 Mar 2012 17:37:55 -0500
Subject: [Slony1-general] A 154 GB table swelled to 527 GB on the Slony
 slave. How to compact it?
In-Reply-To: <CA+jMWodFkAtogPhwk+Tik5Gind+WSFrQZAmkJb6th0OpSD-17A@mail.gmail.com>
References: <CA+jMWodz_6rhfCd9APKf3vkun-kp-gSW=-TgH_Fo+SPoQw2X8A@mail.gmail.com>
	<CA+jMWodFkAtogPhwk+Tik5Gind+WSFrQZAmkJb6th0OpSD-17A@mail.gmail.com>
Message-ID: <4F57E343.8050808@ca.afilias.info>

On 12-03-07 03:59 PM, Aleksey Tsalolikhin wrote:
> Hello,


If the problem is that your table is bloated

The CLUSTER command 
http://www.postgresql.org/docs/8.4/static/sql-cluster.html will compact 
your table.  The VACUUM command does not normally return unused space to 
the operating system (some exceptions apply)





>
>   We're replicating a PostgreSQL 8.4.x database using Slony1-1.2.x
>
>   The origin database "data/base" directory is 197 GB in size.
>
>   The slave database "data/base" directory is 562 GB in size and is
>   over 75% filesystem utilization which has set off the "disk free" siren.
>
>   My biggest table* measures 154 GB on the origin, and 533 GB on
>   the slave.  (*As reported by
>
>   SELECT relname as "Table", pg_size_pretty(pg_total_relation_size(relid))
>    As "Size" from pg_catalog.pg_statio_user_tables
>    ORDER BY pg_total_relation_size(relid) DESC;
>   )
>
>   I took a peek at this table on the slave using pgadmin3. The table
>   has auto-vacuum enabled, and TOAST autovacuum enabled.
>
>   There are 8.6 million live tuples, and 1.5 million dead tuples.
>
>   Last autovacuum was over a month ago.
>
>   Last autoanalyze was 3 hours ago.
>
>   Table size is 4 Gigs, and TOAST table size is 527 Gigs.
>   Indexes size is 3 Gigs.
>
>   Autovacuum threshold is 20%, and the table is just under that threshold.
>
>   I ran vacuum analyze verbose.  But the filesystem is still at 76%
> utilization.
>   In fact, now, the "data/base" directory has grown to 565 GB.
>
>   Why is my slave bigger than my master?  How can I compact it, please?
>
> Best,
> Aleksey
> _______________________________________________
> Slony1-general mailing list
> Slony1-general at lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general


From atsaloli.tech at gmail.com  Wed Mar  7 16:28:40 2012
From: atsaloli.tech at gmail.com (Aleksey Tsalolikhin)
Date: Wed, 7 Mar 2012 16:28:40 -0800
Subject: [Slony1-general] A 154 GB table swelled to 527 GB on the Slony
 slave. How to compact it?
In-Reply-To: <4F57E343.8050808@ca.afilias.info>
References: <CA+jMWodz_6rhfCd9APKf3vkun-kp-gSW=-TgH_Fo+SPoQw2X8A@mail.gmail.com>
	<CA+jMWodFkAtogPhwk+Tik5Gind+WSFrQZAmkJb6th0OpSD-17A@mail.gmail.com>
	<4F57E343.8050808@ca.afilias.info>
Message-ID: <CA+jMWoduFmhK4Ak5ZdCTKWH9GKW91psU-a4wU2DTxih5K52RBw@mail.gmail.com>

On Wed, Mar 7, 2012 at 2:37 PM, Steve Singer <ssinger at ca.afilias.info> wrote:
> On 12-03-07 03:59 PM, Aleksey Tsalolikhin wrote:
>>
>> Hello,
>
>
>
> If the problem is that your table is bloated
>
> The CLUSTER command
> http://www.postgresql.org/docs/8.4/static/sql-cluster.html will compact your
> table. ?The VACUUM command does not normally return unused space to the
> operating system (some exceptions apply)

Thank you, Steve.

I used "check_postgres" to check for bloat and it reported wasted size
only 1 GB.

table XYZ rows:8674174 pages:463848 shouldbe:318436 (1.5X) wasted
size:1191215104 (1 GB)

This does not seem much compared to table size on the master,
154 GB,and on the slave, 527 GB.

I can't run CLUSTER because I don't have another 500 GB free...  I am running
VACUUM FULL right now to return the unused disk space to the OS.
I wondering if it will free 1 GB or 300 GB.  I expect 1 GB, based on the
check_postgres "bloat" check results.

I'll run check_postgres "bloat" check again after the VACUUM FULL finishes.

This table does use TOAST and most of the data is in TOAST...  I wonder if the
1 GB size includes TOAST.

Best,
Aleksey

From atsaloli.tech at gmail.com  Wed Mar  7 18:31:14 2012
From: atsaloli.tech at gmail.com (Aleksey Tsalolikhin)
Date: Wed, 7 Mar 2012 18:31:14 -0800
Subject: [Slony1-general] A 154 GB table swelled to 527 GB on the Slony
 slave. How to compact it?
In-Reply-To: <CA+jMWoduFmhK4Ak5ZdCTKWH9GKW91psU-a4wU2DTxih5K52RBw@mail.gmail.com>
References: <CA+jMWodz_6rhfCd9APKf3vkun-kp-gSW=-TgH_Fo+SPoQw2X8A@mail.gmail.com>
	<CA+jMWodFkAtogPhwk+Tik5Gind+WSFrQZAmkJb6th0OpSD-17A@mail.gmail.com>
	<4F57E343.8050808@ca.afilias.info>
	<CA+jMWoduFmhK4Ak5ZdCTKWH9GKW91psU-a4wU2DTxih5K52RBw@mail.gmail.com>
Message-ID: <CA+jMWofTnhin+yMnfg-OYYPO95VA+gassY+8MfA_dh8B4aKEzA@mail.gmail.com>

On Wed, Mar 7, 2012 at 4:28 PM, Aleksey Tsalolikhin
<atsaloli.tech at gmail.com> wrote:
> On Wed, Mar 7, 2012 at 2:37 PM, Steve Singer <ssinger at ca.afilias.info> wrote:
>>
>>
>> If the problem is that your table is bloated

I ran VACUUM FULL on this table, but it is still over 500 GB in size.

 "check_postgres --action=bloat" now returns OK.  So it's not bloat.
 What else could it be, please?

 Best,
 Aleksey

From brianf at consistentstate.com  Thu Mar  8 12:08:30 2012
From: brianf at consistentstate.com (Brian Fehrle)
Date: Thu, 08 Mar 2012 13:08:30 -0700
Subject: [Slony1-general] Slow sync
In-Reply-To: <4F57E132.3050607@ca.afilias.info>
References: <1331117844.5271.YahooMailNeo@web28504.mail.ukl.yahoo.com>
	<4F57E132.3050607@ca.afilias.info>
Message-ID: <4F5911BE.7070606@consistentstate.com>

I had a similar situation recently, and had to get it caught up on a 
slow connection.

I increased the group size to allow more events be processed at a time, 
it did help catch up a bit faster.

Normally I have all daemons running on one box, so I also killed the 
daemon for this slave and ran it on the actual slave that was behind. It 
sped the sync times up by about 4X.

- Brian F

On 03/07/2012 03:29 PM, Steve Singer wrote:
> On 12-03-07 05:57 AM, Laura Passigni wrote:
>> Hi,
>> I have a big database (about 1350GB) with Slony replica (1 master and 1
>> slave).
>> Last week I have had a network crash between master and slave server.
>> Unfortunately there was a bulk import in progress in the master
>> database. As result the slave server was not in sync with the master for
>> few days.
>> There are now about 80.000 records in the sl_event table and the sync is
>> very slow. I have seen in the log file that the sync of each event
>> requires about 1500/2000 seconds. It is a very huge time.
>> Is there something that I can do? Is there some faster way to sync the
>> databases?
>> Thank you,
>> Laura
>>
> It is possible that your issue is what we have been referring to as bug
> 167.  This has been fixed in slony 2.1.0.  What happens is that when
> sl_log_1 or sl_log_2 grows beyond a certain size the query turns into a
> sequential scan.
>
> Other than upgrading,  you need to push the sync interval up so you
> generate fewer syncs, and increase the sync_groupsize so it processes
> more syncs together.  This might allow slony to catch up.  Once it is
> caught up your sl_log tables will get truncated and you can go back to
> normal settings/operations.
>
>
>>
>> _______________________________________________
>> Slony1-general mailing list
>> Slony1-general at lists.slony.info
>> http://lists.slony.info/mailman/listinfo/slony1-general
> _______________________________________________
> Slony1-general mailing list
> Slony1-general at lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general


From scott.marlowe at gmail.com  Thu Mar  8 13:07:27 2012
From: scott.marlowe at gmail.com (Scott Marlowe)
Date: Thu, 8 Mar 2012 14:07:27 -0700
Subject: [Slony1-general] Slow sync
In-Reply-To: <4F5911BE.7070606@consistentstate.com>
References: <1331117844.5271.YahooMailNeo@web28504.mail.ukl.yahoo.com>
	<4F57E132.3050607@ca.afilias.info>
	<4F5911BE.7070606@consistentstate.com>
Message-ID: <CAOR=d=2u9GuwmqS2BHmsw9xkLFNiLCpM5H+1tKgMZajP9+jj_g@mail.gmail.com>

On Thu, Mar 8, 2012 at 1:08 PM, Brian Fehrle <brianf at consistentstate.com> wrote:
> I had a similar situation recently, and had to get it caught up on a
> slow connection.
>
> I increased the group size to allow more events be processed at a time,
> it did help catch up a bit faster.
>
> Normally I have all daemons running on one box, so I also killed the
> daemon for this slave and ran it on the actual slave that was behind. It
> sped the sync times up by about 4X.

This last paragraph++

From dbrb2002-sql at yahoo.com  Thu Mar 15 18:52:22 2012
From: dbrb2002-sql at yahoo.com (Brian Trudal)
Date: Thu, 15 Mar 2012 18:52:22 -0700 (PDT)
Subject: [Slony1-general] Re copy currently replicated table
Message-ID: <1331862742.79717.YahooMailNeo@web31816.mail.mud.yahoo.com>

Looks like a odd situation; 

I have 2 sets, and one set with 3 tables and another with 50+ tables. Both the sets are replicated to two subscribers; one set has correct data, but second set two tables are off.

And both the subscribers are up2date with origin; but 2 tables out of 3, has wrong number of rows (way off) in subscriber-1;

So, whats the best way to re-copy or re-initiate these two tables copy only to subsriber-1 without subsriber-2 (it shares the set) as subscriber-2 is prod read facing.

Thanks for the help
Brian
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20120315/98080e98/attachment.htm 

From ssinger at ca.afilias.info  Fri Mar 16 06:57:15 2012
From: ssinger at ca.afilias.info (Steve Singer)
Date: Fri, 16 Mar 2012 09:57:15 -0400
Subject: [Slony1-general] Re copy currently replicated table
In-Reply-To: <1331862742.79717.YahooMailNeo@web31816.mail.mud.yahoo.com>
References: <1331862742.79717.YahooMailNeo@web31816.mail.mud.yahoo.com>
Message-ID: <4F6346BB.3000100@ca.afilias.info>

On 12-03-15 09:52 PM, Brian Trudal wrote:
> Looks like a odd situation;
>
> I have 2 sets, and one set with 3 tables and another with 50+ tables.
> Both the sets are replicated to two subscribers; one set has correct
> data, but second set two tables are off.

How did you get your cluster into this situation?  Something has gone wrong.

I assume your still using 2.0.7 with PG 8.4

>
> And both the subscribers are up2date with origin; but 2 tables out of 3,
> has wrong number of rows (way off) in subscriber-1;
>
> So, whats the best way to re-copy or re-initiate these two tables copy
> only to subsriber-1 without subsriber-2 (it shares the set) as
> subscriber-2 is prod read facing.

You can unsubscribe subscriber 1 from the set with the UNSUBSCRIBE SET 
command.  You can then resubscribe subscriber 1 with the
SUBSCRIBE SET command.  This should not effect subscriber 2.



>
> Thanks for the help
> Brian
>
>
>
> _______________________________________________
> Slony1-general mailing list
> Slony1-general at lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general


From georgeesli at gmail.com  Fri Mar 16 08:34:06 2012
From: georgeesli at gmail.com (ESLI george)
Date: Fri, 16 Mar 2012 16:34:06 +0100
Subject: [Slony1-general] Slony installation query.
Message-ID: <CAPLB0Xuj4JHeS2cYQY1qxcDNRtBfoCsB4MT+mgAmJpLi7dyV+g@mail.gmail.com>

Hello,

We are Master students from Cologne University of Applied Sciences Germany.
We are building a prototype for a biogas plant and we are having some
problems implementing the structure

We want do a Master-Slave replication between ubuntu(Master) and
windows(Slave) in PostgreSQL 9.1 using Slony2.1. we have problems in
installing slony 2.1 in ubuntu. The problem is after
configuring(./configure) and then compiling using command 'make' the file
in slony1-2.1.1/src/backend/slony1_funcs.c. The header file Miscadmin.h is
not found and most of the header files(nodes/makefuncs.h, etc.,) are not
found. We have attached the screenshot of the error for Miscadmin.h. We
need to know where we can find these header files and what is the problem
in it.

We are looking forward for your support.

Thanks & Regards
Esli
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20120316/47d3f5ca/attachment-0001.htm 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Terminal Screenshot.JPG
Type: image/jpeg
Size: 180444 bytes
Desc: not available
Url : http://lists.slony.info/pipermail/slony1-general/attachments/20120316/47d3f5ca/attachment-0001.jpeg 

From scott.marlowe at gmail.com  Fri Mar 16 10:03:03 2012
From: scott.marlowe at gmail.com (Scott Marlowe)
Date: Fri, 16 Mar 2012 11:03:03 -0600
Subject: [Slony1-general] Slony installation query.
In-Reply-To: <CAPLB0Xuj4JHeS2cYQY1qxcDNRtBfoCsB4MT+mgAmJpLi7dyV+g@mail.gmail.com>
References: <CAPLB0Xuj4JHeS2cYQY1qxcDNRtBfoCsB4MT+mgAmJpLi7dyV+g@mail.gmail.com>
Message-ID: <CAOR=d=3_52S0YwqbfKX5WC-QgKR_ni-ipScUeuzibQk4GZJcLQ@mail.gmail.com>

On Fri, Mar 16, 2012 at 9:34 AM, ESLI george <georgeesli at gmail.com> wrote:
> Hello,
>
> We are Master students from Cologne University of Applied Sciences Germany.
> We are building a prototype for a biogas plant and we are having some
> problems implementing the structure
>
> We want do a Master-Slave replication between ubuntu(Master) and
> windows(Slave) in PostgreSQL 9.1 using Slony2.1. we have problems in
> installing slony 2.1 in ubuntu. The problem is after
> configuring(./configure) and then compiling using command 'make' the file in
> slony1-2.1.1/src/backend/slony1_funcs.c. The header file Miscadmin.h is not
> found and most of the header files(nodes/makefuncs.h, etc.,) are not found.
> We have attached the screenshot of the error for Miscadmin.h. We need to
> know where we can find these header files and what is the problem in it.

Do you have the -dev packages for postgresql installed?

From scott.marlowe at gmail.com  Fri Mar 16 10:04:19 2012
From: scott.marlowe at gmail.com (Scott Marlowe)
Date: Fri, 16 Mar 2012 11:04:19 -0600
Subject: [Slony1-general] Slony installation query.
In-Reply-To: <CAOR=d=3_52S0YwqbfKX5WC-QgKR_ni-ipScUeuzibQk4GZJcLQ@mail.gmail.com>
References: <CAPLB0Xuj4JHeS2cYQY1qxcDNRtBfoCsB4MT+mgAmJpLi7dyV+g@mail.gmail.com>
	<CAOR=d=3_52S0YwqbfKX5WC-QgKR_ni-ipScUeuzibQk4GZJcLQ@mail.gmail.com>
Message-ID: <CAOR=d=3ZxYfi1BUKtUfZORRVtL_FMH3qNB=hC0NiYVWg1mrtyQ@mail.gmail.com>

Also I just noticed you sent your email to like 6 different
recipients.  Please don't do that.  Pick one.  The slony1 general list
is a good starting place.

On Fri, Mar 16, 2012 at 11:03 AM, Scott Marlowe <scott.marlowe at gmail.com> wrote:
> On Fri, Mar 16, 2012 at 9:34 AM, ESLI george <georgeesli at gmail.com> wrote:
>> Hello,
>>
>> We are Master students from Cologne University of Applied Sciences Germany.
>> We are building a prototype for a biogas plant and we are having some
>> problems implementing the structure
>>
>> We want do a Master-Slave replication between ubuntu(Master) and
>> windows(Slave) in PostgreSQL 9.1 using Slony2.1. we have problems in
>> installing slony 2.1 in ubuntu. The problem is after
>> configuring(./configure) and then compiling using command 'make' the file in
>> slony1-2.1.1/src/backend/slony1_funcs.c. The header file Miscadmin.h is not
>> found and most of the header files(nodes/makefuncs.h, etc.,) are not found.
>> We have attached the screenshot of the error for Miscadmin.h. We need to
>> know where we can find these header files and what is the problem in it.
>
> Do you have the -dev packages for postgresql installed?



-- 
To understand recursion, one must first understand recursion.

From ahodgson at simkin.ca  Fri Mar 16 10:06:38 2012
From: ahodgson at simkin.ca (Alan Hodgson)
Date: Fri, 16 Mar 2012 10:06:38 -0700
Subject: [Slony1-general] Slony installation query.
In-Reply-To: <CAPLB0Xuj4JHeS2cYQY1qxcDNRtBfoCsB4MT+mgAmJpLi7dyV+g@mail.gmail.com>
References: <CAPLB0Xuj4JHeS2cYQY1qxcDNRtBfoCsB4MT+mgAmJpLi7dyV+g@mail.gmail.com>
Message-ID: <2485310.h6C2lnVcC8@skynet.simkin.ca>

On Friday, March 16, 2012 04:34:06 PM ESLI george wrote:
> We want do a Master-Slave replication between ubuntu(Master) and
> windows(Slave) in PostgreSQL 9.1 using Slony2.1. we have problems in
> installing slony 2.1 in ubuntu. The problem is after
> configuring(./configure) and then compiling using command 'make' the file
> in slony1-2.1.1/src/backend/slony1_funcs.c. The header file Miscadmin.h is
> not found and most of the header files(nodes/makefuncs.h, etc.,) are not
> found. We have attached the screenshot of the error for Miscadmin.h. We
> need to know where we can find these header files and what is the problem
> in it.
> 
> We are looking forward for your support.
> 
> Thanks & Regards
> Esli

You need to install the postgresql development package for your distribution. 
I think that's postgresql-server-dev or something similar, on Ubuntu.

From JanWieck at Yahoo.com  Mon Mar 19 05:45:08 2012
From: JanWieck at Yahoo.com (Jan Wieck)
Date: Mon, 19 Mar 2012 08:45:08 -0400
Subject: [Slony1-general] Slony installation query.
In-Reply-To: <CAPLB0Xs0bm7AuS84Ziw5-N3YkySLEBR6hA_fAkVSkyzsnTZPMw@mail.gmail.com>
References: <CAPLB0Xuj4JHeS2cYQY1qxcDNRtBfoCsB4MT+mgAmJpLi7dyV+g@mail.gmail.com>
	<175348016-1331917820-cardhu_decombobulator_blackberry.rim.net-199299264-@b13.c5.bise6.blackberry>
	<CAPLB0Xs0bm7AuS84Ziw5-N3YkySLEBR6hA_fAkVSkyzsnTZPMw@mail.gmail.com>
Message-ID: <4F672A54.8040401@Yahoo.com>

On 3/16/2012 1:29 PM, ESLI george wrote:
> Hi,
>
> Thank you for your reply.
>
> We are using Postgresql for the first time. so we followed  replication
> from the following tutorial :
> http://www.dalibo.org/_media/pgconfeu_slony.pdf  ( worked from Pg 18 to
> Pg 23) after the 'make' we cannot proceed.
>
> we have't specified anything in the pgconfigdir.

Slide 22 of that presentation specifically calls for specifying the 
--with-pgconfigdir option for the configure run.


Jan

>
> regards,
> Esli
>
> On Fri, Mar 16, 2012 at 6:10 PM, Jan Wieck <janwieck at yahoo.com
> <mailto:janwieck at yahoo.com>> wrote:
>
>     Do you have the postgres headers installed and did you specify
>     --with-pgconfigdir for the .configure ?
>     --
>     Sent from a mobile device
>
>     -----Original Message-----
>     From: ESLI george <georgeesli at gmail.com <mailto:georgeesli at gmail.com>>
>     Sender: slony1-general-bounces at lists.slony.info
>     <mailto:slony1-general-bounces at lists.slony.info>
>     Date: Fri, 16 Mar 2012 16:34:06
>     To: <webmaster at main.slony.info <mailto:webmaster at main.slony.info>>;
>     <slony1-commit at lists.slony.info
>     <mailto:slony1-commit at lists.slony.info>>;
>     <slony1-bugs at lists.slony.info
>     <mailto:slony1-bugs at lists.slony.info>>;
>     <slony1-general at lists.slony.info
>     <mailto:slony1-general at lists.slony.info>>;
>     <slony1-patches at lists.slony.info
>     <mailto:slony1-patches at lists.slony.info>>
>     Subject: [Slony1-general] Slony installation query.
>
>     _______________________________________________
>     Slony1-general mailing list
>     Slony1-general at lists.slony.info <mailto:Slony1-general at lists.slony.info>
>     http://lists.slony.info/mailman/listinfo/slony1-general
>
>
>


-- 
Anyone who trades liberty for security deserves neither
liberty nor security. -- Benjamin Franklin

From georgeesli at gmail.com  Mon Mar 19 05:04:04 2012
From: georgeesli at gmail.com (ESLI george)
Date: Mon, 19 Mar 2012 13:04:04 +0100
Subject: [Slony1-general] Installing slony-2.1 in Windows Xp
Message-ID: <CAPLB0Xu8ci4HAnoz6-khZGvhNFivwqRkHTTwv78LMm0NMujZcg@mail.gmail.com>

Hello,

We are Master students from Cologne University of Applied Sciences Germany.
We are building a prototype for a biogas plant and we are having some
problems implementing the structure

We want do a Master-Slave replication between ubuntu(Master) and
windows(Slave) in PostgreSQL 9.1 using Slony2.1. we have problems in
installing slony 2.1 in windows.
We have downloaded the source files. unlike previous versions slony 2.1
doesn't have a .exe file. So can you help us with the steps to install
slony 2.1 in windows xp.

We are looking forward for your support.

Thanks & Regards
Esli
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20120319/81351283/attachment.htm 

From rod at iol.ie  Mon Mar 19 06:03:29 2012
From: rod at iol.ie (Raymond O'Donnell)
Date: Mon, 19 Mar 2012 13:03:29 +0000
Subject: [Slony1-general] Installing slony-2.1 in Windows Xp
In-Reply-To: <CAPLB0Xu8ci4HAnoz6-khZGvhNFivwqRkHTTwv78LMm0NMujZcg@mail.gmail.com>
References: <CAPLB0Xu8ci4HAnoz6-khZGvhNFivwqRkHTTwv78LMm0NMujZcg@mail.gmail.com>
Message-ID: <4F672EA1.3080609@iol.ie>

On 19/03/2012 12:04, ESLI george wrote:
> We want do a Master-Slave replication between ubuntu(Master) and
> windows(Slave) in PostgreSQL 9.1 using Slony2.1. we have problems in
> installing slony 2.1 in windows.
> We have downloaded the source files. unlike previous versions slony 2.1
> doesn't have a .exe file. So can you help us with the steps to install
> slony 2.1 in windows xp.

Guten Tag,

PgAdmin includes the very useful "StackBuilder" application, which will
download and install Slony-I (among many other things) for you. I don't
know what version of Slony the latest StackBuilder installs, but you'll
need to ensure that the Linux version matches - the versions of Slony
must be identical.

I hope this helps,

Ray.

-- 
Raymond O'Donnell :: Galway :: Ireland
rod at iol.ie

From laurapassigni at yahoo.it  Mon Mar 19 06:55:53 2012
From: laurapassigni at yahoo.it (Laura Passigni)
Date: Mon, 19 Mar 2012 13:55:53 +0000 (GMT)
Subject: [Slony1-general] Slow sync
In-Reply-To: <4F57E132.3050607@ca.afilias.info>
References: <1331117844.5271.YahooMailNeo@web28504.mail.ukl.yahoo.com>
	<4F57E132.3050607@ca.afilias.info>
Message-ID: <1332165353.99521.YahooMailNeo@web28516.mail.ukl.yahoo.com>

Thank you for your answer.
I installed the new version (2.1.1) and it is faster. 
However I still have some delay, so I think that also some?
configurations are necessary, as you suggested.
Thank you,
?
Laura

________________________________
Da: Steve Singer <ssinger at ca.afilias.info>
A: Laura Passigni <laurapassigni at yahoo.it> 
Cc: "slony1-general at lists.slony.info" <slony1-general at lists.slony.info> 
Inviato: Mercoled? 7 Marzo 2012 23:29
Oggetto: Re: [Slony1-general] Slow sync

On 12-03-07 05:57 AM, Laura Passigni wrote:
> Hi,
> I have a big database (about 1350GB) with Slony replica (1 master and 1
> slave).
> Last week I have had a network crash between master and slave server.
> Unfortunately there was a bulk import in progress in the master
> database. As result the slave server was not in sync with the master for
> few days.
> There are now about 80.000 records in the sl_event table and the sync is
> very slow. I have seen in the log file that the sync of each event
> requires about 1500/2000 seconds. It is a very huge time.
> Is there something that I can do? Is there some faster way to sync the
> databases?
> Thank you,
> Laura
> 

It is possible that your issue is what we have been referring to as bug 167.? This has been fixed in slony 2.1.0.? What happens is that when sl_log_1 or sl_log_2 grows beyond a certain size the query turns into a sequential scan.

Other than upgrading,? you need to push the sync interval up so you generate fewer syncs, and increase the sync_groupsize so it processes more syncs together.? This might allow slony to catch up.? Once it is caught up your sl_log tables will get truncated and you can go back to normal settings/operations.


> 
> 
> _______________________________________________
> Slony1-general mailing list
> Slony1-general at lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20120319/671a054f/attachment.htm 

From georgeesli at gmail.com  Mon Mar 19 07:49:45 2012
From: georgeesli at gmail.com (ESLI george)
Date: Mon, 19 Mar 2012 15:49:45 +0100
Subject: [Slony1-general] Installing slony-2.1 in Windows Xp
In-Reply-To: <4F672EA1.3080609@iol.ie>
References: <CAPLB0Xu8ci4HAnoz6-khZGvhNFivwqRkHTTwv78LMm0NMujZcg@mail.gmail.com>
	<4F672EA1.3080609@iol.ie>
Message-ID: <CAPLB0XtyooX2BDhp8O2W_UKPfRacgamtGdybjGixK280eP8SHQ@mail.gmail.com>

Hi,

In our postgresql 9.1 - stack builder, we dont have a slony option in the
replication section.Can you provide us with other options.

Thanks & Regards
Esli

On Mon, Mar 19, 2012 at 2:03 PM, Raymond O'Donnell <rod at iol.ie> wrote:

> On 19/03/2012 12:04, ESLI george wrote:
> > We want do a Master-Slave replication between ubuntu(Master) and
> > windows(Slave) in PostgreSQL 9.1 using Slony2.1. we have problems in
> > installing slony 2.1 in windows.
> > We have downloaded the source files. unlike previous versions slony 2.1
> > doesn't have a .exe file. So can you help us with the steps to install
> > slony 2.1 in windows xp.
>
> Guten Tag,
>
> PgAdmin includes the very useful "StackBuilder" application, which will
> download and install Slony-I (among many other things) for you. I don't
> know what version of Slony the latest StackBuilder installs, but you'll
> need to ensure that the Linux version matches - the versions of Slony
> must be identical.
>
> I hope this helps,
>
> Ray.
>
> --
> Raymond O'Donnell :: Galway :: Ireland
> rod at iol.ie
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20120319/807d0e1d/attachment.htm 

From ssinger at ca.afilias.info  Mon Mar 19 07:56:09 2012
From: ssinger at ca.afilias.info (Steve Singer)
Date: Mon, 19 Mar 2012 10:56:09 -0400
Subject: [Slony1-general] Installing slony-2.1 in Windows Xp
In-Reply-To: <CAPLB0XtyooX2BDhp8O2W_UKPfRacgamtGdybjGixK280eP8SHQ@mail.gmail.com>
References: <CAPLB0Xu8ci4HAnoz6-khZGvhNFivwqRkHTTwv78LMm0NMujZcg@mail.gmail.com>	<4F672EA1.3080609@iol.ie>
	<CAPLB0XtyooX2BDhp8O2W_UKPfRacgamtGdybjGixK280eP8SHQ@mail.gmail.com>
Message-ID: <4F674909.8030404@ca.afilias.info>

On 12-03-19 10:49 AM, ESLI george wrote:
> Hi,
>
> In our postgresql 9.1 - stack builder, we dont have a slony option in
> the replication section.Can you provide us with other options.

http://www.slony.info/documentation/2.1/administration.html#BUILDINGWIN32

Has some high level instructions on compiling Slony on WIN32.  You could 
compile it yourself.


>
> Thanks & Regards
> Esli
>
> On Mon, Mar 19, 2012 at 2:03 PM, Raymond O'Donnell <rod at iol.ie
> <mailto:rod at iol.ie>> wrote:
>
>     On 19/03/2012 12:04, ESLI george wrote:
>      > We want do a Master-Slave replication between ubuntu(Master) and
>      > windows(Slave) in PostgreSQL 9.1 using Slony2.1. we have problems in
>      > installing slony 2.1 in windows.
>      > We have downloaded the source files. unlike previous versions
>     slony 2.1
>      > doesn't have a .exe file. So can you help us with the steps to
>     install
>      > slony 2.1 in windows xp.
>
>     Guten Tag,
>
>     PgAdmin includes the very useful "StackBuilder" application, which will
>     download and install Slony-I (among many other things) for you. I don't
>     know what version of Slony the latest StackBuilder installs, but you'll
>     need to ensure that the Linux version matches - the versions of Slony
>     must be identical.
>
>     I hope this helps,
>
>     Ray.
>
>     --
>     Raymond O'Donnell :: Galway :: Ireland
>     rod at iol.ie <mailto:rod at iol.ie>
>
>
>
>
> _______________________________________________
> Slony1-general mailing list
> Slony1-general at lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general


From georgeesli at gmail.com  Mon Mar 19 08:35:01 2012
From: georgeesli at gmail.com (ESLI george)
Date: Mon, 19 Mar 2012 16:35:01 +0100
Subject: [Slony1-general] Installing slony-2.1 in Windows Xp
In-Reply-To: <4F674909.8030404@ca.afilias.info>
References: <CAPLB0Xu8ci4HAnoz6-khZGvhNFivwqRkHTTwv78LMm0NMujZcg@mail.gmail.com>
	<4F672EA1.3080609@iol.ie>
	<CAPLB0XtyooX2BDhp8O2W_UKPfRacgamtGdybjGixK280eP8SHQ@mail.gmail.com>
	<4F674909.8030404@ca.afilias.info>
Message-ID: <CAPLB0Xu08qXShTbqudEwHwy4QDiwPUE59ZWk4oW5fGKE5xCopw@mail.gmail.com>

Hi,
Can you tell me where to declare the environment variables PGSHARE
,PG_INC,PG_LIB, PTHREADS_INC,PTHREADS_LIB and GETTEXT_LIB in win 32?

On Mon, Mar 19, 2012 at 3:56 PM, Steve Singer <ssinger at ca.afilias.info>wrote:

> On 12-03-19 10:49 AM, ESLI george wrote:
>
>> Hi,
>>
>> In our postgresql 9.1 - stack builder, we dont have a slony option in
>> the replication section.Can you provide us with other options.
>>
>
> http://www.slony.info/**documentation/2.1/**administration.html#**
> BUILDINGWIN32<http://www.slony.info/documentation/2.1/administration.html#BUILDINGWIN32>
>
> Has some high level instructions on compiling Slony on WIN32.  You could
> compile it yourself.
>
>
>
>> Thanks & Regards
>> Esli
>>
>> On Mon, Mar 19, 2012 at 2:03 PM, Raymond O'Donnell <rod at iol.ie
>> <mailto:rod at iol.ie>> wrote:
>>
>>    On 19/03/2012 12:04, ESLI george wrote:
>>     > We want do a Master-Slave replication between ubuntu(Master) and
>>     > windows(Slave) in PostgreSQL 9.1 using Slony2.1. we have problems in
>>     > installing slony 2.1 in windows.
>>     > We have downloaded the source files. unlike previous versions
>>    slony 2.1
>>     > doesn't have a .exe file. So can you help us with the steps to
>>    install
>>     > slony 2.1 in windows xp.
>>
>>    Guten Tag,
>>
>>    PgAdmin includes the very useful "StackBuilder" application, which will
>>    download and install Slony-I (among many other things) for you. I don't
>>    know what version of Slony the latest StackBuilder installs, but you'll
>>    need to ensure that the Linux version matches - the versions of Slony
>>    must be identical.
>>
>>    I hope this helps,
>>
>>    Ray.
>>
>>    --
>>    Raymond O'Donnell :: Galway :: Ireland
>>    rod at iol.ie <mailto:rod at iol.ie>
>>
>>
>>
>>
>> ______________________________**_________________
>> Slony1-general mailing list
>> Slony1-general at lists.slony.**info <Slony1-general at lists.slony.info>
>> http://lists.slony.info/**mailman/listinfo/slony1-**general<http://lists.slony.info/mailman/listinfo/slony1-general>
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20120319/efdaa6bd/attachment-0001.htm 

From cbbrowne at afilias.info  Mon Mar 19 09:42:30 2012
From: cbbrowne at afilias.info (Christopher Browne)
Date: Mon, 19 Mar 2012 12:42:30 -0400
Subject: [Slony1-general] Installing slony-2.1 in Windows Xp
In-Reply-To: <CAPLB0Xu08qXShTbqudEwHwy4QDiwPUE59ZWk4oW5fGKE5xCopw@mail.gmail.com>
References: <CAPLB0Xu8ci4HAnoz6-khZGvhNFivwqRkHTTwv78LMm0NMujZcg@mail.gmail.com>
	<4F672EA1.3080609@iol.ie>
	<CAPLB0XtyooX2BDhp8O2W_UKPfRacgamtGdybjGixK280eP8SHQ@mail.gmail.com>
	<4F674909.8030404@ca.afilias.info>
	<CAPLB0Xu08qXShTbqudEwHwy4QDiwPUE59ZWk4oW5fGKE5xCopw@mail.gmail.com>
Message-ID: <CANfbgbbznKY360ug2QsUhWJNk=eGCez57zN60tO+EbXEY-rxEQ@mail.gmail.com>

On Mon, Mar 19, 2012 at 11:35 AM, ESLI george <georgeesli at gmail.com> wrote:
> Hi,
> Can you tell me where to declare the?environment variables PGSHARE
> ,PG_INC,PG_LIB, PTHREADS_INC,PTHREADS_LIB and GETTEXT_LIB in win 32?

The Postgres-related stuff is likely to get defined suitably so that
pg_configure can find it all.

For third-party libraries, it'll all depend on how you installed the
third party libs.  In effect, if you installed them, you should know
where PTHREADS_INC, GETTEXT_LIB, and such are.

From ssinger at ca.afilias.info  Mon Mar 19 10:30:19 2012
From: ssinger at ca.afilias.info (Steve Singer)
Date: Mon, 19 Mar 2012 13:30:19 -0400
Subject: [Slony1-general] Installing slony-2.1 in Windows Xp
In-Reply-To: <CAPLB0Xu08qXShTbqudEwHwy4QDiwPUE59ZWk4oW5fGKE5xCopw@mail.gmail.com>
References: <CAPLB0Xu8ci4HAnoz6-khZGvhNFivwqRkHTTwv78LMm0NMujZcg@mail.gmail.com>
	<4F672EA1.3080609@iol.ie>
	<CAPLB0XtyooX2BDhp8O2W_UKPfRacgamtGdybjGixK280eP8SHQ@mail.gmail.com>
	<4F674909.8030404@ca.afilias.info>
	<CAPLB0Xu08qXShTbqudEwHwy4QDiwPUE59ZWk4oW5fGKE5xCopw@mail.gmail.com>
Message-ID: <4F676D2B.1090205@ca.afilias.info>

On 12-03-19 11:35 AM, ESLI george wrote:
> Hi,
> Can you tell me where to declare the environment variables PGSHARE
> ,PG_INC,PG_LIB, PTHREADS_INC,PTHREADS_LIB and GETTEXT_LIB in win 32?
>

In the command window you would type something like

SET PTHREADS_INC "c:\\pthreads\\include"

to set the environment variable.   (This is the command prompt that the 
Win32 SDK (or MSVC) installs)

The paths would be the actual places that you installed all the third 
party packages and postgresql into.





> On Mon, Mar 19, 2012 at 3:56 PM, Steve Singer <ssinger at ca.afilias.info
> <mailto:ssinger at ca.afilias.info>> wrote:
>
>     On 12-03-19 10:49 AM, ESLI george wrote:
>
>         Hi,
>
>         In our postgresql 9.1 - stack builder, we dont have a slony
>         option in
>         the replication section.Can you provide us with other options.
>
>
>     http://www.slony.info/__documentation/2.1/__administration.html#__BUILDINGWIN32
>     <http://www.slony.info/documentation/2.1/administration.html#BUILDINGWIN32>
>
>     Has some high level instructions on compiling Slony on WIN32.  You
>     could compile it yourself.
>
>
>
>         Thanks & Regards
>         Esli
>
>         On Mon, Mar 19, 2012 at 2:03 PM, Raymond O'Donnell <rod at iol.ie
>         <mailto:rod at iol.ie>
>         <mailto:rod at iol.ie <mailto:rod at iol.ie>>> wrote:
>
>             On 19/03/2012 12:04, ESLI george wrote:
>          > We want do a Master-Slave replication between ubuntu(Master) and
>          > windows(Slave) in PostgreSQL 9.1 using Slony2.1. we have
>         problems in
>          > installing slony 2.1 in windows.
>          > We have downloaded the source files. unlike previous versions
>             slony 2.1
>          > doesn't have a .exe file. So can you help us with the steps to
>             install
>          > slony 2.1 in windows xp.
>
>             Guten Tag,
>
>             PgAdmin includes the very useful "StackBuilder" application,
>         which will
>             download and install Slony-I (among many other things) for
>         you. I don't
>             know what version of Slony the latest StackBuilder installs,
>         but you'll
>             need to ensure that the Linux version matches - the versions
>         of Slony
>             must be identical.
>
>             I hope this helps,
>
>             Ray.
>
>             --
>             Raymond O'Donnell :: Galway :: Ireland
>         rod at iol.ie <mailto:rod at iol.ie> <mailto:rod at iol.ie
>         <mailto:rod at iol.ie>>
>
>
>
>
>         _________________________________________________
>         Slony1-general mailing list
>         Slony1-general at lists.slony.__info
>         <mailto:Slony1-general at lists.slony.info>
>         http://lists.slony.info/__mailman/listinfo/slony1-__general
>         <http://lists.slony.info/mailman/listinfo/slony1-general>
>
>
>


From dbrb2002-sql at yahoo.com  Mon Mar 19 14:04:36 2012
From: dbrb2002-sql at yahoo.com (Brian Trudal)
Date: Mon, 19 Mar 2012 14:04:36 -0700 (PDT)
Subject: [Slony1-general] Moveset changes to sub_forward
Message-ID: <1332191076.50097.YahooMailNeo@web31805.mail.mud.yahoo.com>

Hi there

We have 3 nodes in cluster. 

After moving a set from one node (node-1) to another (node-2), whats the best way to reset the origin in another subscriber (node-3) as it still talking to node-1 as node-1 is doing forward of node-2 changes to node-3 ; rather I want node-3 directly talk to node-2 (new origin) without sub_forward by node-1.

The sl_subscribe looks like this:

engine_db=# select * from sl_subscribe where sub_set=1;
?sub_set | sub_provider | sub_receiver | sub_forward | sub_active 
---------+--------------+--------------+-------------+------------
?????? 1 |??????????? 1 |??????????? 3 | f?????????? | t
?????? 1 |??????????? 2 |??????????? 1 | t?????????? | t
(3 rows)

Rather, after moveset, I expected, line 1 to go away and line-2 to have direct replication to 3 instead of forward through 1.

Thanks for help
Brian
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20120319/2f21fa29/attachment.htm 

From stephane.schildknecht at postgresql.fr  Mon Mar 19 14:26:17 2012
From: stephane.schildknecht at postgresql.fr (=?ISO-8859-15?Q?=22St=E9phane_A=2E_Schildknecht=22?=)
Date: Mon, 19 Mar 2012 22:26:17 +0100
Subject: [Slony1-general] Moveset changes to sub_forward
In-Reply-To: <1332191076.50097.YahooMailNeo@web31805.mail.mud.yahoo.com>
References: <1332191076.50097.YahooMailNeo@web31805.mail.mud.yahoo.com>
Message-ID: <4F67A479.7090006@postgresql.fr>

Le 19/03/2012 22:04, Brian Trudal a ?crit :
> Hi there

Hi,

> 
> We have 3 nodes in cluster.
> 
> After moving a set from one node (node-1) to another (node-2), whats the best
> way to reset the origin in another subscriber (node-3) as it still talking to
> node-1 as node-1 is doing forward of node-2 changes to node-3 ; rather I want
> node-3 directly talk to node-2 (new origin) without sub_forward by node-1.
> 
> The sl_subscribe looks like this:
> 
> engine_db=# select * from sl_subscribe where sub_set=1;
>  sub_set | sub_provider | sub_receiver | sub_forward | sub_active
> ---------+--------------+--------------+-------------+------------
>        1 |            1 |            3 | f           | t
>        1 |            2 |            1 | t           | t
> (3 rows)
> 
> Rather, after moveset, I expected, line 1 to go away and line-2 to have direct
> replication to 3 instead of forward through 1.
> 

You can re-subscribe your nodes in a way that fits your needs.

Just issue subscribe sets commands, and tell node 3 to subscribe to 2.

BR,
-- 
St?phane Schildknecht
http://www.Loxodata.com
Contact r?gional PostgreSQL

From venu_anuganti at yahoo.com  Mon Mar 19 14:40:22 2012
From: venu_anuganti at yahoo.com (Venu Anuganti)
Date: Mon, 19 Mar 2012 14:40:22 -0700 (PDT)
Subject: [Slony1-general] Moveset changes to sub_forward
In-Reply-To: <4F67A479.7090006@postgresql.fr>
References: <1332191076.50097.YahooMailNeo@web31805.mail.mud.yahoo.com>
	<4F67A479.7090006@postgresql.fr>
Message-ID: <1332193222.30275.YahooMailNeo@web31802.mail.mud.yahoo.com>

Doesn't that cause the complete copy of whole tables ?



________________________________
 From: ""St?phane A. Schildknecht"" <stephane.schildknecht at postgresql.fr>
To: slony1-general at lists.slony.info 
Sent: Monday, March 19, 2012 2:26 PM
Subject: Re: [Slony1-general] Moveset changes to sub_forward
 
Le 19/03/2012 22:04, Brian Trudal a ?crit :
> Hi there

Hi,

> 
> We have 3 nodes in cluster.
> 
> After moving a set from one node (node-1) to another (node-2), whats the best
> way to reset the origin in another subscriber (node-3) as it still talking to
> node-1 as node-1 is doing forward of node-2 changes to node-3 ; rather I want
> node-3 directly talk to node-2 (new origin) without sub_forward by node-1.
> 
> The sl_subscribe looks like this:
> 
> engine_db=# select * from sl_subscribe where sub_set=1;
>? sub_set | sub_provider | sub_receiver | sub_forward | sub_active
> ---------+--------------+--------------+-------------+------------
>? ? ? ? 1 |? ? ? ? ? ? 1 |? ? ? ? ? ? 3 | f? ? ? ? ?  | t
>? ? ? ? 1 |? ? ? ? ? ? 2 |? ? ? ? ? ? 1 | t? ? ? ? ?  | t
> (3 rows)
> 
> Rather, after moveset, I expected, line 1 to go away and line-2 to have direct
> replication to 3 instead of forward through 1.
> 

You can re-subscribe your nodes in a way that fits your needs.

Just issue subscribe sets commands, and tell node 3 to subscribe to 2.

BR,
-- 
St?phane Schildknecht
http://www.Loxodata.com
Contact r?gional PostgreSQL
_______________________________________________
Slony1-general mailing list
Slony1-general at lists.slony.info
http://lists.slony.info/mailman/listinfo/slony1-general
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20120319/942552bf/attachment.htm 

From cbbrowne at afilias.info  Mon Mar 19 15:29:26 2012
From: cbbrowne at afilias.info (Christopher Browne)
Date: Mon, 19 Mar 2012 18:29:26 -0400
Subject: [Slony1-general] Moveset changes to sub_forward
In-Reply-To: <1332193222.30275.YahooMailNeo@web31802.mail.mud.yahoo.com>
References: <1332191076.50097.YahooMailNeo@web31805.mail.mud.yahoo.com>
	<4F67A479.7090006@postgresql.fr>
	<1332193222.30275.YahooMailNeo@web31802.mail.mud.yahoo.com>
Message-ID: <CANfbgbaR0dNF2FapNp-cqsZveu0n2eaoirf6NZuQ3rcB0Jc_Fg@mail.gmail.com>

On Mon, Mar 19, 2012 at 5:40 PM, Venu Anuganti <venu_anuganti at yahoo.com> wrote:
> Doesn't that cause the complete copy of whole tables ?

No, if a node is already subscribed, SUBSCRIBE SET just changes how it
is to draw its data.  It doesn't need to start over from scratch.

While that behaviour is documented, if you read the documentation
carefully, I'd agree that the present behaviour isn't totally
intuitive.  I do not find it surprising that you would imagine that it
*would* lead to a complete copy.

There have been some private conversations where the idea has come up
that perhaps we should have add sort of RESHAPE SUBSCRIPTION command,
so that:

- SUBSCRIBE SET would be reserved for the "do a COPY of the complete
set of data"
- RESHAPE SUBSCRIPTION makes configuration changes.

I don't think we agreed conclusively that such a change ought to be
made, but it would be an improvement in the sense that it would fit
with your intuition.

From ssinger at ca.afilias.info  Mon Mar 19 19:04:57 2012
From: ssinger at ca.afilias.info (Steve Singer)
Date: Mon, 19 Mar 2012 22:04:57 -0400
Subject: [Slony1-general] Moveset changes to sub_forward
In-Reply-To: <CANfbgbaR0dNF2FapNp-cqsZveu0n2eaoirf6NZuQ3rcB0Jc_Fg@mail.gmail.com>
References: <1332191076.50097.YahooMailNeo@web31805.mail.mud.yahoo.com>	<4F67A479.7090006@postgresql.fr>	<1332193222.30275.YahooMailNeo@web31802.mail.mud.yahoo.com>
	<CANfbgbaR0dNF2FapNp-cqsZveu0n2eaoirf6NZuQ3rcB0Jc_Fg@mail.gmail.com>
Message-ID: <4F67E5C9.4030209@ca.afilias.info>

On 12-03-19 06:29 PM, Christopher Browne wrote:

> There have been some private conversations where the idea has come up
> that perhaps we should have add sort of RESHAPE SUBSCRIPTION command,
> so that:
>
> - SUBSCRIBE SET would be reserved for the "do a COPY of the complete
> set of data"
> - RESHAPE SUBSCRIPTION makes configuration changes.
>
> I don't think we agreed conclusively that such a change ought to be
> made, but it would be an improvement in the sense that it would fit
> with your intuition.

Actually the RESUBSCRIBE_NODE command is checked into master for 2.2.0.
In 2.2 it is the only way to reshape certain types of cluster.   Venu 
should be able to use the subscribe command in 2.1 or earlier.


> _______________________________________________
> Slony1-general mailing list
> Slony1-general at lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general


From brianp at occinc.com  Tue Mar 27 04:59:26 2012
From: brianp at occinc.com (Brian Peschel)
Date: Tue, 27 Mar 2012 06:59:26 -0500
Subject: [Slony1-general] Problem with Slony implementation of PostGIS
Message-ID: <4F71AB9E.8030503@occinc.com>

(I am sending this to both the PostGIS and Slony support lists as I am 
not sure of the correct location).

I have run into a problem with how PostGIS and Slony are reacting with 
each other.  Let me say upfront, I am a PostGIS newbee and know just 
about nothing about Slony.  And I know this email is long, but I want to 
make sure I included everything.  This is on a Posgtres 8.3.1, PostGIS 
1.3, and Slony 1.2.20

I created a PostGIS table like this:
create table b_temp as select 11459815 as msg_no, 0 as rev_no, 
GeometryFromText('POLYGON((1 1, 2 2, 3 3, 1 1))') as geom1,  
GeometryFromText('POLYGON((1 1, 2 2, 3 3, 3 3, 1 1))') as geom2;

Notice that geom2 has a repeated point of geom1, but other than that 
they are the same:
select geom1 = geom2, ST_Equals(geom1, geom2), ST_OrderingEquals(geom1, 
geom2) from b_temp;
  ?column? | st_equals | st_orderingequals
----------+-----------+-------------------
  t        | t         | f

I then slon'd this table to another node, but didn't start slony on the 
other node so I could look at slony log tables.

Apparently, on an update, slon looks at the data before and after and 
compares if anything has changed.  Then sets the update command for the 
second node appropriately.  Say for example:
update b_temp set rev_no = 1;
Looking in sl_log_1, I see:
log_origin | log_xid  | log_tableid | log_actionseq | log_cmdtype 
|                                                                                                      
log_cmddata
------------+----------+-------------+---------------+-------------+----------------------------------------------------------
           1 | 82987244 |         217 |      55210696 | U           | 
"rev_no"='1' where "msg_no"='11459815' and "rev_no"='0'

That is about what I expected.  Things get interesting if you do a 
non-update.  For example, do this:
update b_temp set rev_no = 1;

Looking in sl_log_1, I see:
log_origin | log_xid  | log_tableid | log_actionseq | log_cmdtype 
|                                                                                                      
log_cmddata
------------+----------+-------------+---------------+-------------+----------------------------------------------------------------
           1 | 82987244 |         217 |      55210696 | U           | 
"msg_no"='11459815'where "msg_no"='11459815' and "rev_no"='0'

Again, not too surprising as the data in the table before and after the 
update are the same.  The problem comes in with updating the geometric.  
Say I want to remove the repeated point in geom2.  So I do this update:
update b_temp set geom2 = geom1;

Doing a point count in node 1 shows the geom changed:
select st_npoints(geom1), st_npoints(geom2) from b_temp;
  st_npoints | st_npoints
------------+------------
           4 |          4

Which is exactly what I expected.  But if you look on node 2 (after slon 
is started)
select st_npoints(geom1), st_npoints(geom2) from b_temp;
  st_npoints | st_npoints
------------+------------
           4 |          5

which is not what I expected.  Looking into sl_log_1 I see:
log_origin | log_xid  | log_tableid | log_actionseq | log_cmdtype 
|                                                                                                      
log_cmddata
------------+----------+-------------+---------------+-------------+----------------------------------------------------------------
           1 | 82987244 |         217 |      55210696 | U           | 
"msg_no"='11459815'where "msg_no"='11459815' and "rev_no"='0'

Also, not what I expected.

I believe the problem comes back to the PostGIS = operator that slony is 
using to compare the before and after data.  Because the PostGIS = 
operator ignores directionality, these two geometrics are considered the 
same even though they are not.  This causes issues where the data in my 
secondary node is different that the data in my primary node even though 
the two nodes are slon'd.  Which, in my mind, is a huge issue.

So, am I missing something?  Is there some way to get slony to use The 
PostGIS function st_orderingequals() rather than = or st_equals()?  Or 
is there some way to get slony to do a binary bit comparison of the two 
geometrics?  if it helps, this is the slony trigger on the table in the 
master database:

     _ks_slony_logtrigger_217 AFTER INSERT OR DELETE OR UPDATE ON b_temp 
FOR EACH ROW EXECUTE PROCEDURE _ks_slony.logtrigger('_ks_slony', '217', 
'kkv')

Thanks for the long read....

- Brian
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20120327/6e2a76dc/attachment.htm 

From ssinger at ca.afilias.info  Tue Mar 27 06:28:17 2012
From: ssinger at ca.afilias.info (Steve Singer)
Date: Tue, 27 Mar 2012 09:28:17 -0400
Subject: [Slony1-general] Problem with Slony implementation of PostGIS
In-Reply-To: <4F71AB9E.8030503@occinc.com>
References: <4F71AB9E.8030503@occinc.com>
Message-ID: <4F71C071.6090809@ca.afilias.info>

On 12-03-27 07:59 AM, Brian Peschel wrote:

Slony looks for the '=' operator on the geometry type and uses that to 
decide if the column has changed.

Postgis seems to points the '=' operator at ST_Geometry_eq which returns 
true even if the two geometries are different (as in your example below).

Options I can think of include:
1) Deleting the '=' operator on two geometry types.  If you do this 
slony will fallback to using text comparision.  I am not sure what this 
will break in your application (or in postgis)

2) Modify slony_funcs.c to not use the operator on geometry types.  This 
would be around  the comment 'If we have an equal operator...' in 
slony1_funcs.c
3) You could probably create an additional column in your table that is 
a text representation of the geometry.  You would have a trigger on the 
master table such that every time the geometry *changed* you updated the 
text representation column, which slony would then see as a change.  You 
then have a trigger on the slave that updates the geometry column every 
time the text representation changes.  {kind of ugly}




> (I am sending this to both the PostGIS and Slony support lists as I am
> not sure of the correct location).
>
> I have run into a problem with how PostGIS and Slony are reacting with
> each other. Let me say upfront, I am a PostGIS newbee and know just
> about nothing about Slony. And I know this email is long, but I want to
> make sure I included everything. This is on a Posgtres 8.3.1, PostGIS
> 1.3, and Slony 1.2.20
>
> I created a PostGIS table like this:
> create table b_temp as select 11459815 as msg_no, 0 as rev_no,
> GeometryFromText('POLYGON((1 1, 2 2, 3 3, 1 1))') as geom1,
> GeometryFromText('POLYGON((1 1, 2 2, 3 3, 3 3, 1 1))') as geom2;
>
> Notice that geom2 has a repeated point of geom1, but other than that
> they are the same:
> select geom1 = geom2, ST_Equals(geom1, geom2), ST_OrderingEquals(geom1,
> geom2) from b_temp;
> ?column? | st_equals | st_orderingequals
> ----------+-----------+-------------------
> t | t | f
>
> I then slon'd this table to another node, but didn't start slony on the
> other node so I could look at slony log tables.
>
> Apparently, on an update, slon looks at the data before and after and
> compares if anything has changed. Then sets the update command for the
> second node appropriately. Say for example:
> update b_temp set rev_no = 1;
> Looking in sl_log_1, I see:
> log_origin | log_xid | log_tableid | log_actionseq | log_cmdtype |
> log_cmddata
> ------------+----------+-------------+---------------+-------------+----------------------------------------------------------
> 1 | 82987244 | 217 | 55210696 | U | "rev_no"='1' where
> "msg_no"='11459815' and "rev_no"='0'
>
> That is about what I expected. Things get interesting if you do a
> non-update. For example, do this:
> update b_temp set rev_no = 1;
>
> Looking in sl_log_1, I see:
> log_origin | log_xid | log_tableid | log_actionseq | log_cmdtype |
> log_cmddata
> ------------+----------+-------------+---------------+-------------+----------------------------------------------------------------
> 1 | 82987244 | 217 | 55210696 | U | "msg_no"='11459815'where
> "msg_no"='11459815' and "rev_no"='0'
>
> Again, not too surprising as the data in the table before and after the
> update are the same. The problem comes in with updating the geometric.
> Say I want to remove the repeated point in geom2. So I do this update:
> update b_temp set geom2 = geom1;
>
> Doing a point count in node 1 shows the geom changed:
> select st_npoints(geom1), st_npoints(geom2) from b_temp;
> st_npoints | st_npoints
> ------------+------------
> 4 | 4
>
> Which is exactly what I expected. But if you look on node 2 (after slon
> is started)
> select st_npoints(geom1), st_npoints(geom2) from b_temp;
> st_npoints | st_npoints
> ------------+------------
> 4 | 5
>
> which is not what I expected. Looking into sl_log_1 I see:
> log_origin | log_xid | log_tableid | log_actionseq | log_cmdtype |
> log_cmddata
> ------------+----------+-------------+---------------+-------------+----------------------------------------------------------------
> 1 | 82987244 | 217 | 55210696 | U | "msg_no"='11459815'where
> "msg_no"='11459815' and "rev_no"='0'
>
> Also, not what I expected.
>
> I believe the problem comes back to the PostGIS = operator that slony is
> using to compare the before and after data. Because the PostGIS =
> operator ignores directionality, these two geometrics are considered the
> same even though they are not. This causes issues where the data in my
> secondary node is different that the data in my primary node even though
> the two nodes are slon'd. Which, in my mind, is a huge issue.
>
> So, am I missing something? Is there some way to get slony to use The
> PostGIS function st_orderingequals() rather than = or st_equals()? Or is
> there some way to get slony to do a binary bit comparison of the two
> geometrics? if it helps, this is the slony trigger on the table in the
> master database:
>
> _ks_slony_logtrigger_217 AFTER INSERT OR DELETE OR UPDATE ON b_temp FOR
> EACH ROW EXECUTE PROCEDURE _ks_slony.logtrigger('_ks_slony', '217', 'kkv')
>
> Thanks for the long read....
>
> - Brian
>
>
>
> _______________________________________________
> Slony1-general mailing list
> Slony1-general at lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general


From dbrb2002-sql at yahoo.com  Tue Mar 27 13:48:14 2012
From: dbrb2002-sql at yahoo.com (Brian Trudal)
Date: Tue, 27 Mar 2012 13:48:14 -0700 (PDT)
Subject: [Slony1-general] CLONE prepare
Message-ID: <1332881294.58103.YahooMailNeo@web31811.mail.mud.yahoo.com>

Hi there

I couldn't get much info from docs; can someone explain what CLONE PREPARE does ? Essentially I wanted to clone a subscriber1 to new subscriber3; but wanted to confirm; after the clone prepare; does the first subscriber1 will stop replicating from origin or it will continue to replicate ?

What happens to other subscribers in the origin node if there are more than one subscribers already ?

Also, do we need to skip the dumping of slony schema (_{clustername}) during the dump + restore while cloning new subscriber ? 

--
brian
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20120327/9d0f998c/attachment.htm 

