From richyen at iparadigms.com  Wed Dec  4 13:38:24 2013
From: richyen at iparadigms.com (Richard Yen)
Date: Wed, 4 Dec 2013 13:38:24 -0800
Subject: [Slony1-general] Events being duplicated in log shipping
Message-ID: <CAKWMdJYNm0y2mkr6EapQZJnHGqgrrq5JaAiTUiJFGJAYNP4EEg@mail.gmail.com>

Hi,

I'm experiencing some issues with slony log shipping where some events are
being written twice into log files.  Occasionally, what will happen is that
the replay of logship files generated by the -a flag, I will encounter
duplicate key violations in the destination node.  When I log in to look,
most (and in some cases, all) commands executed in the offending logship
file have already been applied to the destination node.  This leads me to
believe 1) the archive counter is not incrementing or 2) the DML commands
are being written more than once into separate logship files.

Has anyone else experienced this issue?  I'm running v. 2.1.3 on postgres
8.4.17

Regards,
--Richard
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20131204/e58382a5/attachment.htm 

From steve at ssinger.info  Wed Dec  4 18:21:54 2013
From: steve at ssinger.info (Steve Singer)
Date: Wed, 4 Dec 2013 21:21:54 -0500
Subject: [Slony1-general] Events being duplicated in log shipping
In-Reply-To: <CAKWMdJYNm0y2mkr6EapQZJnHGqgrrq5JaAiTUiJFGJAYNP4EEg@mail.gmail.com>
References: <CAKWMdJYNm0y2mkr6EapQZJnHGqgrrq5JaAiTUiJFGJAYNP4EEg@mail.gmail.com>
Message-ID: <BLU0-SMTP47378346FB40FE5F5826C6DCD70@phx.gbl>

On 12/04/2013 04:38 PM, Richard Yen wrote:
> Hi,
>
> I'm experiencing some issues with slony log shipping where some events
> are being written twice into log files.  Occasionally, what will happen
> is that the replay of logship files generated by the -a flag, I will
> encounter duplicate key violations in the destination node.  When I log
> in to look, most (and in some cases, all) commands executed in the
> offending logship file have already been applied to the destination
> node.  This leads me to believe 1) the archive counter is not
> incrementing or 2) the DML commands are being written more than once
> into separate logship files.
>
> Has anyone else experienced this issue?  I'm running v. 2.1.3 on
> postgres 8.4.17
>


This sounds vaguely familiar, I think someone else has reported this 
before.  Do you have samples of .sql files that have the same data?

Is it the entire SYNC that is duplicated or only some rows?

What does your cluster configuration look like? Only 1 set and 1 
provider or something more complicated?


> Regards,
> --Richard
>
>
> _______________________________________________
> Slony1-general mailing list
> Slony1-general at lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
>


From ssinger at ca.afilias.info  Sat Dec  7 20:10:16 2013
From: ssinger at ca.afilias.info (Steve Singer)
Date: Sat, 07 Dec 2013 23:10:16 -0500
Subject: [Slony1-general] Slony1-2.2.1 build fails because port.h is not
 found
In-Reply-To: <CANFyU97hPZ7Kk2cP7Ec6H0qA7h9J50BG86HnSMNQTfhS_QhUbA@mail.gmail.com>
References: <CANFyU95iiXZ2OLn1OK8T-kA7N9Mp-aHsKWNeLd-0K8Ms_cEKyg@mail.gmail.com>
	<5294A396.5050105@ca.afilias.info>
	<CANFyU97hPZ7Kk2cP7Ec6H0qA7h9J50BG86HnSMNQTfhS_QhUbA@mail.gmail.com>
Message-ID: <52A3F128.3020309@ca.afilias.info>

On 11/29/2013 04:30 AM, Sandeep Thakkar wrote:
> The only work around I see now if to set the CPPFLAGS in the environment
> to the server include directory, so that CPPFLAGS_CLIENT takes it in the
> Makefile.global.
>
>

So in debian (or at least with Wheezy) where the original bug 315 was 
reported


libpq-dev puts port.h in /usr/include/postgresql/port.h so it gets 
picked up by the client include paths.  I am able to do a build with 
--with-pgport

This isn't actually a problem on debian, is the problem on OSX that 
port.h isn't being put in the libpq header directories?  Should it? 
Where do other platforms/distributions put port.h ?



> On Tue, Nov 26, 2013 at 7:05 PM, Steve Singer <ssinger at ca.afilias.info
> <mailto:ssinger at ca.afilias.info>> wrote:
>
>     On 11/26/2013 04:14 AM, Sandeep Thakkar wrote:
>
>         Hi
>
>         I was building Slony1-2.2.1 sources on Mac OS X and found that
>         the build
>         fails because of:
>
>         slonik.c:49:18: error: port.h: No such file or directory
>         CPPFLAGS is now defined to just CPPFLAGS_CLIENT that does not
>         include
>         the PG "server" include directory
>         ('<pginstall>/include/__postgresql/server' contains port.h). Any
>         specific
>         reason why this change was made in 2.2.1?
>
>
>
>     http://www.slony.info/__bugzilla/show_bug.cgi?id=315
>     <http://www.slony.info/bugzilla/show_bug.cgi?id=315>
>
>     On systems that have multiple versions of postgresql installed might
>     pull in files for the client from one version and server includes
>     from another.  You used to be able to get away with this but in more
>     recent versions of PG this breaks things.
>
>     I am not exactly sure what the best way to deal with this in the
>     PGPORT case? I have a feeling just adding the server includes back
>     in on --with-pgport builds will get us back to the bug 315 situation
>
>
>
>
>
>         --
>         Sandeep Thakkar
>
>
>         _________________________________________________
>         Slony1-general mailing list
>         Slony1-general at lists.slony.__info
>         <mailto:Slony1-general at lists.slony.info>
>         http://lists.slony.info/__mailman/listinfo/slony1-__general
>         <http://lists.slony.info/mailman/listinfo/slony1-general>
>
>
>
>
>
> --
> Sandeep Thakkar
>


