From richyen at iparadigms.com  Wed Dec  4 13:38:24 2013
From: richyen at iparadigms.com (Richard Yen)
Date: Wed, 4 Dec 2013 13:38:24 -0800
Subject: [Slony1-general] Events being duplicated in log shipping
Message-ID: <CAKWMdJYNm0y2mkr6EapQZJnHGqgrrq5JaAiTUiJFGJAYNP4EEg@mail.gmail.com>

Hi,

I'm experiencing some issues with slony log shipping where some events are
being written twice into log files.  Occasionally, what will happen is that
the replay of logship files generated by the -a flag, I will encounter
duplicate key violations in the destination node.  When I log in to look,
most (and in some cases, all) commands executed in the offending logship
file have already been applied to the destination node.  This leads me to
believe 1) the archive counter is not incrementing or 2) the DML commands
are being written more than once into separate logship files.

Has anyone else experienced this issue?  I'm running v. 2.1.3 on postgres
8.4.17

Regards,
--Richard
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20131204/e58382a5/attachment.htm 

From steve at ssinger.info  Wed Dec  4 18:21:54 2013
From: steve at ssinger.info (Steve Singer)
Date: Wed, 4 Dec 2013 21:21:54 -0500
Subject: [Slony1-general] Events being duplicated in log shipping
In-Reply-To: <CAKWMdJYNm0y2mkr6EapQZJnHGqgrrq5JaAiTUiJFGJAYNP4EEg@mail.gmail.com>
References: <CAKWMdJYNm0y2mkr6EapQZJnHGqgrrq5JaAiTUiJFGJAYNP4EEg@mail.gmail.com>
Message-ID: <BLU0-SMTP47378346FB40FE5F5826C6DCD70@phx.gbl>

On 12/04/2013 04:38 PM, Richard Yen wrote:
> Hi,
>
> I'm experiencing some issues with slony log shipping where some events
> are being written twice into log files.  Occasionally, what will happen
> is that the replay of logship files generated by the -a flag, I will
> encounter duplicate key violations in the destination node.  When I log
> in to look, most (and in some cases, all) commands executed in the
> offending logship file have already been applied to the destination
> node.  This leads me to believe 1) the archive counter is not
> incrementing or 2) the DML commands are being written more than once
> into separate logship files.
>
> Has anyone else experienced this issue?  I'm running v. 2.1.3 on
> postgres 8.4.17
>


This sounds vaguely familiar, I think someone else has reported this 
before.  Do you have samples of .sql files that have the same data?

Is it the entire SYNC that is duplicated or only some rows?

What does your cluster configuration look like? Only 1 set and 1 
provider or something more complicated?


> Regards,
> --Richard
>
>
> _______________________________________________
> Slony1-general mailing list
> Slony1-general at lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
>


