From cbbrowne at afilias.info  Tue Apr 12 12:35:13 2011
From: cbbrowne at afilias.info (Christopher Browne)
Date: Tue, 12 Apr 2011 15:35:13 -0400
Subject: [Slony1-general] Slony Recent News
Message-ID: <BANLkTimazF84arFR0shafR9kQ+HjGRwjGQ@mail.gmail.com>

It has been a while since the "team" has said anything much broader
than comments about one small issue or another.  It seems about time
to chat about what's up, as we have done quite a lot of stuff but not
given much feedback as to broader intent.  And for there to be some
understanding of "broad intent" is somewhat important.

I just posted a blog entry here <http://linuxdatabases.info/blog/?p=102>

I'll excerpt the Whole Thang...


                  What's up Lately? <2011-04-12 Tue>
                  ==================================

Author: Christopher Browne
Date: [2011-04-12 Tue 15:26]


Git Changeover
~~~~~~~~~~~~~~
   In July 2010, we switched over to use Git, which has been working
   out quite fine so far. The official repository is at
   [git.postgresql.org]; note that some developers are publishing their
   repositories publicly at GitHub:
   * [Christopher Browne]
   * [Steve Singer]
   * [Jan Wieck]

   You can find details at those "private" repositories of branches
   that the developers have opened to work on various bug fixes and
   features.

   [git.postgresql.org]: http://git.postgresql.org/gitweb?p=slony1-engine.git
   [Christopher Browne]: https://github.com/cbbrowne/slony1-engine
   [Steve Singer]: https://github.com/ssinger/slony1-engine
   [Jan Wieck]: https://github.com/wieck/slony1-engine

The next big version
~~~~~~~~~~~~~~~~~~~~
   We have been working on what seems most likely to be called the
   "2.1 release."
   - There are quite a lot of fixes and enhancements already in place.
     We have been quite faithful about integrating release notes in as
     changes are made, so [Master RELEASE notes] should be quite
     accurate in representing what has changed.  Some highlights
     include:
     - Changes to queries against ~sl_log_*~ tables improve
       performance when undergoing large backlog
     - Slonik now supports commands to bulk-add tables and sequences
     - Integration of [clustertest framework] that does rather more
       sophisticated tests, obsolescing previous "ducttape" and shell
       script tests.
     - Cleanup of a bunch of things
       - Use named parameters in all functions.
       - Dropped SNMP support that doesn't seem to run anymore, and
         which was never part of any regression tests.
   - It is unlikely that it will get dubbed "version 3," as there
     aren't the sorts of deep changes that would warrant such.
     - The database schema has not materially changed in any way that
       would warrant re-initializing clusters, as was the case between
       version 1.2 and 2.0.
     - The changes generally aren't really huge, with the exceptions
       of a couple features that aren't quite ready yet (which
       deserves its own separate discussion)

       [Master RELEASE notes]:
http://git.postgresql.org/gitweb?p=slony1-engine.git;a=blob_plain;f=RELEASE;hb=refs/heads/master
       [clustertest framework]:
https://github.com/clustertest/clustertest-framework

Still Outstanding
=================
    There are two features being worked on, which we hoped would be
    ready around the time of PGCon 2011:
    Implicit WAIT FOR EVENT: This feature causes most Slonik
         commands to wait for whatever event responses should be
         received before they may be considered properly finished.
         For instance ~SUBSCRIBE SET~ would wait until the
         subscription has been completed before proceeding.
    Multinode FAIL OVER: For clusters where there are multiple
         origins for different sets, this allows reshaping the entire
         cluster properly, which has historically been rather more
         troublesome than people usually were able to recognize.

    Unfortunately, neither of these are /quite/ ready yet.  It is
    conceivable that the automatic waiting may be /mostly/ ready, but
    complications and interruptions have gotten in the way of
    completion of multinode failover.

When will 2.1 be ready?
~~~~~~~~~~~~~~~~~~~~~~~
   Three possibilities seem to present themselves:
   1. Release what we've got as 2.1, let the outstanding items arrive
      in a future version.

      Unfortunately, this would seem to dictate that we support a
      "version 2.1" for an extended period of time, complete with the
      trouble and effort of backpatching.  It's not very attractive.

   2. Draw in ~Implicit WAIT FOR EVENT~, which would make for a
      substantially more featureful 2.1, and let ~multinode FAIL
      OVER~ come along later.

      We had been /hoping/ that there would be common functionality
      between these two features, so had imagined it a bad idea to do
      one without the other.  But perhaps that's wrong, and
      ~Implicit WAIT FOR EVENT~ doesn't /need/ multinode failover to
      be meaningful.  That does seem like it may be true.

      There is still the same issue as with 1. above, that this would
      mean having an extra version of Slony to support, which isn't
      something anyone is too keen on.

   3. Wait until it's all ready.

      This gets rid of the version proliferation problem, but means
      that it's going to be a while (several months, perhaps quite a
      few) before users may benefit from /any/ of these enhancements.

      Development of the failover facility seems like it will be
      bottlenecked for a while on Jan, so this suggests that it may be
      timely to solicit features that Steve and I might work on
      concurrently in the interim.

So, what might still go into 2.1?
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

   - We periodically get bug reports from people about this and that,
     and minor things will certainly get drawn in, particularly if
     they represent incorrect behaviour.

   - [ABORT script]

     I plan to send a note out soon describing my thoughts thus far.

   - [Cluster Analysis Tooling]

     I think it would be pretty neat to connect to a Slony cluster,
     pull out some data, and generate some web pages and GraphViz
     diagrams to characterize the status and health of the cluster.

   - There was evidently discussion at PGEast about trying to get the
     [altperl scripts] improved/cleaned up.

     My personal opinion (cbbrowne) is that they're not quite general
     enough, and that making them so would be more trouble than it's
     worth, so my "vote" would be to deprecate them.

     But that is certainly not the only opinion out there - there are
     apparently others that regularly use them.

     While I'm not keen on putting effort into them, if there is some
     consensus on what to do, I'd go along with it.  That might
     include:

     - Adding scripts to address slonik features that have not thus
       far been included in ~altperl~.

     - Integrating tests into the set of tests run using the
       clustertest framework, so that we have some verification that
       this stuff works properly.

   - /Insert Your Pet Feature Here?/

     Maybe there's some low hanging fruit that we're not aware of
     that's worth poking at.

     [ABORT script]: http://www.slony.info/bugzilla/show_bug.cgi?id=173
     [Cluster Analysis Tooling]:
http://www.slony.info/bugzilla/show_bug.cgi?id=176
     [altperl scripts]:
http://git.postgresql.org/gitweb?p=slony1-engine.git;a=tree;f=tools/altperl;h=2625f405fb36319c8db4b05df66ca626f911dbc6;hb=HEAD

From bnicholson at hp.com  Tue Apr 12 13:50:35 2011
From: bnicholson at hp.com (Nicholson, Brad (Toronto, ON, CA))
Date: Tue, 12 Apr 2011 20:50:35 +0000
Subject: [Slony1-general] Slony Recent News
In-Reply-To: <BANLkTimazF84arFR0shafR9kQ+HjGRwjGQ@mail.gmail.com>
References: <BANLkTimazF84arFR0shafR9kQ+HjGRwjGQ@mail.gmail.com>
Message-ID: <2626AEE4839D064CB0472A3814DC403F46D3F29AFB@GVW1092EXB.americas.hpqcorp.net>

> -----Original Message-----
> From: slony1-general-bounces at lists.slony.info [mailto:slony1-general-
> bounces at lists.slony.info] On Behalf Of Christopher Browne
> Sent: Tuesday, April 12, 2011 3:35 PM
> To: slony1-general at lists.slony.info
> Subject: [Slony1-general] Slony Recent News
>    - There was evidently discussion at PGEast about trying to get the
>      [altperl scripts] improved/cleaned up.
> 
>      My personal opinion (cbbrowne) is that they're not quite general
>      enough, and that making them so would be more trouble than it's
>      worth, so my "vote" would be to deprecate them.
> 
>      But that is certainly not the only opinion out there - there are
>      apparently others that regularly use them.
> 
>      While I'm not keen on putting effort into them, if there is some
>      consensus on what to do, I'd go along with it.  That might
>      include:
> 
>      - Adding scripts to address slonik features that have not thus
>        far been included in ~altperl~.
> 
>      - Integrating tests into the set of tests run using the
>        clustertest framework, so that we have some verification that
>        this stuff works properly.

I wonder if the right thing to do with the altperl scripts is to move them over to pgfoundry.  If someone wants to pick up support for them they can.  

Brad.

From francescoboccacci at libero.it  Wed Apr 13 03:45:15 2011
From: francescoboccacci at libero.it (francescoboccacci at libero.it)
Date: Wed, 13 Apr 2011 12:45:15 +0200 (CEST)
Subject: [Slony1-general] Slony Problems
Message-ID: <32497090.388861302691515963.JavaMail.defaultUser@defaultHost>

Hi to all,
i have a problem with slony -I. I try to create a replication cluster between 
1 mastere and 4 slaves (check the attach if right).
I run attach script but after 5 minutes i check that i still running when 
arrive at user table. 
User table is a backup restor of the Matser user table.
Someone can help me?

Thanks

Francesco
-------------- next part --------------
A non-text attachment was scrubbed...
Name: cluster_setup_grade_1_2_3_4_9.sh
Type: application/x-sh
Size: 4152 bytes
Desc: not available
Url : http://lists.slony.info/pipermail/slony1-general/attachments/20110413/ebd4a270/attachment.sh 

From stephane.schildknecht at postgresql.fr  Wed Apr 13 04:57:18 2011
From: stephane.schildknecht at postgresql.fr (=?ISO-8859-15?Q?=22St=E9phane_A=2E_Schildknecht=22?=)
Date: Wed, 13 Apr 2011 13:57:18 +0200
Subject: [Slony1-general] Slony Problems
In-Reply-To: <32497090.388861302691515963.JavaMail.defaultUser@defaultHost>
References: <32497090.388861302691515963.JavaMail.defaultUser@defaultHost>
Message-ID: <4DA58F9E.8010007@postgresql.fr>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Le 13/04/2011 12:45, francescoboccacci at libero.it a ?crit :
> Hi to all,
> i have a problem with slony -I. I try to create a replication cluster between 
> 1 mastere and 4 slaves (check the attach if right).
> I run attach script but after 5 minutes i check that i still running when 
> arrive at user table. 
> User table is a backup restor of the Matser user table.
> Someone can help me?
> 

Hi,

The subscribe part of the replication initialisation is missing.

Regards,
- -- 
St?phane Schildknecht
Loxodata
Contact r?gional PostgreSQL

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.10 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/

iEYEARECAAYFAk2lj54ACgkQA+REPKWGI0H6XgCgksUwz9CKZKEf2xg+voagLbGm
NkcAoK7L5Gaxr/3KPcJ/TTv82N2HxyvE
=QjeM
-----END PGP SIGNATURE-----

From francescoboccacci at libero.it  Wed Apr 13 06:08:46 2011
From: francescoboccacci at libero.it (francescoboccacci at libero.it)
Date: Wed, 13 Apr 2011 15:08:46 +0200 (CEST)
Subject: [Slony1-general] R: Re:  Slony Problems
Message-ID: <25013650.414521302700126942.JavaMail.defaultUser@defaultHost>


Hi, and thanks.
in The attach are two file: creation of cluster and subscribe.
These are my steps:

1-run cluster_setup_grade_allgrades.sh
2:

Master grade 1 --Slave grade2
/usr/lib/postgresql/8.4/bin/slon sql_cluster_allgrades "dbname=grade1 
user=navmap" > slon1_2.log &
/usr/lib/postgresql/8.4/bin/slon sql_cluster_allgrades "dbname=grade2 
user=navmap" > slon2_1.log &

Master grade 1 --Slave grade3
/usr/lib/postgresql/8.4/bin/slon sql_cluster_allgrades "dbname=grade1 
user=navmap" > slon1_3.log &
/usr/lib/postgresql/8.4/bin/slon sql_cluster_allgrades "dbname=grade3 
user=navmap" > slon3_1.log &

Master grade 1 --Slave grade4
/usr/lib/postgresql/8.4/bin/slon sql_cluster_allgrades "dbname=grade1 
user=navmap" > slon1_4.log &
/usr/lib/postgresql/8.4/bin/slon sql_cluster_allgrades "dbname=grade4 
user=navmap" > slon4_1.log &

Master grade 1 --Slave grade9
/usr/lib/postgresql/8.4/bin/slon sql_cluster_allgrades "dbname=grade1 
user=navmap" > slon1_9.log &
/usr/lib/postgresql/8.4/bin/slon sql_cluster_allgrades "dbname=grade9 
user=navmap" > slon9_1.log &

I need to run slon twice time for master and 1 slave..am i right?

3-subscribe_allgrades.sh

What it si wrong or all is correct?

Thanks


Francesco














>----Messaggio originale----
>Da: stephane.schildknecht at postgresql.fr
>Data: 13/04/2011 13.57
>A: <slony1-general at lists.slony.info>
>Ogg: Re: [Slony1-general] Slony Problems
>
>-----BEGIN PGP SIGNED MESSAGE-----
>Hash: SHA1
>
>Le 13/04/2011 12:45, francescoboccacci at libero.it a ?crit :
>> Hi to all,
>> i have a problem with slony -I. I try to create a replication cluster 
between 
>> 1 mastere and 4 slaves (check the attach if right).
>> I run attach script but after 5 minutes i check that i still running when 
>> arrive at user table. 
>> User table is a backup restor of the Matser user table.
>> Someone can help me?
>> 
>
>Hi,
>
>The subscribe part of the replication initialisation is missing.
>
>Regards,
>- -- 
>St?phane Schildknecht
>Loxodata
>Contact r?gional PostgreSQL
>
>-----BEGIN PGP SIGNATURE-----
>Version: GnuPG v1.4.10 (GNU/Linux)
>Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/
>
>iEYEARECAAYFAk2lj54ACgkQA+REPKWGI0H6XgCgksUwz9CKZKEf2xg+voagLbGm
>NkcAoK7L5Gaxr/3KPcJ/TTv82N2HxyvE
>=QjeM
>-----END PGP SIGNATURE-----
>_______________________________________________
>Slony1-general mailing list
>Slony1-general at lists.slony.info
>http://lists.slony.info/mailman/listinfo/slony1-general
>

-------------- next part --------------
A non-text attachment was scrubbed...
Name: cluster_setup_grade_allgrades.sh
Type: application/x-sh
Size: 4152 bytes
Desc: not available
Url : http://lists.slony.info/pipermail/slony1-general/attachments/20110413/c6fb8930/attachment-0002.sh 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: subscribe_allgrades.sh
Type: application/x-sh
Size: 691 bytes
Desc: not available
Url : http://lists.slony.info/pipermail/slony1-general/attachments/20110413/c6fb8930/attachment-0003.sh 

From stephane.schildknecht at postgresql.fr  Wed Apr 13 06:49:27 2011
From: stephane.schildknecht at postgresql.fr (=?ISO-8859-15?Q?=22St=E9phane_A=2E_Schildknecht=22?=)
Date: Wed, 13 Apr 2011 15:49:27 +0200
Subject: [Slony1-general] R: Re:  Slony Problems
In-Reply-To: <25013650.414521302700126942.JavaMail.defaultUser@defaultHost>
References: <25013650.414521302700126942.JavaMail.defaultUser@defaultHost>
Message-ID: <4DA5A9E7.6040105@postgresql.fr>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Le 13/04/2011 15:08, francescoboccacci at libero.it a ?crit :
> 
> Hi, and thanks.
> in The attach are two file: creation of cluster and subscribe.
> These are my steps:
> 
> 1-run cluster_setup_grade_allgrades.sh

You should store path in two ways.
(i.e 1-2 and 2-1).
Especially if you ever wants to switch between nodes (otherwise, you can easily
set forward=no when subscribing).

Are all your databases local and in the same PG instance ?

> 2:
> 
> Master grade 1 --Slave grade2
> /usr/lib/postgresql/8.4/bin/slon sql_cluster_allgrades "dbname=grade1 
> user=navmap" > slon1_2.log &
> /usr/lib/postgresql/8.4/bin/slon sql_cluster_allgrades "dbname=grade2 
> user=navmap" > slon2_1.log &
> 
> Master grade 1 --Slave grade3
> /usr/lib/postgresql/8.4/bin/slon sql_cluster_allgrades "dbname=grade1 
> user=navmap" > slon1_3.log &
> /usr/lib/postgresql/8.4/bin/slon sql_cluster_allgrades "dbname=grade3 
> user=navmap" > slon3_1.log &
> 
> Master grade 1 --Slave grade4
> /usr/lib/postgresql/8.4/bin/slon sql_cluster_allgrades "dbname=grade1 
> user=navmap" > slon1_4.log &
> /usr/lib/postgresql/8.4/bin/slon sql_cluster_allgrades "dbname=grade4 
> user=navmap" > slon4_1.log &
> 
> Master grade 1 --Slave grade9
> /usr/lib/postgresql/8.4/bin/slon sql_cluster_allgrades "dbname=grade1 
> user=navmap" > slon1_9.log &
> /usr/lib/postgresql/8.4/bin/slon sql_cluster_allgrades "dbname=grade9 
> user=navmap" > slon9_1.log &
> 
> I need to run slon twice time for master and 1 slave..am i right?

No you're not. You just have to start ONE daemon for each node.

> 
> 3-subscribe_allgrades.sh
> 
> What it si wrong or all is correct?

How does it work?

- -- 
St?phane Schildknecht
Loxodata
Contact r?gional PostgreSQL

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.10 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/

iEYEARECAAYFAk2lqecACgkQA+REPKWGI0FPmACgnpHnkKinAp1YEXAKg4BqUi7I
+jIAninuRWhvD+AaT5ImvqZMi2cVPT8u
=v/mF
-----END PGP SIGNATURE-----

From francescoboccacci at libero.it  Wed Apr 13 07:04:25 2011
From: francescoboccacci at libero.it (francescoboccacci at libero.it)
Date: Wed, 13 Apr 2011 16:04:25 +0200 (CEST)
Subject: [Slony1-general] R: Re:  R: Re:  Slony Problems
Message-ID: <27411172.434671302703465000.JavaMail.defaultUser@defaultHost>

hi,
the master is grade1 database. The others database must be only slaves because 
they have other tables with different data.
Grade1 must be a master.I run subscribe script in putty and now i see these 
messages:

NOTICE:  truncate of "public"."friends" succeeded
NOTICE:  truncate of "public"."user_tokens" succeeded
NOTICE:  truncate of "public"."client_applications" failed - doing delete
NOTICE:  truncate of "public"."gps_points" succeeded
NOTICE:  truncate of "public"."countries" succeeded
NOTICE:  truncate of "public"."gpx_file_tags" succeeded
NOTICE:  truncate of "public"."gpx_files" failed - doing delete
NOTICE:  truncate of "public"."diary_comments" succeeded
NOTICE:  truncate of "public"."languages" failed - doing delete
NOTICE:  truncate of "public"."diary_entries" failed - doing delete
NOTICE:  truncate of "public"."messages" succeeded
NOTICE:  truncate of "public"."friends" succeeded
NOTICE:  truncate of "public"."oauth_nonces" succeeded
NOTICE:  truncate of "public"."gps_points" succeeded
NOTICE:  truncate of "public"."oauth_tokens" succeeded
NOTICE:  truncate of "public"."gpx_file_tags" succeeded
NOTICE:  truncate of "public"."user_blocks" succeeded
NOTICE:  truncate of "public"."gpx_files" failed - doing delete
NOTICE:  truncate of "public"."languages" failed - doing delete
NOTICE:  truncate of "public"."user_preferences" succeeded
NOTICE:  truncate of "public"."user_roles" succeeded
NOTICE:  truncate of "public"."messages" succeeded
NOTICE:  truncate of "public"."user_tokens" succeeded
NOTICE:  truncate of "public"."oauth_nonces" succeeded
NOTICE:  truncate of "public"."oauth_tokens" succeeded
NOTICE:  truncate of "public"."user_blocks" succeeded
NOTICE:  truncate of "public"."user_preferences" succeeded
NOTICE:  truncate of "public"."user_roles" succeeded
NOTICE:  truncate of "public"."user_tokens" succeeded


It is all ok?. I check in the databases and for now only grade1 database have 
just tables "in replication".
I need to wait?

Thanks

Francesco



>----Messaggio originale----
>Da: stephane.schildknecht at postgresql.fr
>Data: 13/04/2011 15.49
>A: <slony1-general at lists.slony.info>
>Ogg: Re: [Slony1-general] R: Re:  Slony Problems
>
>-----BEGIN PGP SIGNED MESSAGE-----
>Hash: SHA1
>
>Le 13/04/2011 15:08, francescoboccacci at libero.it a ?crit :
>> 
>> Hi, and thanks.
>> in The attach are two file: creation of cluster and subscribe.
>> These are my steps:
>> 
>> 1-run cluster_setup_grade_allgrades.sh
>
>You should store path in two ways.
>(i.e 1-2 and 2-1).
>Especially if you ever wants to switch between nodes (otherwise, you can 
easily
>set forward=no when subscribing).
>
>Are all your databases local and in the same PG instance ?
>
>> 2:
>> 
>> Master grade 1 --Slave grade2
>> /usr/lib/postgresql/8.4/bin/slon sql_cluster_allgrades "dbname=grade1 
>> user=navmap" > slon1_2.log &
>> /usr/lib/postgresql/8.4/bin/slon sql_cluster_allgrades "dbname=grade2 
>> user=navmap" > slon2_1.log &
>> 
>> Master grade 1 --Slave grade3
>> /usr/lib/postgresql/8.4/bin/slon sql_cluster_allgrades "dbname=grade1 
>> user=navmap" > slon1_3.log &
>> /usr/lib/postgresql/8.4/bin/slon sql_cluster_allgrades "dbname=grade3 
>> user=navmap" > slon3_1.log &
>> 
>> Master grade 1 --Slave grade4
>> /usr/lib/postgresql/8.4/bin/slon sql_cluster_allgrades "dbname=grade1 
>> user=navmap" > slon1_4.log &
>> /usr/lib/postgresql/8.4/bin/slon sql_cluster_allgrades "dbname=grade4 
>> user=navmap" > slon4_1.log &
>> 
>> Master grade 1 --Slave grade9
>> /usr/lib/postgresql/8.4/bin/slon sql_cluster_allgrades "dbname=grade1 
>> user=navmap" > slon1_9.log &
>> /usr/lib/postgresql/8.4/bin/slon sql_cluster_allgrades "dbname=grade9 
>> user=navmap" > slon9_1.log &
>> 
>> I need to run slon twice time for master and 1 slave..am i right?
>
>No you're not. You just have to start ONE daemon for each node.
>
>> 
>> 3-subscribe_allgrades.sh
>> 
>> What it si wrong or all is correct?
>
>How does it work?
>
>- -- 
>St?phane Schildknecht
>Loxodata
>Contact r?gional PostgreSQL
>
>-----BEGIN PGP SIGNATURE-----
>Version: GnuPG v1.4.10 (GNU/Linux)
>Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/
>
>iEYEARECAAYFAk2lqecACgkQA+REPKWGI0FPmACgnpHnkKinAp1YEXAKg4BqUi7I
>+jIAninuRWhvD+AaT5ImvqZMi2cVPT8u
>=v/mF
>-----END PGP SIGNATURE-----
>_______________________________________________
>Slony1-general mailing list
>Slony1-general at lists.slony.info
>http://lists.slony.info/mailman/listinfo/slony1-general
>



From stephane.schildknecht at postgresql.fr  Wed Apr 13 07:30:23 2011
From: stephane.schildknecht at postgresql.fr (=?ISO-8859-15?Q?=22St=E9phane_A=2E_Schildknecht=22?=)
Date: Wed, 13 Apr 2011 16:30:23 +0200
Subject: [Slony1-general] R: Re:  R: Re:  Slony Problems
In-Reply-To: <27411172.434671302703465000.JavaMail.defaultUser@defaultHost>
References: <27411172.434671302703465000.JavaMail.defaultUser@defaultHost>
Message-ID: <4DA5B37F.5080601@postgresql.fr>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Le 13/04/2011 16:04, francescoboccacci at libero.it a ?crit :
> hi,
> the master is grade1 database. The others database must be only slaves because 
> they have other tables with different data.
> Grade1 must be a master.I run subscribe script in putty and now i see these 
> messages:
> 
(...)

> NOTICE:  truncate of "public"."user_tokens" succeeded
> 
> 
> It is all ok?. I check in the databases and for now only grade1 database have 
> just tables "in replication".
> I need to wait?
> 

Seems to be working, at least.

Just wait a few time and tell us if you can see data on slaves.


- -- 
St?phane Schildknecht
Loxodata
Contact r?gional PostgreSQL

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.10 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/

iEYEARECAAYFAk2ls38ACgkQA+REPKWGI0ERQQCg4SbucPUNtskgCOribDhbw07g
QdMAnjV2+HrjnhVjkbUkuKwwGafFFEBy
=b2PT
-----END PGP SIGNATURE-----

From dba at richyen.com  Wed Apr 13 09:55:39 2011
From: dba at richyen.com (Richard Yen)
Date: Wed, 13 Apr 2011 09:55:39 -0700
Subject: [Slony1-general] sl_log_* gets large--any way to shrink it?
Message-ID: <BANLkTikhjLUzUzqcH=oEBmJEJqQ6218D1A@mail.gmail.com>

Hi everyone,

I ran into a situation last night where sl_log_1 was over 600MB and took
several hours to finish a logswitch.  I would try logswitch_start(), and
then it would tell me a logswitch was already in progress.  Then, I tried
logswitch_finish(), and it would tell me a logswitch was in progress.  When
I looked at pg_stat_activity, there were usually 5 rows with "FETCH 500 FROM
LOG" in my 11-node slony 2.0.6 cluster.

I was wondering if there'd be any way to make that logswitch go faster (or
perhaps more frequently)?  Would anyone know how to minimize the size of
sl_log_*?  I was thinking about doing things like raising sync_interval to
create less entries in sl_log_* -- would that (or some other adjustment) do
the trick?

Thanks for any help!
--Richard
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20110413/a6a3903d/attachment.htm 

From vivek at khera.org  Wed Apr 13 10:33:12 2011
From: vivek at khera.org (Vick Khera)
Date: Wed, 13 Apr 2011 13:33:12 -0400
Subject: [Slony1-general] sl_log_* gets large--any way to shrink it?
In-Reply-To: <BANLkTikhjLUzUzqcH=oEBmJEJqQ6218D1A@mail.gmail.com>
References: <BANLkTikhjLUzUzqcH=oEBmJEJqQ6218D1A@mail.gmail.com>
Message-ID: <BANLkTikRqZ=xFypUPfrFy_csnBqAakPhvQ@mail.gmail.com>

On Wed, Apr 13, 2011 at 12:55 PM, Richard Yen <dba at richyen.com> wrote:

> I was wondering if there'd be any way to make that logswitch go faster (or
> perhaps more frequently)?  Would anyone know how to minimize the size of
> sl_log_*?  I was thinking about doing things like raising sync_interval to
> create less entries in


Why?  Was there some observable "bad" that was resulting from it taking so
long?  In particular, was your replication falling behind?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20110413/9068e19a/attachment.htm 

From dba at richyen.com  Wed Apr 13 10:44:50 2011
From: dba at richyen.com (Richard Yen)
Date: Wed, 13 Apr 2011 10:44:50 -0700
Subject: [Slony1-general] sl_log_* gets large--any way to shrink it?
In-Reply-To: <BANLkTikRqZ=xFypUPfrFy_csnBqAakPhvQ@mail.gmail.com>
References: <BANLkTikhjLUzUzqcH=oEBmJEJqQ6218D1A@mail.gmail.com>
	<BANLkTikRqZ=xFypUPfrFy_csnBqAakPhvQ@mail.gmail.com>
Message-ID: <BANLkTikngw7owru0dud9hmaM-0MamOU-6Q@mail.gmail.com>

On Wed, Apr 13, 2011 at 10:33 AM, Vick Khera <vivek at khera.org> wrote:

> On Wed, Apr 13, 2011 at 12:55 PM, Richard Yen <dba at richyen.com> wrote:
>
>> I was wondering if there'd be any way to make that logswitch go faster (or
>> perhaps more frequently)?  Would anyone know how to minimize the size of
>> sl_log_*?  I was thinking about doing things like raising sync_interval to
>> create less entries in
>
>
> Why?  Was there some observable "bad" that was resulting from it taking so
> long?  In particular, was your replication falling behind?
>

Well, I noticed that when the log gets large and it's in the middle of a
logswitch, load on the origin node will increase and subsequent to that, all
subscriber nodes will lag up to 900sec.  This seems troublesome, considering
that nodes in my cluster typically don't lag for more than 10sec--it's only
during these logswitch events that they lag by so much.

--Richard
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20110413/36493878/attachment.htm 

From richyen at iparadigms.com  Wed Apr 13 10:42:40 2011
From: richyen at iparadigms.com (Richard Yen)
Date: Wed, 13 Apr 2011 10:42:40 -0700
Subject: [Slony1-general] sl_log_* gets large--any way to shrink it?
In-Reply-To: <BANLkTikRqZ=xFypUPfrFy_csnBqAakPhvQ@mail.gmail.com>
References: <BANLkTikhjLUzUzqcH=oEBmJEJqQ6218D1A@mail.gmail.com>
	<BANLkTikRqZ=xFypUPfrFy_csnBqAakPhvQ@mail.gmail.com>
Message-ID: <BANLkTi=L6m5+wRMDN63jgqbntR7aSK1tkQ@mail.gmail.com>

On Wed, Apr 13, 2011 at 10:33 AM, Vick Khera <vivek at khera.org> wrote:

> On Wed, Apr 13, 2011 at 12:55 PM, Richard Yen <dba at richyen.com> wrote:
>
>> I was wondering if there'd be any way to make that logswitch go faster (or
>> perhaps more frequently)?  Would anyone know how to minimize the size of
>> sl_log_*?  I was thinking about doing things like raising sync_interval to
>> create less entries in
>
>
> Why?  Was there some observable "bad" that was resulting from it taking so
> long?  In particular, was your replication falling behind?
>

Well, I noticed that when the log gets large and it's in the middle of a
logswitch, load on the origin node will increase and subsequent to that, all
subscriber nodes will lag up to 900sec.  This seems troublesome, considering
that nodes in my cluster typically don't lag for more than 10sec--it's only
during these logswitch events that they lag by so much.

--Richard
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20110413/daa6b894/attachment.htm 

From vivek at khera.org  Wed Apr 13 11:01:18 2011
From: vivek at khera.org (Vick Khera)
Date: Wed, 13 Apr 2011 14:01:18 -0400
Subject: [Slony1-general] sl_log_* gets large--any way to shrink it?
In-Reply-To: <BANLkTi=L6m5+wRMDN63jgqbntR7aSK1tkQ@mail.gmail.com>
References: <BANLkTikhjLUzUzqcH=oEBmJEJqQ6218D1A@mail.gmail.com>
	<BANLkTikRqZ=xFypUPfrFy_csnBqAakPhvQ@mail.gmail.com>
	<BANLkTi=L6m5+wRMDN63jgqbntR7aSK1tkQ@mail.gmail.com>
Message-ID: <BANLkTinkpZQMgAUZhcOK=PS=VkvJd3jJGw@mail.gmail.com>

On Wed, Apr 13, 2011 at 1:42 PM, Richard Yen <richyen at iparadigms.com> wrote:

> Well, I noticed that when the log gets large and it's in the middle of a
> logswitch, load on the origin node will increase and subsequent to that, all
> subscriber nodes will lag up to 900sec.  This seems troublesome, considering
> that nodes in my cluster typically don't lag for more than 10sec--it's only
> during these logswitch events that they lag by so much.
>

I never noticed that, even when I had my db's on spinning media.  It was
never correlated with log switch.  The only times I got lag was when I had a
*lot* of update/insert activity in a very very short period.

Might I suggest that the cause/effect is the other way around?  Perhaps you
are just hitting your I/O throughput limit for your hardware.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20110413/83a0c968/attachment-0001.htm 

From dba at richyen.com  Wed Apr 13 11:36:14 2011
From: dba at richyen.com (Richard Yen)
Date: Wed, 13 Apr 2011 11:36:14 -0700
Subject: [Slony1-general] sl_log_* gets large--any way to shrink it?
In-Reply-To: <BANLkTinkpZQMgAUZhcOK=PS=VkvJd3jJGw@mail.gmail.com>
References: <BANLkTikhjLUzUzqcH=oEBmJEJqQ6218D1A@mail.gmail.com>
	<BANLkTikRqZ=xFypUPfrFy_csnBqAakPhvQ@mail.gmail.com>
	<BANLkTi=L6m5+wRMDN63jgqbntR7aSK1tkQ@mail.gmail.com>
	<BANLkTinkpZQMgAUZhcOK=PS=VkvJd3jJGw@mail.gmail.com>
Message-ID: <BANLkTimjM3hXocKdhRLzq_4B6kTz6VUteA@mail.gmail.com>

On Wed, Apr 13, 2011 at 11:01 AM, Vick Khera <vivek at khera.org> wrote:

> On Wed, Apr 13, 2011 at 1:42 PM, Richard Yen <richyen at iparadigms.com>wrote:
>
>> Well, I noticed that when the log gets large and it's in the middle of a
>> logswitch, load on the origin node will increase and subsequent to that, all
>> subscriber nodes will lag up to 900sec.  This seems troublesome, considering
>> that nodes in my cluster typically don't lag for more than 10sec--it's only
>> during these logswitch events that they lag by so much.
>>
>
> I never noticed that, even when I had my db's on spinning media.  It was
> never correlated with log switch.  The only times I got lag was when I had a
> *lot* of update/insert activity in a very very short period.
>
> Might I suggest that the cause/effect is the other way around?  Perhaps you
> are just hitting your I/O throughput limit for your hardware.
>
> That sounds like a possibility to me, but as far as I understand it, when a
subscriber is lagging, events in sl_event (and therefore sl_log_*) are not
being processed.  Wouldn't the slave lag block a logswitch from finishing?
 Or perhaps I don't fully understand the way SYNCs are processed and
purged...

--Richard
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20110413/256a4fe8/attachment.htm 

From cbbrowne at afilias.info  Wed Apr 13 11:49:56 2011
From: cbbrowne at afilias.info (Christopher Browne)
Date: Wed, 13 Apr 2011 14:49:56 -0400
Subject: [Slony1-general] sl_log_* gets large--any way to shrink it?
In-Reply-To: <BANLkTimjM3hXocKdhRLzq_4B6kTz6VUteA@mail.gmail.com>
References: <BANLkTikhjLUzUzqcH=oEBmJEJqQ6218D1A@mail.gmail.com>
	<BANLkTikRqZ=xFypUPfrFy_csnBqAakPhvQ@mail.gmail.com>
	<BANLkTi=L6m5+wRMDN63jgqbntR7aSK1tkQ@mail.gmail.com>
	<BANLkTinkpZQMgAUZhcOK=PS=VkvJd3jJGw@mail.gmail.com>
	<BANLkTimjM3hXocKdhRLzq_4B6kTz6VUteA@mail.gmail.com>
Message-ID: <BANLkTikmPVs8SFtNfEh16qs0pT8j4y00HQ@mail.gmail.com>

On Wed, Apr 13, 2011 at 2:36 PM, Richard Yen <dba at richyen.com> wrote:
> On Wed, Apr 13, 2011 at 11:01 AM, Vick Khera <vivek at khera.org> wrote:
>>
>> On Wed, Apr 13, 2011 at 1:42 PM, Richard Yen <richyen at iparadigms.com>
>> wrote:
>>>
>>> Well, I noticed that when the log gets large and it's in the middle of a
>>> logswitch, load on the origin node will increase and subsequent to that, all
>>> subscriber nodes will lag up to 900sec. ?This seems troublesome, considering
>>> that nodes in my cluster typically don't lag for more than 10sec--it's only
>>> during these logswitch events that they lag by so much.
>>
>> I never noticed that, even when I had my db's on spinning media. ?It was
>> never correlated with log switch. ?The only times I got lag was when I had a
>> *lot* of update/insert activity in a very very short period.
>> Might I suggest that the cause/effect is the other way around? ?Perhaps
>> you are just hitting your I/O throughput limit for your hardware.
>
> That sounds like a possibility to me, but as far as I understand it, when a
> subscriber is lagging, events in sl_event (and therefore sl_log_*) are not
> being processed. ?Wouldn't the slave lag block a logswitch from finishing?
> ?Or perhaps I don't fully understand the way SYNCs are processed and
> purged...

Yep, any time there is lag on *any* node, that will start to prevent
logswitches from completing.

The completion always waits on having confirmations back from all the
other nodes, so, if you've got an 8h subscription running, it won't
matter how often you try to switch logs - once that subscription
starts to be processed, the proposals to truncate will all tend to
stall until that subscription completes.

There is merit to keeping the time interval controlled by
"cleanup_interval" pretty short; that's what determines how often slon
considers logswitching.  But there's little point to setting it
*really* short when lags will prevent the switch from completing.  I'd
think it futile to consider values less than a couple of minutes,
myself.

It's possible that the fix for bug #167
<http://www.slony.info/bugzilla/show_bug.cgi?id=167> would address the
load you're seeing; the queries that access sl_log_* presently have
the tendency to do Seq Scans when it ought to be possible to use
indices.  (I'll not re-explain what Jan has described in the bug.)

Jan seems to be keen to backpatch that, which Steve and I weren't
enthralled with basically on the basis that we don't think it's seen
enough usage yet.  But if someone *did* do some testing of 167 on 2.0,
that would definitely answer our concern.

From ssinger_pg at sympatico.ca  Wed Apr 13 15:35:35 2011
From: ssinger_pg at sympatico.ca (Steve Singer)
Date: Wed, 13 Apr 2011 18:35:35 -0400
Subject: [Slony1-general] sl_log_* gets large--any way to shrink it?
In-Reply-To: <BANLkTimjM3hXocKdhRLzq_4B6kTz6VUteA@mail.gmail.com>
References: <BANLkTikhjLUzUzqcH=oEBmJEJqQ6218D1A@mail.gmail.com>
	<BANLkTikRqZ=xFypUPfrFy_csnBqAakPhvQ@mail.gmail.com>
	<BANLkTi=L6m5+wRMDN63jgqbntR7aSK1tkQ@mail.gmail.com>
	<BANLkTinkpZQMgAUZhcOK=PS=VkvJd3jJGw@mail.gmail.com>
	<BANLkTimjM3hXocKdhRLzq_4B6kTz6VUteA@mail.gmail.com>
Message-ID: <BLU0-SMTP8638FEFB4BF9A4858ADACCACAA0@phx.gbl>

On Wed, 13 Apr 2011, Richard Yen wrote:

> That sounds like a possibility to me, but as far as I understand it, when a subscriber is lagging, events
> in sl_event (and therefore sl_log_*) are not being processed. ?Wouldn't the slave lag block a logswitch
> from finishing? ?Or perhaps I don't fully understand the way SYNCs are processed and purged...

Another thing that can cause log switches to be delayed are long running 
transactions.

Let's say you have the following:
t1: begin;
t2; begin insert into a replicted table
t2; commit;
t3: SYNC 1,1111 is generated
t4: SYNC 1,111 is replicated to your slave, it includes the row from t2.

At this point logswitch can not finish because t1 is still in progress and 
t1 MIGHT have written to sl_log_1.

say sometime later

t1: rollback;
txxx: SYNC 1,2222

Log switch can't actually happen until sync 1,2222 is replicated and 
confirmed because the sync that would cover any rows from that transaction 
is 1,2222.


Steve





> --Richard
> 
>

From gie05tech at yahoo.co.id  Thu Apr 14 05:06:28 2011
From: gie05tech at yahoo.co.id (Yogi Rizkiadi)
Date: Thu, 14 Apr 2011 20:06:28 +0800 (SGT)
Subject: [Slony1-general] lots of slave nodes
Message-ID: <408334.9637.qm@web77708.mail.sg1.yahoo.com>

Hi,


i want to implement project with database replication structure 3 layers : A->B->C, which is A is the master node, B are 60 nodes of datacenter, and C are 1 - 7 nodes of machines on every datacenter. So if we count it has more than 100 nodes.

Every machines on layer C only have 1 GB of RAM and network on 3 layers above are perhaps unconsistent.

Is it possible to use Slony-I 2.0.4 and where can i get a good example for doing that ?

Sorry for my bad english


Thanks,


Gie

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20110414/9a105c69/attachment.htm 

From ajs at crankycanuck.ca  Thu Apr 14 06:05:06 2011
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Thu, 14 Apr 2011 09:05:06 -0400
Subject: [Slony1-general] lots of slave nodes
In-Reply-To: <408334.9637.qm@web77708.mail.sg1.yahoo.com>
References: <408334.9637.qm@web77708.mail.sg1.yahoo.com>
Message-ID: <20110414130505.GF24471@shinkuro.com>

On Thu, Apr 14, 2011 at 08:06:28PM +0800, Yogi Rizkiadi wrote:

> i want to implement project with database replication structure 3 layers : A->B->C, which is A is the master node, B are 60 nodes of datacenter, and C are 1 - 7 nodes of machines on every datacenter. So if we count it has more than 100 nodes.
> 
> Every machines on layer C only have 1 GB of RAM and network on 3 layers above are perhaps unconsistent.
> 
> Is it possible to use Slony-I 2.0.4 and where can i get a good example for doing that ?

I think Slony's overhead is going to kill you with that many nodes.
You might be able to segment up the network such that it wasn't too
bad (especially if many of them can't forward), but I'd be sceptical.

You might try chaining things, though.  I have wondered about a
two-layer Slony replication system with a bunch of WAL-streaming
replicas hanging off the second layer.  You have of course various
single points of failure, but it's possible to recover in most cases.

A


-- 
Andrew Sullivan
ajs at crankycanuck.ca

From ssinger at ca.afilias.info  Thu Apr 14 06:37:42 2011
From: ssinger at ca.afilias.info (Steve Singer)
Date: Thu, 14 Apr 2011 09:37:42 -0400
Subject: [Slony1-general] lots of slave nodes
In-Reply-To: <408334.9637.qm@web77708.mail.sg1.yahoo.com>
References: <408334.9637.qm@web77708.mail.sg1.yahoo.com>
Message-ID: <4DA6F8A6.4000502@ca.afilias.info>

On 11-04-14 08:06 AM, Yogi Rizkiadi wrote:
> Hi,
>
>
> i want to implement project with database replication structure 3 layers
> : A->B->C, which is A is the master node, B are 60 nodes of datacenter,
> and C are 1 - 7 nodes of machines on every datacenter. So if we count it
> has more than 100 nodes.
>
> Every machines on layer C only have 1 GB of RAM and network on 3 layers
> above are perhaps unconsistent.
>
> Is it possible to use Slony-I 2.0.4 and where can i get a good example
> for doing that ?
>
> Sorry for my bad english
>
>
> Thanks,
>

I suspect that you will be able to make it work if

A) You chain/cascade things in such a way that no provider has too many 
receivers.  I don't know what the limit will be in terms of number of 
nodes per provider, you might have to experiement.

B) You might need to increase your sync interval so you are doing syncs 
less frequently.   All nodes in the cluster will be generating sync[1] 
and those events must be confirmed by all other nodes.   This cross 
chatter might add up with 100 nodes, but if you then only generate syncs 
once a minute instead of once a second on all nodes but the origin the 
number of events floating through your system will drop.

C) It is fairly important that you be careful when doing slonik 
operations that you WAIT FOR when you need to, event confirmations for 
cluster configuration might take a bit of time in a cluster this big.

[1] - 2.0.4 suffers from 
http://bugs.slony.info/bugzilla/show_bug.cgi?id=127 which prevents these 
SYNC's from being generated on some nodes.  This bug won't cause you 
problems but you should expect some changes with 100 nodes when you upgrade.

Please report back to the list on how well this work for you.  I know of 
someone who has a cascaded cluster of around 50 nodes but I'm not aware 
of anyone running a 100 node cluster.



>
> Gie
>
>
>
> _______________________________________________
> Slony1-general mailing list
> Slony1-general at lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general


From ssinger at ca.afilias.info  Fri Apr 15 11:16:07 2011
From: ssinger at ca.afilias.info (Steve Singer)
Date: Fri, 15 Apr 2011 14:16:07 -0400
Subject: [Slony1-general] TRY blocks and 2.1
Message-ID: <4DA88B67.5040708@ca.afilias.info>

As part of the 2.1 development we have hit a few issues related to try 
blocks that we could use some user feedback on.

1.  As part of bug 196, if slonik is going to create an event as part of 
a transaction it needs to obtain an exclusive lock on sl_event_lock 
BEFORE it does anything else as part of that transaction (ie before the 
xid is assigned to the transaction).

2. As part of the auto-wait for work ( code available at 
https://github.com/ssinger/slony1-engine/commits/auto_wait_for) if 
slonik detects that a 'wait for' is required inside of a try block it 
will bail out on an error (since 'wait for event' has never worked in a 
try block)

To solve issue 1) I see a few options


A) We can require the first command submitted to each event node be the 
first event for that node in a try block.   Ie

try {
   restart node(id=1);
   store node(id=4, event node=1);
}

would fail because the restart node(which does not generate an 
event/obtain the lock) is the first command in the transaction.

but

try {
   sync(id=1);
   restart node(id=1);
   store node(id=4, event node=1);
}

would work fine.


B) We could have all commands in a try block obtain the sl_event_lock 
before that node is used in the block.  Since the slonik commands that 
don't generate events are rare this seems like a good idea.  It will 
mean that running two slonik scripts with try blocks at the same idea 
will probably not work well (but that would be good advise in 1.2 or 2.0 
anyway)

C)  We could get rid of try blocks.  Some people have commented that 
they don't behave as expected anyway and with the additional 
restrictions of changes 1) and 2) they are even less useful.

D) We can execute each set of commands in the try block as part of 
different transactions each time the event node changes.  This is 
consistent with how the documentation describes TRY blocks but isn't how 
they behave in practice today.  This could also mean changing the 
behaviour I described for 'auto wait for'.


I think I like (B) the most.

comments?




From cbbrowne at afilias.info  Fri Apr 15 12:41:35 2011
From: cbbrowne at afilias.info (Christopher Browne)
Date: Fri, 15 Apr 2011 15:41:35 -0400
Subject: [Slony1-general] TRY blocks and 2.1
In-Reply-To: <4DA88B67.5040708@ca.afilias.info>
References: <4DA88B67.5040708@ca.afilias.info>
Message-ID: <BANLkTik8o+p+3XLjZxpqYm=KV2VHi4ofqg@mail.gmail.com>

On Fri, Apr 15, 2011 at 2:16 PM, Steve Singer <ssinger at ca.afilias.info> wrote:
> C) ?We could get rid of try blocks. ?Some people have commented that
> they don't behave as expected anyway and with the additional
> restrictions of changes 1) and 2) they are even less useful.

I'd point not only to "less useful," but also to "less able to be
reasoned about" as an issue.

The "intuitive" position is that TRY blocks are supposed to look like
something quasi-transactional; if there's a failure, "everything
should be rolled back."  That's certainly a cool idea to consider.

Unfortunately, that's not remotely near to being how things are.  If
there are activities inside a TRY block that cross multiple nodes,
it's not reasonable to expect that all to roll back.  (We're not using
2PC!)

And the changes you suggest add to the "destruction of intuition."
The further we go down the "destruction of intuition" path, the more
it's clear that TRY doesn't work as hoped.

Perhaps we indicate that it doesn't promise transactional behaviour;
that leaves it a bit questionable what it's particularly useful for.

From francescoboccacci at libero.it  Tue Apr 19 05:47:49 2011
From: francescoboccacci at libero.it (francescoboccacci at libero.it)
Date: Tue, 19 Apr 2011 14:47:49 +0200 (CEST)
Subject: [Slony1-general] Too many idle process in my server
Message-ID: <18202584.1638241303217269126.JavaMail.defaultUser@defaultHost>

Hi to all,
i have a proble about too mani idle precess in my server.
I use Slony-I for cluster database with 1 master and 4 slaves. Sometimes 
happen that i try to connet to database and i received a message that too many 
connection are in my system. I there a configuration of postgresql that can 
help me to solve this type of problems.

Thanks,

Francesco Boccacci 

From stephane.schildknecht at postgresql.fr  Tue Apr 19 06:08:18 2011
From: stephane.schildknecht at postgresql.fr (=?ISO-8859-15?Q?=22St=E9phane_A=2E_Schildknecht=22?=)
Date: Tue, 19 Apr 2011 15:08:18 +0200
Subject: [Slony1-general] Too many idle process in my server
In-Reply-To: <18202584.1638241303217269126.JavaMail.defaultUser@defaultHost>
References: <18202584.1638241303217269126.JavaMail.defaultUser@defaultHost>
Message-ID: <4DAD8942.6040308@postgresql.fr>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Le 19/04/2011 14:47, francescoboccacci at libero.it a ?crit :
> Hi to all,
> i have a proble about too mani idle precess in my server.
> I use Slony-I for cluster database with 1 master and 4 slaves. Sometimes 
> happen that i try to connet to database and i received a message that too many 
> connection are in my system. I there a configuration of postgresql that can 
> help me to solve this type of problems.

Please tell us how you configured max_connections in postgresql.conf.


- -- 
St?phane Schildknecht
Loxodata
Contact r?gional PostgreSQL

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.10 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/

iEYEARECAAYFAk2tiUIACgkQA+REPKWGI0HNwQCggo+rsqNPXevfBOyhSltdINrh
GeIAoJ7+6fbIndI+L5OcaCpb7QVSQoCS
=yfQ2
-----END PGP SIGNATURE-----

From Dinakaran.K at fs.mphasis.com  Tue Apr 19 06:11:51 2011
From: Dinakaran.K at fs.mphasis.com (Dinakaran Kanagaraj)
Date: Tue, 19 Apr 2011 18:41:51 +0530
Subject: [Slony1-general] PostgreSQL Replicaiton
Message-ID: <903B52597234234780280350C633091427F4935187@FSMPCHMBX01.FS.MPHASIS.COM>

Hi,

I have a PostgreSQL 8.4.3 database running on SuSe Linux Ent server. My requirement is to replicate this database to another machine just for a backup.

Database Details:
On a weekly basis, the application (which uses postgres database) will create few no. Of new tables in the database. So, whenever I do replicate, I need to replicate it with these new tables also.

Please let know if this can be achieved by Slony1. Also, please let know is there any license for getting the Slony product.

Thanks,
Dinakaran
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20110419/eac8a267/attachment.htm 

From rod at iol.ie  Tue Apr 19 06:22:04 2011
From: rod at iol.ie (Raymond O'Donnell)
Date: Tue, 19 Apr 2011 14:22:04 +0100
Subject: [Slony1-general] PostgreSQL Replicaiton
In-Reply-To: <903B52597234234780280350C633091427F4935187@FSMPCHMBX01.FS.MPHASIS.COM>
References: <903B52597234234780280350C633091427F4935187@FSMPCHMBX01.FS.MPHASIS.COM>
Message-ID: <4DAD8C7C.1040208@iol.ie>

On 19/04/2011 14:11, Dinakaran Kanagaraj wrote:
> Hi,
>
> I have a PostgreSQL 8.4.3 database running on SuSe Linux Ent server. My
> requirement is to replicate this database to another machine just for a
> backup.
>
> Database Details:
>
> On a weekly basis, the application (which uses postgres database) will
> create few no. Of new tables in the database. So, whenever I do
> replicate, I need to replicate it with these new tables also.
>
> Please let know if this can be achieved by Slony1. Also, please let know
> is there any license for getting the Slony product.


You can use SLony for this, but it won't pick up the new tables 
automatically - you'll have to add them to the replication set by hand.

If you were on PostgreSQL 9+, you could use it's built-in replication - 
as it's WAL-based, I think it will pick up new tables.

If you're just backing up the database, could you use pg_dump instead?

Ray.


-- 
Raymond O'Donnell :: Galway :: Ireland
rod at iol.ie

From francescoboccacci at libero.it  Tue Apr 19 06:27:46 2011
From: francescoboccacci at libero.it (francescoboccacci at libero.it)
Date: Tue, 19 Apr 2011 15:27:46 +0200 (CEST)
Subject: [Slony1-general] R: Re:  Too many idle process in my server
Message-ID: <1075011.1650821303219666252.JavaMail.defaultUser@defaultHost>

Hi,
postgres.conf 


max_connections = 200 


Thanks

Francesco 
>----Messaggio originale----
>Da: stephane.schildknecht at postgresql.fr
>Data: 19/04/2011 15.08
>A: <slony1-general at lists.slony.info>
>Ogg: Re: [Slony1-general] Too many idle process in my server
>
>-----BEGIN PGP SIGNED MESSAGE-----
>Hash: SHA1
>
>Le 19/04/2011 14:47, francescoboccacci at libero.it a ?crit :
>> Hi to all,
>> i have a proble about too mani idle precess in my server.
>> I use Slony-I for cluster database with 1 master and 4 slaves. Sometimes 
>> happen that i try to connet to database and i received a message that too 
many 
>> connection are in my system. I there a configuration of postgresql that 
can 
>> help me to solve this type of problems.
>
>Please tell us how you configured max_connections in postgresql.conf.
>
>
>- -- 
>St?phane Schildknecht
>Loxodata
>Contact r?gional PostgreSQL
>
>-----BEGIN PGP SIGNATURE-----
>Version: GnuPG v1.4.10 (GNU/Linux)
>Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/
>
>iEYEARECAAYFAk2tiUIACgkQA+REPKWGI0HNwQCggo+rsqNPXevfBOyhSltdINrh
>GeIAoJ7+6fbIndI+L5OcaCpb7QVSQoCS
>=yfQ2
>-----END PGP SIGNATURE-----
>_______________________________________________
>Slony1-general mailing list
>Slony1-general at lists.slony.info
>http://lists.slony.info/mailman/listinfo/slony1-general
>



From stephane.schildknecht at postgresql.fr  Tue Apr 19 06:54:37 2011
From: stephane.schildknecht at postgresql.fr (=?ISO-8859-15?Q?=22St=E9phane_A=2E_Schildknecht=22?=)
Date: Tue, 19 Apr 2011 15:54:37 +0200
Subject: [Slony1-general] R: Re:  Too many idle process in my server
In-Reply-To: <1075011.1650821303219666252.JavaMail.defaultUser@defaultHost>
References: <1075011.1650821303219666252.JavaMail.defaultUser@defaultHost>
Message-ID: <4DAD941D.9010001@postgresql.fr>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Le 19/04/2011 15:27, francescoboccacci at libero.it a ?crit :
> Hi,
> postgres.conf 
> 
> 
> max_connections = 200 
> 

How do you configure your apps ?
1 master and 4 slaves, that's (2 times the number of nodes + a few) connections
established to your server.

As far as I can tell, slony does not consume all connection slot here.

You should have almost 180 left.


- -- 
St?phane Schildknecht
Loxodata
Contact r?gional PostgreSQL

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.10 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/

iEYEARECAAYFAk2tlB0ACgkQA+REPKWGI0Fl+gCcCvWpGoru4V2NNAI30MzBZmbb
UMYAn0IuRO4K/dgslrRArUG2HTGM3rMV
=N4dg
-----END PGP SIGNATURE-----

From francescoboccacci at libero.it  Tue Apr 19 07:03:02 2011
From: francescoboccacci at libero.it (francescoboccacci at libero.it)
Date: Tue, 19 Apr 2011 16:03:02 +0200 (CEST)
Subject: [Slony1-general] R: Re: R: Re: Too many idle process in my server
Message-ID: <29976341.1662181303221782684.JavaMail.defaultUser@defaultHost>

Hi,
i write ps aux | grep postgres in my server:


postgres 32591  0.0  0.0 2230272 36900 ?       Ss   Apr14   1:34 postgres: 
navmap grade1 [local] 
idle                                                         
postgres 32593  0.0  0.1 2228152 67096 ?       Ss   Apr14   1:16 postgres: 
navmap grade2 [local] 
idle                                                         
postgres 32594  0.0  0.0 2225652 3920 ?        Ss   Apr14   0:00 postgres: 
navmap grade2 [local] 
idle                                                         
postgres 32595  0.0  0.2 2228340 189060 ?      Ss   Apr14   1:24 postgres: 
navmap grade2 [local] 
idle                                                         
postgres 32596  0.0  0.0 2225652 3792 ?        Ss   Apr14   0:00 postgres: 
navmap grade1 [local] 
idle                                                         
postgres 32603  0.0  0.0 2225652 3836 ?        Ss   Apr14   0:00 postgres: 
navmap grade1 [local] 
idle                                                         
postgres 32604  0.0  0.0 2225652 3836 ?        Ss   Apr14   0:00 postgres: 
navmap grade1 [local] 
idle                                                         
postgres 32605  0.0  0.2 2228344 181184 ?      Ss   Apr14   1:26 postgres: 
navmap grade4 [local] 
idle                                                         
postgres 32606  0.0  0.0 2225652 3864 ?        Ss   Apr14   0:00 postgres: 
navmap grade1 [local] 
idle                                                         
postgres 32608  0.0  0.0 2228156 63392 ?       Ss   Apr14   1:11 postgres: 
navmap grade1 [local] 
idle                                                         
postgres 32609  0.0  0.0 2225692 3764 ?        Ss   Apr14   0:00 postgres: 
navmap grade4 [local] 
idle                                                         
postgres 32610  0.0  0.0 2225692 3832 ?        Ss   Apr14   0:00 postgres: 
navmap grade4 [local] 
idle                                                         
postgres 32611  0.0  0.0 2230252 36960 ?       Ss   Apr14   1:34 postgres: 
navmap grade1 [local] 
idle                                                         
postgres 32612  0.0  0.9 2231704 604632 ?      Ss   Apr14   0:41 postgres: 
navmap grade4 [local] 
idle                                                         
postgres 32613  0.0  0.1 2228324 66780 ?       Ss   Apr14   1:12 postgres: 
navmap grade4 [local] 
idle                                                         
postgres 32614  0.0  0.0 2225692 3792 ?        Ss   Apr14   0:00 postgres: 
navmap grade4 [local] 
idle                                                         
postgres 32615  0.0  0.4 2231668 323880 ?      Ss   Apr14   0:25 postgres: 
navmap grade1 [local] 
idle                                                         
postgres 32616  0.0  0.2 2228340 188900 ?      Ss   Apr14   1:26 postgres: 
navmap grade9 [local] 
idle                                                         
postgres 32617  0.0  0.0 2225656 3696 ?        Ss   Apr14   0:00 postgres: 
navmap grade9 [local] 
idle                                                         


i saw many (about 40 porcess) like above rows

What's wrong?

Thanks

Francesco

>----Messaggio originale----
>Da: stephane.schildknecht at postgresql.fr
>Data: 19/04/2011 15.54
>A: <slony1-general at lists.slony.info>
>Ogg: Re: [Slony1-general] R: Re:  Too many idle process in my server
>
>-----BEGIN PGP SIGNED MESSAGE-----
>Hash: SHA1
>
>Le 19/04/2011 15:27, francescoboccacci at libero.it a ?crit :
>> Hi,
>> postgres.conf 
>> 
>> 
>> max_connections = 200 
>> 
>
>How do you configure your apps ?
>1 master and 4 slaves, that's (2 times the number of nodes + a few) 
connections
>established to your server.
>
>As far as I can tell, slony does not consume all connection slot here.
>
>You should have almost 180 left.
>
>
>- -- 
>St?phane Schildknecht
>Loxodata
>Contact r?gional PostgreSQL
>
>-----BEGIN PGP SIGNATURE-----
>Version: GnuPG v1.4.10 (GNU/Linux)
>Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/
>
>iEYEARECAAYFAk2tlB0ACgkQA+REPKWGI0Fl+gCcCvWpGoru4V2NNAI30MzBZmbb
>UMYAn0IuRO4K/dgslrRArUG2HTGM3rMV
>=N4dg
>-----END PGP SIGNATURE-----
>_______________________________________________
>Slony1-general mailing list
>Slony1-general at lists.slony.info
>http://lists.slony.info/mailman/listinfo/slony1-general
>



From stephane.schildknecht at postgresql.fr  Tue Apr 19 07:18:43 2011
From: stephane.schildknecht at postgresql.fr (=?ISO-8859-15?Q?=22St=E9phane_A=2E_Schildknecht=22?=)
Date: Tue, 19 Apr 2011 16:18:43 +0200
Subject: [Slony1-general] Too many idle process in my server
In-Reply-To: <29976341.1662181303221782684.JavaMail.defaultUser@defaultHost>
References: <29976341.1662181303221782684.JavaMail.defaultUser@defaultHost>
Message-ID: <4DAD99C3.2080400@postgresql.fr>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Le 19/04/2011 16:03, francescoboccacci at libero.it a ?crit :
> Hi,
> i write ps aux | grep postgres in my server:
> 
> 
(...)

Are all the databases on the same server ?

So, indeed, you may get 5 times the number of connections, which may get higher
than 100...

Each daemon (5 here) will create 2 connection to each node.

- -- 
St?phane Schildknecht
Loxodata
Contact r?gional PostgreSQL

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.10 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/

iEYEARECAAYFAk2tmcMACgkQA+REPKWGI0HmcwCeNh311jzCn1IrxJk8zMjLEh0w
/FwAn10bJfWIU+nY6G6Z0wzE0mdcgZty
=gZ74
-----END PGP SIGNATURE-----

From francescoboccacci at libero.it  Tue Apr 19 07:46:20 2011
From: francescoboccacci at libero.it (francescoboccacci at libero.it)
Date: Tue, 19 Apr 2011 16:46:20 +0200 (CEST)
Subject: [Slony1-general] R: Re:  Too many idle process in my server
Message-ID: <4146967.1676831303224380131.JavaMail.defaultUser@defaultHost>

Yes, i have all databases in the same server.
I attach two file: cluster and subscribe. Between that two script i run 5 slon 
daemon like you said to me some days ago.
What i need to change? An important thing: These 5 databases store different 
data in some tables. Only the tables that i write into cluster must be the 
same.
Can you help me to configure my Slony system without all these kind of 
process?
  
Thanks


Francesco


>----Messaggio originale----
>Da: stephane.schildknecht at postgresql.fr
>Data: 19/04/2011 16.18
>A: <slony1-general at lists.slony.info>
>Ogg: Re: [Slony1-general] Too many idle process in my server
>
>-----BEGIN PGP SIGNED MESSAGE-----
>Hash: SHA1
>
>Le 19/04/2011 16:03, francescoboccacci at libero.it a ?crit :
>> Hi,
>> i write ps aux | grep postgres in my server:
>> 
>> 
>(...)
>
>Are all the databases on the same server ?
>
>So, indeed, you may get 5 times the number of connections, which may get 
higher
>than 100...
>
>Each daemon (5 here) will create 2 connection to each node.
>
>- -- 
>St?phane Schildknecht
>Loxodata
>Contact r?gional PostgreSQL
>
>-----BEGIN PGP SIGNATURE-----
>Version: GnuPG v1.4.10 (GNU/Linux)
>Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/
>
>iEYEARECAAYFAk2tmcMACgkQA+REPKWGI0HmcwCeNh311jzCn1IrxJk8zMjLEh0w
>/FwAn10bJfWIU+nY6G6Z0wzE0mdcgZty
>=gZ74
>-----END PGP SIGNATURE-----
>_______________________________________________
>Slony1-general mailing list
>Slony1-general at lists.slony.info
>http://lists.slony.info/mailman/listinfo/slony1-general
>



From stephane.schildknecht at postgresql.fr  Wed Apr 20 01:38:46 2011
From: stephane.schildknecht at postgresql.fr (=?ISO-8859-15?Q?=22St=E9phane_A=2E_Schildknecht=22?=)
Date: Wed, 20 Apr 2011 10:38:46 +0200
Subject: [Slony1-general] R: Re:  Too many idle process in my server
In-Reply-To: <4146967.1676831303224380131.JavaMail.defaultUser@defaultHost>
References: <4146967.1676831303224380131.JavaMail.defaultUser@defaultHost>
Message-ID: <4DAE9B96.9000204@postgresql.fr>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Le 19/04/2011 16:46, francescoboccacci at libero.it a ?crit :
> Yes, i have all databases in the same server.
> I attach two file: cluster and subscribe. Between that two script i run 5 slon 
> daemon like you said to me some days ago.
> What i need to change? An important thing: These 5 databases store different 
> data in some tables. Only the tables that i write into cluster must be the 
> same.
> Can you help me to configure my Slony system without all these kind of 
> process?
>   
> Thanks
> 

Well, you won't be able to get rid of all these processes, as they are the
essence of the replication daemon.

OTH, you may simplify the setup by
- - storing only required pathes ;
- - subscribing without forwarding.

That won't suppress all the connections, though. Do they really bother you ?

Regards,
- -- 
St?phane Schildknecht
Loxodata
Contact r?gional PostgreSQL
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.10 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/

iEYEARECAAYFAk2um5YACgkQA+REPKWGI0El3gCg0MOu+Nj/MuOWb+wjA6yFL/jQ
nK0AoNG92xBAYwh2DIfZLhd1dv3MH46U
=OMrU
-----END PGP SIGNATURE-----

From ssinger at ca.afilias.info  Wed Apr 20 07:47:00 2011
From: ssinger at ca.afilias.info (Steve Singer)
Date: Wed, 20 Apr 2011 10:47:00 -0400
Subject: [Slony1-general] Slony on MS-Windows
Message-ID: <4DAEF1E4.90200@ca.afilias.info>

As discussed on-list a month or two ago I've been working on getting 
Slony 2.0.7 to again build on MS-Windows, this time using the Microsoft 
compiler (no mingw).

I think this is now in a usable state.

You can get the code at

https://github.com/ssinger/slony1-engine/tree/REL_2_0_STABLE_visualc

To build it

1) You will need to generate the lexer and parser output files on your 
own (either on a unix system and copy them over, or by hand).  Since we 
include these in release .tar files I don't see this as an issue

2) Edit the paths to your postgresql + pthread installations in 
src/slon/win32.mak src/slonik/win32.mak src/backend/win32.mak.    (I am 
NOT using ./configure for these builds, settings are in a config_msvc.h 
file and in the nmake makefiles)

3) Run
cd src\slonik\win32.mak
nmake -f win32.mak slonik.exe
cd ..\backend
nmake -f win32.mak slony1_funcs.dll
cd ..\slon
nmake -f win32.mak slon.exe


I would appreciate it if Sachin could test this out and determine if he 
can build slony to distribute with StackBuilder.

I would also appreciate it if someone could test a configure based mingw 
build to see if I've broken anything that worked in mingw before these 
changes.

I would also appreciate it if someone could try this out on a 64 bit 
windows system with a 64 bit postgresql.

If I get some positive test reports we can discuss if these changes are 
suitable for merging into 2.0 for 2.0.7 or if I should just put them 
onto the 2.1 branch.


From stuart at stuartbishop.net  Fri Apr 22 03:25:02 2011
From: stuart at stuartbishop.net (Stuart Bishop)
Date: Fri, 22 Apr 2011 17:25:02 +0700
Subject: [Slony1-general] TRY blocks and 2.1
In-Reply-To: <BANLkTik8o+p+3XLjZxpqYm=KV2VHi4ofqg@mail.gmail.com>
References: <4DA88B67.5040708@ca.afilias.info>
	<BANLkTik8o+p+3XLjZxpqYm=KV2VHi4ofqg@mail.gmail.com>
Message-ID: <BANLkTi=Nwi_YEo2TFRrP37Gg9dLdeq-k-w@mail.gmail.com>

On Sat, Apr 16, 2011 at 2:41 AM, Christopher Browne
<cbbrowne at afilias.info> wrote:
> On Fri, Apr 15, 2011 at 2:16 PM, Steve Singer <ssinger at ca.afilias.info> wrote:
>> C) ?We could get rid of try blocks. ?Some people have commented that
>> they don't behave as expected anyway and with the additional
>> restrictions of changes 1) and 2) they are even less useful.
>
> I'd point not only to "less useful," but also to "less able to be
> reasoned about" as an issue.
>
> The "intuitive" position is that TRY blocks are supposed to look like
> something quasi-transactional; if there's a failure, "everything
> should be rolled back." ?That's certainly a cool idea to consider.
>
> Unfortunately, that's not remotely near to being how things are. ?If
> there are activities inside a TRY block that cross multiple nodes,
> it's not reasonable to expect that all to roll back. ?(We're not using
> 2PC!)

But it does seem to work well enough...

eg. execute a number of SQL scripts in a try block. If one of them
fails when applying to the master, it all rolls back. If they all
work, the events get propagated and they are applied on the slaves and
if this fails you have other problems. It might not be perfect, but it
is better than a kick in the teeth and I would like to keep it.



-- 
Stuart Bishop <stuart at stuartbishop.net>
http://www.stuartbishop.net/

From ssinger at ca.afilias.info  Mon Apr 25 13:53:39 2011
From: ssinger at ca.afilias.info (Steve Singer)
Date: Mon, 25 Apr 2011 16:53:39 -0400
Subject: [Slony1-general] TRY blocks and 2.1
In-Reply-To: <BANLkTi=Nwi_YEo2TFRrP37Gg9dLdeq-k-w@mail.gmail.com>
References: <4DA88B67.5040708@ca.afilias.info>	<BANLkTik8o+p+3XLjZxpqYm=KV2VHi4ofqg@mail.gmail.com>
	<BANLkTi=Nwi_YEo2TFRrP37Gg9dLdeq-k-w@mail.gmail.com>
Message-ID: <4DB5DF53.2000406@ca.afilias.info>

On 11-04-22 06:25 AM, Stuart Bishop wrote:
> On Sat, Apr 16, 2011 at 2:41 AM, Christopher Browne
> <cbbrowne at afilias.info>  wrote:
>> On Fri, Apr 15, 2011 at 2:16 PM, Steve Singer<ssinger at ca.afilias.info>  wrote:
>>> C)  We could get rid of try blocks.  Some people have commented that
>>> they don't behave as expected anyway and with the additional
>>> restrictions of changes 1) and 2) they are even less useful.
>>
>> I'd point not only to "less useful," but also to "less able to be
>> reasoned about" as an issue.
>>
>> The "intuitive" position is that TRY blocks are supposed to look like
>> something quasi-transactional; if there's a failure, "everything
>> should be rolled back."  That's certainly a cool idea to consider.
>>
>> Unfortunately, that's not remotely near to being how things are.  If
>> there are activities inside a TRY block that cross multiple nodes,
>> it's not reasonable to expect that all to roll back.  (We're not using
>> 2PC!)
>
> But it does seem to work well enough...
>
> eg. execute a number of SQL scripts in a try block. If one of them
> fails when applying to the master, it all rolls back. If they all
> work, the events get propagated and they are applied on the slaves and
> if this fails you have other problems. It might not be perfect, but it
> is better than a kick in the teeth and I would like to keep it.

So how do you feel about slonik obtaining the sl_event_lock on all nodes 
while it performs the execute script.   The concequence of this is that 
no new SYNC events will be generated on any node until ALL of your 
execute scripts (in that try block) commit.

This would mean that if you have nodes  1 hosting set 1, and node 2 
hosting set 2 an EXECUTE SCRIPT (or anything else) in a try block on 
node 1 would pause replication from node 2 (even between nodes 2 and 3). 
  Of course if you don't use a try block then sync event generation on 
node 2 won't be paused.






From sam at eventful.com  Mon Apr 25 17:11:58 2011
From: sam at eventful.com (Sam Choukri)
Date: Mon, 25 Apr 2011 17:11:58 -0700
Subject: [Slony1-general] upgrade postgres 8.1 to 9.0 via slony
Message-ID: <4B12B9D6-F93D-42D3-A5A4-B6B11DAA0766@eventful.com>

Hello,

I am maintaining a pair of database servers on CentOS 5 running Posgtres 8.1.18 and Slony 1.2.22 (1 master to 1 slave). I would like to upgrade the database to Postgres 9.0, but I do not have the option of doing a standard drop and restore. Therefore, I'd like to use Slony to replicate from 8.1 to 9.0, then do a switchover.

The release notes for Slony 1.2.22 says it added explicit support for Postgres 9.0 so I'm cautiously optimistic I can do it. But is it a good idea? Any gotchas I should be concerned about? 

By the way, I could not find a search interface for the slony mail list archives. Does one exist?

Thanks,

-Sam Choukri



From stephane.schildknecht at postgresql.fr  Mon Apr 25 22:40:32 2011
From: stephane.schildknecht at postgresql.fr (=?ISO-8859-15?Q?=22St=E9phane_A=2E_Schildknecht=22?=)
Date: Tue, 26 Apr 2011 07:40:32 +0200
Subject: [Slony1-general] upgrade postgres 8.1 to 9.0 via slony
In-Reply-To: <4B12B9D6-F93D-42D3-A5A4-B6B11DAA0766@eventful.com>
References: <4B12B9D6-F93D-42D3-A5A4-B6B11DAA0766@eventful.com>
Message-ID: <4DB65AD0.7000504@postgresql.fr>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Le 26/04/2011 02:11, Sam Choukri a ?crit :
> Hello,
> 
> I am maintaining a pair of database servers on CentOS 5 running Posgtres 8.1.18 and Slony 1.2.22 (1 master to 1 slave). I would like to upgrade the database to Postgres 9.0, but I do not have the option of doing a standard drop and restore. Therefore, I'd like to use Slony to replicate from 8.1 to 9.0, then do a switchover.
> 
> The release notes for Slony 1.2.22 says it added explicit support for Postgres 9.0 so I'm cautiously optimistic I can do it. But is it a good idea? Any gotchas I should be concerned about? 

Yes, Slony does allow you to do seach an upgrade.
As you are already using Slony, you know what it can do and what it can't.
Doing a replication from 8.1 to 9.0 does not bring you any new gotcha.

> 
> By the way, I could not find a search interface for the slony mail list archives. Does one exist?

google :-)

Regards,

- -- 
St?phane Schildknecht
Loxodata
Contact r?gional PostgreSQL

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.10 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/

iEYEARECAAYFAk22Ws8ACgkQA+REPKWGI0H4tACgvF+D8mmnfoS6W4cLm82cSlaG
aQAAniYHMz5kvesK6fWe29g1LE/M5/0d
=B5mf
-----END PGP SIGNATURE-----

From stuart at stuartbishop.net  Mon Apr 25 23:16:41 2011
From: stuart at stuartbishop.net (Stuart Bishop)
Date: Tue, 26 Apr 2011 13:16:41 +0700
Subject: [Slony1-general] TRY blocks and 2.1
In-Reply-To: <4DB5DF53.2000406@ca.afilias.info>
References: <4DA88B67.5040708@ca.afilias.info>
	<BANLkTik8o+p+3XLjZxpqYm=KV2VHi4ofqg@mail.gmail.com>
	<BANLkTi=Nwi_YEo2TFRrP37Gg9dLdeq-k-w@mail.gmail.com>
	<4DB5DF53.2000406@ca.afilias.info>
Message-ID: <BANLkTimmizUy4e2+UtqP3TwttaD7G=BjbQ@mail.gmail.com>

On Tue, Apr 26, 2011 at 3:53 AM, Steve Singer <ssinger at ca.afilias.info> wrote:
> On 11-04-22 06:25 AM, Stuart Bishop wrote:
>>
>> On Sat, Apr 16, 2011 at 2:41 AM, Christopher Browne
>> <cbbrowne at afilias.info> ?wrote:
>>>
>>> On Fri, Apr 15, 2011 at 2:16 PM, Steve Singer<ssinger at ca.afilias.info>
>>> ?wrote:
>>>>
>>>> C) ?We could get rid of try blocks. ?Some people have commented that
>>>> they don't behave as expected anyway and with the additional
>>>> restrictions of changes 1) and 2) they are even less useful.
>>>
>>> I'd point not only to "less useful," but also to "less able to be
>>> reasoned about" as an issue.
>>>
>>> The "intuitive" position is that TRY blocks are supposed to look like
>>> something quasi-transactional; if there's a failure, "everything
>>> should be rolled back." ?That's certainly a cool idea to consider.
>>>
>>> Unfortunately, that's not remotely near to being how things are. ?If
>>> there are activities inside a TRY block that cross multiple nodes,
>>> it's not reasonable to expect that all to roll back. ?(We're not using
>>> 2PC!)
>>
>> But it does seem to work well enough...
>>
>> eg. execute a number of SQL scripts in a try block. If one of them
>> fails when applying to the master, it all rolls back. If they all
>> work, the events get propagated and they are applied on the slaves and
>> if this fails you have other problems. It might not be perfect, but it
>> is better than a kick in the teeth and I would like to keep it.
>
> So how do you feel about slonik obtaining the sl_event_lock on all nodes
> while it performs the execute script. ? The concequence of this is that no
> new SYNC events will be generated on any node until ALL of your execute
> scripts (in that try block) commit.
>
> This would mean that if you have nodes ?1 hosting set 1, and node 2 hosting
> set 2 an EXECUTE SCRIPT (or anything else) in a try block on node 1 would
> pause replication from node 2 (even between nodes 2 and 3). ?Of course if
> you don't use a try block then sync event generation on node 2 won't be
> paused.

Me? I have no problem with that. My applications already have to cope
with lag because I'm using asynchronous replication, so I'm not
particularly fussed if replication on the cluster stops completely
while I'm twiddling stuff with slonik.

My goal would be to minimize locks on table, increasing my chances of
any particular change being able to run on the live system. I think
this is already the case in 2.0.


-- 
Stuart Bishop <stuart at stuartbishop.net>
http://www.stuartbishop.net/

From vivek at khera.org  Tue Apr 26 05:33:07 2011
From: vivek at khera.org (Vick Khera)
Date: Tue, 26 Apr 2011 08:33:07 -0400
Subject: [Slony1-general] upgrade postgres 8.1 to 9.0 via slony
In-Reply-To: <4B12B9D6-F93D-42D3-A5A4-B6B11DAA0766@eventful.com>
References: <4B12B9D6-F93D-42D3-A5A4-B6B11DAA0766@eventful.com>
Message-ID: <BANLkTinGNngn9qmSh95YQCF33EzZTrPFZA@mail.gmail.com>

On Mon, Apr 25, 2011 at 8:11 PM, Sam Choukri <sam at eventful.com> wrote:

> Therefore, I'd like to use Slony to replicate from 8.1 to 9.0, then do a
> switchover.


Be sure to test your application(s) against the 9.0 version before you do
this. There are some minor incompatibilities you will need to address.
 Mostly these are changes in implicit casting of some types (such as strings
to integers) in certain cases.

Also, if you have utf-8 encoding, beware that newer postgres versions are
more strict than some of the older ones.  I'm not sure if 8.1 is as strict
as 9.0.

There may be other issues. You should research the release notes of every
version between 8.1.x and 9.0.4

As far as slony is concerned, this is one of the use cases it was designed
to handle, so will do its job well.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20110426/d1feb8c0/attachment.htm 

From Frank.Mcgeough at vocalocity.com  Tue Apr 26 07:41:18 2011
From: Frank.Mcgeough at vocalocity.com (Frank McGeough)
Date: Tue, 26 Apr 2011 07:41:18 -0700
Subject: [Slony1-general] dropping trigger on slave
Message-ID: <9F2DDBC1199E7C47B8A3B2CCCDD1E62008EB6E1260@VA3DIAXVS341.RED001.local>

I'm using Postgres 8.4 and Slony 1.2.20. 

My database replication configuration is a master with two slaves. 

I have a table "A" that is replicated. A trigger existed on table "A" that called a function that inserted into another table "B" that was replicated. 

I don't need to replicate table "B" anymore. I've removed it from the replication set. 

I'd like to clean up the trigger and function as well but, although I can easily drop these on the master, the slave trigger is hidden by slony. 

What is the approach used to drop unneeded triggers from slaves? 

Thanks,
Frank

From ssinger at ca.afilias.info  Tue Apr 26 07:50:23 2011
From: ssinger at ca.afilias.info (Steve Singer)
Date: Tue, 26 Apr 2011 10:50:23 -0400
Subject: [Slony1-general] dropping trigger on slave
In-Reply-To: <9F2DDBC1199E7C47B8A3B2CCCDD1E62008EB6E1260@VA3DIAXVS341.RED001.local>
References: <9F2DDBC1199E7C47B8A3B2CCCDD1E62008EB6E1260@VA3DIAXVS341.RED001.local>
Message-ID: <4DB6DBAF.90203@ca.afilias.info>

On 11-04-26 10:41 AM, Frank McGeough wrote:
> I'm using Postgres 8.4 and Slony 1.2.20.
>
> My database replication configuration is a master with two slaves.
>
> I have a table "A" that is replicated. A trigger existed on table "A" that called a function that inserted into another table "B" that was replicated.
>
> I don't need to replicate table "B" anymore. I've removed it from the replication set.
>
> I'd like to clean up the trigger and function as well but, although I can easily drop these on the master, the slave trigger is hidden by slony.
>
> What is the approach used to drop unneeded triggers from slaves?
>

When your 'set drop table(....)' command was replicated to the slave it 
should have restored any hidden triggers on the slave.  Is this not the 
case?

Is the deny access trigger still visible on the slave? If so I would 
suspect that the drop table event hasn't been replicated to the slave.




> Thanks,
> Frank
> _______________________________________________
> Slony1-general mailing list
> Slony1-general at lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general


From Frank.Mcgeough at vocalocity.com  Tue Apr 26 07:59:17 2011
From: Frank.Mcgeough at vocalocity.com (Frank McGeough)
Date: Tue, 26 Apr 2011 07:59:17 -0700
Subject: [Slony1-general] dropping trigger on slave
In-Reply-To: <4DB6DBAF.90203@ca.afilias.info>
References: <9F2DDBC1199E7C47B8A3B2CCCDD1E62008EB6E1260@VA3DIAXVS341.RED001.local>
	<4DB6DBAF.90203@ca.afilias.info>
Message-ID: <9F2DDBC1199E7C47B8A3B2CCCDD1E62008EB6E127A@VA3DIAXVS341.RED001.local>

-----Original Message-----
From: Steve Singer [mailto:ssinger at ca.afilias.info] 
Sent: Tuesday, April 26, 2011 10:50 AM
To: Frank McGeough
Cc: slony1-general at lists.slony.info
Subject: Re: [Slony1-general] dropping trigger on slave

On 11-04-26 10:41 AM, Frank McGeough wrote:
> I'm using Postgres 8.4 and Slony 1.2.20.
>
> My database replication configuration is a master with two slaves.
>
> I have a table "A" that is replicated. A trigger existed on table "A" that called a function that inserted into another table "B" that was replicated.
>
> I don't need to replicate table "B" anymore. I've removed it from the replication set.
>
> I'd like to clean up the trigger and function as well but, although I can easily drop these on the master, the slave trigger is hidden by slony.
>
> What is the approach used to drop unneeded triggers from slaves?
>

When your 'set drop table(....)' command was replicated to the slave it 
should have restored any hidden triggers on the slave.  Is this not the 
case?

Is the deny access trigger still visible on the slave? If so I would 
suspect that the drop table event hasn't been replicated to the slave.

Steve,

The drop table on table "B" worked fine. The problem that I have is that the trigger is on table "A" - which is still replicated. 

To state the question as generally as I can : how do you drop triggers within a Slony replicated system? There are always cases where you realize a trigger on a replicated table is no longer needed. What do you do in that case? What is the Slony prescribed procedure for dealing with that? 


Thanks,
Frank

From ssinger at ca.afilias.info  Tue Apr 26 08:07:24 2011
From: ssinger at ca.afilias.info (Steve Singer)
Date: Tue, 26 Apr 2011 11:07:24 -0400
Subject: [Slony1-general] dropping trigger on slave
In-Reply-To: <9F2DDBC1199E7C47B8A3B2CCCDD1E62008EB6E127A@VA3DIAXVS341.RED001.local>
References: <9F2DDBC1199E7C47B8A3B2CCCDD1E62008EB6E1260@VA3DIAXVS341.RED001.local>	<4DB6DBAF.90203@ca.afilias.info>
	<9F2DDBC1199E7C47B8A3B2CCCDD1E62008EB6E127A@VA3DIAXVS341.RED001.local>
Message-ID: <4DB6DFAC.2090600@ca.afilias.info>

On 11-04-26 10:59 AM, Frank McGeough wrote:

>
> Steve,
>
> The drop table on table "B" worked fine. The problem that I have is that the trigger is on table "A" - which is still replicated.
>
> To state the question as generally as I can : how do you drop triggers within a Slony replicated system? There are always cases where you realize a trigger on a replicated table is no longer needed. What do you do in that case? What is the Slony prescribed procedure for dealing with that?

To drop a non-slony installed trigger on a replicated table in 1.2 you 
use EXECUTE SCRIPT.

When the EXECUTE SCRIPT command/event runs on the slave it will restore 
all replicated tables to the unaltered state for the duration of the script.

Keep in mind that EXECUTE SCRIPT in 1.2 is a heavy locking operation.



>
>
> Thanks,
> Frank
> _______________________________________________
> Slony1-general mailing list
> Slony1-general at lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general


From cbbrowne at afilias.info  Tue Apr 26 08:31:45 2011
From: cbbrowne at afilias.info (Christopher Browne)
Date: Tue, 26 Apr 2011 11:31:45 -0400
Subject: [Slony1-general] dropping trigger on slave
In-Reply-To: <4DB6DFAC.2090600@ca.afilias.info>
References: <9F2DDBC1199E7C47B8A3B2CCCDD1E62008EB6E1260@VA3DIAXVS341.RED001.local>
	<4DB6DBAF.90203@ca.afilias.info>
	<9F2DDBC1199E7C47B8A3B2CCCDD1E62008EB6E127A@VA3DIAXVS341.RED001.local>
	<4DB6DFAC.2090600@ca.afilias.info>
Message-ID: <BANLkTi=SmP4mapGGS1Js-QAAnX6oopCXjQ@mail.gmail.com>

On Tue, Apr 26, 2011 at 11:07 AM, Steve Singer <ssinger at ca.afilias.info> wrote:
> To drop a non-slony installed trigger on a replicated table in 1.2 you
> use EXECUTE SCRIPT.
>
> When the EXECUTE SCRIPT command/event runs on the slave it will restore
> all replicated tables to the unaltered state for the duration of the script.
>
> Keep in mind that EXECUTE SCRIPT in 1.2 is a heavy locking operation.

Yep, "what Steve said."

In version 2, it might become a reasonable proposition to drop the
triggers directly, but on 1.2, Slony does way too much mucking around
with the system catalog for it to seem remotely safe to do other than
EXECUTE SCRIPT.

From scott.marlowe at gmail.com  Tue Apr 26 08:32:47 2011
From: scott.marlowe at gmail.com (Scott Marlowe)
Date: Tue, 26 Apr 2011 09:32:47 -0600
Subject: [Slony1-general] upgrade postgres 8.1 to 9.0 via slony
In-Reply-To: <4B12B9D6-F93D-42D3-A5A4-B6B11DAA0766@eventful.com>
References: <4B12B9D6-F93D-42D3-A5A4-B6B11DAA0766@eventful.com>
Message-ID: <BANLkTikAK4BFovzp4cvZ_bfzKf2fgZfu7w@mail.gmail.com>

On Mon, Apr 25, 2011 at 6:11 PM, Sam Choukri <sam at eventful.com> wrote:
> Hello,
>
> I am maintaining a pair of database servers on CentOS 5 running Posgtres 8.1.18 and Slony 1.2.22 (1 master to 1 slave). I would like to upgrade the database to Postgres 9.0, but I do not have the option of doing a standard drop and restore. Therefore, I'd like to use Slony to replicate from 8.1 to 9.0, then do a switchover.
>
> The release notes for Slony 1.2.22 says it added explicit support for Postgres 9.0 so I'm cautiously optimistic I can do it. But is it a good idea? Any gotchas I should be concerned about?

It's how we upgraded from 8.1 to 8.3 smoothly a year or three ago.
I'd recommend updating slony to the latest version.

From ssinger at ca.afilias.info  Tue Apr 26 08:36:40 2011
From: ssinger at ca.afilias.info (Steve Singer)
Date: Tue, 26 Apr 2011 11:36:40 -0400
Subject: [Slony1-general] upgrade postgres 8.1 to 9.0 via slony
In-Reply-To: <BANLkTikAK4BFovzp4cvZ_bfzKf2fgZfu7w@mail.gmail.com>
References: <4B12B9D6-F93D-42D3-A5A4-B6B11DAA0766@eventful.com>
	<BANLkTikAK4BFovzp4cvZ_bfzKf2fgZfu7w@mail.gmail.com>
Message-ID: <4DB6E688.50901@ca.afilias.info>

On 11-04-26 11:32 AM, Scott Marlowe wrote:
> On Mon, Apr 25, 2011 at 6:11 PM, Sam Choukri<sam at eventful.com>  wrote:
>> Hello,
>>
>> I am maintaining a pair of database servers on CentOS 5 running Posgtres 8.1.18 and Slony 1.2.22 (1 master to 1 slave). I would like to upgrade the database to Postgres 9.0, but I do not have the option of doing a standard drop and restore. Therefore, I'd like to use Slony to replicate from 8.1 to 9.0, then do a switchover.
>>
>> The release notes for Slony 1.2.22 says it added explicit support for Postgres 9.0 so I'm cautiously optimistic I can do it. But is it a good idea? Any gotchas I should be concerned about?
>
> It's how we upgraded from 8.1 to 8.3 smoothly a year or three ago.
> I'd recommend updating slony to the latest version.

1.2.22 is the latest version of Slony that will work for what he is 
doing (if a 1.2.23 is ever needed/released I would assume that would 
continue to work as well).

2.0 or higher requires at least PostgreSQL 8.3 or higher.  After he 
upgrades to 9.0 he could then upgrade to a more recent slony version.



> _______________________________________________
> Slony1-general mailing list
> Slony1-general at lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general


From cbbrowne at afilias.info  Tue Apr 26 08:38:12 2011
From: cbbrowne at afilias.info (Christopher Browne)
Date: Tue, 26 Apr 2011 11:38:12 -0400
Subject: [Slony1-general] upgrade postgres 8.1 to 9.0 via slony
In-Reply-To: <4B12B9D6-F93D-42D3-A5A4-B6B11DAA0766@eventful.com>
References: <4B12B9D6-F93D-42D3-A5A4-B6B11DAA0766@eventful.com>
Message-ID: <BANLkTi=s_nmBmv5LJfpF334TcNLYPDpWHQ@mail.gmail.com>

On Mon, Apr 25, 2011 at 8:11 PM, Sam Choukri <sam at eventful.com> wrote:
> Hello,
>
> I am maintaining a pair of database servers on CentOS 5 running Posgtres 8.1.18 and Slony 1.2.22 (1 master to 1 slave). I would like to upgrade the database to Postgres 9.0, but I do not have the option of doing a standard drop and restore. Therefore, I'd like to use Slony to replicate from 8.1 to 9.0, then do a switchover.
>
> The release notes for Slony 1.2.22 says it added explicit support for Postgres 9.0 so I'm cautiously optimistic I can do it. But is it a good idea? Any gotchas I should be concerned about?

Your "gotchas" will generally have to do with changes in Postgres features.

Notably, somewhere between 8.1 and 9.0, Postgres got quite a bit more
strict about its handling of UTF-8, and a lot of people had headaches
out of complaints of "invalid encoding".

The issue got discussed pretty thoroughly here:
<http://lists.slony.info/pipermail/slony1-general/2010-April/010596.html>

> By the way, I could not find a search interface for the slony mail list archives. Does one exist?

We didn't put one in place; you can probably use search engines (e.g.
- such as G**gl*)...

From sam at eventful.com  Tue Apr 26 10:33:05 2011
From: sam at eventful.com (Sam Choukri)
Date: Tue, 26 Apr 2011 10:33:05 -0700
Subject: [Slony1-general] upgrade postgres 8.1 to 9.0 via slony
In-Reply-To: <BANLkTi=s_nmBmv5LJfpF334TcNLYPDpWHQ@mail.gmail.com>
References: <4B12B9D6-F93D-42D3-A5A4-B6B11DAA0766@eventful.com>
	<BANLkTi=s_nmBmv5LJfpF334TcNLYPDpWHQ@mail.gmail.com>
Message-ID: <0C4C4E1C-C4E5-409A-B99B-C29342735923@eventful.com>

Thank you all for your help. I've already loaded a dump our postgres 8.1 database into a dev server running 9.0 and verified that our applications work as expected. I was just mainly concerned that slony wouldn't fully support that big of a jump in versions. I thought I was going to have to use slony 1.2 to migrate from postgres 8.1 to 8.3, then upgrade to slony 2.0, then make the final jump from postgres 8.3 to 9.0. I'm relieved that I won't have to go through all that hassle. Thank you very much for adding support for postgres 9.0 in slony 1.2!

-Sam Choukri


On Apr 26, 2011, at 8:38 AM, Christopher Browne wrote:

> On Mon, Apr 25, 2011 at 8:11 PM, Sam Choukri <sam at eventful.com> wrote:
>> Hello,
>> 
>> I am maintaining a pair of database servers on CentOS 5 running Posgtres 8.1.18 and Slony 1.2.22 (1 master to 1 slave). I would like to upgrade the database to Postgres 9.0, but I do not have the option of doing a standard drop and restore. Therefore, I'd like to use Slony to replicate from 8.1 to 9.0, then do a switchover.
>> 
>> The release notes for Slony 1.2.22 says it added explicit support for Postgres 9.0 so I'm cautiously optimistic I can do it. But is it a good idea? Any gotchas I should be concerned about?
> 
> Your "gotchas" will generally have to do with changes in Postgres features.
> 
> Notably, somewhere between 8.1 and 9.0, Postgres got quite a bit more
> strict about its handling of UTF-8, and a lot of people had headaches
> out of complaints of "invalid encoding".
> 
> The issue got discussed pretty thoroughly here:
> <http://lists.slony.info/pipermail/slony1-general/2010-April/010596.html>
> 
>> By the way, I could not find a search interface for the slony mail list archives. Does one exist?
> 
> We didn't put one in place; you can probably use search engines (e.g.
> - such as G**gl*)...
> 


From rnancy at afilias.info  Tue Apr 26 11:43:27 2011
From: rnancy at afilias.info (Rose Nancy)
Date: Tue, 26 Apr 2011 14:43:27 -0400
Subject: [Slony1-general] pg_upgrade with Slony replication
Message-ID: <BANLkTim2YA_tS1QSJEBCS_26vCKr_mMhCg@mail.gmail.com>

Hi all,

I am using Postgres 8.3 and slony 2.0.6.
I have tried to upgrade Postgres 8.3 to Postgres 9.0.3 using PG_UPGRADE and
I come across this issue .

Checking for invalid 'name' user columns                    fatal

        | Your installation contains the "name" data type in
        | user tables.  This data type changed its internal
        | alignment between your old and new clusters so this
        | cluster cannot currently be upgraded.  You can
        | remove the problem tables and restart the migration.
        | A list of the problem columns is in the file:
        |       /opt/tables_using_name.txt

             List of tables :
          -_oxrsaero.sl_table.tab_relname
          -_oxrsaero.sl_table.tab_nspname
          -_oxrsaero.sl_table.tab_idxname
          -_oxrsaero.sl_sequence.seq_relname
          -_oxrsaero.sl_sequence.seq_nspname
          -_oxrsaero.vactables.relname

Regards.
Rose.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20110426/cdbe3e5c/attachment.htm 

From ajs at crankycanuck.ca  Tue Apr 26 12:08:50 2011
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Tue, 26 Apr 2011 15:08:50 -0400
Subject: [Slony1-general] pg_upgrade with Slony replication
In-Reply-To: <BANLkTim2YA_tS1QSJEBCS_26vCKr_mMhCg@mail.gmail.com>
References: <BANLkTim2YA_tS1QSJEBCS_26vCKr_mMhCg@mail.gmail.com>
Message-ID: <20110426190849.GB4207@shinkuro.com>

On Tue, Apr 26, 2011 at 02:43:27PM -0400, Rose Nancy wrote:

>           -_oxrsaero.sl_table.tab_relname
>           -_oxrsaero.sl_table.tab_nspname
>           -_oxrsaero.sl_table.tab_idxname
>           -_oxrsaero.sl_sequence.seq_relname
>           -_oxrsaero.sl_sequence.seq_nspname
>           -_oxrsaero.vactables.relname

Looks like you can't use pg_upgrade to upgrade an active Slony system,
then.  I think this is a reasonable limit of pg_upgrade.  The tool is
not designed to do upgrades on random system extensions where the
datatype is incompatible, so if you've done something like that you're
probably going to have to modify pg_upgrade yourself.  Of course,
Slony is using system datatypes because it's really a system extension
posing as a user application.

A



-- 
Andrew Sullivan
ajs at crankycanuck.ca

From ssinger at ca.afilias.info  Tue Apr 26 12:24:08 2011
From: ssinger at ca.afilias.info (Steve Singer)
Date: Tue, 26 Apr 2011 15:24:08 -0400
Subject: [Slony1-general] pg_upgrade with Slony replication
In-Reply-To: <BANLkTim2YA_tS1QSJEBCS_26vCKr_mMhCg@mail.gmail.com>
References: <BANLkTim2YA_tS1QSJEBCS_26vCKr_mMhCg@mail.gmail.com>
Message-ID: <4DB71BD8.7050903@ca.afilias.info>

On 11-04-26 02:43 PM, Rose Nancy wrote:
> Hi all,
>
> I am using Postgres 8.3 and slony 2.0.6.
> I have tried to upgrade Postgres 8.3 to Postgres 9.0.3 using PG_UPGRADE
> and I come across this issue .
>
> Checking for invalid 'name' user columns                    fatal
>
>          | Your installation contains the "name" data type in
>          | user tables.  This data type changed its internal
>          | alignment between your old and new clusters so this
>          | cluster cannot currently be upgraded.  You can
>          | remove the problem tables and restart the migration.
>          | A list of the problem columns is in the file:
>          |       /opt/tables_using_name.txt
>

I am wondering if these tables really should be using type text instead 
of name.   With respect to the 'name' data type the postgresql manual 
says "The name type exists only for the storage of identifiers in the 
internal system catalogs and is not intended for use by the general user."

The slony tables aren't part of the system catalog, they are only 
storing the same type of information as the catalog.  Slony generally 
tries to live by the same rules as other postgresql extensions (I'm 
ignoring the fact that prior to 2.0 it munged pg_class).  Maybe we 
should change these for 2.1?  (I'm not sure how keen I am about changing 
column definitions for 2.0.7)

I suspect your upgrade will work if you change these to type 'text' with 
alter table, then upgrade then change them back to name.  You will also 
need to use the 'UPDATE FUNCTIONS' command post upgrade to make sure the 
v84/90 versions of slony functions get installed instead of the v83 
versions. (I haven't tried this procedure, there might be other issues I 
don't see)




From rnancy at afilias.info  Tue Apr 26 14:33:56 2011
From: rnancy at afilias.info (Rose Nancy)
Date: Tue, 26 Apr 2011 17:33:56 -0400
Subject: [Slony1-general] pg_upgrade with Slony replication
In-Reply-To: <4DB71BD8.7050903@ca.afilias.info>
References: <BANLkTim2YA_tS1QSJEBCS_26vCKr_mMhCg@mail.gmail.com>
	<4DB71BD8.7050903@ca.afilias.info>
Message-ID: <BANLkTimbN8fn+gHm4y+=5ySuaqOBa3+NPw@mail.gmail.com>

Hi,

Thank you for your quick reply.
The problem with changing these to type 'text' with alter table is that,
amongst my list of table using the data type "name",
I have "_oxrsaero.vactables.relname" which is a COMPOSITE TYPE and according
to the Postgres 8.3 documentation I cannot ALTER the attributes of a
COMPOSITE TYPE.

Also I don't think that DROP and RECREATE  "_oxrsaero.vactables.relname "
will be a good idea since some Slony functions might be using it.

So any idea...

Regards
Rose.



On Tue, Apr 26, 2011 at 3:24 PM, Steve Singer <ssinger at ca.afilias.info>wrote:

> On 11-04-26 02:43 PM, Rose Nancy wrote:
>
>> Hi all,
>>
>> I am using Postgres 8.3 and slony 2.0.6.
>> I have tried to upgrade Postgres 8.3 to Postgres 9.0.3 using PG_UPGRADE
>> and I come across this issue .
>>
>> Checking for invalid 'name' user columns                    fatal
>>
>>         | Your installation contains the "name" data type in
>>         | user tables.  This data type changed its internal
>>         | alignment between your old and new clusters so this
>>         | cluster cannot currently be upgraded.  You can
>>         | remove the problem tables and restart the migration.
>>         | A list of the problem columns is in the file:
>>         |       /opt/tables_using_name.txt
>>
>>
> I am wondering if these tables really should be using type text instead of
> name.   With respect to the 'name' data type the postgresql manual says "The
> name type exists only for the storage of identifiers in the internal system
> catalogs and is not intended for use by the general user."
>
> The slony tables aren't part of the system catalog, they are only storing
> the same type of information as the catalog.  Slony generally tries to live
> by the same rules as other postgresql extensions (I'm ignoring the fact that
> prior to 2.0 it munged pg_class).  Maybe we should change these for 2.1?
>  (I'm not sure how keen I am about changing column definitions for 2.0.7)
>
> I suspect your upgrade will work if you change these to type 'text' with
> alter table, then upgrade then change them back to name.  You will also need
> to use the 'UPDATE FUNCTIONS' command post upgrade to make sure the v84/90
> versions of slony functions get installed instead of the v83 versions. (I
> haven't tried this procedure, there might be other issues I don't see)
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20110426/5d725f0f/attachment.htm 

From cbbrowne at afilias.info  Tue Apr 26 15:00:56 2011
From: cbbrowne at afilias.info (Christopher Browne)
Date: Tue, 26 Apr 2011 18:00:56 -0400
Subject: [Slony1-general] pg_upgrade with Slony replication
In-Reply-To: <BANLkTimbN8fn+gHm4y+=5ySuaqOBa3+NPw@mail.gmail.com>
References: <BANLkTim2YA_tS1QSJEBCS_26vCKr_mMhCg@mail.gmail.com>
	<4DB71BD8.7050903@ca.afilias.info>
	<BANLkTimbN8fn+gHm4y+=5ySuaqOBa3+NPw@mail.gmail.com>
Message-ID: <BANLkTin=ByEUp4P-ZXH_9RVyVLvPJw3OEA@mail.gmail.com>

On Tue, Apr 26, 2011 at 5:33 PM, Rose Nancy <rnancy at afilias.info> wrote:
> Hi,
>
> Thank you for your quick reply.
> The problem with changing these to type 'text' with alter table is that,
> amongst my list of table using the data type "name",
> I have "_oxrsaero.vactables.relname" which is a COMPOSITE TYPE and according
> to the Postgres 8.3 documentation I cannot ALTER the attributes of a
> COMPOSITE TYPE.
>
> Also I don't think that DROP and RECREATE? "_oxrsaero.vactables.relname "
> will be a good idea since some Slony functions might be using it.
>
> So any idea...

Oh, it's certainly there in order to be used.  I'm pretty sure I'm "at
fault" for its addition, and if it were *not* referenced, it would be
pretty fair to get rid of it.  :-)

That type is used as the structure to indicate tables that are to be
vacuumed by the cleanup thread.

It should be a pretty reasonable idea to drop the type and recreate it
with a more suitable definition.  That wouldn't disturb Slony terribly
much, as it's only a slon process that would access it, and it seems
likely to me that having a slon running during the pg_upgrade process
would be TOTALLY disastrous!  :-)  I'm pretty sure slons will be down
at that time!

Look for the definition in the sources in
src/backend/slony1_base.v*.sql; it's actually reasonably
well-documented there.

You'd presumably also need to drop the function TablesToVacuum(), and
recreate that.

I am a bit undecided as to the merits of making such a change.  As
Andrew observed, the "name" type is intended to be used for system
datatypes; Slony tends to behave in a pretty 'system-y' way, so it's
not totally "out there" for it to be using "name".  But if it's a
relatively minor "tweak" to have Slony use text in lieu of "name" and
play better with pg_upgrade, well, there's some value to that.

Seeing as how nobody has really tried to think through the
implications of the change, it's not obvious that this is something we
ought to be doing in any already existing branch of Slony.  I'd not be
too keen to "quickly shove it through" on 2.0, or even the
hopefully-forthcoming-in-not-too-long 2.1.

From ajs at crankycanuck.ca  Tue Apr 26 16:58:42 2011
From: ajs at crankycanuck.ca (Andrew Sullivan)
Date: Tue, 26 Apr 2011 19:58:42 -0400
Subject: [Slony1-general] pg_upgrade with Slony replication
In-Reply-To: <BANLkTin=ByEUp4P-ZXH_9RVyVLvPJw3OEA@mail.gmail.com>
References: <BANLkTim2YA_tS1QSJEBCS_26vCKr_mMhCg@mail.gmail.com>
	<4DB71BD8.7050903@ca.afilias.info>
	<BANLkTimbN8fn+gHm4y+=5ySuaqOBa3+NPw@mail.gmail.com>
	<BANLkTin=ByEUp4P-ZXH_9RVyVLvPJw3OEA@mail.gmail.com>
Message-ID: <20110426235841.GA5730@shinkuro.com>

On Tue, Apr 26, 2011 at 06:00:56PM -0400, Christopher Browne wrote:

> Seeing as how nobody has really tried to think through the
> implications of the change, it's not obvious that this is something we
> ought to be doing in any already existing branch of Slony.  I'd not be
> too keen to "quickly shove it through" on 2.0, or even the
> hopefully-forthcoming-in-not-too-long 2.1.

Let me say more emphatically that I think it would be a terrible idea
to try to do this quickly.  I seem to recall there was a reason we
picked name rather than text in the distant past, but I have no clue
any more what it was.  Nevertheless, I'd be pretty reluctant to do
this in a hurry.  I hope the OP is doing this on a copy and not in
production!

A

-- 
Andrew Sullivan
ajs at crankycanuck.ca

From Dinakaran.K at fs.mphasis.com  Wed Apr 27 04:50:52 2011
From: Dinakaran.K at fs.mphasis.com (Dinakaran Kanagaraj)
Date: Wed, 27 Apr 2011 17:20:52 +0530
Subject: [Slony1-general] pg_dump : error
Message-ID: <903B52597234234780280350C633091427F4BA002B@FSMPCHMBX01.FS.MPHASIS.COM>

Hi,

I have postgresql 8.4.3. I tried executing pg_dump using the command : ./pg_dump -U admin -p 15432 SIEM -f /home/karan/dumpfile

After giving the password it throws the below error. Please let know how to fix this.

pg_dump: SQL command failed
pg_dump: Error message from server: ERROR:  permission denied for relation databasechangeloglock
pg_dump: The command was: LOCK TABLE public.databasechangeloglock IN ACCESS SHARE MODE


Thanks,
Dinakaran
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20110427/ea4468a8/attachment-0001.htm 

From cbbrowne at afilias.info  Wed Apr 27 07:59:34 2011
From: cbbrowne at afilias.info (Christopher Browne)
Date: Wed, 27 Apr 2011 10:59:34 -0400
Subject: [Slony1-general] pg_dump : error
In-Reply-To: <903B52597234234780280350C633091427F4BA002B@FSMPCHMBX01.FS.MPHASIS.COM>
References: <903B52597234234780280350C633091427F4BA002B@FSMPCHMBX01.FS.MPHASIS.COM>
Message-ID: <BANLkTikwyivoRQ5hLk5=z=y7Yb0v0iVSqQ@mail.gmail.com>

On Wed, Apr 27, 2011 at 7:50 AM, Dinakaran Kanagaraj
<Dinakaran.K at fs.mphasis.com> wrote:
> Hi,
>
>
>
> I have postgresql 8.4.3. I tried executing pg_dump using the command :
> ./pg_dump -U admin -p 15432 SIEM -f /home/karan/dumpfile
>
>
>
> After giving the password it throws the below error. Please let know how to
> fix this.
>
>
>
> pg_dump: SQL command failed
>
> pg_dump: Error message from server: ERROR:? permission denied for relation
> databasechangeloglock
>
> pg_dump: The command was: LOCK TABLE public.databasechangeloglock IN ACCESS
> SHARE MODE

This doesn't sound much like a Slony issue.

That's not a table used by Slony, so this shouldn't be affected by any
of Slony's behaviour.

I imagine that perhaps the "admin" user isn't allowed access to your
relation, databasechangeloglock.  That seems like a permissions
problem for the user you might be trying to use to do backups.

You might want to redirect this to pgsql-general or pgsql-admin,
though they would probably need a bit more detail to infer anything
useful about a problem like this.

From Dinakaran.K at fs.mphasis.com  Thu Apr 28 02:26:43 2011
From: Dinakaran.K at fs.mphasis.com (Dinakaran Kanagaraj)
Date: Thu, 28 Apr 2011 14:56:43 +0530
Subject: [Slony1-general] Slony I download & INstllation
Message-ID: <903B52597234234780280350C633091427F4BDEACC@FSMPCHMBX01.FS.MPHASIS.COM>

Hi,

I want to download Slony I for SuSe Linux and need the Installation & configuration documents.

Please let know where can I get this...

Thanks,
Dinakaran
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20110428/9b5d29dc/attachment.htm 

From stephane.schildknecht at postgresql.fr  Thu Apr 28 02:55:59 2011
From: stephane.schildknecht at postgresql.fr (=?UTF-8?B?IlN0w6lwaGFuZSBBLiBTY2hpbGRrbmVjaHQi?=)
Date: Thu, 28 Apr 2011 11:55:59 +0200
Subject: [Slony1-general] Slony I download & INstllation
In-Reply-To: <903B52597234234780280350C633091427F4BDEACC@FSMPCHMBX01.FS.MPHASIS.COM>
References: <903B52597234234780280350C633091427F4BDEACC@FSMPCHMBX01.FS.MPHASIS.COM>
Message-ID: <4DB939AF.7020908@postgresql.fr>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Le 28/04/2011 11:26, Dinakaran Kanagaraj a ?crit :
> Hi,
> 
>  
> 
> I want to download Slony I for SuSe Linux and need the Installation &
> configuration documents.
> 
>  
> 
> Please let know where can I get this?

http://slony.info

There you'll have links
- - to download :
http://slony.info/downloads/

(you'll have to compile Slony.)

- - to documentation :
http://slony.info/documentation/

You can also have a look there :
https://build.opensuse.org/package/repositories?package=slony&project=home%3Aflichtenheld%3Aastaro-asg%3Alatest


- -- 
St?phane Schildknecht
Loxodata
Contact r?gional PostgreSQL

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.10 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/

iEYEARECAAYFAk25Oa8ACgkQA+REPKWGI0FBAQCgtX5g0Ty1NgfyHLKpKnYDyFqg
y6IAoLhtVniYPSpjI6JvrwIMkP+MG9RK
=QCS7
-----END PGP SIGNATURE-----

From Dinakaran.K at fs.mphasis.com  Thu Apr 28 03:02:56 2011
From: Dinakaran.K at fs.mphasis.com (Dinakaran Kanagaraj)
Date: Thu, 28 Apr 2011 15:32:56 +0530
Subject: [Slony1-general] Slony I download & INstllation
In-Reply-To: <4DB939AF.7020908@postgresql.fr>
References: <903B52597234234780280350C633091427F4BDEACC@FSMPCHMBX01.FS.MPHASIS.COM>
	<4DB939AF.7020908@postgresql.fr>
Message-ID: <903B52597234234780280350C633091427F4BDEBE8@FSMPCHMBX01.FS.MPHASIS.COM>

Thanks. Is there any licensed version of Slony where I can get if need any support?

Thanks,
Dinakaran
eMail: Dinakaran.K at fs.mphasis.com
Desk #: +91 44 4200 2378 (India) / +1 877 302 1652 Extn: 2378 (US)


-----Original Message-----
From: slony1-general-bounces at lists.slony.info [mailto:slony1-general-bounces at lists.slony.info] On Behalf Of "St?phane A. Schildknecht"
Sent: Thursday, April 28, 2011 3:26 PM
To: slony1-general at lists.slony.info
Subject: Re: [Slony1-general] Slony I download & INstllation

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Le 28/04/2011 11:26, Dinakaran Kanagaraj a ?crit :
> Hi,
>
>
>
> I want to download Slony I for SuSe Linux and need the Installation &
> configuration documents.
>
>
>
> Please let know where can I get this?

http://slony.info

There you'll have links
- - to download :
http://slony.info/downloads/

(you'll have to compile Slony.)

- - to documentation :
http://slony.info/documentation/

You can also have a look there :
https://build.opensuse.org/package/repositories?package=slony&project=home%3Aflichtenheld%3Aastaro-asg%3Alatest


- --
St?phane Schildknecht
Loxodata
Contact r?gional PostgreSQL

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.10 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/

iEYEARECAAYFAk25Oa8ACgkQA+REPKWGI0FBAQCgtX5g0Ty1NgfyHLKpKnYDyFqg
y6IAoLhtVniYPSpjI6JvrwIMkP+MG9RK
=QCS7
-----END PGP SIGNATURE-----
_______________________________________________
Slony1-general mailing list
Slony1-general at lists.slony.info
http://lists.slony.info/mailman/listinfo/slony1-general

From Dinakaran.K at fs.mphasis.com  Thu Apr 28 03:13:19 2011
From: Dinakaran.K at fs.mphasis.com (Dinakaran Kanagaraj)
Date: Thu, 28 Apr 2011 15:43:19 +0530
Subject: [Slony1-general] Slony I download & INstllation
References: <903B52597234234780280350C633091427F4BDEACC@FSMPCHMBX01.FS.MPHASIS.COM>
	<4DB939AF.7020908@postgresql.fr> 
Message-ID: <903B52597234234780280350C633091427F4BDEC45@FSMPCHMBX01.FS.MPHASIS.COM>

I don?t see any Installation for Slony I. Is there any detailed steps for the Slony I installation & configuration?


Thanks,
Dinakaran
eMail: Dinakaran.K at fs.mphasis.com
Desk #: +91 44 4200 2378 (India) / +1 877 302 1652 Extn: 2378 (US)


-----Original Message-----
From: Dinakaran Kanagaraj
Sent: Thursday, April 28, 2011 3:33 PM
To: '"St?phane A. Schildknecht"'; slony1-general at lists.slony.info
Subject: RE: [Slony1-general] Slony I download & INstllation

Thanks. Is there any licensed version of Slony where I can get if need any support?

Thanks,
Dinakaran
eMail: Dinakaran.K at fs.mphasis.com
Desk #: +91 44 4200 2378 (India) / +1 877 302 1652 Extn: 2378 (US)


-----Original Message-----
From: slony1-general-bounces at lists.slony.info [mailto:slony1-general-bounces at lists.slony.info] On Behalf Of "St?phane A. Schildknecht"
Sent: Thursday, April 28, 2011 3:26 PM
To: slony1-general at lists.slony.info
Subject: Re: [Slony1-general] Slony I download & INstllation

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Le 28/04/2011 11:26, Dinakaran Kanagaraj a ?crit :
> Hi,
>
>
>
> I want to download Slony I for SuSe Linux and need the Installation &
> configuration documents.
>
>
>
> Please let know where can I get this?

http://slony.info

There you'll have links
- - to download :
http://slony.info/downloads/

(you'll have to compile Slony.)

- - to documentation :
http://slony.info/documentation/

You can also have a look there :
https://build.opensuse.org/package/repositories?package=slony&project=home%3Aflichtenheld%3Aastaro-asg%3Alatest


- --
St?phane Schildknecht
Loxodata
Contact r?gional PostgreSQL

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.10 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/

iEYEARECAAYFAk25Oa8ACgkQA+REPKWGI0FBAQCgtX5g0Ty1NgfyHLKpKnYDyFqg
y6IAoLhtVniYPSpjI6JvrwIMkP+MG9RK
=QCS7
-----END PGP SIGNATURE-----
_______________________________________________
Slony1-general mailing list
Slony1-general at lists.slony.info
http://lists.slony.info/mailman/listinfo/slony1-general

From rod at iol.ie  Thu Apr 28 03:18:17 2011
From: rod at iol.ie (Raymond O'Donnell)
Date: Thu, 28 Apr 2011 11:18:17 +0100
Subject: [Slony1-general] Slony I download & INstllation
In-Reply-To: <903B52597234234780280350C633091427F4BDEC45@FSMPCHMBX01.FS.MPHASIS.COM>
References: <903B52597234234780280350C633091427F4BDEACC@FSMPCHMBX01.FS.MPHASIS.COM>	<4DB939AF.7020908@postgresql.fr>
	<903B52597234234780280350C633091427F4BDEC45@FSMPCHMBX01.FS.MPHASIS.COM>
Message-ID: <4DB93EE9.2010101@iol.ie>

On 28/04/2011 11:13, Dinakaran Kanagaraj wrote:
> I don?t see any Installation for Slony I. Is there any detailed steps
> for the Slony I installation&  configuration?

You either have to compile it, or use your Linux distribution's package 
manager.

Ray.

-- 
Raymond O'Donnell :: Galway :: Ireland
rod at iol.ie

From Dinakaran.K at fs.mphasis.com  Thu Apr 28 03:21:05 2011
From: Dinakaran.K at fs.mphasis.com (Dinakaran Kanagaraj)
Date: Thu, 28 Apr 2011 15:51:05 +0530
Subject: [Slony1-general] Slony I download & INstllation
In-Reply-To: <4DB93EE9.2010101@iol.ie>
References: <903B52597234234780280350C633091427F4BDEACC@FSMPCHMBX01.FS.MPHASIS.COM>
	<4DB939AF.7020908@postgresql.fr>
	<903B52597234234780280350C633091427F4BDEC45@FSMPCHMBX01.FS.MPHASIS.COM>
	<4DB93EE9.2010101@iol.ie>
Message-ID: <903B52597234234780280350C633091427F4BDEC74@FSMPCHMBX01.FS.MPHASIS.COM>

Is there any documentation or step by step details for this?

Thanks,
Dinakaran
eMail: Dinakaran.K at fs.mphasis.com
Desk #: +91 44 4200 2378 (India) / +1 877 302 1652 Extn: 2378 (US)


-----Original Message-----
From: slony1-general-bounces at lists.slony.info [mailto:slony1-general-bounces at lists.slony.info] On Behalf Of Raymond O'Donnell
Sent: Thursday, April 28, 2011 3:48 PM
To: Dinakaran Kanagaraj
Cc: slony1-general at lists.slony.info
Subject: Re: [Slony1-general] Slony I download & INstllation

On 28/04/2011 11:13, Dinakaran Kanagaraj wrote:
> I don?t see any Installation for Slony I. Is there any detailed steps
> for the Slony I installation&  configuration?

You either have to compile it, or use your Linux distribution's package
manager.

Ray.

--
Raymond O'Donnell :: Galway :: Ireland
rod at iol.ie
_______________________________________________
Slony1-general mailing list
Slony1-general at lists.slony.info
http://lists.slony.info/mailman/listinfo/slony1-general

From rod at iol.ie  Thu Apr 28 03:25:38 2011
From: rod at iol.ie (Raymond O'Donnell)
Date: Thu, 28 Apr 2011 11:25:38 +0100
Subject: [Slony1-general] Slony I download & INstllation
In-Reply-To: <903B52597234234780280350C633091427F4BDEC74@FSMPCHMBX01.FS.MPHASIS.COM>
References: <903B52597234234780280350C633091427F4BDEACC@FSMPCHMBX01.FS.MPHASIS.COM>	<4DB939AF.7020908@postgresql.fr>	<903B52597234234780280350C633091427F4BDEC45@FSMPCHMBX01.FS.MPHASIS.COM>
	<4DB93EE9.2010101@iol.ie>
	<903B52597234234780280350C633091427F4BDEC74@FSMPCHMBX01.FS.MPHASIS.COM>
Message-ID: <4DB940A2.3030308@iol.ie>

On 28/04/2011 11:21, Dinakaran Kanagaraj wrote:
> Is there any documentation or step by step details for this?

Well, read this first:

   http://slony.info/documentation/2.0/requirements.html

After that, I *think* it's something like

    configure
    make
    make install

HTH

Ray.


-- 
Raymond O'Donnell :: Galway :: Ireland
rod at iol.ie

From cbbrowne at afilias.info  Thu Apr 28 08:07:54 2011
From: cbbrowne at afilias.info (Christopher Browne)
Date: Thu, 28 Apr 2011 11:07:54 -0400
Subject: [Slony1-general] Slony I download & INstllation
In-Reply-To: <903B52597234234780280350C633091427F4BDEBE8@FSMPCHMBX01.FS.MPHASIS.COM>
References: <903B52597234234780280350C633091427F4BDEACC@FSMPCHMBX01.FS.MPHASIS.COM>
	<4DB939AF.7020908@postgresql.fr>
	<903B52597234234780280350C633091427F4BDEBE8@FSMPCHMBX01.FS.MPHASIS.COM>
Message-ID: <BANLkTin7YqFkOTawjc_8YbnPfR+3BEp5dw@mail.gmail.com>

On Thu, Apr 28, 2011 at 6:02 AM, Dinakaran Kanagaraj
<Dinakaran.K at fs.mphasis.com> wrote:
> Thanks. Is there any licensed version of Slony where I can get if need any support?

Certainly it's licensed.  You may avail yourself of the copyright notice.

http://git.postgresql.org/gitweb?p=slony1-engine.git;a=blob;f=COPYRIGHT

The main developers are mostly employees of Afilias who are a major
user of the software, and while we have some particular support
responsibilities there, we don't really have any mechanism for
offering support more widely.

A number of the Postgres consulting firms have expertise with Slony,
and if you solicit assistance on the list, I'm sure some of them are
on the list and could contact you off-list to explore service
offerings and fees.

From cbbrowne at afilias.info  Fri Apr 29 14:50:56 2011
From: cbbrowne at afilias.info (Christopher Browne)
Date: Fri, 29 Apr 2011 17:50:56 -0400
Subject: [Slony1-general] Looking at bug #137 - DDL application change
Message-ID: <BANLkTin=aUcTOadXr824HxQf=7adkU9mGQ@mail.gmail.com>

I decided to start taking a poke at this, as time seems permitting, at
least for now.  I don't anticipate this being ready for 2.1, but
hopefully some strategy can be arrived at, and problems worked thru
now, rather than having to wait until later.

The problem noticed was that, with the enormously decreased locking,
in 2.0, of DDL, some race conditions have emerged.  They wouldn't
generally bite us at Afilias, as we have the practice of taking
outages before DDL goes in, so that we prevent the "race" by virtue of
outage.  But one of the regression tests is rather more aggressive,
having data changes trying to go in until the last possible instant.
And so you can have the scenario where the DDL "sync" has I/U/D
changes interspersed with DDL changes, and no way to get the right
ordering.

Two "bits" of change seem apropos to rectify this:

a) We allow the DDL script to specify what tables it needs to lock.

Before applying the DDL against the origin, the connection submits the
lock request.  The tables being locked, no more data is going to get
in edge-wise into those tables until after we apply the DDL.  This
still hasn't guaranteed ordering, though, hence part b)...

b) Rather than stowing the DDL inside the event, the DDL gets
dribbled, statement by statement, into sl_log_{1|2}.

Now, as I'm reviewing the code, it looks a whole lot like this
strategy makes the notion of a "DDL event" go away.

As I reviewed bits of the implementation, more and more sections of
the DDL handling code seemed to become irrelevant, to the dual points
that...

1.  I'm wondering if I'm crazy in thinking that the DDL_SCRIPT event
might be able to be eliminated.

2.  If I'm not crazy, then boy, this seems to simplify the
implementation of, well, "everything about DDL."

What seems to disappear are:
a) The code for the DDL_SCRIPT event
b) Capturing anything at all in sl_event, except just as an informational thing.
c) pl/pgsql functions ddl_prepare_script_int(), ddlscript_complete()
d) Running the parser in src/parsestatements/scanner.c as part of
slon.  It's still needed in slonik to split apart the statements, but
once split, and stowed in sl_log_*, no more splitting needed.

What remains...

slonik needs to:
a) Lock the tables
b) Run ddlscript_prepare(), which just does some validation, and sets
replication mode to 'local'
c) Split the DDL into statements
d) Prepare a statement to drop DDL into sl_log_*
e) For each statement
  e.1) Run the DDL on the origin
  e.2) Save DDL into sl_log_*
f) Restore replication mode (probably to 'origin')

slon, today, does a great deal of work, but it basically all gets dropped.
- The DDL event doesn't need to do anything.
- No need to split statements up.

Basically, when processing sl_log_*, we'll sometimes have DDL
statements, so that today's (Insert,Update,Delete,Truncate) augments
to (Insert,Update,Delete,Truncate,Script), and we basically just need
to enclose the Script items with set/restore replication mode.

Still apparent complications:
- ONLY ON NODE functionality basically just connects to the specified
node, and omits saving the DDL in sl_log_*, right?  That's a small
change to slonik, and requires *nothing* of slon, right?

- Log shipping...  Nothing special; we're capturing sl_log_* output;
DDL is just an addition to this.

This *looks* like it turns into a considerable code simplification,
which would be mighty nice, if so.

From bogus@does.not.exist.com  Fri Apr 15 11:16:16 2011
From: bogus@does.not.exist.com ()
Date: Fri, 15 Apr 2011 18:16:16 -0000
Subject: No subject
Message-ID: <mailman.1.1305140220.6915.slony1-general@lists.slony.info>

my_db=# select * from cron_lock;
        id         |      lock_until_time
-------------------+----------------------------
 anonymous_marking | 2011-05-11 11:40:02.456091
(1 row)


From bogus@does.not.exist.com  Fri Apr 15 11:16:16 2011
From: bogus@does.not.exist.com ()
Date: Fri, 15 Apr 2011 18:16:16 -0000
Subject: No subject
Message-ID: <mailman.2.1305140220.6915.slony1-general@lists.slony.info>

my_db=# select * from cron_lock ;
        id         |      lock_until_time
-------------------+----------------------------
 anonymous_marking | 2011-05-11 10:40:02.123721
(1 row)


From bogus@does.not.exist.com  Fri Apr 15 11:16:16 2011
From: bogus@does.not.exist.com ()
Date: Fri, 15 Apr 2011 18:16:16 -0000
Subject: No subject
Message-ID: <mailman.3.1305140220.6915.slony1-general@lists.slony.info>

my_db=# select * from _sac_uk.sl_log_2 where log_tableid =190;
 log_origin |  log_txid  | log_tableid | log_actionseq | log_cmdtype |
                                      log_cmddata

------------+------------+-------------+---------------+-------------+-----------------------------------------------------------------------------------------------------
          1 | 1369072247 |         190 |     239698918 | I           |
("id","lock_until_time") values ('anonymous_marking','2011-05-11
11:40:02.456091')
          1 | 1369182578 |         190 |     239728797 | I           |
("id","lock_until_time") values
('process_past_due_pm_assignments.pl','2011-05-11
11:00:23.944101')
          1 | 1369182587 |         190 |     239728806 | D           |
"id"='process_past_due_pm_assignments.pl'
          1 | 1369182626 |         190 |     239728830 | I           |
("id","lock_until_time") values
('process_past_due_pm_assignments.pl','2011-05-11
11:00:24.525818')          1 | 1369182671 |         190 |     239728833 | D
          | "id"='process_past_due_pm_assignments.pl'
(5 rows)

my_db=# select * from _sac_uk.sl_log_1 where log_tableid =190;
 log_origin |  log_txid  | log_tableid | log_actionseq | log_cmdtype |
                             log_cmddata

------------+------------+-------------+---------------+-------------+------------------------------------------------------------------------------------
         1 | 1369393174 |         190 |     239789790 | D           |
"id"='anonymous_marking'
          1 | 1369403276 |         190 |     239793047 | I           |
("id","lock_until_time") values ('anonymous_marking','2011-05-11
12:40:02.970433')(2 rows)

On the subscriber logs:May 11 11:54:40 uk-sdb2 postgres[30851]: [926-1]
2011-05-11 11:54:40.755 PDT [user=slony,db=my_db 10.1.0.149(47318) PID:30851
XID:1509911291]ERROR:  duplicate key value violates unique constraint
"cron_lock_pkey"
May 11 11:54:40 uk-sdb2 postgres[30851]: [926-2] 2011-05-11 11:54:40.755 PDT
[user=slony,db=my_db 10.1.0.149(47318) PID:30851 XID:1509911291]STATEMENT:
 update only "public"."m_user" set "last_login"='2011-05-11 10:40:02.429308'
where "id"='2459339';

Any help would be much appreciated.
--Richard

--000e0cd14f88f871e704a304a2b7
Content-Type: text/html; charset=UTF-8
Content-Transfer-Encoding: quoted-printable

<div><div>Hello,</div><div><br></div><div><div>running=C2=A0slon version 2.=
0.6 here...</div></div><div><br></div><div>Would anyone be able to help me =
track down why slony missed a DELETE? =C2=A0It seems that my replication is=
 broken as the subscribers are trying to process an INSERT, but a primary k=
ey is being violated. =C2=A0The origin machine does not have the offending =
tuple, which leads me to believe that a DELETE was processed, but wasn&#39;=
t propagated to the subscribers</div>
<div><br></div><div>From my origin machine:</div><div>my_db=3D# select * fr=
om cron_lock;</div><div>=C2=A0 =C2=A0 =C2=A0 =C2=A0 id =C2=A0 =C2=A0 =C2=A0=
 =C2=A0 | =C2=A0 =C2=A0 =C2=A0lock_until_time =C2=A0 =C2=A0 =C2=A0=C2=A0</d=
iv><div>-------------------+----------------------------</div><div>=C2=A0an=
onymous_marking | 2011-05-11 11:40:02.456091</div>
<div>(1 row)</div><div><br></div><div>From my subscriber machines:</div><di=
v>my_db=3D# select * from cron_lock ;</div><div>=C2=A0 =C2=A0 =C2=A0 =C2=A0=
 id =C2=A0 =C2=A0 =C2=A0 =C2=A0 | =C2=A0 =C2=A0 =C2=A0lock_until_time =C2=
=A0 =C2=A0 =C2=A0=C2=A0</div><div>-------------------+---------------------=
-------</div>
<div>=C2=A0anonymous_marking | 2011-05-11 10:40:02.123721</div><div>(1 row)=
</div><div><br></div><div>From the origin&#39;s sl_log_* tables:</div><div>=
my_db=3D# select * from _sac_uk.sl_log_2 where log_tableid =3D190;</div><di=
v>=C2=A0log_origin | =C2=A0log_txid =C2=A0| log_tableid | log_actionseq | l=
og_cmdtype | =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0=
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 log_cmddata =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0=C2=A0</div>
<div>------------+------------+-------------+---------------+-------------+=
---------------------------------------------------------------------------=
--------------------------</div><div>=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 1 |=
 1369072247 | =C2=A0 =C2=A0 =C2=A0 =C2=A0 190 | =C2=A0 =C2=A0 239698918 | I=
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 | (&quot;id&quot;,&quot;lock_until_time=
&quot;) values (&#39;anonymous_marking&#39;,&#39;2011-05-11 11:40:02.456091=
&#39;)</div>
<div>=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 1 | 1369182578 | =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 190 | =C2=A0 =C2=A0 239728797 | I =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 | (&quot;id&quot;,&quot;lock_until_time&quot;) values (&#39;<a href=
=3D"http://process_past_due_pm_assignments.pl">process_past_due_pm_assignme=
nts.pl</a>&#39;,&#39;2011-05-11 11:00:23.944101&#39;)</div>
<div>=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 1 | 1369182587 | =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 190 | =C2=A0 =C2=A0 239728806 | D =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 | &quot;id&quot;=3D&#39;<a href=3D"http://process_past_due_pm_assign=
ments.pl">process_past_due_pm_assignments.pl</a>&#39;</div><div>=C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 1 | 1369182626 | =C2=A0 =C2=A0 =C2=A0 =C2=A0 190 |=
 =C2=A0 =C2=A0 239728830 | I =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 | (&quot;id=
&quot;,&quot;lock_until_time&quot;) values (&#39;<a href=3D"http://process_=
past_due_pm_assignments.pl">process_past_due_pm_assignments.pl</a>&#39;,&#3=
9;2011-05-11 11:00:24.525818&#39;) =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A01 | 13=
69182671 | =C2=A0 =C2=A0 =C2=A0 =C2=A0 190 | =C2=A0 =C2=A0 239728833 | D =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 | &quot;id&quot;=3D&#39;<a href=3D"http:=
//process_past_due_pm_assignments.pl">process_past_due_pm_assignments.pl</a=
>&#39;</div>
<div>(5 rows)</div><div><br></div><div>my_db=3D# select * from _sac_uk.sl_l=
og_1 where log_tableid =3D190;</div><div>=C2=A0log_origin | =C2=A0log_txid =
=C2=A0| log_tableid | log_actionseq | log_cmdtype | =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0log_cmddata =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0=C2=A0</div>
<div>------------+------------+-------------+---------------+-------------+=
---------------------------------------------------------------------------=
--------- =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A01 | 1369393174 | =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 190 | =C2=A0 =C2=A0 239789790 | D =C2=A0 =C2=A0 =C2=A0 =C2=A0=
 =C2=A0 | &quot;id&quot;=3D&#39;anonymous_marking&#39;</div>
<div>=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 1 | 1369403276 | =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 190 | =C2=A0 =C2=A0 239793047 | I =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 | (&quot;id&quot;,&quot;lock_until_time&quot;) values (&#39;anonymou=
s_marking&#39;,&#39;2011-05-11 12:40:02.970433&#39;)(2 rows)</div><div><br>=
</div>
<div>On the subscriber logs:May 11 11:54:40 uk-sdb2 postgres[30851]: [926-1=
] 2011-05-11 11:54:40.755 PDT [user=3Dslony,db=3Dmy_db 10.1.0.149(47318) PI=
D:30851 XID:1509911291]ERROR: =C2=A0duplicate key value violates unique con=
straint &quot;cron_lock_pkey&quot;</div>
<div>May 11 11:54:40 uk-sdb2 postgres[30851]: [926-2] 2011-05-11 11:54:40.7=
55 PDT [user=3Dslony,db=3Dmy_db 10.1.0.149(47318) PID:30851 XID:1509911291]=
STATEMENT: =C2=A0update only &quot;public&quot;.&quot;m_user&quot; set &quo=
t;last_login&quot;=3D&#39;2011-05-11 10:40:02.429308&#39; where &quot;id&qu=
ot;=3D&#39;2459339&#39;;</div>
<div><br></div><div>Any help would be much appreciated.</div><div>--Richard=
</div></div><div><br></div>

--000e0cd14f88f871e704a304a2b7--

