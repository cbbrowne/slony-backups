From ssinger at ca.afilias.info  Tue Jul  1 10:37:33 2014
From: ssinger at ca.afilias.info (Steve Singer)
Date: Tue, 01 Jul 2014 13:37:33 -0400
Subject: [Slony1-general] manually delete sl_log_x table
In-Reply-To: <CAAMgDX=dXYbK_5X+7wbapx-=Kc8cH9b+VjX7Jc6XcPZDqL4iHQ@mail.gmail.com>
References: <CAAMgDX=KUx8Hty2WJXARWSTtKsnKP2Je=f0VVVcP8hwZyaAuHA@mail.gmail.com>	<53AAE50E.7030101@ca.afilias.info>	<CAAMgDXmMB9gJrxgVuBRnvKMewShy2xiV0kygE2Rv+0JK9pLPrA@mail.gmail.com>	<53AAE9CC.6020706@ca.afilias.info>	<CAAMgDXnpdJYESt3zBpVi8tCe-qJgXSM+e=7xiQXzUxKTDwz9kQ@mail.gmail.com>	<53AB741F.907@ca.afilias.info>	<CAAMgDXmWR_pNdm1cwmXy+TWKnitPki+A_S1gKxfsnpzmz1gKFw@mail.gmail.com>
	<CAAMgDX=dXYbK_5X+7wbapx-=Kc8cH9b+VjX7Jc6XcPZDqL4iHQ@mail.gmail.com>
Message-ID: <53B2F1DD.9000400@ca.afilias.info>

On 06/30/2014 01:05 PM, Soni M wrote:
> it seems a slony process that has <IDLE> in transaction for many times.
> the client address and the user are identical to slony slave.
>
>

Which version of slony are you on?



> On Mon, Jun 30, 2014 at 11:54 PM, Soni M <diptatapa at gmail.com
> <mailto:diptatapa at gmail.com>> wrote:
>
>     On Thu, Jun 26, 2014 at 8:15 AM, Steve Singer
>     <ssinger at ca.afilias.info <mailto:ssinger at ca.afilias.info>> wrote:
>
>
>
>         Which transactions are locking sl_log_2 when slony is in that state?
>
>         The slony log trigger should only be adding rows to sl_log_1 in
>         this state.   If this isn't the case then there is a problem.
>
>         The problem with waiting for the lock is other transactions will
>         the block and queue up behind the cleanup thread/transaction.
>
>
>
>     I saw this query from slony slave :
>
>     fetch 500 from LOG;
>
>     but another time it is
>
>     <IDLE> in transaction
>
>     that has lock on sl_log_2. The <IDLE> in transaction appear much
>     more often.
>
>     --
>     Regards,
>
>     Soni Maula Harriz
>
>
>
>
> --
> Regards,
>
> Soni Maula Harriz


From diptatapa at gmail.com  Tue Jul  1 17:24:21 2014
From: diptatapa at gmail.com (Soni M)
Date: Wed, 2 Jul 2014 07:24:21 +0700
Subject: [Slony1-general] manually delete sl_log_x table
In-Reply-To: <53B2F1DD.9000400@ca.afilias.info>
References: <CAAMgDX=KUx8Hty2WJXARWSTtKsnKP2Je=f0VVVcP8hwZyaAuHA@mail.gmail.com>
	<53AAE50E.7030101@ca.afilias.info>
	<CAAMgDXmMB9gJrxgVuBRnvKMewShy2xiV0kygE2Rv+0JK9pLPrA@mail.gmail.com>
	<53AAE9CC.6020706@ca.afilias.info>
	<CAAMgDXnpdJYESt3zBpVi8tCe-qJgXSM+e=7xiQXzUxKTDwz9kQ@mail.gmail.com>
	<53AB741F.907@ca.afilias.info>
	<CAAMgDXmWR_pNdm1cwmXy+TWKnitPki+A_S1gKxfsnpzmz1gKFw@mail.gmail.com>
	<CAAMgDX=dXYbK_5X+7wbapx-=Kc8cH9b+VjX7Jc6XcPZDqL4iHQ@mail.gmail.com>
	<53B2F1DD.9000400@ca.afilias.info>
Message-ID: <CAAMgDXkuAUo-96hamWtE_DiBEbkG1=0OUA9wmovYxMb1Omheqw@mail.gmail.com>

Master : Ubuntu 10.04 LTS, Postgre 9.1.13, Slony 2.0.7 from Ubuntu Package
Slave : Ubuntu 10.04 LTS, Postgres 9.1.13, Slony 2.0.7 seems build from
source.
DB size 1.5 TB, Master utilize relative high number of temp tables and
relative High number of locks on busy time

DB=# select mode, count(*) from pg_locks group by mode;
           mode           | count
--------------------------+--------
 ExclusiveLock            |    112
 RowShareLock             |     37
 AccessExclusiveLock      | 208577
 RowExclusiveLock         |  33087
 ShareUpdateExclusiveLock |      5
 ShareLock                |  54906
 AccessShareLock          |  93607
(7 rows)

but the slave is relative low on load.

this is the connection from slave that open from May 25th
postgres 14090  0.1  1.1 4512644 230760 ?      Ss   May25  59:08 postgres:
slony_user dbname master_ip_address(58554) idle

On slave, this connection seems always keep on idle status, but on master,
this connection often in "<IDLE> in transaction" status for some minutes
and hold lock on sl_log_2 while transaction are filling up sl_log_1.

Such condition usually happen on server high load time, but on low load it
sometimes happen, but not many and does not affect on replication lag.

On Wed, Jul 2, 2014 at 12:37 AM, Steve Singer <ssinger at ca.afilias.info>
wrote:

> On 06/30/2014 01:05 PM, Soni M wrote:
>
>> it seems a slony process that has <IDLE> in transaction for many times.
>> the client address and the user are identical to slony slave.
>>
>>
>>
> Which version of slony are you on?
>
>>
>>
>


-- 
Regards,

Soni Maula Harriz
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20140702/7bc31293/attachment.htm 

