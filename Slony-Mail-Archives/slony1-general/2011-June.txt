From jason at daylife.com  Mon Jun  6 15:54:35 2011
From: jason at daylife.com (JasonN)
Date: Mon, 6 Jun 2011 15:54:35 -0700 (PDT)
Subject: [Slony1-general]  Verifying Data Consistency with Slony?
Message-ID: <31787795.post@talk.nabble.com>


Hello and thanks for taking the time to read my post...

I'm using Slony-I v1.2.20 and I have a simple master/slave replication
occurring between two servers.  Recently, we had a bit of an interruption to
our network and I need to verify the consistency of the data between the two
databases. I've checked the logs for any outstanding errors, but they seem
to report that everything is running fine.  

Aside form using sql queries, is there any way to check data consistency
using slony (ie ensure that the tables are in fact replicated 1:1)?

Thanks for your help in advance!

Cheers,
Jason
-- 
View this message in context: http://old.nabble.com/Verifying-Data-Consistency-with-Slony--tp31787795p31787795.html
Sent from the Slony-I -- General mailing list archive at Nabble.com.


From vivek at khera.org  Tue Jun  7 05:40:15 2011
From: vivek at khera.org (Vick Khera)
Date: Tue, 7 Jun 2011 08:40:15 -0400
Subject: [Slony1-general] Verifying Data Consistency with Slony?
In-Reply-To: <31787795.post@talk.nabble.com>
References: <31787795.post@talk.nabble.com>
Message-ID: <BANLkTi=zr6Hm2401_6JexHSQy_OJibJ4qQ@mail.gmail.com>

On Mon, Jun 6, 2011 at 6:54 PM, JasonN <jason at daylife.com> wrote:
> Aside form using sql queries, is there any way to check data consistency
> using slony (ie ensure that the tables are in fact replicated 1:1)?
>

No.  If you don't trust slony's own report that replication is
up-to-date, then you have to run queries on the DB.

From glynastill at yahoo.co.uk  Wed Jun  8 04:05:15 2011
From: glynastill at yahoo.co.uk (Glyn Astill)
Date: Wed, 8 Jun 2011 12:05:15 +0100 (BST)
Subject: [Slony1-general] Lock set doesn't generate event in 2.0.6?
Message-ID: <331907.4657.qm@web26002.mail.ukl.yahoo.com>

Hi Guys,

Last week we upgraded from 1.2.22 to 2.0.6 and today I'm trying to move a set from one node to another.? I'm using my own set of scripts that I've been using for years with 1.2.22, however when I wait for event after lock set I get the message "Error: script did not generate any event on node 1"


Below is the script I'm running:

??????? ECHO 'ATTEMPT: Lock the set and wait for the lock:';
??????? LOCK SET ( ID = 1, ORIGIN = 1);
??????? ECHO 'ATTEMPT: Waiting for confirm on all nodes:';
??????? WAIT FOR EVENT (ORIGIN = 1, CONFIRMED = ALL, WAIT ON = 1, TIMEOUT = 0);

I know we now can't run wait for event in a try block, but what's changed and what am I doing wrong here?


Thanks
Glyn
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20110608/03ba02eb/attachment.htm 

From ssinger at ca.afilias.info  Wed Jun  8 06:16:25 2011
From: ssinger at ca.afilias.info (Steve Singer)
Date: Wed, 08 Jun 2011 09:16:25 -0400
Subject: [Slony1-general] Lock set doesn't generate event in 2.0.6?
In-Reply-To: <331907.4657.qm@web26002.mail.ukl.yahoo.com>
References: <331907.4657.qm@web26002.mail.ukl.yahoo.com>
Message-ID: <4DEF7629.3080701@ca.afilias.info>

On 11-06-08 07:05 AM, Glyn Astill wrote:
> Hi Guys,
>
> Last week we upgraded from 1.2.22 to 2.0.6 and today I'm trying to move
> a set from one node to another. I'm using my own set of scripts that
> I've been using for years with 1.2.22, however when I wait for event
> after lock set I get the message "Error: script did not generate any
> event on node 1"
>
> Below is the script I'm running:
>
> ECHO 'ATTEMPT: Lock the set and wait for the lock:';
> LOCK SET ( ID = 1, ORIGIN = 1);
> ECHO 'ATTEMPT: Waiting for confirm on all nodes:';
> WAIT FOR EVENT (ORIGIN = 1, CONFIRMED = ALL, WAIT ON = 1, TIMEOUT = 0);
>
> I know we now can't run wait for event in a try block, but what's
> changed and what am I doing wrong here?

lock set does not generate an event in either 1.2.22 or 2.0.6

What has changed between them is that if you 'wait for event' in 1.2 
when no event then the 'wait for event' command is treated like a no-op, 
it continues without waiting.  In 2.0 the 'wait for event' command 
generates an error if you try to wait for an event that does not exist.




>
>
> Thanks
> Glyn
>
>
>
> _______________________________________________
> Slony1-general mailing list
> Slony1-general at lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general


From glynastill at yahoo.co.uk  Wed Jun  8 07:52:55 2011
From: glynastill at yahoo.co.uk (Glyn Astill)
Date: Wed, 8 Jun 2011 15:52:55 +0100 (BST)
Subject: [Slony1-general] Lock set doesn't generate event in 2.0.6?
In-Reply-To: <4DEF7629.3080701@ca.afilias.info>
References: <331907.4657.qm@web26002.mail.ukl.yahoo.com>
	<4DEF7629.3080701@ca.afilias.info>
Message-ID: <411204.56783.qm@web26006.mail.ukl.yahoo.com>






> From: Steve Singer <ssinger at ca.afilias.info>

>>  I know we now can't run wait for event in a try block, but what's
>>  changed and what am I doing wrong here?
> 
> lock set does not generate an event in either 1.2.22 or 2.0.6
> 
> What has changed between them is that if you 'wait for event' in 1.2 
> when no event then the 'wait for event' command is treated like a no-op, 
> 
> it continues without waiting.? In 2.0 the 'wait for event' command 
> generates an error if you try to wait for an event that does not exist.
> 

Ah, okay.? So there's no need to wait for event after lock set and before running move set then? 

I'm pretty sure that was the way I was advised (or read somewhere) to run move set back in the day.

Looking at the function I see it's going to have done its work by the time it returns anyway.


From ssinger at ca.afilias.info  Wed Jun  8 08:20:52 2011
From: ssinger at ca.afilias.info (Steve Singer)
Date: Wed, 08 Jun 2011 11:20:52 -0400
Subject: [Slony1-general] Lock set doesn't generate event in 2.0.6?
In-Reply-To: <411204.56783.qm@web26006.mail.ukl.yahoo.com>
References: <331907.4657.qm@web26002.mail.ukl.yahoo.com>
	<4DEF7629.3080701@ca.afilias.info>
	<411204.56783.qm@web26006.mail.ukl.yahoo.com>
Message-ID: <4DEF9354.1050504@ca.afilias.info>

On 11-06-08 10:52 AM, Glyn Astill wrote:
>
>
>
>
>

> Ah, okay.  So there's no need to wait for event after lock set and before running move set then?

No there is no need to do a 'wait for event' after a LOCK SET.

>
> I'm pretty sure that was the way I was advised (or read somewhere) to run move set back in the day.
>
> Looking at the function I see it's going to have done its work by the time it returns anyway.





From vivek at khera.org  Wed Jun  8 13:31:04 2011
From: vivek at khera.org (Vick Khera)
Date: Wed, 8 Jun 2011 16:31:04 -0400
Subject: [Slony1-general] Lock set doesn't generate event in 2.0.6?
In-Reply-To: <411204.56783.qm@web26006.mail.ukl.yahoo.com>
References: <331907.4657.qm@web26002.mail.ukl.yahoo.com>
	<4DEF7629.3080701@ca.afilias.info>
	<411204.56783.qm@web26006.mail.ukl.yahoo.com>
Message-ID: <BANLkTi=Z6i7JemBKDbePMr6ONk1or7BQiA@mail.gmail.com>

On Wed, Jun 8, 2011 at 10:52 AM, Glyn Astill <glynastill at yahoo.co.uk> wrote:
> I'm pretty sure that was the way I was advised (or read somewhere) to run move set back in the day.
>

I don't remember *ever* doing a wait for event after a lock set.  it
just waits until the lock is complete.

From glynastill at yahoo.co.uk  Wed Jun  8 20:15:57 2011
From: glynastill at yahoo.co.uk (Glyn Astill)
Date: Thu, 9 Jun 2011 04:15:57 +0100 (BST)
Subject: [Slony1-general] 2.0.6 Subscribe set errors
Message-ID: <165449.30644.qm@web26004.mail.ukl.yahoo.com>

Hi Guys,

Just had an issue with subscribe set in 2.0.6.? From what I can see somehow slonik is passing parameters 
to reshapesubscription in the wrong order, instead of (sub_set, sub_provider, sub_receiver) it seems to be 
sending (sub_provider, sub_set, sub_receiver).? In turn that made slonik hang on me and borked my subscriptions. 

Here's what I submitted to slonik:

??? SUBSCRIBE SET ( ID = 1000, PROVIDER = 4, RECEIVER = 5, FORWARD = YES );

Here's the error message I get from slonik:

??? Way5b:/pgsql/slony# slonik reshape.scr
??? reshape.scr:17: ATTEMPT:? SUBSCRIBE SET
??? reshape.scr:18: NOTICE:? subscribe set: omit_copy=f
??? reshape.scr:18: NOTICE:? subscribe set: omit_copy=f
??? CONTEXT:? SQL statement "SELECT? "_main_replication".subscribeSet_int( $1 ,? $2 ,? $3 ,? $4 ,? $5 )"
??? PL/pgSQL function "subscribeset" line 77 at PERFORM
??? reshape.scr:18: PGRES_FATAL_ERROR select "_main_replication".reshapeSubscription(4,1000,5); - ERROR:? insert or update on table "sl_subscribe" violates foreign key constraint "sl_subscribe-sl_path-ref"
??? DETAIL:? Key (sub_provider,sub_receiver)=(1000,5) is not present in table "sl_path".
??? CONTEXT:? SQL statement "update "_main_replication".sl_subscribe set sub_provider= $1? WHERE sub_set= $2? AND sub_receiver= $3 "
??? PL/pgSQL function "reshapesubscription" line 11 at SQL statement
??? error reshaping subscriber

And here's what my reshapesubscription looks like:

??? CREATE OR REPLACE FUNCTION _main_replication.reshapesubscription(integer, integer, integer)
??? ? RETURNS integer AS
??? $BODY$
??? declare
??? ??? p_sub_set??? ??? ??? alias for $1;
??? ??? p_sub_provider??? ??? alias for $2;
??? ??? p_sub_receiver??? ??? alias for $3;
??? begin
??? ??? -- ----
??? ??? -- Grab the central configuration lock
??? ??? -- ----
??? ??? lock table "_main_replication".sl_config_lock;
??? 
??? ??? update "_main_replication".sl_subscribe set sub_provider=p_sub_provider
??? ??? ??? ?? WHERE sub_set=p_sub_set AND sub_receiver=p_sub_receiver;
??? ??? if found then
??? ??? ?? perform "_main_replication".RebuildListenEntries();
??? ??? ?? notify "_main_replication_Restart";
??? ??? end if;
??? ??? return 0;
??? end
??? $BODY$
??? LANGUAGE plpgsql VOLATILE;

Looking in the slonik.c starting on on line 3541 I can see the following:

??????????????? slon_mkquery(&query,
???????????????????????????????????????? "select \"_%s\".reshapeSubscription(%d,%d,%d);",
???????????????????????????????????????? stmt->hdr.script->clustername,
???????????????????????????????????????? stmt->sub_provider,stmt->sub_setid,
???????????????????????????????????????? stmt->sub_receiver);

Unless I'm going crazy (It is now 4am), that pretty much looks the wrong way around to me?

Thanks
Glyn


From JanWieck at Yahoo.com  Thu Jun  9 06:14:49 2011
From: JanWieck at Yahoo.com (Jan Wieck)
Date: Thu, 09 Jun 2011 09:14:49 -0400
Subject: [Slony1-general] Support for EnterpriseDB version string?
In-Reply-To: <4DDE0290.4020603@mark.mielke.cc>
References: <4DDE0290.4020603@mark.mielke.cc>
Message-ID: <4DF0C749.2010705@Yahoo.com>

On 5/26/2011 3:34 AM, Mark Mielke wrote:
> Hi all:
>
> I've attached a patch against Slony-I 2.0.4 that we are currently using
> to allow our PostgreSQL 8.4.8 + Slony-I 2.0.4 work properly with
> EnterpriseDB 8.4.7.20 + EnterpriseDB's version of Slony-I 2.0.4. Please
> take a look and see whether you agree that this should be incorporated
> up stream.

After discussion with Chris and Steve I have committed this change to 
2.0 STABLE as well as master (current 2.1 BETA). It seems safe enough.

Greg's suggestion to just look for three numbers in the string involves 
a bit more dramatic changes because that may require moving from 
sscanf() to using regular expressions. A change we should consider for 
2.2, but definitely nothing we want to back patch into 2.0.


Jan


>
> It's a very trivial patch - but I guess it implies that Slony-I
> introduces recognition of EnterpriseDB's build of PostgreSQL more
> officially?
>
> I had a similar patch against Slony-I 2.0.6 that I can provide if this
> patch file isn't good enough - but due to EnterpriseDB still
> distributing Slony-I 2.0.4, we're version locked on Slony-I 2.0.4 for now...
>
> Thanks!
>
>
>
>
> _______________________________________________
> Slony1-general mailing list
> Slony1-general at lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general


-- 
Anyone who trades liberty for security deserves neither
liberty nor security. -- Benjamin Franklin

From ssinger at ca.afilias.info  Thu Jun  9 06:26:05 2011
From: ssinger at ca.afilias.info (Steve Singer)
Date: Thu, 09 Jun 2011 09:26:05 -0400
Subject: [Slony1-general] 2.0.6 Subscribe set errors
In-Reply-To: <165449.30644.qm@web26004.mail.ukl.yahoo.com>
References: <165449.30644.qm@web26004.mail.ukl.yahoo.com>
Message-ID: <4DF0C9ED.302@ca.afilias.info>

On 11-06-08 11:15 PM, Glyn Astill wrote:
> Hi Guys,
>
> Just had an issue with subscribe set in 2.0.6.  From what I can see somehow slonik is passing parameters
> to reshapesubscription in the wrong order, instead of (sub_set, sub_provider, sub_receiver) it seems to be
> sending (sub_provider, sub_set, sub_receiver).  In turn that made slonik hang on me and borked my subscriptions.
>

Yes the parameters appear to be passed in the wrong order.

I have created a bug for this and attached a patch
http://bugs.slony.info/bugzilla/show_bug.cgi?id=220

Once Jan or Chris looks over the patch I will commit this for 2.0.7 and 
for the next 2.1 beta

Thanks for the report

> Here's what I submitted to slonik:
>
>      SUBSCRIBE SET ( ID = 1000, PROVIDER = 4, RECEIVER = 5, FORWARD = YES );
>
> Here's the error message I get from slonik:
>
>      Way5b:/pgsql/slony# slonik reshape.scr
>      reshape.scr:17: ATTEMPT:  SUBSCRIBE SET
>      reshape.scr:18: NOTICE:  subscribe set: omit_copy=f
>      reshape.scr:18: NOTICE:  subscribe set: omit_copy=f
>      CONTEXT:  SQL statement "SELECT  "_main_replication".subscribeSet_int( $1 ,  $2 ,  $3 ,  $4 ,  $5 )"
>      PL/pgSQL function "subscribeset" line 77 at PERFORM
>      reshape.scr:18: PGRES_FATAL_ERROR select "_main_replication".reshapeSubscription(4,1000,5); - ERROR:  insert or update on table "sl_subscribe" violates foreign key constraint "sl_subscribe-sl_path-ref"
>      DETAIL:  Key (sub_provider,sub_receiver)=(1000,5) is not present in table "sl_path".
>      CONTEXT:  SQL statement "update "_main_replication".sl_subscribe set sub_provider= $1  WHERE sub_set= $2  AND sub_receiver= $3 "
>      PL/pgSQL function "reshapesubscription" line 11 at SQL statement
>      error reshaping subscriber
>
> And here's what my reshapesubscription looks like:
>
>      CREATE OR REPLACE FUNCTION _main_replication.reshapesubscription(integer, integer, integer)
>        RETURNS integer AS
>      $BODY$
>      declare
>          p_sub_set            alias for $1;
>          p_sub_provider        alias for $2;
>          p_sub_receiver        alias for $3;
>      begin
>          -- ----
>          -- Grab the central configuration lock
>          -- ----
>          lock table "_main_replication".sl_config_lock;
>
>          update "_main_replication".sl_subscribe set sub_provider=p_sub_provider
>                 WHERE sub_set=p_sub_set AND sub_receiver=p_sub_receiver;
>          if found then
>             perform "_main_replication".RebuildListenEntries();
>             notify "_main_replication_Restart";
>          end if;
>          return 0;
>      end
>      $BODY$
>      LANGUAGE plpgsql VOLATILE;
>
> Looking in the slonik.c starting on on line 3541 I can see the following:
>
>                  slon_mkquery(&query,
>                                           "select \"_%s\".reshapeSubscription(%d,%d,%d);",
>                                           stmt->hdr.script->clustername,
>                                           stmt->sub_provider,stmt->sub_setid,
>                                           stmt->sub_receiver);
>
> Unless I'm going crazy (It is now 4am), that pretty much looks the wrong way around to me?
>
> Thanks
> Glyn
>
> _______________________________________________
> Slony1-general mailing list
> Slony1-general at lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general


From glynastill at yahoo.co.uk  Thu Jun  9 08:43:19 2011
From: glynastill at yahoo.co.uk (Glyn Astill)
Date: Thu, 9 Jun 2011 16:43:19 +0100 (BST)
Subject: [Slony1-general] 2.0.6 Subscribe set errors
In-Reply-To: <4DF0C9ED.302@ca.afilias.info>
References: <165449.30644.qm@web26004.mail.ukl.yahoo.com>
	<4DF0C9ED.302@ca.afilias.info>
Message-ID: <582425.44838.qm@web26008.mail.ukl.yahoo.com>

----- Original Message -----

> From: Steve Singer <ssinger at ca.afilias.info>
> To: Glyn Astill <glynastill at yahoo.co.uk>
> Cc: slony <slony1-general at lists.slony.info>
> Sent: Thursday, 9 June 2011, 14:26
> Subject: Re: [Slony1-general] 2.0.6 Subscribe set errors
> 
> On 11-06-08 11:15 PM, Glyn Astill wrote:
>>  Hi Guys,
>> 
>>  Just had an issue with subscribe set in 2.0.6.? From what I can see somehow 
> slonik is passing parameters
>>  to reshapesubscription in the wrong order, instead of (sub_set, 
> sub_provider, sub_receiver) it seems to be
>>  sending (sub_provider, sub_set, sub_receiver).? In turn that made slonik 
> hang on me and borked my subscriptions.
>> 
> 
> Yes the parameters appear to be passed in the wrong order.
> 
> I have created a bug for this and attached a patch
> http://bugs.slony.info/bugzilla/show_bug.cgi?id=220
> 
> Once Jan or Chris looks over the patch I will commit this for 2.0.7 and 
> for the next 2.1 beta
> 

Thanks Steve, I applied the change shortly after emailing the list last night/this morning and can confirm it appears to resolve the issue.

From ssinger at ca.afilias.info  Wed Jun 15 15:06:14 2011
From: ssinger at ca.afilias.info (Steve Singer)
Date: Wed, 15 Jun 2011 18:06:14 -0400
Subject: [Slony1-general] Slony 2.0.7 RC2 released
Message-ID: <4DF92CD6.9090103@ca.afilias.info>

The Slony-I team is pleased to release the second release candidate for 
version 2.0.7 of Slony-I.

http://www.slony.info/downloads/2.0/source/slony1-2.0.7.rc2.tar.bz2
http://www.slony.info/downloads/2.0/source/slony1-2.0.7.rc2-docs.tar.bz2

Changes from the previous release candidate include:
--------------------------------------------------------
Bug #204 - Additional fixes for bug204 relating to circular entries in
            sl_subscribe following a failover to a non-direct subscriber.

Bug #217 - Execute script (ddlscript_complete_int) will now 	
	   reconfigure  the trigger arguments on the log trigger for
	   any tables that needs it.

Bug #220  Fix issue where changing the provider of an existing
            subscriber passed parameters in the wrong order to
            the stored procedure.
Bug #221  Add explicit casting to accommodate a user defined CAST



Changes since 2.0.6 include
--------------------------------
Fix for bug where slon was not properly detecting connection
  failures  when receiving events from the remote listener.

Bug #193 - vac_count not being reset to 0 (bug between 1.2 and 2.0 in
           restructure of cleanup thread), so vacuums were being done
           every time

Bug #195 - change slon_quote_* functions to IMMUTABLE

Bug #204 - Fix issue with FAILOVER to a non-direct subscriber
            introduced in 2.0.5

Support for building with Visual Studio on Win32

Bug # 214 - tools/slonikconfdump.sh was added back in


Users are requested to test 2.0.7 rc2 and report any issues they find.

From francescoboccacci at libero.it  Tue Jun 21 10:35:44 2011
From: francescoboccacci at libero.it (francescoboccacci at libero.it)
Date: Tue, 21 Jun 2011 19:35:44 +0200 (CEST)
Subject: [Slony1-general] Subscribe error
Message-ID: <30783745.2020391308677744453.JavaMail.defaultUser@defaultHost>


Hi to all,
i have a question for you about subscribe problem.I try to explain ho work my 
database cluster.
I have a database with 10 tables with IP:192.168.25.86 (this is the matser) 
and another database with only three tables with IP:192.168.25.89 (slave).
My goal is to replicate only the three tables of the master.So the tables in 
the slave have the same data that are inide the master database ( i used pg_dum 
and pg_restore command with only data option).
I create a cluster script into the server of master database and i run it. No 
problem!
I start slon process in both server and i specified the same cluster name. No 
problem!
After i create a subscribe script into master database and i run it. Problem:

CONTEXT:  SQL statement "SELECT  "_sql_master_slave".subscribeSet_int( $1 ,  
$2 ,  $3 , 
$4 ,  $5 )"
    PL/pgSQL function "subscribeset" line 77 at PERFORM

What does it means?
i have to run subscribe script from slave server?
Please help me. I use slony version 1-2.0.6.


Thanks

Francesco Boccacci

From ssinger at ca.afilias.info  Tue Jun 21 10:40:19 2011
From: ssinger at ca.afilias.info (Steve Singer)
Date: Tue, 21 Jun 2011 13:40:19 -0400
Subject: [Slony1-general] Subscribe error
In-Reply-To: <30783745.2020391308677744453.JavaMail.defaultUser@defaultHost>
References: <30783745.2020391308677744453.JavaMail.defaultUser@defaultHost>
Message-ID: <4E00D783.4060501@ca.afilias.info>

On 11-06-21 01:35 PM, francescoboccacci at libero.it wrote:
>

> CONTEXT:  SQL statement "SELECT  "_sql_master_slave".subscribeSet_int( $1 ,
> $2 ,  $3 ,
> $4 ,  $5 )"
>      PL/pgSQL function "subscribeset" line 77 at PERFORM
>

Slony normally prints this notice out as part of the subscription 
process. It is normal and does not indicate an error.



> What does it means?
> i have to run subscribe script from slave server?
> Please help me. I use slony version 1-2.0.6.
>
>
> Thanks
>
> Francesco Boccacci
> _______________________________________________
> Slony1-general mailing list
> Slony1-general at lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general


From cbbrowne at afilias.info  Tue Jun 21 11:08:10 2011
From: cbbrowne at afilias.info (Christopher Browne)
Date: Tue, 21 Jun 2011 14:08:10 -0400
Subject: [Slony1-general] Subscribe error
In-Reply-To: <4E00D783.4060501@ca.afilias.info>
References: <30783745.2020391308677744453.JavaMail.defaultUser@defaultHost>
	<4E00D783.4060501@ca.afilias.info>
Message-ID: <BANLkTi=rvcqcLCxFyVZr0U_LBQjCHy0Xgg@mail.gmail.com>

On Tue, Jun 21, 2011 at 1:40 PM, Steve Singer <ssinger at ca.afilias.info> wrote:
> On 11-06-21 01:35 PM, francescoboccacci at libero.it wrote:
>>
>
>> CONTEXT: ?SQL statement "SELECT ?"_sql_master_slave".subscribeSet_int( $1 ,
>> $2 , ?$3 ,
>> $4 , ?$5 )"
>> ? ? ?PL/pgSQL function "subscribeset" line 77 at PERFORM
>>
>
> Slony normally prints this notice out as part of the subscription
> process. It is normal and does not indicate an error.

As a general rule, if the notification doesn't have the word "ERROR"
in it, then it isn't actually an error.

Slony reports various things that it does, so that an observing
administrator has some visibility of what it's up to.  In a number of
places, we RAISE NOTICE to indicate what's up.

Sometimes PostgreSQL automatically generates notices.  For instance,
if you create a table, and define a primary key, a notice will be
generated indicating extra actions taken.  For instance:

emp at localhost->  create table foo (id serial primary key);
NOTICE:  CREATE TABLE will create implicit sequence "foo_id_seq" for
serial column "foo.id"
NOTICE:  CREATE TABLE / PRIMARY KEY will create implicit index
"foo_pkey" for table "foo"
CREATE TABLE

It should be clear that those aren't errors.  When Slony generates
notices, they're not errors, either.

I think something is missing in the context information that was
reported; the information shown is neither an error message nor
notification of something that was done, but rather is merely
indicating where the thread of execution was when something else,
which presumably was output immediately before the CONTEXT line, was
reported.  I'd sure like to see what was reported BEFORE the
"CONTEXT:" line.

There has been some debugging code that wasn't very useful that has
gotten into the code base.  I don't always feel badly about that - it
can be useful to get that extra bit of output.  But there may be a
"RAISE NOTICE" statement that we could want to trim out.

From yl.wang at invantest.com  Wed Jun 22 21:52:26 2011
From: yl.wang at invantest.com (rodney)
Date: Thu, 23 Jun 2011 12:52:26 +0800
Subject: [Slony1-general] postgres slony-i master node tables can't be
 written after running for few days
Message-ID: <1308804746.2065.3.camel@scadmin-ThinkPad-T61>

Hi all

I set up slony to replicate 3 tables from one opensuse pc (master node)
to another opensuse pc (slave node). It works well at first. After
running for few days, it suddenly come out the error message of -

ERROR: Slony-I: Table euprofiles is replicated and cannot be modified on
a subscriber node - role=0

euprofiles is one of the tables being replicated by slony.

I know that this message may occur if you are trying to write to the
table of slave node. But here I am writing to master node only.

Does anyone see similar problem?


Best regards
Rodney Wang




From yl.wang at invantest.com  Wed Jun 22 21:55:48 2011
From: yl.wang at invantest.com (rodney)
Date: Thu, 23 Jun 2011 12:55:48 +0800
Subject: [Slony1-general] postgres slony-i master node tables can't be
 written after running for few days
In-Reply-To: <1308804746.2065.3.camel@scadmin-ThinkPad-T61>
References: <1308804746.2065.3.camel@scadmin-ThinkPad-T61>
Message-ID: <1308804948.2065.5.camel@scadmin-ThinkPad-T61>

My Postgres version is 8.3.15, slony-i version is 2.0.6

Thanks


On Thu, 2011-06-23 at 12:52 +0800, rodney wrote:
> Hi all
> 
> I set up slony to replicate 3 tables from one opensuse pc (master node)
> to another opensuse pc (slave node). It works well at first. After
> running for few days, it suddenly come out the error message of -
> 
> ERROR: Slony-I: Table euprofiles is replicated and cannot be modified on
> a subscriber node - role=0
> 
> euprofiles is one of the tables being replicated by slony.
> 
> I know that this message may occur if you are trying to write to the
> table of slave node. But here I am writing to master node only.
> 
> Does anyone see similar problem?
> 
> 
> Best regards
> Rodney Wang
> 
> 
> 
> _______________________________________________
> Slony1-general mailing list
> Slony1-general at lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general

-- 
rodney <yl.wang at invantest.com>


From stephane.schildknecht at postgresql.fr  Wed Jun 22 23:21:27 2011
From: stephane.schildknecht at postgresql.fr (=?ISO-8859-15?Q?=22St=E9phane_A=2E_Schildknecht=22?=)
Date: Thu, 23 Jun 2011 08:21:27 +0200
Subject: [Slony1-general] postgres slony-i master node tables can't be
 written after running for few days
In-Reply-To: <1308804746.2065.3.camel@scadmin-ThinkPad-T61>
References: <1308804746.2065.3.camel@scadmin-ThinkPad-T61>
Message-ID: <4E02DB67.7010608@postgresql.fr>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Hello,

Le 23/06/2011 06:52, rodney a ?crit :
> Hi all
> 
> I set up slony to replicate 3 tables from one opensuse pc (master node)
> to another opensuse pc (slave node). It works well at first. After
> running for few days, it suddenly come out the error message of -
> 
> ERROR: Slony-I: Table euprofiles is replicated and cannot be modified on
> a subscriber node - role=0

Could you execute \d euprofiles on every node and give us the result?

Do you have any message in slony logfile?

> 
> euprofiles is one of the tables being replicated by slony.
> 
> I know that this message may occur if you are trying to write to the
> table of slave node. But here I am writing to master node only.

For some reason, it now thinks the table is on the slave.
How do you connect to your databases ? Direct connection? Through a virtual IP?

Is there any auto-magical switch in your infrastructure?

Regards,
- -- 
St?phane Schildknecht
Loxodata
Contact r?gional PostgreSQL

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.10 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/

iEYEARECAAYFAk4C22cACgkQA+REPKWGI0Ep/wCgwI9yUvPcrWAyKYybSVQ7f9hG
SvkAoIiD7nMi4uFxaYyJDiI5i90lsP1o
=coBk
-----END PGP SIGNATURE-----

From yl.wang at invantest.com  Wed Jun 22 23:41:48 2011
From: yl.wang at invantest.com (rodney)
Date: Thu, 23 Jun 2011 14:41:48 +0800
Subject: [Slony1-general] postgres slony-i master node tables can't be
 written after running for few days
In-Reply-To: <4E02DB67.7010608@postgresql.fr>
References: <1308804746.2065.3.camel@scadmin-ThinkPad-T61>
	<4E02DB67.7010608@postgresql.fr>
Message-ID: <1308811308.2065.20.camel@scadmin-ThinkPad-T61>

Hi,

I connect to the both master and slave nodes directly.

I already re-configure slony, and it is working properly now

for master node , the triggers are:
<----------------------------------------------------------------------------------
Indexes:
    "euprofiles_pkey" PRIMARY KEY, btree (id)
Triggers:
    _profile_propagation_logtrigger AFTER INSERT OR DELETE OR UPDATE ON
euprofiles FOR EACH ROW EXECUTE PROCEDURE
_profile_propagation.logtrigger('_profile_propagation', '2', 'k')

Disabled triggers:
    _profile_propagation_denyaccess BEFORE INSERT OR DELETE OR UPDATE ON
euprofiles FOR EACH ROW EXECUTE PROCEDURE
_profile_propagation.denyaccess('_profile_propagation')
---------------------------------------------------------------------------------->


for slave node, the triggers are:
<----------------------------------------------------------------------------------
Indexes:
    "euprofiles_pkey" PRIMARY KEY, btree (id)
Triggers:
    _profile_propagation_denyaccess BEFORE INSERT OR DELETE OR UPDATE ON
euprofiles FOR EACH ROW EXECUTE PROCEDURE
_profile_propagation.denyaccess('_profile_propagation')
Disabled triggers:
    _profile_propagation_logtrigger AFTER INSERT OR DELETE OR UPDATE ON
euprofiles FOR EACH ROW EXECUTE PROCEDURE
_profile_propagation.logtrigger('_profile_propagation', '2', 'k')
---------------------------------------------------------------------------------->

I don't know how to reproduce the problem, just waiting it to happen
again. To give more information about how I setup slony, Following is my
scripts I used to configure slony

<----------------------------------------------------------------------------------

##
## Subscribe
##

subscribe(){

provider=$1
subscriber=$2
if test ${provider} -eq ${subscriber}
then
        echo "provider and subscriber should be different"
        return
fi


/export/home/tools/pgsql/current/bin/slonik <<EOF
include <preamble.sk>;
echo 'Subscribing ${subscriber} to ${provider}';
subscribe set (id=1,provider=$provider,receiver=$subscriber,forward=no);
sync(id=1);
wait for event (origin=$provider, confirmed=$subscriber, wait on=1);
echo 'Done';
EOF


}


##
## Add new node 
##

addnode() {

new_node_id=$1
new_node_comment=$2
new_node_conn=$3

/export/home/tools/pgsql/current/bin/slonik <<EOF
include <preamble.sk>;
echo 'Adding new node ${new_node_id} ${new_node_comment}
${new_node_conn}';
store node(id=${new_node_id}, comment='${new_node_comment}', event
node=1);
store path(server=1, client=${new_node_id}, conninfo='host=168.198.1.92
port=5432 dbname=ops_db user=scadmin password=scadmin0');
store path(server=${new_node_id}, client=1,
conninfo='${new_node_conn}');
echo 'done';
EOF


}


##
## initialize slony cluster 
##

initcluster() {

/export/home/tools/pgsql/current/bin/slonik <<EOF
include <preamble.sk>;
echo 'initializing cluster';
init cluster (id=1, comment='navigator');
create set (id=1, origin=1, comment='source tables');
set add table(set id=1, origin=1, id=1, fully qualified
name='public.code_descs', comment='source table #1',
key='code_descs_pkey');
set add table(set id=1, origin=1, id=2, fully qualified
name='public.euprofiles', comment='source table #2',
key='euprofiles_pkey');
set add table(set id=1, origin=1, id=3, fully qualified
name='public.glob_confs', comment='source table #2',
key='glob_confs_pkey');
EOF

}


##
## Dispatch command
##

if [[ $1 = "sub" ]]; then
        if [[ $# -lt 3 ]]; then
                echo "usage: $0 sub <provider node id> <subscriber node
id> ";
                exit 0;
        fi
        subscribe $2 $3;

elif [[ $1 = "add" ]]; then
        if [[ $# -lt 4 ]]; then
                echo "usage: $0 add <new node id> <new node comment>
<new node connection>";
                exit 0;
        fi
        addnode $2 "$3" "$4";
elif [[ $1 = "init" ]]; then
        initcluster
else
        echo "command not valid, usage: $0 < init | sub | add >";
fi
---------------------------------------------------------------------------------->

I run the the following two commands on master side

> ./slony_admin.sh init
> ./slony_admin.sh add 2 iabox "host=168.198.1.46 port=5432
dbname=igops.ia.db user=scadmin password=scadmin0"

and the following one commnds on the slave node
> ./slony_admin.sh sub 1 2

That's all what I did.



Thanks
Rodney



On Thu, 2011-06-23 at 08:21 +0200, "St?phane A. Schildknecht" wrote:
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
> 
> Hello,
> 
> Le 23/06/2011 06:52, rodney a ?crit :
> > Hi all
> > 
> > I set up slony to replicate 3 tables from one opensuse pc (master node)
> > to another opensuse pc (slave node). It works well at first. After
> > running for few days, it suddenly come out the error message of -
> > 
> > ERROR: Slony-I: Table euprofiles is replicated and cannot be modified on
> > a subscriber node - role=0
> 
> Could you execute \d euprofiles on every node and give us the result?
> 
> Do you have any message in slony logfile?
> 
> > 
> > euprofiles is one of the tables being replicated by slony.
> > 
> > I know that this message may occur if you are trying to write to the
> > table of slave node. But here I am writing to master node only.
> 
> For some reason, it now thinks the table is on the slave.
> How do you connect to your databases ? Direct connection? Through a virtual IP?
> 
> Is there any auto-magical switch in your infrastructure?
> 
> Regards,
> - -- 
> St?phane Schildknecht
> Loxodata
> Contact r?gional PostgreSQL
> 
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v1.4.10 (GNU/Linux)
> Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/
> 
> iEYEARECAAYFAk4C22cACgkQA+REPKWGI0Ep/wCgwI9yUvPcrWAyKYybSVQ7f9hG
> SvkAoIiD7nMi4uFxaYyJDiI5i90lsP1o
> =coBk
> -----END PGP SIGNATURE-----
> _______________________________________________
> Slony1-general mailing list
> Slony1-general at lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general

-- 
rodney <yl.wang at invantest.com>


From yl.wang at invantest.com  Wed Jun 22 23:45:52 2011
From: yl.wang at invantest.com (rodney)
Date: Thu, 23 Jun 2011 14:45:52 +0800
Subject: [Slony1-general] postgres slony-i master node tables can't be
 written after running for few days
In-Reply-To: <4E02DB67.7010608@postgresql.fr>
References: <1308804746.2065.3.camel@scadmin-ThinkPad-T61>
	<4E02DB67.7010608@postgresql.fr>
Message-ID: <1308811552.2065.21.camel@scadmin-ThinkPad-T61>

The contents for preamable.sk are:

# file preamble.sk 
cluster name = profile_propagation;
node 1 admin conninfo = 'host=168.198.1.92 port=5432 dbname=ops_db
user=scadmin password=scadmin0';
node 2 admin conninfo = 'host=168.198.1.46 port=5432 dbname=igops.ia.db
user=scadmin password=scadmin0';




On Thu, 2011-06-23 at 08:21 +0200, "St?phane A. Schildknecht" wrote:
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
> 
> Hello,
> 
> Le 23/06/2011 06:52, rodney a ?crit :
> > Hi all
> > 
> > I set up slony to replicate 3 tables from one opensuse pc (master node)
> > to another opensuse pc (slave node). It works well at first. After
> > running for few days, it suddenly come out the error message of -
> > 
> > ERROR: Slony-I: Table euprofiles is replicated and cannot be modified on
> > a subscriber node - role=0
> 
> Could you execute \d euprofiles on every node and give us the result?
> 
> Do you have any message in slony logfile?
> 
> > 
> > euprofiles is one of the tables being replicated by slony.
> > 
> > I know that this message may occur if you are trying to write to the
> > table of slave node. But here I am writing to master node only.
> 
> For some reason, it now thinks the table is on the slave.
> How do you connect to your databases ? Direct connection? Through a virtual IP?
> 
> Is there any auto-magical switch in your infrastructure?
> 
> Regards,
> - -- 
> St?phane Schildknecht
> Loxodata
> Contact r?gional PostgreSQL
> 
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v1.4.10 (GNU/Linux)
> Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/
> 
> iEYEARECAAYFAk4C22cACgkQA+REPKWGI0Ep/wCgwI9yUvPcrWAyKYybSVQ7f9hG
> SvkAoIiD7nMi4uFxaYyJDiI5i90lsP1o
> =coBk
> -----END PGP SIGNATURE-----
> _______________________________________________
> Slony1-general mailing list
> Slony1-general at lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general

-- 
rodney <yl.wang at invantest.com>


From stephane.schildknecht at postgresql.fr  Thu Jun 23 00:51:17 2011
From: stephane.schildknecht at postgresql.fr (=?ISO-8859-15?Q?=22St=E9phane_A=2E_Schildknecht=22?=)
Date: Thu, 23 Jun 2011 09:51:17 +0200
Subject: [Slony1-general] postgres slony-i master node tables can't be
 written after running for few days
In-Reply-To: <1308811308.2065.20.camel@scadmin-ThinkPad-T61>
References: <1308804746.2065.3.camel@scadmin-ThinkPad-T61>	
	<4E02DB67.7010608@postgresql.fr>
	<1308811308.2065.20.camel@scadmin-ThinkPad-T61>
Message-ID: <4E02F075.2090801@postgresql.fr>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Le 23/06/2011 08:41, rodney a ?crit :
> Hi,
> 
> I connect to the both master and slave nodes directly.
> 
> I already re-configure slony, and it is working properly now
> 
> for master node , the triggers are:
> <----------------------------------------------------------------------------------
(...)
> ---------------------------------------------------------------------------------->

OK.
> 
> 
> for slave node, the triggers are:
> <----------------------------------------------------------------------------------
(...)
> ---------------------------------------------------------------------------------->

OK.

> 
> I don't know how to reproduce the problem, just waiting it to happen
> again. To give more information about how I setup slony, Following is my
> scripts I used to configure slony
> 

These scripts seem OK.
I would guess something has reenabled the disabled triggers. But what?


- -- 
St?phane Schildknecht
Loxodata
Contact r?gional PostgreSQL

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.10 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/

iEYEARECAAYFAk4C8HUACgkQA+REPKWGI0F5PQCeIjtELBNpIAM14g8MWrehHqcN
nq8AnRIxmDG4Hj/o5MZmFe+VXsH1+zHO
=zi3p
-----END PGP SIGNATURE-----

From yl.wang at invantest.com  Thu Jun 23 00:57:34 2011
From: yl.wang at invantest.com (rodney)
Date: Thu, 23 Jun 2011 15:57:34 +0800
Subject: [Slony1-general] postgres slony-i master node tables can't be
 written after running for few days
In-Reply-To: <4E02F075.2090801@postgresql.fr>
References: <1308804746.2065.3.camel@scadmin-ThinkPad-T61>
	<4E02DB67.7010608@postgresql.fr>
	<1308811308.2065.20.camel@scadmin-ThinkPad-T61>
	<4E02F075.2090801@postgresql.fr>
Message-ID: <1308815854.2065.23.camel@scadmin-ThinkPad-T61>


Is there any case that slony will turn a master node into a slave node
automatically?

Thanks
Rodney


On Thu, 2011-06-23 at 09:51 +0200, "St?phane A. Schildknecht" wrote:
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
> 
> Le 23/06/2011 08:41, rodney a ?crit :
> > Hi,
> > 
> > I connect to the both master and slave nodes directly.
> > 
> > I already re-configure slony, and it is working properly now
> > 
> > for master node , the triggers are:
> > <----------------------------------------------------------------------------------
> (...)
> > ---------------------------------------------------------------------------------->
> 
> OK.
> > 
> > 
> > for slave node, the triggers are:
> > <----------------------------------------------------------------------------------
> (...)
> > ---------------------------------------------------------------------------------->
> 
> OK.
> 
> > 
> > I don't know how to reproduce the problem, just waiting it to happen
> > again. To give more information about how I setup slony, Following is my
> > scripts I used to configure slony
> > 
> 
> These scripts seem OK.
> I would guess something has reenabled the disabled triggers. But what?
> 
> 
> - -- 
> St?phane Schildknecht
> Loxodata
> Contact r?gional PostgreSQL
> 
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v1.4.10 (GNU/Linux)
> Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/
> 
> iEYEARECAAYFAk4C8HUACgkQA+REPKWGI0F5PQCeIjtELBNpIAM14g8MWrehHqcN
> nq8AnRIxmDG4Hj/o5MZmFe+VXsH1+zHO
> =zi3p
> -----END PGP SIGNATURE-----

-- 
rodney <yl.wang at invantest.com>


From stephane.schildknecht at postgresql.fr  Thu Jun 23 01:16:26 2011
From: stephane.schildknecht at postgresql.fr (=?ISO-8859-15?Q?=22St=E9phane_A=2E_Schildknecht=22?=)
Date: Thu, 23 Jun 2011 10:16:26 +0200
Subject: [Slony1-general] postgres slony-i master node tables can't be
 written after running for few days
In-Reply-To: <1308815854.2065.23.camel@scadmin-ThinkPad-T61>
References: <1308804746.2065.3.camel@scadmin-ThinkPad-T61>	
	<4E02DB67.7010608@postgresql.fr>	
	<1308811308.2065.20.camel@scadmin-ThinkPad-T61>	
	<4E02F075.2090801@postgresql.fr>
	<1308815854.2065.23.camel@scadmin-ThinkPad-T61>
Message-ID: <4E02F65A.2080505@postgresql.fr>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Le 23/06/2011 09:57, rodney a ?crit :
> 
> Is there any case that slony will turn a master node into a slave node
> automatically?

None that I'm aware of.
There's no such automatic procedure.


- -- 
St?phane Schildknecht
Loxodata
Contact r?gional PostgreSQL

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.10 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/

iEYEARECAAYFAk4C9loACgkQA+REPKWGI0FpLQCgqsCabu9FktOfx5T38BYfwIQY
J9cAoI6+iyPZXlcZ+YgUEF15/ZSjfPR3
=wPJ9
-----END PGP SIGNATURE-----

From yl.wang at invantest.com  Thu Jun 23 01:45:17 2011
From: yl.wang at invantest.com (rodney)
Date: Thu, 23 Jun 2011 16:45:17 +0800
Subject: [Slony1-general] postgres slony-i master node tables can't be
 written after running for few days
In-Reply-To: <4E02F65A.2080505@postgresql.fr>
References: <1308804746.2065.3.camel@scadmin-ThinkPad-T61>
	<4E02DB67.7010608@postgresql.fr>
	<1308811308.2065.20.camel@scadmin-ThinkPad-T61>
	<4E02F075.2090801@postgresql.fr>
	<1308815854.2065.23.camel@scadmin-ThinkPad-T61>
	<4E02F65A.2080505@postgresql.fr>
Message-ID: <1308818717.2065.26.camel@scadmin-ThinkPad-T61>

Well, I'll be waiting the problem to happen again before doing any
further analysis. Thanks very much St?phane Schildknecht, for your
immediate reply.

Best regards
Rodney

On Thu, 2011-06-23 at 10:16 +0200, "St?phane A. Schildknecht" wrote:
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
> 
> Le 23/06/2011 09:57, rodney a ?crit :
> > 
> > Is there any case that slony will turn a master node into a slave node
> > automatically?
> 
> None that I'm aware of.
> There's no such automatic procedure.
> 
> 
> - -- 
> St?phane Schildknecht
> Loxodata
> Contact r?gional PostgreSQL
> 
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v1.4.10 (GNU/Linux)
> Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/
> 
> iEYEARECAAYFAk4C9loACgkQA+REPKWGI0FpLQCgqsCabu9FktOfx5T38BYfwIQY
> J9cAoI6+iyPZXlcZ+YgUEF15/ZSjfPR3
> =wPJ9
> -----END PGP SIGNATURE-----

-- 
rodney <yl.wang at invantest.com>


From francescoboccacci at libero.it  Thu Jun 23 02:03:59 2011
From: francescoboccacci at libero.it (francescoboccacci at libero.it)
Date: Thu, 23 Jun 2011 11:03:59 +0200 (CEST)
Subject: [Slony1-general] Info log file slony
Message-ID: <18541341.2729961308819839139.JavaMail.defaultUser@defaultHost>

Hi to all,
i have a question for you. I'n using slony to replicate two databases.
I run cluster script, after:

/usr/lib/postgresql/8.4/bin/slon sql_cluster_master_slave  "dbname=master 
user=navmap" > slonmaster.log &
/usr/lib/postgresql/8.4/bin/slon sql_cluster_master_slave "dbname=slave 
user=navmap" > slonslave.log &

at the end subscribe script.

My question is:

the two log file grow up in size day by day. I like to clean up these files 
and rebuild from scratch.
Is there a slony command to do that or i have to create a script and run it 
from crontab that delete these files?

Thanks


Francesco


From dan at randomdan.homeip.net  Thu Jun 23 02:10:04 2011
From: dan at randomdan.homeip.net (Dan Goodliffe)
Date: Thu, 23 Jun 2011 10:10:04 +0100
Subject: [Slony1-general] Info log file slony
In-Reply-To: <18541341.2729961308819839139.JavaMail.defaultUser@defaultHost>
References: <18541341.2729961308819839139.JavaMail.defaultUser@defaultHost>
Message-ID: <4E0302EC.7080209@randomdan.homeip.net>

I actually let syslog deal with it... something like this

/usr/lib/postgresql/8.4/bin/slon sql_cluster_master_slave  "dbname=master
user=navmap"| logger -t slony1

Syslog's logs are rotated automatically by logrotate.
You might want to set up a filter for "slony1" to stop slony cluttering 
up the main log file.

D

On 23/06/11 10:03, francescoboccacci at libero.it wrote:
> Hi to all,
> i have a question for you. I'n using slony to replicate two databases.
> I run cluster script, after:
>
> /usr/lib/postgresql/8.4/bin/slon sql_cluster_master_slave  "dbname=master
> user=navmap">  slonmaster.log&
> /usr/lib/postgresql/8.4/bin/slon sql_cluster_master_slave "dbname=slave
> user=navmap">  slonslave.log&
>
> at the end subscribe script.
>
> My question is:
>
> the two log file grow up in size day by day. I like to clean up these files
> and rebuild from scratch.
> Is there a slony command to do that or i have to create a script and run it
> from crontab that delete these files?
>
> Thanks
>
>
> Francesco
>
> _______________________________________________
> Slony1-general mailing list
> Slony1-general at lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general

From stephane.schildknecht at postgresql.fr  Thu Jun 23 05:55:12 2011
From: stephane.schildknecht at postgresql.fr (=?ISO-8859-15?Q?=22St=E9phane_A=2E_Schildknecht=22?=)
Date: Thu, 23 Jun 2011 14:55:12 +0200
Subject: [Slony1-general] Info log file slony
In-Reply-To: <18541341.2729961308819839139.JavaMail.defaultUser@defaultHost>
References: <18541341.2729961308819839139.JavaMail.defaultUser@defaultHost>
Message-ID: <4E0337B0.9060206@postgresql.fr>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Le 23/06/2011 11:03, francescoboccacci at libero.it a ?crit :
> Hi to all,
> i have a question for you. I'n using slony to replicate two databases.
> I run cluster script, after:
> 
> /usr/lib/postgresql/8.4/bin/slon sql_cluster_master_slave  "dbname=master 
> user=navmap" > slonmaster.log &
> /usr/lib/postgresql/8.4/bin/slon sql_cluster_master_slave "dbname=slave 
> user=navmap" > slonslave.log &
> 
> at the end subscribe script.
> 
> My question is:
> 
> the two log file grow up in size day by day. I like to clean up these files 
> and rebuild from scratch.
> Is there a slony command to do that or i have to create a script and run it 
> from crontab that delete these files?
> 

logrotate will do the trick.

I use syslog (configured through slon configuration file) and configured
logrotation through a file located in logrotate.d, which contains :

/var/log/slony/*.log {
  weekly
  rotate 2
  copytruncate
  delaycompress
  compress
  notifempty
  missingok
}



- -- 
St?phane Schildknecht
Loxodata
Contact r?gional PostgreSQL

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.10 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/

iEYEARECAAYFAk4DN68ACgkQA+REPKWGI0EOKACfcAJQUN8rxH2GnTJT6MGM+YCk
JugAn26AV8BCPJHlxq8rULoxvLW/et7Q
=qySi
-----END PGP SIGNATURE-----

From stephane.schildknecht at postgresql.fr  Fri Jun 24 02:26:58 2011
From: stephane.schildknecht at postgresql.fr (=?ISO-8859-15?Q?=22St=E9phane_A=2E_Schildknecht=22?=)
Date: Fri, 24 Jun 2011 11:26:58 +0200
Subject: [Slony1-general] R: Re:  Info log file slony
In-Reply-To: <12847964.2871521308837369113.JavaMail.defaultUser@defaultHost>
References: <12847964.2871521308837369113.JavaMail.defaultUser@defaultHost>
Message-ID: <4E045862.2090209@postgresql.fr>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Le 23/06/2011 15:56, francescoboccacci at libero.it a ?crit :
> 
> Hi,
> this is my logrotate.conf file:
> 
> 
> # see "man logrotate" for details
> # rotate log files weekly
> weekly
> 
> # keep 4 weeks worth of backlogs
> rotate 4
> 
> # create new (empty) log files after rotating old ones
> create
> 
> # uncomment this if you want your log files compressed
> #compress
> 
> # packages drop log rotation information into this directory
> include /etc/logrotate.d
> 
> # no packages own wtmp, or btmp -- we'll rotate them here
> /var/log/wtmp {
>     missingok
>     monthly
>     create 0664 root utmp
>     rotate 1
> }
> 
> /var/log/btmp {
>     missingok
>     monthly
>     create 0660 root utmp
>     rotate 1
> }
> 
> /home/prod1/log_slony/*.log {
>   weekly
>   rotate 2
>   copytruncate
>   delaycompress
>   compress
>   notifempty
>   missingok
> }
> 
> # system-specific logs may be configured here
> 
> Do you think is right?Do i have to restart some process after my modify?
> 

logrotate is usually issued by cron. So you don't have anything special to do.
The configuration I gave was for a weekly rotate, if your files are overgrowing
on a daily basis, you can have

daily
rotate 7

for instance.

Regards,
- -- 
St?phane Schildknecht
Loxodata
Contact r?gional PostgreSQL

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.10 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/

iEYEARECAAYFAk4EWGIACgkQA+REPKWGI0GqtQCg2ldsiuQCTy/wbp2S2R/mGd6G
rCsAoILfPsQVdyAAj3JLk+yK8ZKbeD7z
=3skK
-----END PGP SIGNATURE-----

From atsaloli.tech at gmail.com  Sat Jun 25 10:43:47 2011
From: atsaloli.tech at gmail.com (Aleksey Tsalolikhin)
Date: Sat, 25 Jun 2011 10:43:47 -0700
Subject: [Slony1-general] How is replication of TRIGGERS handled under Slony?
Message-ID: <BANLkTi=jBrfR0pMC5+HUeym6JDRzTTz87w@mail.gmail.com>

Hi.  I've been using Slony for a couple of years, and it's been working great;
but we've just started using triggers in our application, and when I manually
added the trigger on the subscriber side, next time I tried to recreate the
data set, it wouldn't go due to multiple triggers issue.  So how do I replicate
triggers, please?

-----------------------------------------------------------------------------------------------------

This is the issue I ran into after manually adding the trigger on the
subscriber:


NOTICE: Slony-I: alterTableForReplication(): multiple instances of
trigger % on table %'',

This normally happens if you have a table that had a trigger attached
to it that replication hid due to this being a subscriber node, and
then you added a trigger by the same name back to replication. Now,
when trying to "fix up" triggers, those two triggers conflict.

The DDL script will keep running and rerunning, or the UNINSTALL NODE
will keep failing, until you drop the "visible" trigger, by hand, much
as you must have added it, by hand, earlier.

ERROR: Slony-I: Unable to disable triggers

This is the error that follows the "multiple triggers" problem.
------------------------------------------------------------------------------------------------------------

Should I have added the trigger to replication using slonik?  If so,
how, please?  I looked
on the slony.info web site but did not find the answer.

I am using slony1-1.2.21

Thanks,
Aleksey

From atsaloli.tech at gmail.com  Sat Jun 25 20:21:48 2011
From: atsaloli.tech at gmail.com (Aleksey Tsalolikhin)
Date: Sat, 25 Jun 2011 20:21:48 -0700
Subject: [Slony1-general] I've run into a "hopefully obsolete" issue,
 FAQ 5.2.8.4. Replication Fails - Unique Constraint Violation
Message-ID: <BANLkTimUH5qjN9n_n-LCgwq0R5_a3BW2tg@mail.gmail.com>

Hi.  In the Slony FAQ, section "5.2.8.4. Replication Fails - Unique
Constraint Violation" is listed under "hopefully obsolete".

I've just run into this issue, using Slony-I 1.2.21, running against
Postgres 8.4.8.  So looks like this issue is still around.

I had Slony repeatedly trying to insert values on the subscriber that
were rejected with "unique constraint violation".

Same values do not appear on the master -- I guess the master's
database rejected them.  It appears that Slony was attempting to
replicate to the subscriber a transaction that was rejected on the
master?  The description in 5.2.8.4 fits to a "t".  Looks like this
"glitch" is still around.

Aleksey

From atsaloli.tech at gmail.com  Sat Jun 25 20:30:25 2011
From: atsaloli.tech at gmail.com (Aleksey Tsalolikhin)
Date: Sat, 25 Jun 2011 20:30:25 -0700
Subject: [Slony1-general] How is replication of TRIGGERS handled under
	Slony?
In-Reply-To: <BANLkTi=jBrfR0pMC5+HUeym6JDRzTTz87w@mail.gmail.com>
References: <BANLkTi=jBrfR0pMC5+HUeym6JDRzTTz87w@mail.gmail.com>
Message-ID: <BANLkTi=Zj0tTDcoVv=e11R0MdvCBbRrn3w@mail.gmail.com>

I've found the documentation of how SlonyI-1.2 handles triggers,
at http://slony.info/documentation/1.2/triggers.html, but I still don't
understand what I actually need to do to set up replication
if I have triggers on the master?

Could somebody please contribute a short procedural (howto)
section for this case?

Thanks,
Aleksey


On Sat, Jun 25, 2011 at 10:43 AM, Aleksey Tsalolikhin
<atsaloli.tech at gmail.com> wrote:
> Hi. ?I've been using Slony for a couple of years, and it's been working great;
> but we've just started using triggers in our application, and when I manually
> added the trigger on the subscriber side, next time I tried to recreate the
> data set, it wouldn't go due to multiple triggers issue. ?So how do I replicate
> triggers, please?
>
> -----------------------------------------------------------------------------------------------------
>
> This is the issue I ran into after manually adding the trigger on the
> subscriber:
>
>
> NOTICE: Slony-I: alterTableForReplication(): multiple instances of
> trigger % on table %'',
>
> This normally happens if you have a table that had a trigger attached
> to it that replication hid due to this being a subscriber node, and
> then you added a trigger by the same name back to replication. Now,
> when trying to "fix up" triggers, those two triggers conflict.
>
> The DDL script will keep running and rerunning, or the UNINSTALL NODE
> will keep failing, until you drop the "visible" trigger, by hand, much
> as you must have added it, by hand, earlier.
>
> ERROR: Slony-I: Unable to disable triggers
>
> This is the error that follows the "multiple triggers" problem.
> ------------------------------------------------------------------------------------------------------------
>
> Should I have added the trigger to replication using slonik? ?If so,
> how, please? ?I looked
> on the slony.info web site but did not find the answer.
>
> I am using slony1-1.2.21
>
> Thanks,
> Aleksey
>

From kleptog at gmail.com  Sun Jun 26 03:07:06 2011
From: kleptog at gmail.com (Martijn van Oosterhout)
Date: Sun, 26 Jun 2011 12:07:06 +0200
Subject: [Slony1-general] How is replication of TRIGGERS handled under
	Slony?
In-Reply-To: <BANLkTi=jBrfR0pMC5+HUeym6JDRzTTz87w@mail.gmail.com>
References: <BANLkTi=jBrfR0pMC5+HUeym6JDRzTTz87w@mail.gmail.com>
Message-ID: <BANLkTi=pmwvX4WABEo1SNdZo_qgwJw2+KQ@mail.gmail.com>

On 25 June 2011 19:43, Aleksey Tsalolikhin <atsaloli.tech at gmail.com> wrote:
> Hi. ?I've been using Slony for a couple of years, and it's been working great;
> but we've just started using triggers in our application, and when I manually
> added the trigger on the subscriber side, next time I tried to recreate the
> data set, it wouldn't go due to multiple triggers issue. ?So how do I replicate
> triggers, please?

Not sure exactly what you ran into, but I've never used Slony to
replicate DDL. It's also a bit weird that the name of the trigger
didn't get filled in. I usually define the triggers in the schema
before starting the replication.

One thing to realise is that by default triggers are not fired on
slaves. This is usually what you want, but if you're using triggers to
fire off some external process that you also want to happen on the
slave, you can use ALTER TABLE foo ENABLE ALWAYS TRIGGER bar;


> This is the issue I ran into after manually adding the trigger on the
> subscriber:

What do you mean by "manually added"? Unless you used slony, I don't
see how slony could complain?

Have a nice day,
-- 
Martijn van Oosterhout <kleptog at gmail.com> http://svana.org/kleptog/

From ssinger_pg at sympatico.ca  Sun Jun 26 05:29:39 2011
From: ssinger_pg at sympatico.ca (Steve Singer)
Date: Sun, 26 Jun 2011 08:29:39 -0400
Subject: [Slony1-general] How is replication of TRIGGERS handled under
 Slony?
In-Reply-To: <BANLkTi=jBrfR0pMC5+HUeym6JDRzTTz87w@mail.gmail.com>
References: <BANLkTi=jBrfR0pMC5+HUeym6JDRzTTz87w@mail.gmail.com>
Message-ID: <BLU0-SMTP41A46EE8695ABDB6277FE9AC540@phx.gbl>

Aleksey Tsalolikhin wrote:
> Hi.  I've been using Slony for a couple of years, and it's been working great;
> but we've just started using triggers in our application, and when I manually
> added the trigger on the subscriber side, next time I tried to recreate the
> data set, it wouldn't go due to multiple triggers issue.  So how do I replicate
> triggers, please?

Did you attempt to add the trigger (or make any other DDL change) on the 
subscriber outside of an EXECUTE SCRIPT block?

In 1.2.x slony munges the catalog (pg_class) to disable triggers on the 
subscriber nodes.

The comments another poster gave you about ENABLE/DISALBE triggers 
applies  to Slony 2.0 but might not work as you want for 1.2

My understanding of a procedure for running triggers on the master with 
1.2 is that you

1. You write a SQL script that adds the triggers to the tables via 
EXECUTE SCRIPT.
2.  That script will then run on all nodes.
3.  When you insert data into your table your trigger will run along 
with the slony triggers.
4.  When slony replicates the data to the slave this trigger will NOT 
run (and nor will the slony trigger) becaues pg_class on the slave was 
munged by slony to prevent triggers from running.

If you want your trigger to also run on the slave you can accomplish 
this in 1.2 with the SET ADD TRIGGER command.

If you tried to add a trigger to a slave without using EXECUTE SCRIPT 
(in 1.2) you might have corrupted your slave.

This is all different in 2.0,  I would recommend also looking at how 2.0 
  deals with this stuff and start planning an upgrade.

> 
> -----------------------------------------------------------------------------------------------------
> 
> This is the issue I ran into after manually adding the trigger on the
> subscriber:
> 
> 
> NOTICE: Slony-I: alterTableForReplication(): multiple instances of
> trigger % on table %'',
> 
> This normally happens if you have a table that had a trigger attached
> to it that replication hid due to this being a subscriber node, and
> then you added a trigger by the same name back to replication. Now,
> when trying to "fix up" triggers, those two triggers conflict.
> 
> The DDL script will keep running and rerunning, or the UNINSTALL NODE
> will keep failing, until you drop the "visible" trigger, by hand, much
> as you must have added it, by hand, earlier.
> 
> ERROR: Slony-I: Unable to disable triggers
> 
> This is the error that follows the "multiple triggers" problem.
> ------------------------------------------------------------------------------------------------------------
> 
> Should I have added the trigger to replication using slonik?  If so,
> how, please?  I looked
> on the slony.info web site but did not find the answer.
> 
> I am using slony1-1.2.21
> 
> Thanks,
> Aleksey
> _______________________________________________
> Slony1-general mailing list
> Slony1-general at lists.slony.info
> http://lists.slony.info/mailman/listinfo/slony1-general
> 
> 


From yl.wang at invantest.com  Sun Jun 26 19:48:54 2011
From: yl.wang at invantest.com (rodney)
Date: Mon, 27 Jun 2011 10:48:54 +0800
Subject: [Slony1-general] How many slaves can be supported by slony2.0?
Message-ID: <1309142934.2589.4.camel@scadmin-ThinkPad-T61>

Hi

I'm trying to setup slony to replicate table from one master to around
200 slaves. Can slony support slave number at this scale? It is observed
in pgadmin that when I have 1 slave, the num of listener is 1. However,
when I have 2 slaves, the num of listener increase from 1 to 4 (not 2).
Will this be a problem if the slave go to a large number, like 100?


Best regards

-- 
rodney <yl.wang at invantest.com>


From guillaume at lelarge.info  Sun Jun 26 23:20:49 2011
From: guillaume at lelarge.info (Guillaume Lelarge)
Date: Mon, 27 Jun 2011 08:20:49 +0200
Subject: [Slony1-general] How many slaves can be supported by slony2.0?
In-Reply-To: <1309142934.2589.4.camel@scadmin-ThinkPad-T61>
References: <1309142934.2589.4.camel@scadmin-ThinkPad-T61>
Message-ID: <1309155649.2085.0.camel@laptop>

On Mon, 2011-06-27 at 10:48 +0800, rodney wrote:
> Hi
> 
> I'm trying to setup slony to replicate table from one master to around
> 200 slaves. Can slony support slave number at this scale? It is observed
> in pgadmin that when I have 1 slave, the num of listener is 1. However,
> when I have 2 slaves, the num of listener increase from 1 to 4 (not 2).
> Will this be a problem if the slave go to a large number, like 100?
> 

Yes, you usually don't go over 12 or 15 nodes with Slony.


-- 
Guillaume
  http://blog.guillaume.lelarge.info
  http://www.dalibo.com


