From ragavendra.dba at gmail.com  Sun Jul  1 05:32:12 2012
From: ragavendra.dba at gmail.com (Raghav)
Date: Sun, 1 Jul 2012 18:02:12 +0530
Subject: [Slony1-general] Swapping Providers
In-Reply-To: <CANwAqWgt-5m9Own3E7aR9ueB3sZuCAdDiYK9Pxr6ftEmAOMjAg@mail.gmail.com>
References: <CANwAqWggSUrkzSP8bnc11+udsnUZb-gy9xhndjLPPXv-nLsV7w@mail.gmail.com>
	<4FE399F1.2070807@ca.afilias.info>
	<CANwAqWjYFZ3Oiz3nS_=628Y-1YaZpLxXJJ_SGpKbQbsCgn_W1g@mail.gmail.com>
	<4FE712CD.20204@Yahoo.com>
	<CANwAqWhtDm3QCCt8HqQGBBB1Ye_tp64jXJ2dUgApfxZqYzfmZg@mail.gmail.com>
	<4FE85D6B.5090607@Yahoo.com>
	<CANwAqWgYAAxRmrJ5B2nh00_NuL=Djz4gMm2K_8AKUrhtw4CVkA@mail.gmail.com>
	<CANwAqWgt-5m9Own3E7aR9ueB3sZuCAdDiYK9Pxr6ftEmAOMjAg@mail.gmail.com>
Message-ID: <CANwAqWjeZYqyZvLQ8uF0-ofJVZKmvbYc+1RVUAkZohx6AMLD6w@mail.gmail.com>

Sorry for late on this, its due to actual Production swap implementation.
Though I tested as suggested, I didnt get time to post my reply.
After doing vigorous testing by taking into consideration Steve & Jan
points, we succeded it without any problem.

This analysis is flawed. The two event numbers are from different origins
> and therefore, don't compare to each other. The combination of
> ev_origin,ev_seqno can never be higher on any node, than it is on the
> origin itself.


Yes, my analysis has flaw. Its no where related to SEQ.No...which I
analyzed and every node seq.no number is independed by itself.

To simulate this problem, Steve and I were pointing out, do the following:
> 1. Create your setup as before.
> 2. Stop the streaming replication (simulating the network communication
> problem)
> 3. Update a row on the master and wait for the SYNC to replicate.
> 4. Stop the slon processes. DO NOT let the streaming replica catch up with
> the now DEAD master. Assume the master and all its data, including WAL,
> have become unavailable.
> 5. Promote DR-master and do the two store path commands.
> 6. Start slon processes.
> 7. Update another row on the new master.
> 8. Compare table content on master and slave.
> You can detect the problem before step 5 by comparing the ev_seqno with
> ev_origin=old-master on the DR-master and slave. Whichever is higher should
> be promoted to master. In the unlikely case that it is the Slony slave, you
> will have to rebuild the DR-master from scratch, though.


Yep, I could able to detect before Step 5.

In short of our actual production swap, we stopped application(NO DML's)
and Slony. Checked DR-master(which is warm standby) is complete sync with
Master(primary). Promoted DR-master, did changes to store_path on both the
ends. Started slon on both the nodes. Sync catch-up well. We have taken
complete care of NOT happening any Step 2 or 3 though .. :)

Thanks once again.

--Raghav
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20120701/9b6c44d3/attachment.htm 

