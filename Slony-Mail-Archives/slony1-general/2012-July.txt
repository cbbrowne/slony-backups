From ragavendra.dba at gmail.com  Sun Jul  1 05:32:12 2012
From: ragavendra.dba at gmail.com (Raghav)
Date: Sun, 1 Jul 2012 18:02:12 +0530
Subject: [Slony1-general] Swapping Providers
In-Reply-To: <CANwAqWgt-5m9Own3E7aR9ueB3sZuCAdDiYK9Pxr6ftEmAOMjAg@mail.gmail.com>
References: <CANwAqWggSUrkzSP8bnc11+udsnUZb-gy9xhndjLPPXv-nLsV7w@mail.gmail.com>
	<4FE399F1.2070807@ca.afilias.info>
	<CANwAqWjYFZ3Oiz3nS_=628Y-1YaZpLxXJJ_SGpKbQbsCgn_W1g@mail.gmail.com>
	<4FE712CD.20204@Yahoo.com>
	<CANwAqWhtDm3QCCt8HqQGBBB1Ye_tp64jXJ2dUgApfxZqYzfmZg@mail.gmail.com>
	<4FE85D6B.5090607@Yahoo.com>
	<CANwAqWgYAAxRmrJ5B2nh00_NuL=Djz4gMm2K_8AKUrhtw4CVkA@mail.gmail.com>
	<CANwAqWgt-5m9Own3E7aR9ueB3sZuCAdDiYK9Pxr6ftEmAOMjAg@mail.gmail.com>
Message-ID: <CANwAqWjeZYqyZvLQ8uF0-ofJVZKmvbYc+1RVUAkZohx6AMLD6w@mail.gmail.com>

Sorry for late on this, its due to actual Production swap implementation.
Though I tested as suggested, I didnt get time to post my reply.
After doing vigorous testing by taking into consideration Steve & Jan
points, we succeded it without any problem.

This analysis is flawed. The two event numbers are from different origins
> and therefore, don't compare to each other. The combination of
> ev_origin,ev_seqno can never be higher on any node, than it is on the
> origin itself.


Yes, my analysis has flaw. Its no where related to SEQ.No...which I
analyzed and every node seq.no number is independed by itself.

To simulate this problem, Steve and I were pointing out, do the following:
> 1. Create your setup as before.
> 2. Stop the streaming replication (simulating the network communication
> problem)
> 3. Update a row on the master and wait for the SYNC to replicate.
> 4. Stop the slon processes. DO NOT let the streaming replica catch up with
> the now DEAD master. Assume the master and all its data, including WAL,
> have become unavailable.
> 5. Promote DR-master and do the two store path commands.
> 6. Start slon processes.
> 7. Update another row on the new master.
> 8. Compare table content on master and slave.
> You can detect the problem before step 5 by comparing the ev_seqno with
> ev_origin=old-master on the DR-master and slave. Whichever is higher should
> be promoted to master. In the unlikely case that it is the Slony slave, you
> will have to rebuild the DR-master from scratch, though.


Yep, I could able to detect before Step 5.

In short of our actual production swap, we stopped application(NO DML's)
and Slony. Checked DR-master(which is warm standby) is complete sync with
Master(primary). Promoted DR-master, did changes to store_path on both the
ends. Started slon on both the nodes. Sync catch-up well. We have taken
complete care of NOT happening any Step 2 or 3 though .. :)

Thanks once again.

--Raghav
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20120701/9b6c44d3/attachment.htm 

From efraindector at motumweb.com  Mon Jul  2 11:49:44 2012
From: efraindector at motumweb.com (=?UTF-8?Q?Efra=C3=ADn_D=C3=A9ctor?=)
Date: Mon, 2 Jul 2012 13:49:44 -0500
Subject: [Slony1-general] slonik_execute_script not working
Message-ID: <D7367DEE330645D8B0648399EA517120@CMOTUM25PC>

Hello. I?m testin Slony, everything is running fine in terms of replication, however I?m trying to test adding a column to a table that is beaing replicated.

I?m using altperl, so using the documentation I see that using slonik_execute_script should help me to create the new column.

This is how I am using it: 

slonik_execute_script 1 /root/script.sql

After I execute the script this message is shown:

cluster name = replication;
node 1 admin conninfo='host=192.168.20.144 dbname=nomina user=pgsql port=5432';
node 2 admin conninfo='host=192.168.20.210 dbname=nomina user=pgsql port=5432;
  execute script (
    set id = 1,
    filename = '/tmp/EpbvGiNpWb',
    event node = 1
  );

script.sql contains:  ALTER TABLE personas ADD COLUMN prueba integer;

However, nothing happens on the master or slave. 

Could you please, tell me what Im doing wrong?.

Thank you in advance.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20120702/5930d3c7/attachment.htm 

From wolf at uen.org  Mon Jul  2 12:29:03 2012
From: wolf at uen.org (Wolf Schwurack)
Date: Mon, 2 Jul 2012 19:29:03 +0000
Subject: [Slony1-general] slonik_execute_script not working
In-Reply-To: <D7367DEE330645D8B0648399EA517120@CMOTUM25PC>
Message-ID: <485368C10B2A274EABE47136B8AFCA1223FC6B70@X-MB11.xds.umail.utah.edu>

You can not run DDL statement using slony, it states that in slony docs

      0___      Wolfgang Schwurack
     c/  /'_    SA/DBA - UEN
    (*)  \(*)   801-587-9444
                wolf at uen.org

From: Efra?n D?ctor <efraindector at motumweb.com<mailto:efraindector at motumweb.com>>
Organization: HESA T?cnica
Date: Monday, July 2, 2012 12:49 PM
To: "slony1-general at lists.slony.info<mailto:slony1-general at lists.slony.info>" <slony1-general at lists.slony.info<mailto:slony1-general at lists.slony.info>>
Subject: [Slony1-general] slonik_execute_script not working

Hello. I?m testin Slony, everything is running fine in terms of replication, however I?m trying to test adding a column to a table that is beaing replicated.

I?m using altperl, so using the documentation I see that using slonik_execute_script should help me to create the new column.

This is how I am using it:

slonik_execute_script 1 /root/script.sql

After I execute the script this message is shown:

cluster name = replication;
node 1 admin conninfo='host=192.168.20.144 dbname=nomina user=pgsql port=5432';
node 2 admin conninfo='host=192.168.20.210 dbname=nomina user=pgsql port=5432;
  execute script (
    set id = 1,
    filename = '/tmp/EpbvGiNpWb',
    event node = 1
  );

script.sql contains:  ALTER TABLE personas ADD COLUMN prueba integer;

However, nothing happens on the master or slave.

Could you please, tell me what Im doing wrong?.

Thank you in advance.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20120702/5a2166f3/attachment.htm 

From guillaume at lelarge.info  Mon Jul  2 13:37:21 2012
From: guillaume at lelarge.info (Guillaume Lelarge)
Date: Mon, 02 Jul 2012 22:37:21 +0200
Subject: [Slony1-general] slonik_execute_script not working
In-Reply-To: <D7367DEE330645D8B0648399EA517120@CMOTUM25PC>
References: <D7367DEE330645D8B0648399EA517120@CMOTUM25PC>
Message-ID: <1341261441.1912.38.camel@localhost.localdomain>

On Mon, 2012-07-02 at 13:49 -0500, Efra?n D?ctor wrote:
> Hello. I?m testin Slony, everything is running fine in terms of replication, however I?m trying to test adding a column to a table that is beaing replicated.
> 
> I?m using altperl, so using the documentation I see that using slonik_execute_script should help me to create the new column.
> 
> This is how I am using it: 
> 
> slonik_execute_script 1 /root/script.sql
> 
> After I execute the script this message is shown:
> 
> cluster name = replication;
> node 1 admin conninfo='host=192.168.20.144 dbname=nomina user=pgsql port=5432';
> node 2 admin conninfo='host=192.168.20.210 dbname=nomina user=pgsql port=5432;
>   execute script (
>     set id = 1,
>     filename = '/tmp/EpbvGiNpWb',
>     event node = 1
>   );
> 
> script.sql contains:  ALTER TABLE personas ADD COLUMN prueba integer;
> 
> However, nothing happens on the master or slave. 
> 
> Could you please, tell me what Im doing wrong?.
> 

You forgot to send the slonik script to slonik. IOW:

slonik_execute_script 1 /root/script.sql | slonik


-- 
Guillaume
http://blog.guillaume.lelarge.info
http://www.dalibo.com


From efraindector at motumweb.com  Mon Jul  2 15:05:39 2012
From: efraindector at motumweb.com (=?UTF-8?Q?Efra=C3=ADn_D=C3=A9ctor?=)
Date: Mon, 2 Jul 2012 17:05:39 -0500
Subject: [Slony1-general] slonik_execute_script not working
In-Reply-To: <1341261441.1912.38.camel@localhost.localdomain>
References: <D7367DEE330645D8B0648399EA517120@CMOTUM25PC>
	<1341261441.1912.38.camel@localhost.localdomain>
Message-ID: <256D5C27F5D1491F81420DACE76E41EC@CMOTUM25PC>

That was it. It worked.

Thank you really much.

-----Mensaje original----- 
From: Guillaume Lelarge
Sent: Monday, July 02, 2012 3:37 PM
To: Efra?n D?ctor
Cc: slony1-general at lists.slony.info
Subject: Re: [Slony1-general] slonik_execute_script not working

On Mon, 2012-07-02 at 13:49 -0500, Efra?n D?ctor wrote:
> Hello. I?m testin Slony, everything is running fine in terms of 
> replication, however I?m trying to test adding a column to a table that is 
> beaing replicated.
>
> I?m using altperl, so using the documentation I see that using 
> slonik_execute_script should help me to create the new column.
>
> This is how I am using it:
>
> slonik_execute_script 1 /root/script.sql
>
> After I execute the script this message is shown:
>
> cluster name = replication;
> node 1 admin conninfo='host=192.168.20.144 dbname=nomina user=pgsql 
> port=5432';
> node 2 admin conninfo='host=192.168.20.210 dbname=nomina user=pgsql 
> port=5432;
>   execute script (
>     set id = 1,
>     filename = '/tmp/EpbvGiNpWb',
>     event node = 1
>   );
>
> script.sql contains:  ALTER TABLE personas ADD COLUMN prueba integer;
>
> However, nothing happens on the master or slave.
>
> Could you please, tell me what Im doing wrong?.
>

You forgot to send the slonik script to slonik. IOW:

slonik_execute_script 1 /root/script.sql | slonik


-- 
Guillaume
http://blog.guillaume.lelarge.info
http://www.dalibo.com


From vivek at khera.org  Wed Jul  4 12:39:08 2012
From: vivek at khera.org (Vick Khera)
Date: Wed, 4 Jul 2012 15:39:08 -0400
Subject: [Slony1-general] slonik_execute_script not working
In-Reply-To: <485368C10B2A274EABE47136B8AFCA1223FC6B70@X-MB11.xds.umail.utah.edu>
References: <D7367DEE330645D8B0648399EA517120@CMOTUM25PC>
	<485368C10B2A274EABE47136B8AFCA1223FC6B70@X-MB11.xds.umail.utah.edu>
Message-ID: <CALd+dcd3MfdYJzOBPgV2zQVXafpg2-RRVVLpmtyrUYdNS2qZfw@mail.gmail.com>

On Mon, Jul 2, 2012 at 3:29 PM, Wolf Schwurack <wolf at uen.org> wrote:

> You can not run DDL statement using slony, it states that in slony docs
>

Where? That's the only safe way to perform DDL on a replicated table.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.slony.info/pipermail/slony1-general/attachments/20120704/6843db58/attachment.htm 

