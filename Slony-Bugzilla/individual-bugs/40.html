<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                      "http://www.w3.org/TR/html4/loose.dtd">
<html>
  <head>
    <title>Bug 40 &ndash; libpq thread test insufficient</title>


<link rel="Top" href="http://www.slony.info/bugzilla/">

  

  


  
    <link rel="Show" title="Dependency Tree"
          href="showdependencytree.cgi?id=40&amp;hide_resolved=1">
      <link rel="Show" title="Dependency Graph"
            href="showdependencygraph.cgi?id=40">


      <link rel="Show" title="Bug Activity"
            href="show_activity.cgi?id=40">
      <link rel="Show" title="Printer-Friendly Version"
            href="show_bug.cgi?format=multiple&amp;id=40">


    

    
      <link href="skins/standard/global.css"
            rel="stylesheet"
            type="text/css">
      <link href="skins/standard/yui/calendar.css"
            rel="stylesheet"
            type="text/css">
      <link href="skins/standard/show_bug.css"
            rel="stylesheet"
            type="text/css">
    <!--[if lte IE 7]>
      
      <link href="skins/standard/IE-fixes.css"
            rel="stylesheet"
            type="text/css">
    <![endif]-->

    
        <link href="skins/standard/global.css"
              rel="stylesheet"
              title="Classic"
              type="text/css">
        <link href="skins/standard/yui/calendar.css"
              rel="stylesheet"
              title="Classic"
              type="text/css">
        <link href="skins/standard/show_bug.css"
              rel="stylesheet"
              title="Classic"
              type="text/css">
      <!--[if lte IE 7]>
      
        <link href="skins/standard/IE-fixes.css"
              rel="stylesheet"
              title="Classic"
              type="text/css">
      <![endif]-->

    
        
            <link href="skins/contrib/Dusk/global.css"
                  rel="alternate stylesheet"
                  title="Dusk"
                  type="text/css">
            <link href="skins/contrib/Dusk/yui/calendar.css"
                  rel="alternate stylesheet"
                  title="Dusk"
                  type="text/css">
            <link href="skins/contrib/Dusk/show_bug.css"
                  rel="alternate stylesheet"
                  title="Dusk"
                  type="text/css">
        <!--[if lte IE 7]>
          
          <link href="skins/contrib/Dusk/IE-fixes.css"
                rel="alternate stylesheet"
                title="Dusk"
                type="text/css">
        <![endif]-->

    

    
        <link href="skins/custom/global.css" rel="stylesheet" type="text/css">
        <link href="skins/custom/yui/calendar.css" rel="stylesheet" type="text/css">
        <link href="skins/custom/show_bug.css" rel="stylesheet" type="text/css">
    <!--[if lte IE 7]>
      
      <link href="skins/custom/IE-fixes.css"
            rel="stylesheet"
            type="text/css">
    <![endif]-->

    <script src="js/yui/yahoo-dom-event.js" type="text/javascript"></script>
    <script src="js/global.js" type="text/javascript"></script>
    <script type="text/javascript">
    <!--
        YAHOO.namespace('bugzilla');
        if (YAHOO.env.ua.gecko) {
            YAHOO.util.Event._simpleRemove(window, "unload", 
                                           YAHOO.util.Event._unload);
        }
        
        var BUGZILLA = {
            param: {
                cookiepath: '\/'
            }
        };
    // -->
    </script>

        <script src="js/util.js" type="text/javascript"></script>
        <script src="js/field.js" type="text/javascript"></script>
        <script src="js/yui/calendar.js" type="text/javascript"></script>

    

    
    <link rel="search" type="application/opensearchdescription+xml"
                       title="Bugzilla" href="./search_plugin.cgi">
    <link rel="shortcut icon" href="images/favicon.ico" >
  </head>



  <body onload=""
        class="www-slony-info-bugzilla bz_bug bz_status_RESOLVED bz_product_Slony-I bz_component_slon bz_bug_40">



<div id="header">
<div id="banner">
  </div>

<table border="0" cellspacing="0" cellpadding="0" id="titles">
<tr>
    <td id="title">
      <p>Bugzilla &ndash; Bug&nbsp;40</p>
    </td>

    <td id="subtitle">
      <p class="subheader">libpq thread test insufficient</p>
    </td>

    <td id="information">
      <p class="header_addl_info">Last modified: 2010-09-13 13:42:56 PDT</p>
    </td>
</tr>
</table>
<ul class="links">
  <li><a href="./">Home</a></li>
  <li><span class="separator">| </span><a href="enter_bug.cgi">New</a></li>
  <li><span class="separator">| </span><a href="query.cgi">Search</a></li>

  <li class="form">
    <span class="separator">| </span>
    <form action="buglist.cgi" method="get"
        onsubmit="if (this.quicksearch.value == '')
                  { alert('Please enter one or more search terms first.');
                    return false; } return true;">
    <input class="txt" type="text" id="quicksearch_top" name="quicksearch">
    <input class="btn" type="submit" value="Find" id="find_top"></form></li>

  <li><span class="separator">| </span><a href="report.cgi">Reports</a></li>

  <li></li>


  <li>
        <span class="separator">| </span>
        <a href="docs/en/html/bug_page.html" target="_blank">Help</a>
      </li>
    
      <li id="new_account_container_top">
        <span class="separator">| </span>
        <a href="createaccount.cgi">New&nbsp;Account</a>
      </li>

    <li id="mini_login_container_top">
  <span class="separator">| </span>
  <a id="login_link_top" href="?GoAheadAndLogIn=1"
     onclick="return show_mini_login_form('_top')">Log In</a>
  <form action="http://www.slony.info/bugzilla/show_bug.cgi?id=40" method="POST" 
        class="mini_login bz_default_hidden"
        id="mini_login_top"
        onsubmit="return check_mini_login_fields( '_top' );"
  >
    <input id="Bugzilla_login_top" 
           class="bz_login"
           name="Bugzilla_login"
           onfocus="mini_login_on_focus('_top')"
    >
    <input class="bz_password" 
           id="Bugzilla_password_top" 
           name="Bugzilla_password"
           type="password"
    >
    <input class="bz_password bz_default_hidden bz_mini_login_help" type="text" 
           id="Bugzilla_password_dummy_top" value="password"
           onfocus="mini_login_on_focus('_top')"
    >
    <input type="submit" name="GoAheadAndLogIn" value="Log in" 
            id="log_in_top">
    <script type="text/javascript">
      mini_login_constants = {
          "login" : "login",
          "warning" : "You must set the login and password before logging in."
      };
      
      if (YAHOO.env.ua.gecko || YAHOO.env.ua.ie || YAHOO.env.ua.opera) {
          YAHOO.util.Event.onDOMReady(function() {
              init_mini_login_form('_top');
          });
      }
      else {
          YAHOO.util.Event.on(window, 'load', function () {
              window.setTimeout(function() {
                  init_mini_login_form('_top');
              }, 200);
          });
    }
    </script>
    <a href="#" onclick="return hide_mini_login_form('_top')">[x]</a>
  </form>
</li>
<li id="forgot_container_top">
  <span class="separator">| </span>
  <a id="forgot_link_top" href="?GoAheadAndLogIn=1#forgot"
     onclick="return show_forgot_form('_top')">Forgot Password</a>
  <form action="token.cgi" method="post" id="forgot_form_top"
        class="mini_forgot bz_default_hidden">
    <label>Login: <input type="text" name="loginname" size="20"></label>
    <input id="forgot_button_top" value="Reset Password" 
           type="submit">
    <input type="hidden" name="a" value="reqpw">
    <a href="#" onclick="return hide_forgot_form('_top')">[x]</a>
  </form>
</li>
</ul>

</div>

<div id="bugzilla-body">

<div class="navigation">
  
  
  <i><font color="#777777">First</font></i>
  <i><font color="#777777">Last</font></i>
  <i><font color="#777777">Prev</font></i>
  <i><font color="#777777">Next</font></i>
  &nbsp;&nbsp;
  <i><font color="#777777">No search results available</font></i>
</div>
<script type="text/javascript">
  <!--
  
  /* Outputs a link to call replyToComment(); used to reduce HTML output */
  function addReplyLink(id, real_id) {
      /* XXX this should really be updated to use the DOM Core's
       * createElement, but finding a container isn't trivial.
       */
        document.write('[<a href="#add_comment" onclick="replyToComment(' + 
                       id + ',' + real_id + ');">reply<' + '/a>]');
  }

  /* Adds the reply text to the `comment' textarea */
  function replyToComment(id, real_id) {
      var prefix = "(In reply to comment #" + id + ")\n";
      var replytext = "";
        /* pre id="comment_name_N" */
        var text_elem = document.getElementById('comment_text_'+id);
        var text = getText(text_elem);

        /* make sure we split on all newlines -- IE or Moz use \r and \n
         * respectively.
         */
        text = text.split(/\r|\n/);

        for (var i=0; i < text.length; i++) {
            replytext += "> " + text[i] + "\n"; 
        }

        replytext = prefix + replytext + "\n";


      /* <textarea id="comment"> */
      var textarea = document.getElementById('comment');
      textarea.value += replytext;

      textarea.focus();
  }

  if (typeof Node == 'undefined') {
      /* MSIE doesn't define Node, so provide a compatibility object */
      window.Node = {
          TEXT_NODE: 3,
          ENTITY_REFERENCE_NODE: 5
      };
  }

  /* Concatenates all text from element's childNodes. This is used
   * instead of innerHTML because we want the actual text (and
   * innerText is non-standard).
   */
  function getText(element) {
      var child, text = "";
      for (var i=0; i < element.childNodes.length; i++) {
          child = element.childNodes[i];
          var type = child.nodeType;
          if (type == Node.TEXT_NODE || type == Node.ENTITY_REFERENCE_NODE) {
              text += child.nodeValue;
          } else {
              /* recurse into nodes of other types */
              text += getText(child);
          }
      }
      return text;
  }


  //-->
  </script>

<form name="changeform" method="post" action="process_bug.cgi">

  <input type="hidden" name="delta_ts" value="2010-09-13 13:42:56">
  <input type="hidden" name="longdesclength" value="27">
  <input type="hidden" name="id" value="40">
  <input type="hidden" name="token" value="1446871817-9bc51f862f25ceb0af85be146ab0cc5a">
<div class="bz_alias_short_desc_container edit_form">
     <a href="show_bug.cgi?id=40">
        <b>Bug&nbsp;40</b></a> - 
     <span id="summary_alias_container" class="bz_default_hidden"> 
      <span id="short_desc_nonedit_display">libpq thread test insufficient</span>
     </span>
  
       
    <div id="summary_alias_input">
      <table id="summary">  
        
        <tr>
          <td>
            <label accesskey="s" for="short_desc"><u>S</u>ummary</label>:
          </td>
          <td>libpq thread test insufficient
          </td>
        </tr>
      </table>
    </div>
  </div>
  <script type="text/javascript">
    hideAliasAndSummary('libpq thread test insufficient', '');
  </script>
  <table class="edit_form">
    <tr>
      
      <td id="bz_show_bug_column_1" class="bz_show_bug_column">     
        <table>
          <tr>
    <td class="field_label">
      <b><a href="page.cgi?id=fields.html#status">Status</a></b>:
    </td>
    <td id="bz_field_status">
      <span id="static_bug_status">RESOLVED
          FIXED
      </span>
    </td>
  </tr>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
          <tr>
<th class="field_label "
      id="field_label_product">
        <a href="describecomponents.cgi">Product:</a>
  </th>

<td class="field_value "
    id="field_container_product" >Slony-I</td>
    </tr>
        
    
    
    <tr>
      <td class="field_label">
        <label for="component" accesskey="m">
          <b><a href="describecomponents.cgi?product=Slony-I">
            Co<u>m</u>ponent</a>:
          </b>
        </label>
      </td><td>slon
  </td>
    </tr>
    <tr>
      <td class="field_label">
        <label for="version"><b>Version</b></label>:
      </td>
<td>2.0
  </td>
    </tr>
        
    
        
    <tr>
      <td class="field_label">
        <label for="rep_platform" accesskey="h"><b>Platform</b></label>:
      </td>
      <td class="field_value">All
       Linux
       <script type="text/javascript">
         assignToDefaultOnChange(['product', 'component']);
       </script>
      </td>
    </tr>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
          
          <tr>
      <td class="field_label">
        <label for="priority" accesskey="i">
          <b><a href="page.cgi?id=fields.html#importance"><u>I</u>mportance</a></b></label>:
      </td>
      <td>high
       normal
      </td>
    </tr>            
          
          <tr>
      <td class="field_label">
        <b><a href="page.cgi?id=fields.html#assigned_to">Assigned To</a></b>:
      </td>
      <td><span class="vcard"><span class="fn">Christopher Browne</span>
</span>
      </td>
    </tr>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
          <tr>
    <td class="field_label">
      <label for="bug_file_loc" accesskey="u"><b>
          <u>U</u>RL</b></label>:
    </td>
    <td>
      <span id="bz_url_input_area">
          <a href=""></a>
      </span>
    </td>
  </tr>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
          
          <tr><th class="field_label">
    <label for="dependson">Depends&nbsp;on</label>:
  </th>
  <td>    
    <span id="dependson_input_area">
    </span>
    
  </td>
  </tr>
  
  <tr><th class="field_label">
    <label for="blocked" accesskey="b"><u>B</u>locks</label>:
  </th>
  <td>    
    <span id="blocked_input_area">
    </span>
    
  </td>
  
  <tr>
    <th>&nbsp;</th>
  
    <td colspan="2" align="left" id="show_dependency_tree_or_graph">
      Show dependency <a href="showdependencytree.cgi?id=40&amp;hide_resolved=1">tree</a>
  
        /&nbsp;<a href="showdependencygraph.cgi?id=40">graph</a>
    </td>
  </tr>
          
        </table>
      </td>
      <td>
        <div class="bz_column_spacer">&nbsp;</div>
      </td>
      
      <td id="bz_show_bug_column_2" class="bz_show_bug_column">
        <table cellpadding="3" cellspacing="1">
        <tr>
    <td class="field_label">
      <b>Reported</b>:
    </td>
    <td>2008-03-10 07:24 PDT by <span class="vcard"><span class="fn">Peter Eisentraut</span>
</span>
    </td>
  </tr>
  
  <tr>
    <td class="field_label">
      <b> Modified</b>:
    </td>
    <td>2010-09-13 13:42 PDT 
      (<a href="show_activity.cgi?id=40">History</a>)
    </td>
  
  </tr>
         <tr>
      <td class="field_label">
        <label for="newcc" accesskey="a"><b>CC List</b>:</label>
      </td>
      <td>1 
          user
        <span id="cc_edit_area_showhide_container" class="bz_default_hidden">
          (<a href="#" id="cc_edit_area_showhide">show</a>)
        </span>
        <div id="cc_edit_area">
          <br>
            <select id="cc" name="cc" multiple="multiple" size="5">
                <option value="slony1-bugs">slony1-bugs</option>
            </select>
        </div>
        <script type="text/javascript">
          hideEditableField( 'cc_edit_area_showhide_container', 
                             'cc_edit_area', 
                             'cc_edit_area_showhide', 
                             '', 
                             '');  
        </script>
      </td>
    </tr>
         <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
<tr><th class="field_label "
      id="field_label_see_also">
        <a href="page.cgi?id=fields.html#see_also">See Also:</a>
  </th>

<td class="field_value "
    id="field_container_see_also" ></td>
    </tr> 
         
         <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
         
                

        </table>
      </td>
    </tr>
    <tr>
      <td colspan="3">
          <hr id="bz_top_half_spacer">
      </td>
    </tr>
  </table>

  
  


<script type="text/javascript">
<!--
function toggle_display(link) {
    var table = document.getElementById("attachment_table");
    // Store current height for scrolling later
    var originalHeight = table.offsetHeight;
    var rows = YAHOO.util.Dom.getElementsByClassName(
        'bz_tr_obsolete', 'tr', table);

    for (var i = 0; i < rows.length; i++) {
        bz_toggleClass(rows[i], 'bz_default_hidden');
    }

    if (YAHOO.util.Dom.hasClass(rows[0], 'bz_default_hidden')) {
        link.innerHTML = "Show Obsolete";
    }
    else {
        link.innerHTML = "Hide Obsolete";
    }

    var newHeight = table.offsetHeight;
    // This scrolling makes the window appear to not move at all.
    window.scrollBy(0, newHeight - originalHeight);

    return false;
}
//-->
</script>

<br>
<table id="attachment_table" cellspacing="0" cellpadding="4">
  <tr>
    <th colspan="2" align="left">
      <a name="a0" id="a0">Attachments</a>
    </th>
  </tr>


      <tr class="">
        <td valign="top">
            <a name="a1" href="attachment.cgi?id=64"
               title="View the content of the attachment">
          <b>additional proposed patch</b></a>

          <span class="bz_attach_extra_info">
              (1.87 KB,
                patch)

            <br>
            <a href="#attach_64"
               title="Go to the comment associated with the attachment">2010-09-07 15:34 PDT</a>,
<span class="vcard"><span class="fn">Steve Singer</span>
</span>
          </span>
        </td>


        <td valign="top">
          <a href="attachment.cgi?id=64&amp;action=edit">Details</a>
            | <a href="attachment.cgi?id=64&amp;action=diff">Diff</a>
        </td>
      </tr>
      <tr class="">
        <td valign="top">
            <a name="a2" href="attachment.cgi?id=65"
               title="View the content of the attachment">
          <b>Add a runtime check for libpq threading </b></a>

          <span class="bz_attach_extra_info">
              (868 bytes,
                patch)

            <br>
            <a href="#attach_65"
               title="Go to the comment associated with the attachment">2010-09-08 11:38 PDT</a>,
<span class="vcard"><span class="fn">Steve Singer</span>
</span>
          </span>
        </td>


        <td valign="top">
          <a href="attachment.cgi?id=65&amp;action=edit">Details</a>
            | <a href="attachment.cgi?id=65&amp;action=diff">Diff</a>
        </td>
      </tr>

  <tr class="bz_attach_footer">
    <td colspan="2">
        <span class="bz_attach_view_hide">
        </span>
      <a href="attachment.cgi?bugid=40&amp;action=enter">Add an attachment</a>
      (proposed patch, testcase, etc.)
    </td>
  </tr>
</table>
<br>




  <br>
  <table cellpadding="1" cellspacing="1">
    <tr>
      <td id="comment_status_commit">
        <!-- The table keeps the commit button aligned with the box. -->
        <a name="add_comment"></a>
          <fieldset>
            <legend>Note</legend>
            <p>
              You need to
              <a href="show_bug.cgi?id=40&amp;GoAheadAndLogIn=1">log in</a>
              before you can comment on or make changes to this bug.
            </p>
          </fieldset>
        
        <hr>
        <div id="comments"><script type="text/javascript">
  <!--
  function updateCommentPrivacy(checkbox, id) {
    var comment_elem = document.getElementById('comment_text_'+id).parentNode;
    if (checkbox.checked) {
      if (!comment_elem.className.match('bz_private')) {
        comment_elem.className = comment_elem.className.concat(' bz_private');
      }
    }
    else {
      comment_elem.className =
        comment_elem.className.replace(/(\s*|^)bz_private(\s*|$)/, '$2');
    }
  }

  /* The functions below expand and collapse comments  */

  function toggle_comment_display(link, comment_id) {
    var comment = document.getElementById('comment_text_' + comment_id);
    var re = new RegExp(/\bcollapsed\b/);
    if (comment.className.match(re))
        expand_comment(link, comment);
    else
        collapse_comment(link, comment);
  }

  function toggle_all_comments(action) {
    var num_comments = 27;

    // If for some given ID the comment doesn't exist, this doesn't mean
    // there are no more comments, but that the comment is private and
    // the user is not allowed to view it.

    for (var id = 0; id < num_comments; id++) {
        var comment = document.getElementById('comment_text_' + id);
        if (!comment)
            continue;

        var link = document.getElementById('comment_link_' + id);
        if (action == 'collapse')
            collapse_comment(link, comment);
        else
            expand_comment(link, comment);
    }
  }

  function collapse_comment(link, comment) {
    link.innerHTML = "[+]";
    link.title = "Expand the comment.";
    YAHOO.util.Dom.addClass(comment, 'collapsed');
  }

  function expand_comment(link, comment) {
    link.innerHTML = "[-]";
    link.title = "Collapse the comment";
    YAHOO.util.Dom.removeClass(comment, 'collapsed');
  }

  /* This way, we are sure that browsers which do not support JS
   * won't display this link  */

  function addCollapseLink(count) {
    document.write(' <a href="#" class="bz_collapse_comment"' +
                   ' id="comment_link_' + count +
                   '" onclick="toggle_comment_display(this, ' +  count +
                   '); return false;" title="Collapse the comment.">[-]<\/a> ');
  }
  //-->
  </script>








<div class="bz_comment bz_first_comment">

      <div class="bz_first_comment_head">



        <span class="bz_comment_number">
          <a name="c0" 
             href="show_bug.cgi?id=40#c0">Description</a>
        </span>

        <span class="bz_comment_user"><span class="vcard"><span class="fn">Peter Eisentraut</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2008-03-10 07:24:48 PDT
        </span>
      </div>



<pre class="bz_comment_text" >config/acx_libpq.m4 is apparently of the opinion that it only needs to verify
that libpq is compiled thread-safely on aix, mingw, and solaris.  I think that
is insufficient.  I have found a posting about this on the mailing list:

&quot;&quot;&quot;
Date: Donnerstag, Juni 14, 2007 11:26:04 -0400
From: Andrew Sullivan &lt;<a href="mailto:ajs@crankycanuck.ca">ajs@crankycanuck.ca</a>&gt;
To: <a href="mailto:slony1-general@gborg.postgresql.org">slony1-general@gborg.postgresql.org</a>
Cc:
Subject: Re: [Slony1-general] idle in transaction on subscriber

On Thu, Jun 14, 2007 at 04:19:20PM +0200, Jacques Caron wrote:
<span class="quote">&gt; PostgreSQL library (libpq) was not compiled with
&gt; --enable-thread-safety, and this causes random breakage in slon. The</span >

You're not actually supposed to need to use that switch on platforms
where it's not checked, on the grounds that thread safety is _always_
on there.  What's your platform and compilier?  It may be that we
need more tests.
&quot;&quot;&quot;

It is definitely wrong to assume that platforms other than those listed have
thread-safety always enabled.  Linux is a counterexample.

I think it would be most prudent to require thread-safety on all platforms
except those where you have documented evidence that it is not necessary.  I
don't know any among the more common Unix-like platforms that would fit that
description, however.</pre>
    </div>
  <div class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a name="c1" 
             href="show_bug.cgi?id=40#c1">Comment 1</a>
        </span>

        <span class="bz_comment_user"><span class="vcard"><span class="fn">Christopher Browne</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2008-03-12 09:02:40 PDT
        </span>
      </div>



<pre class="bz_comment_text" >It may be insufficient, but there hasn't been a specific problem case reported
yet.

If someone discovers that [Platform X] requires threading enabled, we can in
the short term tell them they need that, and add that platform to the list that
we know about.

I don't see particular value in pursuing this theoretical insufficiency when it
is something that may be fairly easily addressed.</pre>
    </div>
  <div class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a name="c2" 
             href="show_bug.cgi?id=40#c2">Comment 2</a>
        </span>

        <span class="bz_comment_user"><span class="vcard"><span class="fn">Jan Wieck</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2010-06-02 12:23:18 PDT
        </span>
      </div>



<pre class="bz_comment_text" >We will enable this for 2.0 as soon as the 2.0.4 release is out.</pre>
    </div>
  <div class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a name="c3" 
             href="show_bug.cgi?id=40#c3">Comment 3</a>
        </span>

        <span class="bz_comment_user"><span class="vcard"><span class="fn">Christopher Browne</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2010-08-19 10:19:14 PDT
        </span>
      </div>



<pre class="bz_comment_text" >I have set up a branch (of REL_2_0_STABLE) for this:

<a href="http://github.com/cbbrowne/slony1-engine/commits/bug40">http://github.com/cbbrowne/slony1-engine/commits/bug40</a>

As per Peter's comments, I'm treating Linux as the only platform where we
assume that libpq is compiled thread-safely.  If there are other platforms
where that should be deemed to be the case, please let me know.</pre>
    </div>
  <div class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a name="c4" 
             href="show_bug.cgi?id=40#c4">Comment 4</a>
        </span>

        <span class="bz_comment_user"><span class="vcard"><span class="fn">Steve Singer</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2010-08-24 11:44:53 PDT
        </span>
      </div>



<pre class="bz_comment_text" >This seems  okay to me.
I'm taking it at someones word that Linux doesn't need --enable-thread-safety</pre>
    </div>
  <div class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a name="c5" 
             href="show_bug.cgi?id=40#c5">Comment 5</a>
        </span>

        <span class="bz_comment_user"><span class="vcard"><span class="fn">Peter Eisentraut</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2010-08-24 11:59:20 PDT
        </span>
      </div>



<pre class="bz_comment_text" >There is possibly some confusion here.  --enable-thread-safety always creates a
functionally different libpq on any platform.  And a libpq compiled without
that flag is not suitable for multithreaded applications on any platform.  At
least a glance at the source code indicates as much.  It might be that you
don't actually need the parts in question, but I'm not sure.

What you might be thinking of is that on some platforms (including Linux,
excluding BSD, I think), most/all libc functions are reentrant by default,
without the need for special compiler flags.  But that just means that the
--enable-thread-safety flag has to do less work, it doesn't make the entire
library thread-safe automatically.</pre>
    </div>
  <div class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a name="c6" 
             href="show_bug.cgi?id=40#c6">Comment 6</a>
        </span>

        <span class="bz_comment_user"><span class="vcard"><span class="fn">Jan Wieck</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2010-08-24 12:48:11 PDT
        </span>
      </div>



<pre class="bz_comment_text" >Correct, Peter.

Slony is multi threaded, but never do two threads use the same database
connection or any object derived there of. Maybe that is why it does work on
some platforms that don't actually produce a 100% thread safe libpq without
--enable-thread-safety.

What I would suggest is that we collect a slightly longer list of OS's, where
this is irrelevant for Slony and then make this a test with 3 possible
outcomes. Error out if --enable-thread-safety wasn't used where we know it
needs to be (aix, solaris), Don't care if it was (Linux, FreeBSD) and give a
WARNING for everything else.

This has IMHO time until 2.0.6</pre>
    </div>
  <div class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a name="c7" 
             href="show_bug.cgi?id=40#c7">Comment 7</a>
        </span>

        <span class="bz_comment_user"><span class="vcard"><span class="fn">Steve Singer</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2010-08-24 13:01:04 PDT
        </span>
      </div>



<pre class="bz_comment_text" >While slony does not have multiple threads using the same libpq connection it
does have multiple threads accessing libpq on different connections at the same
time.

Does this mean that we do need to be running with --enable-thread-saftey ?

I haven't looked very closely at the parts of libpq that change based on
ENABLE_THREAD_SAFETY and it looks like we do provide callbacks to openssl for
locking.   I suspect slony needs this on ALL platforms to be safe.

There have been reports I've seen of slony replication breaking over ssl
connections maybe this could have been related.

I think we should modify the patch to require slony to be built with a
threadsafe libpq on all platforms.</pre>
    </div>
  <div class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a name="c8" 
             href="show_bug.cgi?id=40#c8">Comment 8</a>
        </span>

        <span class="bz_comment_user"><span class="vcard"><span class="fn">Jan Wieck</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2010-08-24 13:04:12 PDT
        </span>
      </div>



<pre class="bz_comment_text" >After looking at some of the libpq code I have to agree with that.

This is a heavy handed change inside of a stable branch, but it looks safer.


Jan</pre>
    </div>
  <div class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a name="c9" 
             href="show_bug.cgi?id=40#c9">Comment 9</a>
        </span>

        <span class="bz_comment_user"><span class="vcard"><span class="fn">Christopher Browne</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2010-08-24 13:21:39 PDT
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to <a href="show_bug.cgi?id=40#c8">comment #8</a>)
<span class="quote">&gt; After looking at some of the libpq code I have to agree with that.
&gt; 
&gt; This is a heavy handed change inside of a stable branch, but it looks safer.</span >

I have updated the patch to be &quot;more heavy handed.&quot;

<a href="http://github.com/cbbrowne/slony1-engine/commit/f9a90879df8ce4764cbdcc380c1dd8e7a5623dae">http://github.com/cbbrowne/slony1-engine/commit/f9a90879df8ce4764cbdcc380c1dd8e7a5623dae</a>

I'd be concerned that this may adversely affect folks on Linux, in the scenario
where we're requiring &quot;ETS&quot; which then requires people to rebuild packages.

- I took a peek at Debian, and the pg_config there does indicate
--enable-thread-safety, so it should be safe-ish.

- Ubuntu derives from Debian, and the Ubuntu instance I have handy does &quot;ETS&quot;
too.

I don't have Fedora, RHAS/RHES, SuSE handy to me.</pre>
    </div>
  <div class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a name="c10" 
             href="show_bug.cgi?id=40#c10">Comment 10</a>
        </span>

        <span class="bz_comment_user"><span class="vcard"><span class="fn">Christopher Browne</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2010-08-24 15:28:25 PDT
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to <a href="show_bug.cgi?id=40#c9">comment #9</a>)
<span class="quote">&gt; - I took a peek at Debian, and the pg_config there does indicate
&gt; --enable-thread-safety, so it should be safe-ish.
&gt; 
&gt; - Ubuntu derives from Debian, and the Ubuntu instance I have handy does &quot;ETS&quot;
&gt; too.</span >

Note: Jan took a look at FreeBSD, and found that Ports indicates ETS, so
FreeBSD shouldn't be adversely affected.</pre>
    </div>
  <div class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a name="c11" 
             href="show_bug.cgi?id=40#c11">Comment 11</a>
        </span>

        <span class="bz_comment_user"><span class="vcard"><span class="fn">Steve Singer</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2010-08-25 11:19:10 PDT
        </span>
      </div>



<pre class="bz_comment_text" >Conclusion: Go!</pre>
    </div>
  <div class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a name="c12" 
             href="show_bug.cgi?id=40#c12">Comment 12</a>
        </span>

        <span class="bz_comment_user"><span class="vcard"><span class="fn">Christopher Browne</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2010-08-25 12:48:19 PDT
        </span>
      </div>



<pre class="bz_comment_text" >Here is the patch that I propose to put into 2.0/HEAD:

<a href="http://github.com/cbbrowne/slony1-engine/commit/7e74997c0f8427c08c2885de2a3218ca333da632">http://github.com/cbbrowne/slony1-engine/commit/7e74997c0f8427c08c2885de2a3218ca333da632</a>

Please verify, and pass back to me.</pre>
    </div>
  <div class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a name="c13" 
             href="show_bug.cgi?id=40#c13">Comment 13</a>
        </span>

        <span class="bz_comment_user"><span class="vcard"><span class="fn">Peter Eisentraut</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2010-08-27 13:25:02 PDT
        </span>
      </div>



<pre class="bz_comment_text" >--enable-thread-safety is the default in PG 9.0, so it might be enabled even
though you don't see the option in `pg_config --configure`.</pre>
    </div>
  <div class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a name="c14" 
             href="show_bug.cgi?id=40#c14">Comment 14</a>
        </span>

        <span class="bz_comment_user"><span class="vcard"><span class="fn">Steve Singer</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2010-08-30 07:35:49 PDT
        </span>
      </div>



<pre class="bz_comment_text" >Chris,

Per Peter's comment, the patch fails when we try to build against a 9.0 with
default(ish) options to ./configure (for postgres) even though PG is built with
threading.

What I think we need to do is have configure compile up a program that links
against libpq and calls 
int PQisthreadsafe();
and make sure the return code is 1.</pre>
    </div>
  <div class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a name="c15" 
             href="show_bug.cgi?id=40#c15">Comment 15</a>
        </span>

        <span class="bz_comment_user"><span class="vcard"><span class="fn">Christopher Browne</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2010-08-30 09:36:10 PDT
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to <a href="show_bug.cgi?id=40#c14">comment #14</a>)
<span class="quote">&gt; Chris,
&gt; 
&gt; Per Peter's comment, the patch fails when we try to build against a 9.0 with
&gt; default(ish) options to ./configure (for postgres) even though PG is built with
&gt; threading.
&gt; 
&gt; What I think we need to do is have configure compile up a program that links
&gt; against libpq and calls 
&gt; int PQisthreadsafe();
&gt; and make sure the return code is 1.</span >

OK, I have added a test that seems to work.

<a href="http://github.com/cbbrowne/slony1-engine/commit/99507a92d54063d038ef572bcfe78916f589886d">http://github.com/cbbrowne/slony1-engine/commit/99507a92d54063d038ef572bcfe78916f589886d</a>

I do a bit of trickery with LIBS, which I don't particularly like.

The test is certainly open to improvement.</pre>
    </div>
  <div class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a name="c16" 
             href="show_bug.cgi?id=40#c16">Comment 16</a>
        </span>

        <span class="bz_comment_user"><span class="vcard"><span class="fn">Jan Wieck</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2010-08-30 10:30:22 PDT
        </span>
      </div>



<pre class="bz_comment_text" >We need to make sure that this test is building the test program against the
libpq-fe that is pointed out by pg_config. Other than that, asking the library
itself is IMHO the right thing.</pre>
    </div>
  <div class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a name="c17" 
             href="show_bug.cgi?id=40#c17">Comment 17</a>
        </span>

        <span class="bz_comment_user"><span class="vcard"><span class="fn">Christopher Browne</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2010-08-30 11:52:38 PDT
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to <a href="show_bug.cgi?id=40#c16">comment #16</a>)
<span class="quote">&gt; We need to make sure that this test is building the test program against the
&gt; libpq-fe that is pointed out by pg_config. Other than that, asking the library
&gt; itself is IMHO the right thing.</span >

Yes, we surely are.  The values of LIBS and such are used; extracting from
config.log, for my install:

configure:5523: checking PostgreSQL for thread-safety
configure:5545: gcc -o conftest -g -O2 
-I/var/lib/postgresql/dbs/postgresql-8.4/include/
-I/var/lib/postgresql/dbs/postgresql-8.4/include/server/ 
-L/var/lib/postgresql/dbs/postgresql-8.4/lib/ conftest.c  -lpq &gt;&amp;5</pre>
    </div>
  <div class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a name="c18" 
             href="show_bug.cgi?id=40#c18">Comment 18</a>
        </span>

        <span class="bz_comment_user"><span class="vcard"><span class="fn">Steve Singer</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2010-08-30 12:17:36 PDT
        </span>
      </div>



<pre class="bz_comment_text" >I've tested this on AIX and the patch seems to behave as expected.

On linux when i compile with --disable-thread-safety it still 'seems' to give
me a libpq that has thread safety enabled.  Maybe this is where the 'ignore on
linux' behaviour we previously in the check came from?</pre>
    </div>
  <div class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a name="c19" 
             href="show_bug.cgi?id=40#c19">Comment 19</a>
        </span>

        <span class="bz_comment_user"><span class="vcard"><span class="fn">Christopher Browne</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2010-08-30 12:32:57 PDT
        </span>
      </div>



<pre class="bz_comment_text" >Applied to HEAD and 2.0

Version 2.0_STABLE:

<a href="http://git.postgresql.org/gitweb?p=slony1-engine.git;a=commit;h=d747d9c97beeace62a1798e9b81807ca5727de3c">http://git.postgresql.org/gitweb?p=slony1-engine.git;a=commit;h=d747d9c97beeace62a1798e9b81807ca5727de3c</a>

HEAD:

<a href="http://git.postgresql.org/gitweb?p=slony1-engine.git;a=commit;h=ce8854ccb0c21ff50cc957000f0775d2afdc051d">http://git.postgresql.org/gitweb?p=slony1-engine.git;a=commit;h=ce8854ccb0c21ff50cc957000f0775d2afdc051d</a></pre>
    </div>
  <div class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a name="c20" 
             href="show_bug.cgi?id=40#c20">Comment 20</a>
        </span>

        <span class="bz_comment_user"><span class="vcard"><span class="fn">Steve Singer</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2010-09-07 15:32:48 PDT
        </span>
      </div>



<pre class="bz_comment_text" >I am reopening this.

If libpq isn't installed in a system path (ie /usr/lib) then the configure time
check fails.  Furthermore while it links against the correct libpq at runtime
it might pick up the wrong libpq.

Patch proposed at
<a href="http://github.com/ssinger/slony1-engine/commit/aeeaae2692930536961e3fe013a0ac7f14cd91a4">http://github.com/ssinger/slony1-engine/commit/aeeaae2692930536961e3fe013a0ac7f14cd91a4</a></pre>
    </div>
  <div class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a name="c21" 
             href="show_bug.cgi?id=40#c21">Comment 21</a>
        </span>

        <span class="bz_comment_user"><span class="vcard"><span class="fn">Steve Singer</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2010-09-07 15:34:37 PDT
        </span>
      </div>



<pre class="bz_comment_text" ><span class=""><a href="attachment.cgi?id=64" name="attach_64" title="additional proposed patch">Created an attachment (id=64)</a> <a href="attachment.cgi?id=64&amp;action=edit" title="additional proposed patch">[details]</a></span>
additional proposed patch

A proposed patch to get the test program to find the correct libpq at test
runtime</pre>
    </div>
  <div class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a name="c22" 
             href="show_bug.cgi?id=40#c22">Comment 22</a>
        </span>

        <span class="bz_comment_user"><span class="vcard"><span class="fn">Jan Wieck</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2010-09-08 11:16:02 PDT
        </span>
      </div>



<pre class="bz_comment_text" >This all leads me to think that a test during the startup of slon itself to
double check that it isn't using the &quot;wrong&quot; libpq at runtime would be a good
idea too.</pre>
    </div>
  <div class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a name="c23" 
             href="show_bug.cgi?id=40#c23">Comment 23</a>
        </span>

        <span class="bz_comment_user"><span class="vcard"><span class="fn">Steve Singer</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2010-09-08 11:38:41 PDT
        </span>
      </div>



<pre class="bz_comment_text" ><span class=""><a href="attachment.cgi?id=65" name="attach_65" title="Add a runtime check for libpq threading">Created an attachment (id=65)</a> <a href="attachment.cgi?id=65&amp;action=edit" title="Add a runtime check for libpq threading">[details]</a></span>
Add a runtime check for libpq threading</pre>
    </div>
  <div class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a name="c24" 
             href="show_bug.cgi?id=40#c24">Comment 24</a>
        </span>

        <span class="bz_comment_user"><span class="vcard"><span class="fn">Steve Singer</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2010-09-08 11:39:28 PDT
        </span>
      </div>



<pre class="bz_comment_text" >A patch to do the runtime check is attached and available at 
<a href="http://github.com/ssinger/slony1-engine/commit/e7959571d8975414e05a19acdcefdd20683c1014">http://github.com/ssinger/slony1-engine/commit/e7959571d8975414e05a19acdcefdd20683c1014</a></pre>
    </div>
  <div class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a name="c25" 
             href="show_bug.cgi?id=40#c25">Comment 25</a>
        </span>

        <span class="bz_comment_user"><span class="vcard"><span class="fn">Christopher Browne</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2010-09-08 11:59:40 PDT
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to <a href="show_bug.cgi?id=40#c24">comment #24</a>)
<span class="quote">&gt; A patch to do the runtime check is attached and available at 
&gt; <a href="http://github.com/ssinger/slony1-engine/commit/e7959571d8975414e05a19acdcefdd20683c1014">http://github.com/ssinger/slony1-engine/commit/e7959571d8975414e05a19acdcefdd20683c1014</a></span >

I like the idea...  I don't think we need to prescribe --enable-thread-safety,
just to mention that is what frequently is lacking.

This patch changes your messages a bit.

<a href="http://github.com/cbbrowne/slony1-engine/commit/3d40cceaf6fd442fa3653c85616f542f4a1f3d96">http://github.com/cbbrowne/slony1-engine/commit/3d40cceaf6fd442fa3653c85616f542f4a1f3d96</a></pre>
    </div>
  <div class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a name="c26" 
             href="show_bug.cgi?id=40#c26">Comment 26</a>
        </span>

        <span class="bz_comment_user"><span class="vcard"><span class="fn">Steve Singer</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2010-09-13 13:42:56 PDT
        </span>
      </div>



<pre class="bz_comment_text" >Fix applied
2ee266a20be37964b6aa0df1554a0b5998fbba4a</pre>
    </div>
        </div>
        
      </td>
    </tr>
  </table>
</form>

<hr>
<ul class="related_actions">
    <li><a href="show_bug.cgi?format=multiple&amp;id=40">Format For Printing</a></li>
    <li>&nbsp;-&nbsp;<a href="show_bug.cgi?ctype=xml&amp;id=40">XML</a></li>
    <li>&nbsp;-&nbsp;<a href="enter_bug.cgi?cloned_bug_id=40">Clone This Bug</a></li>
    
    <li>&nbsp;-&nbsp;<a href="#">Top of page </a></li>
    </ul>        


<div class="navigation">
  
  
  <i><font color="#777777">First</font></i>
  <i><font color="#777777">Last</font></i>
  <i><font color="#777777">Prev</font></i>
  <i><font color="#777777">Next</font></i>
  &nbsp;&nbsp;
  <i><font color="#777777">No search results available</font></i>
</div>

<br>
</div>



<div id="footer">
  <div class="intro"></div>




<ul id="useful-links">
  <li id="links-actions"><ul class="links">
  <li><a href="./">Home</a></li>
  <li><span class="separator">| </span><a href="enter_bug.cgi">New</a></li>
  <li><span class="separator">| </span><a href="query.cgi">Search</a></li>

  <li class="form">
    <span class="separator">| </span>
    <form action="buglist.cgi" method="get"
        onsubmit="if (this.quicksearch.value == '')
                  { alert('Please enter one or more search terms first.');
                    return false; } return true;">
    <input class="txt" type="text" id="quicksearch_bottom" name="quicksearch">
    <input class="btn" type="submit" value="Find" id="find_bottom"></form></li>

  <li><span class="separator">| </span><a href="report.cgi">Reports</a></li>

  <li></li>


  <li>
        <span class="separator">| </span>
        <a href="docs/en/html/bug_page.html" target="_blank">Help</a>
      </li>
    
      <li id="new_account_container_bottom">
        <span class="separator">| </span>
        <a href="createaccount.cgi">New&nbsp;Account</a>
      </li>

    <li id="mini_login_container_bottom">
  <span class="separator">| </span>
  <a id="login_link_bottom" href="?GoAheadAndLogIn=1"
     onclick="return show_mini_login_form('_bottom')">Log In</a>
  <form action="http://www.slony.info/bugzilla/show_bug.cgi?id=40" method="POST" 
        class="mini_login bz_default_hidden"
        id="mini_login_bottom"
        onsubmit="return check_mini_login_fields( '_bottom' );"
  >
    <input id="Bugzilla_login_bottom" 
           class="bz_login"
           name="Bugzilla_login"
           onfocus="mini_login_on_focus('_bottom')"
    >
    <input class="bz_password" 
           id="Bugzilla_password_bottom" 
           name="Bugzilla_password"
           type="password"
    >
    <input class="bz_password bz_default_hidden bz_mini_login_help" type="text" 
           id="Bugzilla_password_dummy_bottom" value="password"
           onfocus="mini_login_on_focus('_bottom')"
    >
    <input type="submit" name="GoAheadAndLogIn" value="Log in" 
            id="log_in_bottom">
    <script type="text/javascript">
      mini_login_constants = {
          "login" : "login",
          "warning" : "You must set the login and password before logging in."
      };
      
      if (YAHOO.env.ua.gecko || YAHOO.env.ua.ie || YAHOO.env.ua.opera) {
          YAHOO.util.Event.onDOMReady(function() {
              init_mini_login_form('_bottom');
          });
      }
      else {
          YAHOO.util.Event.on(window, 'load', function () {
              window.setTimeout(function() {
                  init_mini_login_form('_bottom');
              }, 200);
          });
    }
    </script>
    <a href="#" onclick="return hide_mini_login_form('_bottom')">[x]</a>
  </form>
</li>
<li id="forgot_container_bottom">
  <span class="separator">| </span>
  <a id="forgot_link_bottom" href="?GoAheadAndLogIn=1#forgot"
     onclick="return show_forgot_form('_bottom')">Forgot Password</a>
  <form action="token.cgi" method="post" id="forgot_form_bottom"
        class="mini_forgot bz_default_hidden">
    <label>Login: <input type="text" name="loginname" size="20"></label>
    <input id="forgot_button_bottom" value="Reset Password" 
           type="submit">
    <input type="hidden" name="a" value="reqpw">
    <a href="#" onclick="return hide_forgot_form('_bottom')">[x]</a>
  </form>
</li>
</ul>
  </li>

  
    

  


  
</ul>

  <div class="outro"></div>
</div>

</body>
</html>