<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                      "http://www.w3.org/TR/html4/loose.dtd">
<html>
  <head>
    <title>Bug 327 &ndash; Sync failed right after initial copy</title>


<link rel="Top" href="http://www.slony.info/bugzilla/">

  

  


  
    <link rel="Show" title="Dependency Tree"
          href="showdependencytree.cgi?id=327&amp;hide_resolved=1">
      <link rel="Show" title="Dependency Graph"
            href="showdependencygraph.cgi?id=327">


      <link rel="Show" title="Bug Activity"
            href="show_activity.cgi?id=327">
      <link rel="Show" title="Printer-Friendly Version"
            href="show_bug.cgi?format=multiple&amp;id=327">


    

    
      <link href="skins/standard/global.css"
            rel="stylesheet"
            type="text/css">
      <link href="skins/standard/yui/calendar.css"
            rel="stylesheet"
            type="text/css">
      <link href="skins/standard/show_bug.css"
            rel="stylesheet"
            type="text/css">
    <!--[if lte IE 7]>
      
      <link href="skins/standard/IE-fixes.css"
            rel="stylesheet"
            type="text/css">
    <![endif]-->

    
        <link href="skins/standard/global.css"
              rel="stylesheet"
              title="Classic"
              type="text/css">
        <link href="skins/standard/yui/calendar.css"
              rel="stylesheet"
              title="Classic"
              type="text/css">
        <link href="skins/standard/show_bug.css"
              rel="stylesheet"
              title="Classic"
              type="text/css">
      <!--[if lte IE 7]>
      
        <link href="skins/standard/IE-fixes.css"
              rel="stylesheet"
              title="Classic"
              type="text/css">
      <![endif]-->

    
        
            <link href="skins/contrib/Dusk/global.css"
                  rel="alternate stylesheet"
                  title="Dusk"
                  type="text/css">
            <link href="skins/contrib/Dusk/yui/calendar.css"
                  rel="alternate stylesheet"
                  title="Dusk"
                  type="text/css">
            <link href="skins/contrib/Dusk/show_bug.css"
                  rel="alternate stylesheet"
                  title="Dusk"
                  type="text/css">
        <!--[if lte IE 7]>
          
          <link href="skins/contrib/Dusk/IE-fixes.css"
                rel="alternate stylesheet"
                title="Dusk"
                type="text/css">
        <![endif]-->

    

    
        <link href="skins/custom/global.css" rel="stylesheet" type="text/css">
        <link href="skins/custom/yui/calendar.css" rel="stylesheet" type="text/css">
        <link href="skins/custom/show_bug.css" rel="stylesheet" type="text/css">
    <!--[if lte IE 7]>
      
      <link href="skins/custom/IE-fixes.css"
            rel="stylesheet"
            type="text/css">
    <![endif]-->

    <script src="js/yui/yahoo-dom-event.js" type="text/javascript"></script>
    <script src="js/global.js" type="text/javascript"></script>
    <script type="text/javascript">
    <!--
        YAHOO.namespace('bugzilla');
        if (YAHOO.env.ua.gecko) {
            YAHOO.util.Event._simpleRemove(window, "unload", 
                                           YAHOO.util.Event._unload);
        }
        
        var BUGZILLA = {
            param: {
                cookiepath: '\/'
            }
        };
    // -->
    </script>

        <script src="js/util.js" type="text/javascript"></script>
        <script src="js/field.js" type="text/javascript"></script>
        <script src="js/yui/calendar.js" type="text/javascript"></script>

    

    
    <link rel="search" type="application/opensearchdescription+xml"
                       title="Bugzilla" href="./search_plugin.cgi">
    <link rel="shortcut icon" href="images/favicon.ico" >
  </head>



  <body onload=""
        class="www-slony-info-bugzilla bz_bug bz_status_RESOLVED bz_product_Slony-I bz_component_slon bz_bug_327">



<div id="header">
<div id="banner">
  </div>

<table border="0" cellspacing="0" cellpadding="0" id="titles">
<tr>
    <td id="title">
      <p>Bugzilla &ndash; Bug&nbsp;327</p>
    </td>

    <td id="subtitle">
      <p class="subheader">Sync failed right after initial copy</p>
    </td>

    <td id="information">
      <p class="header_addl_info">Last modified: 2014-02-13 05:17:01 PST</p>
    </td>
</tr>
</table>
<ul class="links">
  <li><a href="./">Home</a></li>
  <li><span class="separator">| </span><a href="enter_bug.cgi">New</a></li>
  <li><span class="separator">| </span><a href="query.cgi">Search</a></li>

  <li class="form">
    <span class="separator">| </span>
    <form action="buglist.cgi" method="get"
        onsubmit="if (this.quicksearch.value == '')
                  { alert('Please enter one or more search terms first.');
                    return false; } return true;">
    <input class="txt" type="text" id="quicksearch_top" name="quicksearch">
    <input class="btn" type="submit" value="Find" id="find_top"></form></li>

  <li><span class="separator">| </span><a href="report.cgi">Reports</a></li>

  <li></li>


  <li>
        <span class="separator">| </span>
        <a href="docs/en/html/bug_page.html" target="_blank">Help</a>
      </li>
    
      <li id="new_account_container_top">
        <span class="separator">| </span>
        <a href="createaccount.cgi">New&nbsp;Account</a>
      </li>

    <li id="mini_login_container_top">
  <span class="separator">| </span>
  <a id="login_link_top" href="?GoAheadAndLogIn=1"
     onclick="return show_mini_login_form('_top')">Log In</a>
  <form action="http://www.slony.info/bugzilla/show_bug.cgi?id=327" method="POST" 
        class="mini_login bz_default_hidden"
        id="mini_login_top"
        onsubmit="return check_mini_login_fields( '_top' );"
  >
    <input id="Bugzilla_login_top" 
           class="bz_login"
           name="Bugzilla_login"
           onfocus="mini_login_on_focus('_top')"
    >
    <input class="bz_password" 
           id="Bugzilla_password_top" 
           name="Bugzilla_password"
           type="password"
    >
    <input class="bz_password bz_default_hidden bz_mini_login_help" type="text" 
           id="Bugzilla_password_dummy_top" value="password"
           onfocus="mini_login_on_focus('_top')"
    >
    <input type="submit" name="GoAheadAndLogIn" value="Log in" 
            id="log_in_top">
    <script type="text/javascript">
      mini_login_constants = {
          "login" : "login",
          "warning" : "You must set the login and password before logging in."
      };
      
      if (YAHOO.env.ua.gecko || YAHOO.env.ua.ie || YAHOO.env.ua.opera) {
          YAHOO.util.Event.onDOMReady(function() {
              init_mini_login_form('_top');
          });
      }
      else {
          YAHOO.util.Event.on(window, 'load', function () {
              window.setTimeout(function() {
                  init_mini_login_form('_top');
              }, 200);
          });
    }
    </script>
    <a href="#" onclick="return hide_mini_login_form('_top')">[x]</a>
  </form>
</li>
<li id="forgot_container_top">
  <span class="separator">| </span>
  <a id="forgot_link_top" href="?GoAheadAndLogIn=1#forgot"
     onclick="return show_forgot_form('_top')">Forgot Password</a>
  <form action="token.cgi" method="post" id="forgot_form_top"
        class="mini_forgot bz_default_hidden">
    <label>Login: <input type="text" name="loginname" size="20"></label>
    <input id="forgot_button_top" value="Reset Password" 
           type="submit">
    <input type="hidden" name="a" value="reqpw">
    <a href="#" onclick="return hide_forgot_form('_top')">[x]</a>
  </form>
</li>
</ul>

</div>

<div id="bugzilla-body">

<div class="navigation">
  
  
  <i><font color="#777777">First</font></i>
  <i><font color="#777777">Last</font></i>
  <i><font color="#777777">Prev</font></i>
  <i><font color="#777777">Next</font></i>
  &nbsp;&nbsp;
  <i><font color="#777777">No search results available</font></i>
</div>
<script type="text/javascript">
  <!--
  
  /* Outputs a link to call replyToComment(); used to reduce HTML output */
  function addReplyLink(id, real_id) {
      /* XXX this should really be updated to use the DOM Core's
       * createElement, but finding a container isn't trivial.
       */
        document.write('[<a href="#add_comment" onclick="replyToComment(' + 
                       id + ',' + real_id + ');">reply<' + '/a>]');
  }

  /* Adds the reply text to the `comment' textarea */
  function replyToComment(id, real_id) {
      var prefix = "(In reply to comment #" + id + ")\n";
      var replytext = "";
        /* pre id="comment_name_N" */
        var text_elem = document.getElementById('comment_text_'+id);
        var text = getText(text_elem);

        /* make sure we split on all newlines -- IE or Moz use \r and \n
         * respectively.
         */
        text = text.split(/\r|\n/);

        for (var i=0; i < text.length; i++) {
            replytext += "> " + text[i] + "\n"; 
        }

        replytext = prefix + replytext + "\n";


      /* <textarea id="comment"> */
      var textarea = document.getElementById('comment');
      textarea.value += replytext;

      textarea.focus();
  }

  if (typeof Node == 'undefined') {
      /* MSIE doesn't define Node, so provide a compatibility object */
      window.Node = {
          TEXT_NODE: 3,
          ENTITY_REFERENCE_NODE: 5
      };
  }

  /* Concatenates all text from element's childNodes. This is used
   * instead of innerHTML because we want the actual text (and
   * innerText is non-standard).
   */
  function getText(element) {
      var child, text = "";
      for (var i=0; i < element.childNodes.length; i++) {
          child = element.childNodes[i];
          var type = child.nodeType;
          if (type == Node.TEXT_NODE || type == Node.ENTITY_REFERENCE_NODE) {
              text += child.nodeValue;
          } else {
              /* recurse into nodes of other types */
              text += getText(child);
          }
      }
      return text;
  }


  //-->
  </script>

<form name="changeform" method="post" action="process_bug.cgi">

  <input type="hidden" name="delta_ts" value="2014-02-13 05:17:01">
  <input type="hidden" name="longdesclength" value="8">
  <input type="hidden" name="id" value="327">
  <input type="hidden" name="token" value="1483479752-3e85cc6cbb309a797c9bfdaec891f5ae">
<div class="bz_alias_short_desc_container edit_form">
     <a href="show_bug.cgi?id=327">
        <b>Bug&nbsp;327</b></a> - 
     <span id="summary_alias_container" class="bz_default_hidden"> 
      <span id="short_desc_nonedit_display">Sync failed right after initial copy</span>
     </span>
  
       
    <div id="summary_alias_input">
      <table id="summary">  
        
        <tr>
          <td>
            <label accesskey="s" for="short_desc"><u>S</u>ummary</label>:
          </td>
          <td>Sync failed right after initial copy
          </td>
        </tr>
      </table>
    </div>
  </div>
  <script type="text/javascript">
    hideAliasAndSummary('Sync failed right after initial copy', '');
  </script>
  <table class="edit_form">
    <tr>
      
      <td id="bz_show_bug_column_1" class="bz_show_bug_column">     
        <table>
          <tr>
    <td class="field_label">
      <b><a href="page.cgi?id=fields.html#status">Status</a></b>:
    </td>
    <td id="bz_field_status">
      <span id="static_bug_status">RESOLVED
          FIXED
      </span>
    </td>
  </tr>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
          <tr>
<th class="field_label "
      id="field_label_product">
        <a href="describecomponents.cgi">Product:</a>
  </th>

<td class="field_value "
    id="field_container_product" >Slony-I</td>
    </tr>
        
    
    
    <tr>
      <td class="field_label">
        <label for="component" accesskey="m">
          <b><a href="describecomponents.cgi?product=Slony-I">
            Co<u>m</u>ponent</a>:
          </b>
        </label>
      </td><td>slon
  </td>
    </tr>
    <tr>
      <td class="field_label">
        <label for="version"><b>Version</b></label>:
      </td>
<td>2.0
  </td>
    </tr>
        
    
        
    <tr>
      <td class="field_label">
        <label for="rep_platform" accesskey="h"><b>Platform</b></label>:
      </td>
      <td class="field_value">PC
       Linux
       <script type="text/javascript">
         assignToDefaultOnChange(['product', 'component']);
       </script>
      </td>
    </tr>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
          
          <tr>
      <td class="field_label">
        <label for="priority" accesskey="i">
          <b><a href="page.cgi?id=fields.html#importance"><u>I</u>mportance</a></b></label>:
      </td>
      <td>urgent
       critical
      </td>
    </tr>            
          
          <tr>
      <td class="field_label">
        <b><a href="page.cgi?id=fields.html#assigned_to">Assigned To</a></b>:
      </td>
      <td><span class="vcard"><span class="fn">Jan Wieck</span>
</span>
      </td>
    </tr>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
          <tr>
    <td class="field_label">
      <label for="bug_file_loc" accesskey="u"><b>
          <u>U</u>RL</b></label>:
    </td>
    <td>
      <span id="bz_url_input_area">
          <a href=""></a>
      </span>
    </td>
  </tr>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
          
          <tr><th class="field_label">
    <label for="dependson">Depends&nbsp;on</label>:
  </th>
  <td>    
    <span id="dependson_input_area">
    </span>
    
  </td>
  </tr>
  
  <tr><th class="field_label">
    <label for="blocked" accesskey="b"><u>B</u>locks</label>:
  </th>
  <td>    
    <span id="blocked_input_area">
    </span>
    
  </td>
  
  <tr>
    <th>&nbsp;</th>
  
    <td colspan="2" align="left" id="show_dependency_tree_or_graph">
      Show dependency <a href="showdependencytree.cgi?id=327&amp;hide_resolved=1">tree</a>
  
        /&nbsp;<a href="showdependencygraph.cgi?id=327">graph</a>
    </td>
  </tr>
          
        </table>
      </td>
      <td>
        <div class="bz_column_spacer">&nbsp;</div>
      </td>
      
      <td id="bz_show_bug_column_2" class="bz_show_bug_column">
        <table cellpadding="3" cellspacing="1">
        <tr>
    <td class="field_label">
      <b>Reported</b>:
    </td>
    <td>2013-12-09 02:25 PST by <span class="vcard"><span class="fn">Timur</span>
</span>
    </td>
  </tr>
  
  <tr>
    <td class="field_label">
      <b> Modified</b>:
    </td>
    <td>2014-02-13 05:17 PST 
      (<a href="show_activity.cgi?id=327">History</a>)
    </td>
  
  </tr>
         <tr>
      <td class="field_label">
        <label for="newcc" accesskey="a"><b>CC List</b>:</label>
      </td>
      <td>2 
          users
        <span id="cc_edit_area_showhide_container" class="bz_default_hidden">
          (<a href="#" id="cc_edit_area_showhide">show</a>)
        </span>
        <div id="cc_edit_area">
          <br>
            <select id="cc" name="cc" multiple="multiple" size="5">
                <option value="slony1-bugs">slony1-bugs</option>
                <option value="vikram.rai">vikram.rai</option>
            </select>
        </div>
        <script type="text/javascript">
          hideEditableField( 'cc_edit_area_showhide_container', 
                             'cc_edit_area', 
                             'cc_edit_area_showhide', 
                             '', 
                             '');  
        </script>
      </td>
    </tr>
         <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
<tr><th class="field_label "
      id="field_label_see_also">
        <a href="page.cgi?id=fields.html#see_also">See Also:</a>
  </th>

<td class="field_value "
    id="field_container_see_also" ></td>
    </tr> 
         
         <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
         
                

        </table>
      </td>
    </tr>
    <tr>
      <td colspan="3">
          <hr id="bz_top_half_spacer">
      </td>
    </tr>
  </table>

  
  


<script type="text/javascript">
<!--
function toggle_display(link) {
    var table = document.getElementById("attachment_table");
    // Store current height for scrolling later
    var originalHeight = table.offsetHeight;
    var rows = YAHOO.util.Dom.getElementsByClassName(
        'bz_tr_obsolete', 'tr', table);

    for (var i = 0; i < rows.length; i++) {
        bz_toggleClass(rows[i], 'bz_default_hidden');
    }

    if (YAHOO.util.Dom.hasClass(rows[0], 'bz_default_hidden')) {
        link.innerHTML = "Show Obsolete";
    }
    else {
        link.innerHTML = "Hide Obsolete";
    }

    var newHeight = table.offsetHeight;
    // This scrolling makes the window appear to not move at all.
    window.scrollBy(0, newHeight - originalHeight);

    return false;
}
//-->
</script>

<br>
<table id="attachment_table" cellspacing="0" cellpadding="4">
  <tr>
    <th colspan="2" align="left">
      <a name="a0" id="a0">Attachments</a>
    </th>
  </tr>


      <tr class="">
        <td valign="top">
            <a name="a1" href="attachment.cgi?id=199"
               title="View the content of the attachment">
          <b>Proposed fix</b></a>

          <span class="bz_attach_extra_info">
              (964 bytes,
                patch)

            <br>
            <a href="#attach_199"
               title="Go to the comment associated with the attachment">2014-01-29 09:14 PST</a>,
<span class="vcard"><span class="fn">Jan Wieck</span>
</span>
          </span>
        </td>


        <td valign="top">
          <a href="attachment.cgi?id=199&amp;action=edit">Details</a>
            | <a href="attachment.cgi?id=199&amp;action=diff">Diff</a>
        </td>
      </tr>

  <tr class="bz_attach_footer">
    <td colspan="2">
        <span class="bz_attach_view_hide">
        </span>
      <a href="attachment.cgi?bugid=327&amp;action=enter">Add an attachment</a>
      (proposed patch, testcase, etc.)
    </td>
  </tr>
</table>
<br>




  <br>
  <table cellpadding="1" cellspacing="1">
    <tr>
      <td id="comment_status_commit">
        <!-- The table keeps the commit button aligned with the box. -->
        <a name="add_comment"></a>
          <fieldset>
            <legend>Note</legend>
            <p>
              You need to
              <a href="show_bug.cgi?id=327&amp;GoAheadAndLogIn=1">log in</a>
              before you can comment on or make changes to this bug.
            </p>
          </fieldset>
        
        <hr>
        <div id="comments"><script type="text/javascript">
  <!--
  function updateCommentPrivacy(checkbox, id) {
    var comment_elem = document.getElementById('comment_text_'+id).parentNode;
    if (checkbox.checked) {
      if (!comment_elem.className.match('bz_private')) {
        comment_elem.className = comment_elem.className.concat(' bz_private');
      }
    }
    else {
      comment_elem.className =
        comment_elem.className.replace(/(\s*|^)bz_private(\s*|$)/, '$2');
    }
  }

  /* The functions below expand and collapse comments  */

  function toggle_comment_display(link, comment_id) {
    var comment = document.getElementById('comment_text_' + comment_id);
    var re = new RegExp(/\bcollapsed\b/);
    if (comment.className.match(re))
        expand_comment(link, comment);
    else
        collapse_comment(link, comment);
  }

  function toggle_all_comments(action) {
    var num_comments = 8;

    // If for some given ID the comment doesn't exist, this doesn't mean
    // there are no more comments, but that the comment is private and
    // the user is not allowed to view it.

    for (var id = 0; id < num_comments; id++) {
        var comment = document.getElementById('comment_text_' + id);
        if (!comment)
            continue;

        var link = document.getElementById('comment_link_' + id);
        if (action == 'collapse')
            collapse_comment(link, comment);
        else
            expand_comment(link, comment);
    }
  }

  function collapse_comment(link, comment) {
    link.innerHTML = "[+]";
    link.title = "Expand the comment.";
    YAHOO.util.Dom.addClass(comment, 'collapsed');
  }

  function expand_comment(link, comment) {
    link.innerHTML = "[-]";
    link.title = "Collapse the comment";
    YAHOO.util.Dom.removeClass(comment, 'collapsed');
  }

  /* This way, we are sure that browsers which do not support JS
   * won't display this link  */

  function addCollapseLink(count) {
    document.write(' <a href="#" class="bz_collapse_comment"' +
                   ' id="comment_link_' + count +
                   '" onclick="toggle_comment_display(this, ' +  count +
                   '); return false;" title="Collapse the comment.">[-]<\/a> ');
  }
  //-->
  </script>








<div class="bz_comment bz_first_comment">

      <div class="bz_first_comment_head">



        <span class="bz_comment_number">
          <a name="c0" 
             href="show_bug.cgi?id=327#c0">Description</a>
        </span>

        <span class="bz_comment_user"><span class="vcard"><span class="fn">Timur</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2013-12-09 02:25:23 PST
        </span>
      </div>



<pre class="bz_comment_text" >HW/SW info:
Slony: v2.2.1
OS: CentOS release 6.4 (2.6.32-358.6.2.el6.x86_64)
DB: PostgreSQL 9.2.4

Details:
Sync failed right after initial copy. 
At first time, with &quot;omit copy = yes&quot; it failed with:

<span class="quote">&gt;&gt;&gt;&gt;</span >
2013-12-03 22:13:02 HKT ERROR  remoteWorkerThread_1: SYNC aborted
2013-12-03 22:13:12 HKT INFO   remoteWorkerThread_1: syncing set 18 with 219
table(s) from provider 1
2013-12-03 22:13:12 HKT ERROR  remoteWorkerThread_1_1: error at end of COPY IN:
ERROR:  invalid memory alloc request size 1869439327
CONTEXT:  COPY sl_log_2, line 949: &quot;1   1810515783      18203   27151   casino 
jackpot_contrib_summary U       1      
{contrib_amount_bc,4.317294024,summary_d...&quot;
2013-12-03 22:13:12 HKT ERROR  remoteWorkerThread_1_1: failed SYNC's log
selection query was  '
COPY (
select   log_origin, log_txid, NULL::integer, log_actionseq, NULL::text,
NULL::text, log_cmdtype, NULL::integer, log_cmdargs
from &quot;_cluster_casino&quot;.sl_log_script
where log_origin = 1 and log_txid &gt;=
&quot;pg_catalog&quot;.txid_snapshot_xmax('1810515020:1810515020:')
and log_txid &lt; '1810515860'
and &quot;pg_catalog&quot;.txid_visible_in_snapshot(log_txid, '1810515860:1810515860:')
union all
select log_origin, log_txid, NULL::integer, log_actionseq, NULL::text,
NULL::text, log_cmdtype, NULL::integer, log_cmdargs
from &quot;_cluster_casino&quot;.sl_log_script
where log_origin = 1 and log_txid in (select *
                                      from
&quot;pg_catalog&quot;.txid_snapshot_xip('1810515020:1810515020:')
                                      except select * from
&quot;pg_catalog&quot;.txid_snapshot_xip('1810515860:1810515860:') )
                                      union
                                      all select log_origin, log_txid,
log_tableid, log_actionseq, log_tablenspname, log_tablerelname, log_cmdtype,
log_cmdupdncols, log_cmdargs
                                      from &quot;_cluster_casino&quot;.sl_log_1
                                      where log_origin = 1
                                      and log_tableid in
(18229,18046,18058,18047,18048,18080,18104,18049,18050,18001,18002,18003,18005,18006,18007,18008,18009,18011,18012,18013,18010,18014,18015,
                                                        
18016,18017,18018,18019,18020,18021,18022,18023,18024,18025,18026,18030,18027,18028,18031,18032,18033,18034,18035,18036,18037,18038,18039,18040,
                                                        
18041,18042,18043,18044,18045,18051,18052,18053,18054,18055,18056,18057,18059,18060,18061,18062,18063,18064,18065,18066,18067,18068,18069,18070,
                                                        
18071,18072,18073,18074,18075,18076,18077,18078,18079,18081,18082,18083,18084,18085,18086,18087,18088,18089,18090,18091,18092,18093,18094,18095,
                                                        
18096,18097,18098,18099,18100,18101,18102,18103,18105,18106,18107,18110,18111,18112,18113,18114,18115,18116,18117,18118,18119,18120,18121,18122,
                                                        
18123,18124,18125,18126,18127,18128,18129,18130,18132,18135,18136,18137,18138,18139,18140,18141,18142,18143,18145,18146,18147,18148,18149,18150,
                                                        
18151,18152,18153,18154,18155,18156,18157,18158,18159,18160,18161,18162,18163,18164,18165,18166,18167,18168,18169,18170,18171,18172,18173,18174,
                                                        
18175,18176,18177,18178,18179,18180,18181,18182,18183,18184,18185,18186,18187,18189,18190,18191,18192,18193,18194,18195,18196,18197,18198,18199,
                                                        
18201,18202,18203,18204,18205,18206,18207,18208,18209,18210,18211,18212,18213,18214,18215,18216,18217,18218,18219,18220,18221,18222,18223,18224,
                                                        
18225,18226,18227,18228)
                                      and log_txid &gt;= '1810515020'
                                      and log_txid &lt; '1810515860'
                                      and
&quot;pg_catalog&quot;.txid_visible_in_snapshot(log_txid, '1810515860:1810515860:')
                                      union all select log_origin, log_txid,
log_tableid, log_actionseq, log_tablenspname, log_tablerelname, log_cmdtype,
log_cmdupdncols, log_cmdargs
                                      from &quot;_cluster_casino&quot;.sl_log_1
                                      where log_origin = 1 and log_tableid in
(18229,18046,18058,18047,18048,18080,18104,18049,18050,18001,18002,18003,18005,18006,18007,18008,18009,18011,18012,18013,
                                                                 
18010,18014,18015,18016,18017,18018,18019,18020,18021,18022,18023,18024,18025,18026,18030,18027,18028,18031,18032,18033,18034,18035,18036,
                                                                 
18037,18038,18039,18040,18041,18042,18043,18044,18045,18051,18052,18053,18054,18055,18056,18057,18059,18060,18061,18062,18063,18064,
                                                                 
18065,18066,18067,18068,18069,18070,18071,18072,18073,18074,18075,18076,18077,18078,18079,18081,18082,18083,18084,18085,18086,18087,
                                                                 
18088,18089,18090,18091,18092,18093,18094,18095,18096,18097,18098,18099,18100,18101,18102,18103,18105,18106,18107,18110,18111,18112,
                                                                 
18113,18114,18115,18116,18117,18118,18119,18120,18121,18122,18123,18124,18125,18126,18127,18128,18129,18130,18132,18135,18136,18137,
                                                                 
18138,18139,18140,18141,18142,18143,18145,18146,18147,18148,18149,18150,18151,18152,18153,18154,18155,18156,18157,18158,18159,18160,
                                                                 
18161,18162,18163,18164,18165,18166,18167,18168,18169,18170,18171,18172,18173,18174,18175,18176,18177,18178,18179,18180,18181,18182,
                                                                 
18183,18184,18185,18186,18187,18189,18190,18191,18192,18193,18194,18195,18196,18197,18198,18199,18201,18202,18203,18204,18205,18206,
                                                                 
18207,18208,18209,18210,18211,18212,18213,18214,18215,18216,18217,18218,18219,18220,18221,18222,18223,18224,18225,18226,18227,18228)
                                       and log_txid in (select *
                                                        from
&quot;pg_catalog&quot;.txid_snapshot_xip('1810515020:1810515020:')
                                                        except select *
                                                        from
&quot;pg_catalog&quot;.txid_snapshot_xip('1810515860:1810515860:') )
                                                        union
                                                        all select log_origin,
log_txid, log_tableid, log_actionseq, log_tablenspname, log_tablerelname,
log_cmdtype, log_cmdupdncols, log_cmdargs
                                                        from
&quot;_cluster_casino&quot;.sl_log_2 where log_origin = 1 and log_tableid in
(18229,18046,18058,18047,18048,18080,18104,18049,18050,18001,18002,18003,18005,
                                                      
18006,18007,18008,18009,18011,18012,18013,18010,18014,18015,18016,18017,18018,18019,18020,18021,18022,18023,18024,18025,18026,18030,18027,18028,18031,
                                                      
18032,18033,18034,18035,18036,18037,18038,18039,18040,18041,18042,18043,18044,18045,18051,18052,18053,18054,18055,18056,18057,18059,18060,18061,18062,18063,18064,
                                                      
18065,18066,18067,18068,18069,18070,18071,18072,18073,18074,18075,18076,18077,18078,18079,18081,18082,18083,18084,18085,18086,18087,18088,18089,18090,18091,18092,18093,
                                                      
18094,18095,18096,18097,18098,18099,18100,18101,18102,18103,18105,18106,18107,18110,18111,18112,18113,18114,18115,18116,18117,18118,18119,18120,18121,18122,18123,18124,
                                                      
18125,18126,18127,18128,18129,18130,18132,18135,18136,18137,18138,18139,18140,18141,18142,18143,18145,18146,18147,18148,18149,18150,18151,18152,18153,18154,18155,18156,
                                                      
18157,18158,18159,18160,18161,18162,18163,18164,18165,18166,18167,18168,18169,18170,18171,18172,18173,18174,18175,18176,18177,18178,18179,18180,18181,18182,18183,18184,
                                                      
18185,18186,18187,18189,18190,18191,18192,18193,18194,18195,18196,18197,18198,18199,18201,18202,18203,18204,18205,18206,18207,18208,18209,18210,18211,18212,18213,18214,
                                                      
18215,18216,18217,18218,18219,18220,18221,18222,18223,18224,18225,18226,18227,18228)
                                                        and log_txid &gt;=
'1810515020' and log_txid &lt; '1810515860' and
&quot;pg_catalog&quot;.txid_visible_in_snapshot(log_txid, '1810515860:1810515860:')
                                                        union all select
log_origin, log_txid, log_tableid, log_actionseq, log_tablenspname,
log_tablerelname, log_cmdtype, log_cmdupdncols, log_cmdargs
                                                        from
&quot;_cluster_casino&quot;.sl_log_2 where log_origin = 1 and log_tableid in
(18229,18046,18058,18047,18048,18080,18104,18049,18050,18001,18002,18003,18005,18006,18007,18008,18009,18011,18012,18013,18010,18014,18015,18016,18017,18018,18019,18020,18021,18022,18023,18024,18025,18026,18030,18027,18028,18031,18032,18033,18034,18035,18036,18037,18038,18039,18040,18041,18042,18043,18044,18045,18051,18052,18053,18054,18055,18056,18057,18059,18060,18061,18062,18063,18064,18065,18066,18067,18068,18069,18070,18071,18072,18073,18074,18075,18076,18077,18078,18079,18081,18082,18083,18084,18085,18086,18087,18088,18089,18090,18091,18092,18093,18094,18095,18096,18097,18098,18099,18100,18101,18102,18103,18105,18106,18107,18110,18111,18112,18113,18114,18115,18116,18117,18118,18119,18120,18121,18122,18123,18124,18125,18126,18127,18128,18129,18130,18132,18135,18136,18137,18138,18139,18140,18141,
                                                      
18142,18143,18145,18146,18147,18148,18149,18150,18151,18152,18153,18154,18155,18156,18157,18158,18159,18160,18161,18162,18163,18164,18165,18166,18167,18168,18169,18170,18171,18172,18173,18174,18175,18176,18177,18178,18179,18180,18181,18182,18183,18184,18185,18186,18187,18189,18190,18191,18192,18193,18194,18195,18196,18197,18198,18199,18201,18202,18203,18204,18205,18206,18207,18208,18209,18210,18211,18212,18213,18214,18215,18216,18217,18218,18219,18220,18221,18222,18223,18224,18225,18226,18227,18228)
                                                        and log_txid in (select
* from &quot;pg_catalog&quot;.txid_snapshot_xip('1810515020:1810515020:')
                                                        except select * from
&quot;pg_catalog&quot;.txid_snapshot_xip('1810515860:1810515860:') ) order by
log_actionseq) TO STDOUT
&lt;&lt;&lt;&lt;


Later after cluster uninstall, after initial copy with &quot;omit copy = no&quot;:
<span class="quote">&gt;&gt;&gt;&gt;</span >
2013-12-04 06:59:42 HKT INFO   remoteWorkerThread_1: 0.280 seconds to copy
sequences
2013-12-04 06:59:42 HKT INFO   remoteWorkerThread_1: copy_set SYNC found, use
event seqno 5000000641.
2013-12-04 06:59:43 HKT INFO   remoteWorkerThread_1: 0.477 seconds to build
initial setsync status
2013-12-04 06:59:43 HKT INFO   copy_set 18 done in 10132.370 seconds
2013-12-04 06:59:43 HKT CONFIG enableSubscription: sub_set=18
2013-12-04 07:00:13 HKT CONFIG storeListen: li_origin=1 li_receiver=2
li_provider=1
2013-12-04 07:00:13 HKT CONFIG remoteWorkerThread_1: update provider
configuration
2013-12-04 07:00:13 HKT CONFIG remoteWorkerThread_1: added active set 18 to
provider 1
2013-12-04 07:00:13 HKT CONFIG version for &quot;dbname=db01 host=db01-slony
port=5443 user=slon_casino&quot; is 90204
2013-12-04 07:00:13 HKT INFO   remoteWorkerThread_1: syncing set 18 with 219
table(s) from provider 1
2013-12-04 07:00:13 HKT INFO   cleanupThread: 9616.145 seconds for
cleanupEvent()
2013-12-04 07:00:17 HKT INFO   remoteWorkerThread_1: SYNC 5000000642 done in
3.942 seconds
2013-12-04 07:00:17 HKT INFO   remoteWorkerThread_1: syncing set 18 with 219
table(s) from provider 1
2013-12-04 07:01:26 HKT ERROR  remoteWorkerThread_1_1: error at end of COPY IN:
server closed the connection unexpectedly
        This probably means the server terminated abnormally
        before or while processing the request.
2013-12-04 07:01:26 HKT ERROR  remoteWorkerThread_1_1: failed SYNC's log
selection query was 'COPY ( select log_origin, log_txid, NULL::integer,
log_actionseq, NULL::text, NULL::text, log_cmdtype, NULL::integer, log_cmdargs
from &quot;_clust
er_casino&quot;.sl_log_script where log_origin = 1 and log_txid &gt;=
&quot;pg_catalog&quot;.txid_snapshot_xmax('1814446848:1814446855:1814446848') and
log_txid &lt; '1814450484' and &quot;pg_catalog&quot;.txid_visible_in_snapshot(log_txid,
'1814450484:1814450484:') 
union all select log_origin, log_txid, NULL::integer, log_actionseq,
NULL::text, NULL::text, log_cmdtype, NULL::integer, log_cmdargs from
&quot;_cluster_casino&quot;.sl_log_script where log_origin = 1 and log_txid in (select *
from &quot;pg_catalog&quot;.t
xid_snapshot_xip('1814446848:1814446855:1814446848') except select * from
&quot;pg_catalog&quot;.txid_snapshot_xip('1814450484:1814450484:') ) union all select
log_origin, log_txid, log_tableid, log_actionseq, log_tablenspname,
log_tablerelname, 
log_cmdtype, log_cmdupdncols, log_cmdargs from &quot;_cluster_casino&quot;.sl_log_1 where
log_origin = 1 and log_tableid in
(18001,18002,18003,18005,18006,18007,18008,18009,18010,18011,18012,18013,18014,18015,18016,18017,18018,18019,18020,18021,1
8022,18023,18024,18025,18026,18027,18028,18030,18031,18032,18033,18034,18035,18036,18037,18038,18039,18040,18041,18042,18043,18044,18045,18046,18047,18048,18049,18050,18051,18052,18053,18054,18055,18056,18057,18058,18059,18060,18061,180
62,18063,18064,18065,18066,18067,18068,18069,18070,18071,18072,18073,18074,18075,18076,18077,18078,18079,18080,18081,18082,18083,18084,18085,18086,18087,18088,18089,18090,18091,18092,18093,18094,18095,18096,18097,18098,18099,18100,18101
,18102,18103,18104,18105,18106,18107,18110,18111,18112,18113,18114,18115,18116,18117,18118,18119,18120,18121,18122,18123,18124,18125,18126,18127,18128,18129,18130,18132,18135,18136,18137,18138,18139,18140,18141,18142,18143,18145,18146,1
8147,18148,18149,18150,18151,18152,18153,18154,18155,18156,18157,18158,18159,18160,18161,18162,18163,18164,18165,18166,18167,18168,18169,18170,18171,18172,18173,18174,18175,18176,18177,18178,18179,18180,18181,18182,18183,18184,18185,181
86,18187,18189,18190,18191,18192,18193,18194,18195,18196,18197,18198,18199,18201,18202,18203,18204,18205,18206,18207,18208,18209,18210,18211,18212,18213,18214,18215,18216,18217,18218,18219,18220,18221,18222,18223,18224,18225,18226,18227
,18228,18229) and log_txid &gt;= '1814446855' and log_txid &lt; '1814450484' and
&quot;pg_catalog&quot;.txid_visible_in_snapshot(log_txid, '1814450484:1814450484:') union
all select log_origin, log_txid, log_tableid, log_actionseq, log_tablenspname,
lo
g_tablerelname, log_cmdtype, log_cmdupdncols, log_cmdargs from
&quot;_cluster_casino&quot;.sl_log_1 where log_origin = 1 and log_tableid in
(18001,18002,18003,18005,18006,18007,18008,18009,18010,18011,18012,18013,18014,18015,18016,18017,18018,180
19,18020,18021,18022,18023,18024,18025,18026,18027,18028,18030,18031,18032,18033,18034,18035,18036,18037,18038,18039,18040,18041,18042,18043,18044,18045,18046,18047,18048,18049,18050,18051,18052,18053,18054,18055,18056,18057,18058,18059
,18060,18061,18062,18063,18064,18065,18066,18067,18068,18069,18070,18071,18072,18073,18074,18075,18076,18077,18078,18079,18080,18081,18082,18083,18084,18085,18086,18087,18088,18089,18090,18091,18092,18093,18094,18095,18096,18097,18098,1
8099,18100,18101,18102,18103,18104,18105,18106,18107,18110,18111,18112,18113,18114,18115,18116,18117,18118,18119,18120,18121,18122,18123,18124,18125,18126,18127,18128,18129,18130,18132,18135,18136,18137,18138,18139,18140,18141,18142,181
43,18145,18146,18147,18148,18149,18150,18151,18152,18153,18154,18155,18156,18157,18158,18159,18160,18161,18162,18163,18164,18165,18166,18167,18168,18169,18170,18171,18172,18173,18174,18175,18176,18177,18178,18179,18180,18181,18182,18183
,18184,18185,18186,18187,18189,18190,18191,18192,18193,18194,18195,18196,18197,18198,18199,18201,18202,18203,18204,18205,18206,18207,18208,18209,18210,18211,18212,18213,18214,18215,18216,18217,18218,18219,18220,18221,18222,18223,18224,1
8225,18226,18227,18228,18229) and log_txid in (select * from
&quot;pg_catalog&quot;.txid_snapshot_xip('1814446848:1814446855:1814446848') except
select * from &quot;pg_catalog&quot;.txid_snapshot_xip('1814450484:1814450484:') ) union
all select log_origin,
 log_txid, log_tableid, log_actionseq, log_tablenspname, log_tablerelname,
log_cmdtype, log_cmdupdncols, log_cmdargs from &quot;_cluster_casino&quot;.sl_log_2 where
log_origin = 1 and log_tableid in
(18001,18002,18003,18005,18006,18007,18008,1800
9,18010,18011,18012,18013,18014,18015,18016,18017,18018,18019,18020,18021,18022,18023,18024,18025,18026,18027,18028,18030,18031,18032,18033,18034,18035,18036,18037,18038,18039,18040,18041,18042,18043,18044,18045,18046,18047,18048,18049,
18050,18051,18052,18053,18054,18055,18056,18057,18058,18059,18060,18061,18062,18063,18064,18065,18066,18067,18068,18069,18070,18071,18072,18073,18074,18075,18076,18077,18078,18079,18080,18081,18082,18083,18084,18085,18086,18087,18088,18
089,18090,18091,18092,18093,18094,18095,18096,18097,18098,18099,18100,18101,18102,18103,18104,18105,18106,18107,18110,18111,18112,18113,18114,18115,18116,18117,18118,18119,18120,18121,18122,18123,18124,18125,18126,18127,18128,18129,1813
0,18132,18135,18136,18137,18138,18139,18140,18141,18142,18143,18145,18146,18147,18148,18149,18150,18151,18152,18153,18154,18155,18156,18157,18158,18159,18160,18161,18162,18163,18164,18165,18166,18167,18168,18169,18170,18171,18172,18173,
18174,18175,18176,18177,18178,18179,18180,18181,18182,18183,18184,18185,18186,18187,18189,18190,18191,18192,18193,18194,18195,18196,18197,18198,18199,18201,18202,18203,18204,18205,18206,18207,18208,18209,18210,18211,18212,18213,18214,18
215,18216,18217,18218,18219,18220,18221,18222,18223,18224,18225,18226,18227,18228,18229)
and log_txid &gt;= '1814446855' and log_txid &lt; '1814450484' and
&quot;pg_catalog&quot;.txid_visible_in_snapshot(log_txid, '1814450484:1814450484:') union
all se
lect log_origin, log_txid, log_tableid, log_actionseq, log_tablenspname,
log_tablerelname, log_cmdtype, log_cmdupdncols, log_cmdargs from
&quot;_cluster_casino&quot;.sl_log_2 where log_origin = 1 and log_tableid in
(18001,18002,18003,18005,18006,
18007,18008,18009,18010,18011,18012,18013,18014,18015,18016,18017,18018,18019,18020,18021,18022,18023,18024,18025,18026,18027,18028,18030,18031,18032,18033,18034,18035,18036,18037,18038,18039,18040,18041,18042,18043,18044,18045,18046,18
047,18048,18049,18050,18051,18052,18053,18054,18055,18056,18057,18058,18059,18060,18061,18062,18063,18064,18065,18066,18067,18068,18069,18070,18071,18072,18073,18074,18075,18076,18077,18078,18079,18080,18081,18082,18083,18084,18085,1808
6,18087,18088,18089,18090,18091,18092,18093,18094,18095,18096,18097,18098,18099,18100,18101,18102,18103,18104,18105,18106,18107,18110,18111,18112,18113,18114,18115,18116,18117,18118,18119,18120,18121,18122,18123,18124,18125,18126,18127,
18128,18129,18130,18132,18135,18136,18137,18138,18139,18140,18141,18142,18143,18145,18146,18147,18148,18149,18150,18151,18152,18153,18154,18155,18156,18157,18158,18159,18160,18161,18162,18163,18164,18165,18166,18167,18168,18169,18170,18
171,18172,18173,18174,18175,18176,18177,18178,18179,18180,18181,18182,18183,18184,18185,18186,18187,18189,18190,18191,18192,18193,18194,18195,18196,18197,18198,18199,18201,18202,18203,18204,18205,18206,18207,18208,18209,18210,18211,1821
2,18213,18214,18215,18216,18217,18218,18219,18220,18221,18222,18223,18224,18225,18226,18227,18228,18229)
and log_txid in (select * from
&quot;pg_catalog&quot;.txid_snapshot_xip('1814446848:1814446855:1814446848') except
select * from &quot;pg_catalog&quot;
.txid_snapshot_xip('1814450484:1814450484:') ) order by log_actionseq) TO
STDOUT'
2013-12-04 07:01:26 HKT ERROR  remoteWorkerThread_1: SYNC aborted
2013-12-04 07:01:26 HKT ERROR  remoteWorkerThread_1: &quot;rollback transaction&quot;
PGRES_FATAL_ERROR 2013-12-04 07:01:26 HKT CONFIG slon: child terminated signal:
9; pid: 12018, current worker pid: 12018
2013-12-04 07:01:26 HKT CONFIG slon: restart of worker in 10 seconds
&lt;&lt;&lt;&lt;

Together with second attempt's failure I got &quot;Segmentation fault&quot; in Postgres:
<span class="quote">&gt;&gt;&gt;&gt;</span >
&lt;2013-12-04 07:00:13 HKT-slon_casino-XXX.XXX.XXX.85(57578)-db01
[app:slon.local_cleanup,pid:12031,00000]&gt;LOG:  process 12031 acquired
AccessExclusiveLock on relation 355503 of database 31761 after 9616098.245 ms
&lt;2013-12-04 07:00:13 HKT-slon_casino-XXX.XXX.XXX.85(57578)-db01
[app:slon.local_cleanup,pid:12031,00000]&gt;STATEMENT:  begin;lock table
&quot;_cluster_casino&quot;.sl_config_lock;select &quot;_cluster_casino&quot;.cleanupEvent('10
minutes'::interval);commi
t;
&lt;2013-12-04 07:00:13 HKT-slon_casino-XXX.XXX.XXX.85(57578)-db01
[app:slon.local_cleanup,pid:12031,00000]&gt;LOG:  duration: 9616145.184 ms 
statement: begin;lock table &quot;_cluster_casino&quot;.sl_config_lock;select
&quot;_cluster_casino&quot;.cleanupEven
t('10 minutes'::interval);commit;
&lt;2013-12-04 07:01:26 HKT--- [app:,pid:75714,00000]&gt;LOG:  server process (PID
12028) was terminated by signal 11: Segmentation fault
&lt;2013-12-04 07:01:26 HKT--- [app:,pid:75714,00000]&gt;DETAIL:  Failed process was
running: COPY &quot;_cluster_casino&quot;.&quot;sl_log_2&quot; ( log_origin,
log_txid,log_tableid,log_actionseq,log_tablenspname, log_tablerelname,
log_cmdtype, log_cmdupdncols,
log_cmdargs) FROM STDIN
&lt;2013-12-04 07:01:26 HKT--- [app:,pid:75714,00000]&gt;LOG:  terminating any other
active server processes
&lt;2013-12-04 07:01:27 HKT--- [app:,pid:75714,00000]&gt;LOG:  all server processes
terminated; reinitializing
&lt;2013-12-04 07:01:30 HKT--- [app:,pid:21980,00000]&gt;LOG:  database system was
interrupted; last known up at 2013-12-04 06:58:01 HKT
&lt;2013-12-04 07:01:30 HKT--- [app:,pid:21980,00000]&gt;LOG:  database system was
not properly shut down; automatic recovery in progress
&lt;2013-12-04 07:01:30 HKT--- [app:,pid:21980,00000]&gt;LOG:  redo starts at
759/FA2ED570
&lt;2013-12-04 07:01:36 HKT-slon_xg-XXX.XXX.XXX.84(58626)-db01
[app:[unknown],pid:21983,57P03]&gt;FATAL:  the database system is in recovery mode
&lt;&lt;&lt;&lt;


Restart neither postgresql nor the slony has not helped. So, I did a rollback
to Slony 2.1.4 and it works perfect now.

P.s.
I have 3 independent slony clusters (for 3 different db schemas) within one
database. I got such problems only with one of them. Other 2 worked good with
v2.2.1.
Unfortunately, I can't do more investigations for you, because this is
production env and I already did a rollback to 2.1.4.</pre>
    </div>
  <div class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a name="c1" 
             href="show_bug.cgi?id=327#c1">Comment 1</a>
        </span>

        <span class="bz_comment_user"><span class="vcard"><span class="fn">Jan Wieck</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2013-12-12 10:22:09 PST
        </span>
      </div>



<pre class="bz_comment_text" >Interestingly the number 1869439327 (the requested memory size) represents the
string &quot;_amo&quot;, which is part of the array data of that very log row in the
column/value list right in the first column name &quot;contrib_amount_bc&quot;. This
would indicate something went wrong in the apply trigger and apparently wrote
that column name over some other variables.

I'll take a detailed look at the apply trigger code.</pre>
    </div>
  <div class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a name="c2" 
             href="show_bug.cgi?id=327#c2">Comment 2</a>
        </span>

        <span class="bz_comment_user"><span class="vcard"><span class="fn">Matt</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2014-01-24 08:24:22 PST
        </span>
      </div>



<pre class="bz_comment_text" >I think I may have hit this same bug. My symptoms:

Set up a cluster with Postgres 9.2.6 and Slony 2.2.1. Cascading replication set
up with Master -&gt; Intermediate Slave -&gt; 4 Slaves

After 2 days of uptime and no DDL changes, the intermediate slave's slon daemon
stated saying messages like:

2014-01-23 14:55:58 EST ERROR  remoteWorkerThread_1_1: error at end of COPY IN:
ERROR:  invalid input syntax for integer: &quot;33.7726910000000018&quot;

The column in question is a “double precision” on both master &amp; slave.

I tried restarting the slon daemon on both master and intermediate slave. The
error message changed slightly:

COPY IN: ERROR:  invalid input syntax for integer: &quot;Los Angeles&quot;

Unfortunately I have to tear down this cluster since we need the machinery, but
I'll keep my eye out for it again</pre>
    </div>
  <div class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a name="c3" 
             href="show_bug.cgi?id=327#c3">Comment 3</a>
        </span>

        <span class="bz_comment_user"><span class="vcard"><span class="fn">Jan Wieck</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2014-01-29 09:14:38 PST
        </span>
      </div>



<pre class="bz_comment_text" ><span class=""><a href="attachment.cgi?id=199" name="attach_199" title="Proposed fix">Created an attachment (id=199)</a> <a href="attachment.cgi?id=199&amp;action=edit" title="Proposed fix">[details]</a></span>
Proposed fix</pre>
    </div>
  <div class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a name="c4" 
             href="show_bug.cgi?id=327#c4">Comment 4</a>
        </span>

        <span class="bz_comment_user"><span class="vcard"><span class="fn">Jan Wieck</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2014-01-29 09:21:04 PST
        </span>
      </div>



<pre class="bz_comment_text" >I was able to reproduce the memory corruption and found what I believe is the
place, where it happens. The code, that evicts an apply query form the cache
when more than apply_cache_size different query plans are needed inside of a
single SYNC processing, free'd data from the &quot;new&quot; cache entry, not the one to
evict.

The commit is here:
<a href="https://github.com/wieck/slony1-engine/commit/6b56d480e211344eb952c9c23924ba555ac21d28">https://github.com/wieck/slony1-engine/commit/6b56d480e211344eb952c9c23924ba555ac21d28</a></pre>
    </div>
  <div class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a name="c5" 
             href="show_bug.cgi?id=327#c5">Comment 5</a>
        </span>

        <span class="bz_comment_user"><span class="vcard"><span class="fn">Steve Singer</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2014-02-03 13:50:28 PST
        </span>
      </div>



<pre class="bz_comment_text" >This fix looks safe to commit.
I haven't verified if the fix actually fixes the problem reported.

How difficult is it to write a unit test that would reproduce this issue?</pre>
    </div>
  <div class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a name="c6" 
             href="show_bug.cgi?id=327#c6">Comment 6</a>
        </span>

        <span class="bz_comment_user"><span class="vcard"><span class="fn">Jan Wieck</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2014-02-06 09:38:58 PST
        </span>
      </div>



<pre class="bz_comment_text" >Patch applied to REL_2_2_STABLE and master.

A unit test does not necessarily make sense for this particular bug.
Reproducing it was rather simple by creating an artificial transaction profile
that caused individual LRU based apply cache eviction. After fixing it I ran
the corresponding test application over night, pushing millions of transactions
with a random number of updates while replicating thousands of SYNC events
without any problems or apparent memory leaks. Any sort of unit test would not
even scratch that test.</pre>
    </div>
  <div class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a name="c7" 
             href="show_bug.cgi?id=327#c7">Comment 7</a>
        </span>

        <span class="bz_comment_user"><span class="vcard"><span class="fn">Steve Singer</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2014-02-13 05:17:01 PST
        </span>
      </div>



<pre class="bz_comment_text" >*** <span class="bz_closed"><a href="show_bug.cgi?id=330" title="RESOLVED DUPLICATE - slon process started with errors in replication.">Bug 330</a></span> has been marked as a duplicate of this bug. ***</pre>
    </div>
        </div>
        
      </td>
    </tr>
  </table>
</form>

<hr>
<ul class="related_actions">
    <li><a href="show_bug.cgi?format=multiple&amp;id=327">Format For Printing</a></li>
    <li>&nbsp;-&nbsp;<a href="show_bug.cgi?ctype=xml&amp;id=327">XML</a></li>
    <li>&nbsp;-&nbsp;<a href="enter_bug.cgi?cloned_bug_id=327">Clone This Bug</a></li>
    
    <li>&nbsp;-&nbsp;<a href="#">Top of page </a></li>
    </ul>        


<div class="navigation">
  
  
  <i><font color="#777777">First</font></i>
  <i><font color="#777777">Last</font></i>
  <i><font color="#777777">Prev</font></i>
  <i><font color="#777777">Next</font></i>
  &nbsp;&nbsp;
  <i><font color="#777777">No search results available</font></i>
</div>

<br>
</div>



<div id="footer">
  <div class="intro"></div>




<ul id="useful-links">
  <li id="links-actions"><ul class="links">
  <li><a href="./">Home</a></li>
  <li><span class="separator">| </span><a href="enter_bug.cgi">New</a></li>
  <li><span class="separator">| </span><a href="query.cgi">Search</a></li>

  <li class="form">
    <span class="separator">| </span>
    <form action="buglist.cgi" method="get"
        onsubmit="if (this.quicksearch.value == '')
                  { alert('Please enter one or more search terms first.');
                    return false; } return true;">
    <input class="txt" type="text" id="quicksearch_bottom" name="quicksearch">
    <input class="btn" type="submit" value="Find" id="find_bottom"></form></li>

  <li><span class="separator">| </span><a href="report.cgi">Reports</a></li>

  <li></li>


  <li>
        <span class="separator">| </span>
        <a href="docs/en/html/bug_page.html" target="_blank">Help</a>
      </li>
    
      <li id="new_account_container_bottom">
        <span class="separator">| </span>
        <a href="createaccount.cgi">New&nbsp;Account</a>
      </li>

    <li id="mini_login_container_bottom">
  <span class="separator">| </span>
  <a id="login_link_bottom" href="?GoAheadAndLogIn=1"
     onclick="return show_mini_login_form('_bottom')">Log In</a>
  <form action="http://www.slony.info/bugzilla/show_bug.cgi?id=327" method="POST" 
        class="mini_login bz_default_hidden"
        id="mini_login_bottom"
        onsubmit="return check_mini_login_fields( '_bottom' );"
  >
    <input id="Bugzilla_login_bottom" 
           class="bz_login"
           name="Bugzilla_login"
           onfocus="mini_login_on_focus('_bottom')"
    >
    <input class="bz_password" 
           id="Bugzilla_password_bottom" 
           name="Bugzilla_password"
           type="password"
    >
    <input class="bz_password bz_default_hidden bz_mini_login_help" type="text" 
           id="Bugzilla_password_dummy_bottom" value="password"
           onfocus="mini_login_on_focus('_bottom')"
    >
    <input type="submit" name="GoAheadAndLogIn" value="Log in" 
            id="log_in_bottom">
    <script type="text/javascript">
      mini_login_constants = {
          "login" : "login",
          "warning" : "You must set the login and password before logging in."
      };
      
      if (YAHOO.env.ua.gecko || YAHOO.env.ua.ie || YAHOO.env.ua.opera) {
          YAHOO.util.Event.onDOMReady(function() {
              init_mini_login_form('_bottom');
          });
      }
      else {
          YAHOO.util.Event.on(window, 'load', function () {
              window.setTimeout(function() {
                  init_mini_login_form('_bottom');
              }, 200);
          });
    }
    </script>
    <a href="#" onclick="return hide_mini_login_form('_bottom')">[x]</a>
  </form>
</li>
<li id="forgot_container_bottom">
  <span class="separator">| </span>
  <a id="forgot_link_bottom" href="?GoAheadAndLogIn=1#forgot"
     onclick="return show_forgot_form('_bottom')">Forgot Password</a>
  <form action="token.cgi" method="post" id="forgot_form_bottom"
        class="mini_forgot bz_default_hidden">
    <label>Login: <input type="text" name="loginname" size="20"></label>
    <input id="forgot_button_bottom" value="Reset Password" 
           type="submit">
    <input type="hidden" name="a" value="reqpw">
    <a href="#" onclick="return hide_forgot_form('_bottom')">[x]</a>
  </form>
</li>
</ul>
  </li>

  
    

  


  
</ul>

  <div class="outro"></div>
</div>

</body>
</html>