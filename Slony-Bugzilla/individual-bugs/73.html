<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                      "http://www.w3.org/TR/html4/loose.dtd">
<html>
  <head>
    <title>Bug 73 &ndash; Slony-I: old key column xxx.yyy IS NULL on UPDATE</title>


<link rel="Top" href="http://www.slony.info/bugzilla/">

  

  


  
    <link rel="Show" title="Dependency Tree"
          href="showdependencytree.cgi?id=73&amp;hide_resolved=1">
      <link rel="Show" title="Dependency Graph"
            href="showdependencygraph.cgi?id=73">


      <link rel="Show" title="Bug Activity"
            href="show_activity.cgi?id=73">
      <link rel="Show" title="Printer-Friendly Version"
            href="show_bug.cgi?format=multiple&amp;id=73">


    

    
      <link href="skins/standard/global.css"
            rel="stylesheet"
            type="text/css">
      <link href="skins/standard/yui/calendar.css"
            rel="stylesheet"
            type="text/css">
      <link href="skins/standard/show_bug.css"
            rel="stylesheet"
            type="text/css">
    <!--[if lte IE 7]>
      
      <link href="skins/standard/IE-fixes.css"
            rel="stylesheet"
            type="text/css">
    <![endif]-->

    
        <link href="skins/standard/global.css"
              rel="stylesheet"
              title="Classic"
              type="text/css">
        <link href="skins/standard/yui/calendar.css"
              rel="stylesheet"
              title="Classic"
              type="text/css">
        <link href="skins/standard/show_bug.css"
              rel="stylesheet"
              title="Classic"
              type="text/css">
      <!--[if lte IE 7]>
      
        <link href="skins/standard/IE-fixes.css"
              rel="stylesheet"
              title="Classic"
              type="text/css">
      <![endif]-->

    
        
            <link href="skins/contrib/Dusk/global.css"
                  rel="alternate stylesheet"
                  title="Dusk"
                  type="text/css">
            <link href="skins/contrib/Dusk/yui/calendar.css"
                  rel="alternate stylesheet"
                  title="Dusk"
                  type="text/css">
            <link href="skins/contrib/Dusk/show_bug.css"
                  rel="alternate stylesheet"
                  title="Dusk"
                  type="text/css">
        <!--[if lte IE 7]>
          
          <link href="skins/contrib/Dusk/IE-fixes.css"
                rel="alternate stylesheet"
                title="Dusk"
                type="text/css">
        <![endif]-->

    

    
        <link href="skins/custom/global.css" rel="stylesheet" type="text/css">
        <link href="skins/custom/yui/calendar.css" rel="stylesheet" type="text/css">
        <link href="skins/custom/show_bug.css" rel="stylesheet" type="text/css">
    <!--[if lte IE 7]>
      
      <link href="skins/custom/IE-fixes.css"
            rel="stylesheet"
            type="text/css">
    <![endif]-->

    <script src="js/yui/yahoo-dom-event.js" type="text/javascript"></script>
    <script src="js/global.js" type="text/javascript"></script>
    <script type="text/javascript">
    <!--
        YAHOO.namespace('bugzilla');
        if (YAHOO.env.ua.gecko) {
            YAHOO.util.Event._simpleRemove(window, "unload", 
                                           YAHOO.util.Event._unload);
        }
        
        var BUGZILLA = {
            param: {
                cookiepath: '\/'
            }
        };
    // -->
    </script>

        <script src="js/util.js" type="text/javascript"></script>
        <script src="js/field.js" type="text/javascript"></script>
        <script src="js/yui/calendar.js" type="text/javascript"></script>

    

    
    <link rel="search" type="application/opensearchdescription+xml"
                       title="Bugzilla" href="./search_plugin.cgi">
    <link rel="shortcut icon" href="images/favicon.ico" >
  </head>



  <body onload=""
        class="www-slony-info-bugzilla bz_bug bz_status_RESOLVED bz_product_Slony-I bz_component_slonik bz_bug_73">



<div id="header">
<div id="banner">
  </div>

<table border="0" cellspacing="0" cellpadding="0" id="titles">
<tr>
    <td id="title">
      <p>Bugzilla &ndash; Bug&nbsp;73</p>
    </td>

    <td id="subtitle">
      <p class="subheader">Slony-I: old key column xxx.yyy IS NULL on UPDATE</p>
    </td>

    <td id="information">
      <p class="header_addl_info">Last modified: 2009-02-20 04:20:36 PST</p>
    </td>
</tr>
</table>
<ul class="links">
  <li><a href="./">Home</a></li>
  <li><span class="separator">| </span><a href="enter_bug.cgi">New</a></li>
  <li><span class="separator">| </span><a href="query.cgi">Search</a></li>

  <li class="form">
    <span class="separator">| </span>
    <form action="buglist.cgi" method="get"
        onsubmit="if (this.quicksearch.value == '')
                  { alert('Please enter one or more search terms first.');
                    return false; } return true;">
    <input class="txt" type="text" id="quicksearch_top" name="quicksearch">
    <input class="btn" type="submit" value="Find" id="find_top"></form></li>

  <li><span class="separator">| </span><a href="report.cgi">Reports</a></li>

  <li></li>


  <li>
        <span class="separator">| </span>
        <a href="docs/en/html/bug_page.html" target="_blank">Help</a>
      </li>
    
      <li id="new_account_container_top">
        <span class="separator">| </span>
        <a href="createaccount.cgi">New&nbsp;Account</a>
      </li>

    <li id="mini_login_container_top">
  <span class="separator">| </span>
  <a id="login_link_top" href="?GoAheadAndLogIn=1"
     onclick="return show_mini_login_form('_top')">Log In</a>
  <form action="http://www.slony.info/bugzilla/show_bug.cgi?id=73" method="POST" 
        class="mini_login bz_default_hidden"
        id="mini_login_top"
        onsubmit="return check_mini_login_fields( '_top' );"
  >
    <input id="Bugzilla_login_top" 
           class="bz_login"
           name="Bugzilla_login"
           onfocus="mini_login_on_focus('_top')"
    >
    <input class="bz_password" 
           id="Bugzilla_password_top" 
           name="Bugzilla_password"
           type="password"
    >
    <input class="bz_password bz_default_hidden bz_mini_login_help" type="text" 
           id="Bugzilla_password_dummy_top" value="password"
           onfocus="mini_login_on_focus('_top')"
    >
    <input type="submit" name="GoAheadAndLogIn" value="Log in" 
            id="log_in_top">
    <script type="text/javascript">
      mini_login_constants = {
          "login" : "login",
          "warning" : "You must set the login and password before logging in."
      };
      
      if (YAHOO.env.ua.gecko || YAHOO.env.ua.ie || YAHOO.env.ua.opera) {
          YAHOO.util.Event.onDOMReady(function() {
              init_mini_login_form('_top');
          });
      }
      else {
          YAHOO.util.Event.on(window, 'load', function () {
              window.setTimeout(function() {
                  init_mini_login_form('_top');
              }, 200);
          });
    }
    </script>
    <a href="#" onclick="return hide_mini_login_form('_top')">[x]</a>
  </form>
</li>
<li id="forgot_container_top">
  <span class="separator">| </span>
  <a id="forgot_link_top" href="?GoAheadAndLogIn=1#forgot"
     onclick="return show_forgot_form('_top')">Forgot Password</a>
  <form action="token.cgi" method="post" id="forgot_form_top"
        class="mini_forgot bz_default_hidden">
    <label>Login: <input type="text" name="loginname" size="20"></label>
    <input id="forgot_button_top" value="Reset Password" 
           type="submit">
    <input type="hidden" name="a" value="reqpw">
    <a href="#" onclick="return hide_forgot_form('_top')">[x]</a>
  </form>
</li>
</ul>

</div>

<div id="bugzilla-body">

<div class="navigation">
  
  
  <i><font color="#777777">First</font></i>
  <i><font color="#777777">Last</font></i>
  <i><font color="#777777">Prev</font></i>
  <i><font color="#777777">Next</font></i>
  &nbsp;&nbsp;
  <i><font color="#777777">No search results available</font></i>
</div>
<script type="text/javascript">
  <!--
  
  /* Outputs a link to call replyToComment(); used to reduce HTML output */
  function addReplyLink(id, real_id) {
      /* XXX this should really be updated to use the DOM Core's
       * createElement, but finding a container isn't trivial.
       */
        document.write('[<a href="#add_comment" onclick="replyToComment(' + 
                       id + ',' + real_id + ');">reply<' + '/a>]');
  }

  /* Adds the reply text to the `comment' textarea */
  function replyToComment(id, real_id) {
      var prefix = "(In reply to comment #" + id + ")\n";
      var replytext = "";
        /* pre id="comment_name_N" */
        var text_elem = document.getElementById('comment_text_'+id);
        var text = getText(text_elem);

        /* make sure we split on all newlines -- IE or Moz use \r and \n
         * respectively.
         */
        text = text.split(/\r|\n/);

        for (var i=0; i < text.length; i++) {
            replytext += "> " + text[i] + "\n"; 
        }

        replytext = prefix + replytext + "\n";


      /* <textarea id="comment"> */
      var textarea = document.getElementById('comment');
      textarea.value += replytext;

      textarea.focus();
  }

  if (typeof Node == 'undefined') {
      /* MSIE doesn't define Node, so provide a compatibility object */
      window.Node = {
          TEXT_NODE: 3,
          ENTITY_REFERENCE_NODE: 5
      };
  }

  /* Concatenates all text from element's childNodes. This is used
   * instead of innerHTML because we want the actual text (and
   * innerText is non-standard).
   */
  function getText(element) {
      var child, text = "";
      for (var i=0; i < element.childNodes.length; i++) {
          child = element.childNodes[i];
          var type = child.nodeType;
          if (type == Node.TEXT_NODE || type == Node.ENTITY_REFERENCE_NODE) {
              text += child.nodeValue;
          } else {
              /* recurse into nodes of other types */
              text += getText(child);
          }
      }
      return text;
  }


  //-->
  </script>

<form name="changeform" method="post" action="process_bug.cgi">

  <input type="hidden" name="delta_ts" value="2009-02-20 04:20:36">
  <input type="hidden" name="longdesclength" value="7">
  <input type="hidden" name="id" value="73">
  <input type="hidden" name="token" value="1383973525-84db5d65e2f83ce042782ec8f02bc60d">
<div class="bz_alias_short_desc_container edit_form">
     <a href="show_bug.cgi?id=73">
        <b>Bug&nbsp;73</b></a> - 
     <span id="summary_alias_container" class="bz_default_hidden"> 
      <span id="short_desc_nonedit_display">Slony-I: old key column xxx.yyy IS NULL on UPDATE</span>
     </span>
  
       
    <div id="summary_alias_input">
      <table id="summary">  
        
        <tr>
          <td>
            <label accesskey="s" for="short_desc"><u>S</u>ummary</label>:
          </td>
          <td>Slony-I: old key column xxx.yyy IS NULL on UPDATE
          </td>
        </tr>
      </table>
    </div>
  </div>
  <script type="text/javascript">
    hideAliasAndSummary('Slony-I: old key column xxx.yyy IS NULL on UPDATE', '');
  </script>
  <table class="edit_form">
    <tr>
      
      <td id="bz_show_bug_column_1" class="bz_show_bug_column">     
        <table>
          <tr>
    <td class="field_label">
      <b><a href="page.cgi?id=fields.html#status">Status</a></b>:
    </td>
    <td id="bz_field_status">
      <span id="static_bug_status">RESOLVED
          DUPLICATE
            of <span class="bz_closed"><a href="show_bug.cgi?id=67" title="RESOLVED FIXED - Array overrun in logtrigger()">bug 67</a></span>
      </span>
    </td>
  </tr>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
          <tr>
<th class="field_label "
      id="field_label_product">
        <a href="describecomponents.cgi">Product:</a>
  </th>

<td class="field_value "
    id="field_container_product" >Slony-I</td>
    </tr>
        
    
    
    <tr>
      <td class="field_label">
        <label for="component" accesskey="m">
          <b><a href="describecomponents.cgi?product=Slony-I">
            Co<u>m</u>ponent</a>:
          </b>
        </label>
      </td><td>slonik
  </td>
    </tr>
    <tr>
      <td class="field_label">
        <label for="version"><b>Version</b></label>:
      </td>
<td>devel
  </td>
    </tr>
        
    
        
    <tr>
      <td class="field_label">
        <label for="rep_platform" accesskey="h"><b>Platform</b></label>:
      </td>
      <td class="field_value">PC
       Linux
       <script type="text/javascript">
         assignToDefaultOnChange(['product', 'component']);
       </script>
      </td>
    </tr>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
          
          <tr>
      <td class="field_label">
        <label for="priority" accesskey="i">
          <b><a href="page.cgi?id=fields.html#importance"><u>I</u>mportance</a></b></label>:
      </td>
      <td>urgent
       blocker
      </td>
    </tr>            
          
          <tr>
      <td class="field_label">
        <b><a href="page.cgi?id=fields.html#assigned_to">Assigned To</a></b>:
      </td>
      <td><span class="vcard"><span class="fn">Slony Bugs List</span>
</span>
      </td>
    </tr>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
          <tr>
    <td class="field_label">
      <label for="bug_file_loc" accesskey="u"><b>
          <u>U</u>RL</b></label>:
    </td>
    <td>
      <span id="bz_url_input_area">
          <a href=""></a>
      </span>
    </td>
  </tr>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
          
          <tr><th class="field_label">
    <label for="dependson">Depends&nbsp;on</label>:
  </th>
  <td>    
    <span id="dependson_input_area">
    </span>
    
  </td>
  </tr>
  
  <tr><th class="field_label">
    <label for="blocked" accesskey="b"><u>B</u>locks</label>:
  </th>
  <td>    
    <span id="blocked_input_area">
    </span>
    
  </td>
  
  <tr>
    <th>&nbsp;</th>
  
    <td colspan="2" align="left" id="show_dependency_tree_or_graph">
      Show dependency <a href="showdependencytree.cgi?id=73&amp;hide_resolved=1">tree</a>
  
        /&nbsp;<a href="showdependencygraph.cgi?id=73">graph</a>
    </td>
  </tr>
          
        </table>
      </td>
      <td>
        <div class="bz_column_spacer">&nbsp;</div>
      </td>
      
      <td id="bz_show_bug_column_2" class="bz_show_bug_column">
        <table cellpadding="3" cellspacing="1">
        <tr>
    <td class="field_label">
      <b>Reported</b>:
    </td>
    <td>2009-02-20 02:33 PST by <span class="vcard"><span class="fn">Thomas Berger</span>
</span>
    </td>
  </tr>
  
  <tr>
    <td class="field_label">
      <b> Modified</b>:
    </td>
    <td>2009-02-20 04:20 PST 
      (<a href="show_activity.cgi?id=73">History</a>)
    </td>
  
  </tr>
         <tr>
      <td class="field_label">
        <label for="newcc" accesskey="a"><b>CC List</b>:</label>
      </td>
      <td>3 
          users
        <span id="cc_edit_area_showhide_container" class="bz_default_hidden">
          (<a href="#" id="cc_edit_area_showhide">show</a>)
        </span>
        <div id="cc_edit_area">
          <br>
            <select id="cc" name="cc" multiple="multiple" size="5">
                <option value="aburacze">aburacze</option>
                <option value="fkieling">fkieling</option>
                <option value="slony1-bugs">slony1-bugs</option>
            </select>
        </div>
        <script type="text/javascript">
          hideEditableField( 'cc_edit_area_showhide_container', 
                             'cc_edit_area', 
                             'cc_edit_area_showhide', 
                             '', 
                             '');  
        </script>
      </td>
    </tr>
         <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
<tr><th class="field_label "
      id="field_label_see_also">
        <a href="page.cgi?id=fields.html#see_also">See Also:</a>
  </th>

<td class="field_value "
    id="field_container_see_also" ></td>
    </tr> 
         
         <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
         
                

        </table>
      </td>
    </tr>
    <tr>
      <td colspan="3">
          <hr id="bz_top_half_spacer">
      </td>
    </tr>
  </table>

  
  


<script type="text/javascript">
<!--
function toggle_display(link) {
    var table = document.getElementById("attachment_table");
    // Store current height for scrolling later
    var originalHeight = table.offsetHeight;
    var rows = YAHOO.util.Dom.getElementsByClassName(
        'bz_tr_obsolete', 'tr', table);

    for (var i = 0; i < rows.length; i++) {
        bz_toggleClass(rows[i], 'bz_default_hidden');
    }

    if (YAHOO.util.Dom.hasClass(rows[0], 'bz_default_hidden')) {
        link.innerHTML = "Show Obsolete";
    }
    else {
        link.innerHTML = "Hide Obsolete";
    }

    var newHeight = table.offsetHeight;
    // This scrolling makes the window appear to not move at all.
    window.scrollBy(0, newHeight - originalHeight);

    return false;
}
//-->
</script>

<br>
<table id="attachment_table" cellspacing="0" cellpadding="4">
  <tr>
    <th colspan="2" align="left">
      <a name="a0" id="a0">Attachments</a>
    </th>
  </tr>



  <tr class="bz_attach_footer">
    <td colspan="2">
      <a href="attachment.cgi?bugid=73&amp;action=enter">Add an attachment</a>
      (proposed patch, testcase, etc.)
    </td>
  </tr>
</table>
<br>




  <br>
  <table cellpadding="1" cellspacing="1">
    <tr>
      <td id="comment_status_commit">
        <!-- The table keeps the commit button aligned with the box. -->
        <a name="add_comment"></a>
          <fieldset>
            <legend>Note</legend>
            <p>
              You need to
              <a href="show_bug.cgi?id=73&amp;GoAheadAndLogIn=1">log in</a>
              before you can comment on or make changes to this bug.
            </p>
          </fieldset>
        
        <hr>
        <div id="comments"><script type="text/javascript">
  <!--
  function updateCommentPrivacy(checkbox, id) {
    var comment_elem = document.getElementById('comment_text_'+id).parentNode;
    if (checkbox.checked) {
      if (!comment_elem.className.match('bz_private')) {
        comment_elem.className = comment_elem.className.concat(' bz_private');
      }
    }
    else {
      comment_elem.className =
        comment_elem.className.replace(/(\s*|^)bz_private(\s*|$)/, '$2');
    }
  }

  /* The functions below expand and collapse comments  */

  function toggle_comment_display(link, comment_id) {
    var comment = document.getElementById('comment_text_' + comment_id);
    var re = new RegExp(/\bcollapsed\b/);
    if (comment.className.match(re))
        expand_comment(link, comment);
    else
        collapse_comment(link, comment);
  }

  function toggle_all_comments(action) {
    var num_comments = 7;

    // If for some given ID the comment doesn't exist, this doesn't mean
    // there are no more comments, but that the comment is private and
    // the user is not allowed to view it.

    for (var id = 0; id < num_comments; id++) {
        var comment = document.getElementById('comment_text_' + id);
        if (!comment)
            continue;

        var link = document.getElementById('comment_link_' + id);
        if (action == 'collapse')
            collapse_comment(link, comment);
        else
            expand_comment(link, comment);
    }
  }

  function collapse_comment(link, comment) {
    link.innerHTML = "[+]";
    link.title = "Expand the comment.";
    YAHOO.util.Dom.addClass(comment, 'collapsed');
  }

  function expand_comment(link, comment) {
    link.innerHTML = "[-]";
    link.title = "Collapse the comment";
    YAHOO.util.Dom.removeClass(comment, 'collapsed');
  }

  /* This way, we are sure that browsers which do not support JS
   * won't display this link  */

  function addCollapseLink(count) {
    document.write(' <a href="#" class="bz_collapse_comment"' +
                   ' id="comment_link_' + count +
                   '" onclick="toggle_comment_display(this, ' +  count +
                   '); return false;" title="Collapse the comment.">[-]<\/a> ');
  }
  //-->
  </script>








<div class="bz_comment bz_first_comment">

      <div class="bz_first_comment_head">



        <span class="bz_comment_number">
          <a name="c0" 
             href="show_bug.cgi?id=73#c0">Description</a>
        </span>

        <span class="bz_comment_user"><span class="vcard"><span class="fn">Thomas Berger</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2009-02-20 02:33:22 PST
        </span>
      </div>



<pre class="bz_comment_text" >Database statements breaks with the following error:

Slony-I: old key column product.pictureurl IS NULL on UPDATE

The columns are NO Key-Columns!

Statement: UPDATE product.product SET w3s_export_hash=:hash WHERE id=:id

Table:

                      Tabelle Â»product.productÂ«
         Spalte         |             Typ             |  Attribute
------------------------+-----------------------------+--------------
 id                     | bigint                      | not null
 name                   | character varying(300)      |
 manufacturer_id        | bigint                      |
 category_id            | bigint                      |
 clickcount             | bigint                      |
 offercount             | bigint                      |
 minprice               | real                        |
 maxprice               | real                        |
 url                    | character varying(300)      |
 pictureurl             | character varying(300)      |
 search_keys            | text                        |
 description            | text                        |
 user_rating            | integer                     | default (-1)
 cb_test_result         | integer                     |
 alias_id               | bigint                      |
 complete_solution_url  | character varying(300)      |
 complete_solution_date | date                        |
 ir_url                 | character varying(300)      |
 ir_beitrags_id         | bigint                      | default 0
 w3s_export_hash        | character varying(255)      |
 lastmodification       | timestamp without time zone |
 fazit_cb               | text                        |
 fazit_cbs              | text                        |
 fazit_avf              | text                        |
 cb_grade               | real                        | default (-1)
 cbs_grade              | real                        | default (-1)
 avf_grade              | real                        | default (-1)
 testfazit_positiv      | text                        |
 testfazit_negativ      | text                        |
 testartikel_url        | character varying(255)      |
 testartikel_datum      | timestamp without time zone |
 ir_import_hash         | character varying(32)       |
Indexe:
    Â»pk_productÂ« PRIMARY KEY, btree (id)
    Â»idx_ir_beitrags_idÂ« btree (ir_beitrags_id)
    Â»idx_product_alias_idÂ« btree (alias_id)
    Â»idx_product_category_idÂ« btree (category_id)
    Â»idx_product_empty_complete_solution_urlÂ« btree (complete_solution_url)
WHERE complete_solution_url IS NOT NULL AND complete_solution_url::text &lt;&gt;
''::text
    Â»idx_product_id_nameÂ« btree (id, name)
    Â»idx_product_id_name_ir_urlÂ« btree (id, name, ir_url)
    Â»idx_product_manufacturer_idÂ« btree (manufacturer_id)
    Â»idx_product_product_ir_urlÂ« btree (id, name, ir_url)
    Â»idx_product_user_ratingÂ« btree (user_rating)
Fremdschlüssel-Constraints:
    Â»fk_product_manufacturer_idÂ« FOREIGN KEY (manufacturer_id) REFERENCES
product.manufacturer(id)
    Â»fk_product_ref_133_categoryÂ« FOREIGN KEY (category_id) REFERENCES
product.category(id) ON UPDATE SET NULL ON DELETE SET NULL
Trigger:
    _cpdb_cluster_logtrigger AFTER INSERT OR DELETE OR UPDATE ON
product.product FOR EACH ROW EXECUTE PROCEDURE
_cpdb_cluster.logtrigger('_cpdb_cluster', '19', 'k')
Abgeschaltete Trigger:
    _cpdb_cluster_denyaccess BEFORE INSERT OR DELETE OR UPDATE ON
product.product FOR EACH ROW EXECUTE PROCEDURE
_cpdb_cluster.denyaccess('_cpdb_cluster')


Versions:
postgres@cbcpdb1:~$ slon -v
slon version 2.0.0

postgres@cbcpdb1:~$ psql --version
psql (PostgreSQL) 8.3.5</pre>
    </div>
  <div class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a name="c1" 
             href="show_bug.cgi?id=73#c1">Comment 1</a>
        </span>

        <span class="bz_comment_user"><span class="vcard"><span class="fn">Adam Buraczewski</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2009-02-20 03:32:46 PST
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to <a href="show_bug.cgi?id=73#c0">comment #0</a>)
<span class="quote">&gt; Database statements breaks with the following error:
&gt; 
&gt; Slony-I: old key column product.pictureurl IS NULL on UPDATE
&gt; 
&gt; The columns are NO Key-Columns!</span >

I think the source of this problem is the same as in the <span class="bz_closed"><a href="show_bug.cgi?id=67" title="RESOLVED FIXED - Array overrun in logtrigger()">bug #67</a></span> I described in
December. Slony-I 2.0.0 introduces a form of &quot;compression&quot; of attkind parameter
to _Slony_I_logTrigger() trigger function, but it is not properly handled
inside this function. As a result, the trigger randomly treats a non-key column
as a key column and expects it to be non-NULL. I prepared a patch and it is
attached to the <span class="bz_closed"><a href="show_bug.cgi?id=67" title="RESOLVED FIXED - Array overrun in logtrigger()">bug #67</a></span> (try it, please). The only problem with the patch is
that Christopher Browne wanted a sort of regression tests which would clearly
show this bug and I couldn't yet deliver such tests (I think it is quite
difficult and maybe you have just found a good example).

Best regards,
Adam Buraczewski</pre>
    </div>
  <div class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a name="c2" 
             href="show_bug.cgi?id=73#c2">Comment 2</a>
        </span>

        <span class="bz_comment_user"><span class="vcard"><span class="fn">Thomas Berger</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2009-02-20 03:36:04 PST
        </span>
      </div>



<pre class="bz_comment_text" >Hi, 

we had the same Problem with the &quot;old&quot; Slony Version,

so it is not a 2.0.0 bug.

Greetings
Thomas Berger</pre>
    </div>
  <div class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a name="c3" 
             href="show_bug.cgi?id=73#c3">Comment 3</a>
        </span>

        <span class="bz_comment_user"><span class="vcard"><span class="fn">Thomas Berger</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2009-02-20 03:38:35 PST
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to <a href="show_bug.cgi?id=73#c2">comment #2</a>)
<span class="quote">&gt; Hi, 
&gt; 
&gt; we had the same Problem with the &quot;old&quot; Slony Version,
&gt; 
&gt; so it is not a 2.0.0 bug.
&gt; 
&gt; Greetings
&gt; Thomas Berger
&gt; </span >
We will test the patch also of course!</pre>
    </div>
  <div class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a name="c4" 
             href="show_bug.cgi?id=73#c4">Comment 4</a>
        </span>

        <span class="bz_comment_user"><span class="vcard"><span class="fn">Thomas Berger</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2009-02-20 04:01:10 PST
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to <a href="show_bug.cgi?id=73#c1">comment #1</a>)
<span class="quote">&gt; (In reply to <a href="show_bug.cgi?id=73#c0">comment #0</a>)
&gt; &gt; Database statements breaks with the following error:
&gt; &gt; 
&gt; &gt; Slony-I: old key column product.pictureurl IS NULL on UPDATE
&gt; &gt; 
&gt; &gt; The columns are NO Key-Columns!
&gt; 
&gt; I think the source of this problem is the same as in the <span class="bz_closed"><a href="show_bug.cgi?id=67" title="RESOLVED FIXED - Array overrun in logtrigger()">bug #67</a></span> I described in
&gt; December. Slony-I 2.0.0 introduces a form of &quot;compression&quot; of attkind parameter
&gt; to _Slony_I_logTrigger() trigger function, but it is not properly handled
&gt; inside this function. As a result, the trigger randomly treats a non-key column
&gt; as a key column and expects it to be non-NULL. I prepared a patch and it is
&gt; attached to the <span class="bz_closed"><a href="show_bug.cgi?id=67" title="RESOLVED FIXED - Array overrun in logtrigger()">bug #67</a></span> (try it, please). The only problem with the patch is
&gt; that Christopher Browne wanted a sort of regression tests which would clearly
&gt; show this bug and I couldn't yet deliver such tests (I think it is quite
&gt; difficult and maybe you have just found a good example).
&gt; 
&gt; Best regards,
&gt; Adam Buraczewski
&gt; </span >
We have build in the patch. Now we have to look, if we have the problem again.
I will close this bug in one week, if the problem is fixed.

Thank you for your fast help until here =)

Greetings
Thomas Berger</pre>
    </div>
  <div class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a name="c5" 
             href="show_bug.cgi?id=73#c5">Comment 5</a>
        </span>

        <span class="bz_comment_user"><span class="vcard"><span class="fn">Adam Buraczewski</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2009-02-20 04:13:59 PST
        </span>
      </div>



<pre class="bz_comment_text" ><span class="quote">&gt; we had the same Problem with the &quot;old&quot; Slony Version,
&gt; so it is not a 2.0.0 bug.</span >

Well, the handling of the &quot;attkind&quot; parameter inside the logging trigger was
the same in older versions of Slony-I (the bug is quite old, it is simply
exposed in 2.0.0). The reason is simple: there is no checking for an end of
null-terminated string. Look at the output of \d on your table:

<span class="quote">&gt; Trigger:
&gt;     _cpdb_cluster_logtrigger AFTER INSERT OR DELETE OR UPDATE ON
&gt; product.product FOR EACH ROW EXECUTE PROCEDURE
&gt; _cpdb_cluster.logtrigger('_cpdb_cluster', '19', 'k')</span >

The last trigger parameter is 'k', while in Slony-I 1.2.x it was something like
'kvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv'. This is the &quot;attkind&quot; parameter. The
trigger function expects its length to be equal to the number of columns of the
table and iterates through it to find which columns are keys. However, it does
not check if the string is shorter than the number of columns (it does not
check for a byte 0 terminating the string at all). If the string is shorter, it
simply reads random garbage from the memory behind (this is a typical array
overrun bug) and when it encounters a 'k' byte among this garbage it treats a
random column as a key column and throws an error.

In Slony-I 1.2.x the problem was not exposed, since the length of this string
was usually as big as the number of columns of the table.  However, the bug
also existed and when someone added columns to the table without notifying
Slony (i.e. without doing it via slonik's EXECUTE SCRIPT command), the trigger
was not updated and the &quot;attkind&quot; string was shorter than the number of
columns. In that case the error message was the same. 

I noticed that when Christopher Browne added compression to &quot;attkind&quot;
parameter, he prepared a patch to the trigger function (very similar to mine),
but somehow this patch was not applied to Slony-I :(

Best regards,
Adam Buraczewski</pre>
    </div>
  <div class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a name="c6" 
             href="show_bug.cgi?id=73#c6">Comment 6</a>
        </span>

        <span class="bz_comment_user"><span class="vcard"><span class="fn">Adam Buraczewski</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2009-02-20 04:20:36 PST
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to <a href="show_bug.cgi?id=73#c4">comment #4</a>)
<span class="quote">&gt; We have build in the patch. Now we have to look, if we have the problem again.
&gt; I will close this bug in one week, if the problem is fixed.</span >

I think it would be better to mark this bug as a duplicate of <span class="bz_closed"><a href="show_bug.cgi?id=67" title="RESOLVED FIXED - Array overrun in logtrigger()">bug #67</a></span> instead,
which I just have done.

<span class="quote">&gt; Thank you for your fast help until here =)</span >
You're welcome :)

Best regards,
Adam Buraczewski


*** This bug has been marked as a duplicate of <span class="bz_closed"><a href="show_bug.cgi?id=67" title="RESOLVED FIXED - Array overrun in logtrigger()">bug 67</a></span> ***</pre>
    </div>
        </div>
        
      </td>
    </tr>
  </table>
</form>

<hr>
<ul class="related_actions">
    <li><a href="show_bug.cgi?format=multiple&amp;id=73">Format For Printing</a></li>
    <li>&nbsp;-&nbsp;<a href="show_bug.cgi?ctype=xml&amp;id=73">XML</a></li>
    <li>&nbsp;-&nbsp;<a href="enter_bug.cgi?cloned_bug_id=73">Clone This Bug</a></li>
    
    <li>&nbsp;-&nbsp;<a href="#">Top of page </a></li>
    </ul>        


<div class="navigation">
  
  
  <i><font color="#777777">First</font></i>
  <i><font color="#777777">Last</font></i>
  <i><font color="#777777">Prev</font></i>
  <i><font color="#777777">Next</font></i>
  &nbsp;&nbsp;
  <i><font color="#777777">No search results available</font></i>
</div>

<br>
</div>



<div id="footer">
  <div class="intro"></div>




<ul id="useful-links">
  <li id="links-actions"><ul class="links">
  <li><a href="./">Home</a></li>
  <li><span class="separator">| </span><a href="enter_bug.cgi">New</a></li>
  <li><span class="separator">| </span><a href="query.cgi">Search</a></li>

  <li class="form">
    <span class="separator">| </span>
    <form action="buglist.cgi" method="get"
        onsubmit="if (this.quicksearch.value == '')
                  { alert('Please enter one or more search terms first.');
                    return false; } return true;">
    <input class="txt" type="text" id="quicksearch_bottom" name="quicksearch">
    <input class="btn" type="submit" value="Find" id="find_bottom"></form></li>

  <li><span class="separator">| </span><a href="report.cgi">Reports</a></li>

  <li></li>


  <li>
        <span class="separator">| </span>
        <a href="docs/en/html/bug_page.html" target="_blank">Help</a>
      </li>
    
      <li id="new_account_container_bottom">
        <span class="separator">| </span>
        <a href="createaccount.cgi">New&nbsp;Account</a>
      </li>

    <li id="mini_login_container_bottom">
  <span class="separator">| </span>
  <a id="login_link_bottom" href="?GoAheadAndLogIn=1"
     onclick="return show_mini_login_form('_bottom')">Log In</a>
  <form action="http://www.slony.info/bugzilla/show_bug.cgi?id=73" method="POST" 
        class="mini_login bz_default_hidden"
        id="mini_login_bottom"
        onsubmit="return check_mini_login_fields( '_bottom' );"
  >
    <input id="Bugzilla_login_bottom" 
           class="bz_login"
           name="Bugzilla_login"
           onfocus="mini_login_on_focus('_bottom')"
    >
    <input class="bz_password" 
           id="Bugzilla_password_bottom" 
           name="Bugzilla_password"
           type="password"
    >
    <input class="bz_password bz_default_hidden bz_mini_login_help" type="text" 
           id="Bugzilla_password_dummy_bottom" value="password"
           onfocus="mini_login_on_focus('_bottom')"
    >
    <input type="submit" name="GoAheadAndLogIn" value="Log in" 
            id="log_in_bottom">
    <script type="text/javascript">
      mini_login_constants = {
          "login" : "login",
          "warning" : "You must set the login and password before logging in."
      };
      
      if (YAHOO.env.ua.gecko || YAHOO.env.ua.ie || YAHOO.env.ua.opera) {
          YAHOO.util.Event.onDOMReady(function() {
              init_mini_login_form('_bottom');
          });
      }
      else {
          YAHOO.util.Event.on(window, 'load', function () {
              window.setTimeout(function() {
                  init_mini_login_form('_bottom');
              }, 200);
          });
    }
    </script>
    <a href="#" onclick="return hide_mini_login_form('_bottom')">[x]</a>
  </form>
</li>
<li id="forgot_container_bottom">
  <span class="separator">| </span>
  <a id="forgot_link_bottom" href="?GoAheadAndLogIn=1#forgot"
     onclick="return show_forgot_form('_bottom')">Forgot Password</a>
  <form action="token.cgi" method="post" id="forgot_form_bottom"
        class="mini_forgot bz_default_hidden">
    <label>Login: <input type="text" name="loginname" size="20"></label>
    <input id="forgot_button_bottom" value="Reset Password" 
           type="submit">
    <input type="hidden" name="a" value="reqpw">
    <a href="#" onclick="return hide_forgot_form('_bottom')">[x]</a>
  </form>
</li>
</ul>
  </li>

  
    

  


  
</ul>

  <div class="outro"></div>
</div>

</body>
</html>